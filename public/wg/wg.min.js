let unsafeWindow=window,GM_info={};var httpRequest=new XMLHttpRequest;function GM_addStyle(e){try{var t=document.createElement("style");t.textContent=e,(document.head||document.body||document.documentElement||document).appendChild(t)}catch(e){console.log("GM_addStyle: "+e)}}function GM_setValue(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(e){console.log("GM_setValue: "+e)}}function GM_getValue(e,t){e=localStorage.getItem(e);if(!e)return t;try{return JSON.parse(e)}catch(e){return console.log("GM_getValue: "+e),t}}function GM_listValues(){var t=localStorage.length,o=[];for(let e=0;e<t;e++)"roles"!=localStorage.key(e)&&o.push(localStorage.key(e));return o}function GM_deleteValue(e){localStorage.removeItem(e)}function GM_setClipboard(e){var t=document.createElement("input");document.body.appendChild(t),t.value=e,t.focus(),t.select();try{document.execCommand("copy")}catch(e){console.log("GM_setClipboard: "+e.message)}t.blur(),document.body.removeChild(t)}function GM_export(){try{var t=GM_listValues(),o={};for(let e=0;e<t.length;e++)o[t[e]]=GM_getValue(t[e]);var e=JSON.stringify(o);console.log(e),android.myexport(e)}catch(e){console.log("GM_export: "+e.message)}}function GM_import(e){var t,o=e;for(t in o)GM_setValue(t,o[t])}httpRequest.open("GET","http://wsmud.ii74.com/S/version",!0),httpRequest.send(),httpRequest.onreadystatechange=function(){var e;4==httpRequest.readyState&&200==httpRequest.status&&(e=httpRequest.responseText,console.log(e),GM_info.script=JSON.parse(e))},GM_info.script={version:""},!function(){Array.prototype.baoremove=function(e){if(isNaN(e)||e>this.length)return!1;this.splice(e,1)},Array.prototype.remove=function(e){e=this.indexOf(e);-1<e&&this.splice(e,1)},String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"gm"),t)};var copyToClipboard=function(e){var t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("Copy"),t.parentNode.removeChild(t)};function dateFormat(e,t){var o,n,s={"Y+":t.getFullYear().toString(),"m+":(t.getMonth()+1).toString(),"d+":t.getDate().toString(),"H+":t.getHours().toString(),"M+":t.getMinutes().toString(),"S+":t.getSeconds().toString()};for(n in s)(o=new RegExp("("+n+")").exec(e))&&(e=e.replace(o[1],1==o[1].length?s[n]:s[n].padStart(o[1].length,"0")));return e}function AutoScroll(e){var t,o,n;e&&0!=$(e).length&&(t=$(e)[0].scrollTop)<(n=$(e)[0].scrollHeight)-(o=Math.ceil($(e).height()))&&(n=n-o<120?1:Math.ceil((n-o)/120),$(e)[0].scrollTop=t+n,setTimeout(function(){AutoScroll(e)},1e3/120))}function addWan(e,t,o,n){var e=getDigit(e);return 3<e?(5<=(e=e%8)&&(e=4),Math.round(t/Math.pow(10,e+o-n))/Math.pow(10,n)+"万"):Math.round(t/Math.pow(10,o-n))/Math.pow(10,n)}function getDigit(e){for(var t=-1;1<=e;)t++,e/=10;return t}function addChineseUnit(e,t){t=null==t?2:t;var o=Math.floor(e),n=getDigit(o),s=[];if(3<n){var i=Math.floor(n/8);if(1<=i){n=Math.round(o/Math.pow(10,8*i));s.push(addWan(n,e,8*i,t));for(var a=0;a<i;a++)s.push("亿");return s.join("")}return addWan(o,e,0,t)}return e}function getQueryVariable(e){for(var t=window.location.search.substring(1).split("&"),o=0;o<t.length;o++){var n=t[o].split("=");if(n[0]==e)return n[1]}return!1}var CanUse=!1,CanUse,_ws,ws,ws_on_message,cmd_queue,cmd_busy,echo,_send_cmd,send_cmd;function show_msg(e){ws_on_message({type:"text",data:e})}WebSocket?(console.log("插件可正常运行,Plugins can run normally"),CanUse=!0,_ws=WebSocket,unsafeWindow.WebSocket=function(e){ws=new _ws(e)},unsafeWindow.WebSocket.prototype={CONNECTING:_ws.CONNECTING,OPEN:_ws.OPEN,CLOSING:_ws.CLOSING,CLOSED:_ws.CLOSED,get url(){return ws.url},get protocol(){return ws.protocol},get readyState(){return ws.readyState},get bufferedAmount(){return ws.bufferedAmount},get extensions(){return ws.extensions},get binaryType(){return ws.binaryType},set binaryType(e){ws.binaryType=e},get onopen(){return ws.onopen},set onopen(e){ws.onopen=e},get onmessage(){return ws.onmessage},set onmessage(e){ws_on_message=e,ws.onmessage=WG.receive_message,unsafeWindow.funny&&null!=unsafeWindow.funny.API&&(unsafeWindow.funny.API.ws_on_message=e,unsafeWindow.funny.API.websocket=ws)},get onclose(){return ws.onclose},set onclose(t){ws.onclose=e=>{WG.online=!1,G.connected=!1,auto_relogin=GM_getValue(roleid+"_auto_relogin",auto_relogin),t(e),"开"==auto_relogin&&setTimeout(()=>{console.log(new Date),KEY.do_command("score")},1e4)}},get onerror(){return ws.onerror},set onerror(e){ws.onerror=e},send:function(t){if(null==G.cookie&&(G.cookie=t),-1<t.indexOf(G.id)&&!G.connected&&(t=G.cookie+" "+G.id),G.cmd_echo&&show_msg("<hiy>"+t+"</hiy>"),"$"==t[0])WG.SendCmd(t);else{if("@"==t[0]){if(unsafeWindow&&unsafeWindow.ToRaid)return void ToRaid.perform(t);messageAppend("插件未安装,请访问 https://greasyfork.org/zh-CN/scripts/375851-wsmud-raid 下载并安装"),window.open("https://greasyfork.org/zh-CN/scripts/375851-wsmud-raid ","_blank").location}var e;if(0==t.indexOf("drop"))e=(e=t.split(" "))[e.length-1],WG.getItemNameByid(e,function(e){0<=lock_list.indexOf(e)?messageAppend(`已锁物品${e}，无法丢弃，请解锁后重试`):ws.send(t)});else switch(0!=t.indexOf("jh ")&&0!=t.indexOf("go ")||"开"==auto_rewardgoto&&WG.Send("tm "+t),t){case"sm":T.sm();break;case"wk":WG.zdwk();break;case"backup":WG.make_config();break;case"load":WG.load_config();break;default:ws.send(t)}}},close:function(){ws.close()}},cmd_queue=[],cmd_busy=!1,echo=!1,_send_cmd=function(){if(ws&&1==ws.readyState)if(0<cmd_queue.length){cmd_busy=!0;for(var e=(new Date).getTime(),t=0;t<cmd_queue.length;t++)if(!cmd_queue[t].timestamp||cmd_queue[t].timestamp>=e-1300){cmd_queue.splice(0,t);break}for(t=0;t<Math.min(cmd_queue.length,5);t++)if(!cmd_queue[t].timestamp)try{ws.send(cmd_queue[t].cmd),cmd_queue[t].timestamp=e}catch(e){return cmd_busy=!1,void(cmd_queue=[])}cmd_queue[cmd_queue.length-1].timestamp?cmd_busy=!1:setTimeout(_send_cmd,100)}else cmd_busy=!1;else cmd_busy=!1,cmd_queue=[]},send_cmd=function(e,t){if(ws&&1==ws.readyState)if(e=e instanceof Array?e:e.split(";"),t)for(var o=0;o<e.length;o++)G.cmd_echo&&show_msg("<hiy>"+e[o]+"</hiy>"),ws.send(e[o]);else{for(o=0;o<e.length;o++)cmd_queue.push({cmd:e[o],timestamp:0});cmd_busy||_send_cmd()}}):console.log("插件不可运行,请打开'https://greasyfork.org/zh-CN/forum/discussion/41547/x'");var L={msg:function(t){let o=setInterval(()=>{var e;"undefined"!=typeof layer?(clearInterval(o),layer.msg(t,{offset:"50%",shift:5})):((e=document.createElement("script")).setAttribute("src","https://cdn.staticfile.org/layer/2.3/layer.js"),document.head.appendChild(e))},500)},isMobile:function(){var e=navigator.userAgent,t=!e.match(/(iPad).*OS\s([\d_]+)/)&&e.match(/(iPhone\sOS)\s([\d_]+)/),e=e.match(/(Android)\s+([\d.]+)/);return t||e}},roomItemSelectIndex=-1,timer=0,cnt=0,zb_npc,zb_place,next=0,roomData=[],packData=[],storeData=[],eqData=[],store_list=[],lock_list=[],needfind={"武当派-林间小径":["go south"],"峨眉派-走廊":["go north","go south;go south","go north;go east;go east"],"丐帮-暗道":["go east","go east;go east","go east"],"逍遥派-林间小道":["go west;go north","go south;go south","go north;go west"],"少林派-竹林":["go north"],"逍遥派-地下石室":["go up"],"逍遥派-木屋":["go south;go south;go south;go south"]},pgoods={},goods={"米饭":{id:null,type:"wht",sales:"店小二",place:"扬州城-醉仙楼"},"包子":{id:null,type:"wht",sales:"店小二",place:"扬州城-醉仙楼"},"鸡腿":{id:null,type:"wht",sales:"店小二",place:"扬州城-醉仙楼"},"面条":{id:null,type:"wht",sales:"店小二",place:"扬州城-醉仙楼"},"扬州炒饭":{id:null,type:"wht",sales:"店小二",place:"扬州城-醉仙楼"},"米酒":{id:null,type:"wht",sales:"店小二",place:"扬州城-醉仙楼"},"花雕酒":{id:null,type:"wht",sales:"店小二",place:"扬州城-醉仙楼"},"女儿红":{id:null,type:"wht",sales:"店小二",place:"扬州城-醉仙楼"},"醉仙酿":{id:null,type:"hig",sales:"店小二",place:"扬州城-醉仙楼"},"神仙醉":{id:null,type:"hiy",sales:"店小二",place:"扬州城-醉仙楼"},"布衣":{id:null,type:"wht",sales:"杂货铺老板 杨永福",place:"扬州城-杂货铺"},"钢刀":{id:null,type:"wht",sales:"杂货铺老板 杨永福",place:"扬州城-杂货铺"},"钢刀":{id:null,type:"wht",sales:"铁匠铺老板 铁匠",place:"扬州城-打铁铺"},"木棍":{id:null,type:"wht",sales:"杂货铺老板 杨永福",place:"扬州城-杂货铺"},"英雄巾":{id:null,type:"wht",sales:"杂货铺老板 杨永福",place:"扬州城-杂货铺"},"布鞋":{id:null,type:"wht",sales:"杂货铺老板 杨永福",place:"扬州城-杂货铺"},"铁戒指":{id:null,type:"wht",sales:"杂货铺老板 杨永福",place:"扬州城-杂货铺"},"簪子":{id:null,type:"wht",sales:"杂货铺老板 杨永福",place:"扬州城-杂货铺"},"长鞭":{id:null,type:"wht",sales:"杂货铺老板 杨永福",place:"扬州城-杂货铺"},"钓鱼竿":{id:null,type:"wht",sales:"杂货铺老板 杨永福",place:"扬州城-杂货铺"},"鱼饵":{id:null,type:"wht",sales:"杂货铺老板 杨永福",place:"扬州城-杂货铺"},"铁剑":{id:null,type:"wht",sales:"铁匠铺老板 铁匠",place:"扬州城-打铁铺"},"铁棍":{id:null,type:"wht",sales:"铁匠铺老板 铁匠",place:"扬州城-打铁铺"},"铁杖":{id:null,type:"wht",sales:"铁匠铺老板 铁匠",place:"扬州城-打铁铺"},"铁镐":{id:null,type:"wht",sales:"铁匠铺老板 铁匠",place:"扬州城-打铁铺"},"飞镖":{id:null,type:"wht",sales:"铁匠铺老板 铁匠",place:"扬州城-打铁铺"},"hig金创药":{id:null,type:"hig",sales:"药铺老板 平一指",place:"扬州城-药铺"},"hig引气丹":{id:null,type:"hig",sales:"药铺老板 平一指",place:"扬州城-药铺"}},equip={"铁镐":0},npcs={"店小二":0,"铁匠铺老板 铁匠":0,"药铺老板 平一指":0,"杂货铺老板 杨永福":0},place={"住房":"jh fam 0 start;go west;go west;go north;go enter","住房-卧室":"jh fam 0 start;go west;go west;go north;go enter;go north;store","住房-小花园":"jh fam 0 start;go west;go west;go north;go enter;go northeast","住房-炼药房":"jh fam 0 start;go west;go west;go north;go enter;go east","住房-练功房":"jh fam 0 start;go west;go west;go north;go enter;go west","扬州城-钱庄":"jh fam 0 start;go north;go west;store","扬州城-广场":"jh fam 0 start","扬州城-书院":"jh fam 0 start;go east;go north","扬州城-醉仙楼":"jh fam 0 start;go north;go north;go east","扬州城-杂货铺":"jh fam 0 start;go east;go south","扬州城-打铁铺":"jh fam 0 start;go east;go east;go south","扬州城-药铺":"jh fam 0 start;go east;go east;go north","扬州城-衙门正厅":"jh fam 0 start;go west;go north;go north","扬州城-镖局正厅":"jh fam 0 start;go west;go west;go south;go south","扬州城-矿山":"jh fam 0 start;go west;go west;go west;go west","扬州城-喜宴":"jh fam 0 start;go north;go north;go east;go up","扬州城-擂台":"jh fam 0 start;go west;go south","扬州城-当铺":"jh fam 0 start;go south;go east","扬州城-帮派":"jh fam 0 start;go south;go south;go east","扬州城-有间客栈":"jh fam 0 start;go north;go east","扬州城-赌场":"jh fam 0 start;go south;go west","帮会-大门":"jh fam 0 start;go south;go south;go east;go east","帮会-大院":"jh fam 0 start;go south;go south;go east;go east;go east","帮会-练功房":"jh fam 0 start;go south;go south;go east;go east;go east;go north","帮会-聚义堂":"jh fam 0 start;go south;go south;go east;go east;go east;go east","帮会-仓库":"jh fam 0 start;go south;go south;go east;go east;go east;go east;go north","帮会-炼药房":"jh fam 0 start;go south;go south;go east;go east;go east;go south","扬州城-扬州武馆":"jh fam 0 start;go south;go south;go west","扬州城-武庙":"jh fam 0 start;go north;go north;go west","武当派-广场":"jh fam 1 start;","武当派-三清殿":"jh fam 1 start;go north","武当派-石阶":"jh fam 1 start;go west","武当派-练功房":"jh fam 1 start;go west;go west","武当派-太子岩":"jh fam 1 start;go west;go northup","武当派-桃园小路":"jh fam 1 start;go west;go northup;go north","武当派-舍身崖":"jh fam 1 start;go west;go northup;go north;go east","武当派-南岩峰":"jh fam 1 start;go west;go northup;go north;go west","武当派-乌鸦岭":"jh fam 1 start;go west;go northup;go north;go west;go northup","武当派-五老峰":"jh fam 1 start;go west;go northup;go north;go west;go northup;go northup","武当派-虎头岩":"jh fam 1 start;go west;go northup;go north;go west;go northup;go northup;go northup","武当派-朝天宫":"jh fam 1 start;go west;go northup;go north;go west;go northup;go northup;go northup;go north","武当派-三天门":"jh fam 1 start;go west;go northup;go north;go west;go northup;go northup;go northup;go north;go north","武当派-紫金城":"jh fam 1 start;go west;go northup;go north;go west;go northup;go northup;go northup;go north;go north;go north","武当派-林间小径":"jh fam 1 start;go west;go northup;go north;go west;go northup;go northup;go northup;go north;go north;go north;go north;go north","武当派-后山小院":"jh fam 1 start;go west;go northup;go north;go west;go northup;go northup;go northup;go north;go north;go north;go north;go north;go north","少林派-广场":"jh fam 2 start;","少林派-山门殿":"jh fam 2 start;go north","少林派-东侧殿":"jh fam 2 start;go north;go east","少林派-西侧殿":"jh fam 2 start;go north;go west","少林派-天王殿":"jh fam 2 start;go north;go north","少林派-大雄宝殿":"jh fam 2 start;go north;go north;go northup","少林派-钟楼":"jh fam 2 start;go north;go north;go northeast","少林派-鼓楼":"jh fam 2 start;go north;go north;go northwest","少林派-后殿":"jh fam 2 start;go north;go north;go northwest;go northeast","少林派-练武场":"jh fam 2 start;go north;go north;go northwest;go northeast;go north","少林派-罗汉堂":"jh fam 2 start;go north;go north;go northwest;go northeast;go north;go east","少林派-般若堂":"jh fam 2 start;go north;go north;go northwest;go northeast;go north;go west","少林派-方丈楼":"jh fam 2 start;go north;go north;go northwest;go northeast;go north;go north","少林派-戒律院":"jh fam 2 start;go north;go north;go northwest;go northeast;go north;go north;go east","少林派-达摩院":"jh fam 2 start;go north;go north;go northwest;go northeast;go north;go north;go west","少林派-竹林":"jh fam 2 start;go north;go north;go northwest;go northeast;go north;go north;go north","少林派-藏经阁":"jh fam 2 start;go north;go north;go northwest;go northeast;go north;go north;go north;go west","少林派-达摩洞":"jh fam 2 start;go north;go north;go northwest;go northeast;go north;go north;go north;go north;go north","华山派-镇岳宫":"jh fam 3 start;","华山派-苍龙岭":"jh fam 3 start;go eastup","华山派-舍身崖":"jh fam 3 start;go eastup;go southup","华山派-峭壁":"jh fam 3 start;go eastup;go southup;jumpdown","华山派-山谷":"jh fam 3 start;go eastup;go southup;jumpdown;go southup","华山派-山间平地":"jh fam 3 start;go eastup;go southup;jumpdown;go southup;go south","华山派-林间小屋":"jh fam 3 start;go eastup;go southup;jumpdown;go southup;go south;go east","华山派-玉女峰":"jh fam 3 start;go westup","华山派-玉女祠":"jh fam 3 start;go westup;go west","华山派-练武场":"jh fam 3 start;go westup;go north","华山派-练功房":"jh fam 3 start;go westup;go north;go east","华山派-客厅":"jh fam 3 start;go westup;go north;go north","华山派-偏厅":"jh fam 3 start;go westup;go north;go north;go east","华山派-寝室":"jh fam 3 start;go westup;go north;go north;go north","华山派-玉女峰山路":"jh fam 3 start;go westup;go south","华山派-玉女峰小径":"jh fam 3 start;go westup;go south;go southup","华山派-思过崖":"jh fam 3 start;go westup;go south;go southup;go southup","华山派-山洞":"jh fam 3 start;go westup;go south;go southup;go southup;break bi;go enter","华山派-长空栈道":"jh fam 3 start;go westup;go south;go southup;go southup;break bi;go enter;go westup","华山派-落雁峰":"jh fam 3 start;go westup;go south;go southup;go southup;break bi;go enter;go westup;go westup","华山派-华山绝顶":"jh fam 3 start;go westup;go south;go southup;go southup;break bi;go enter;go westup;go westup;jumpup","峨眉派-金顶":"jh fam 4 start","峨眉派-庙门":"jh fam 4 start;go west","峨眉派-广场":"jh fam 4 start;go west;go south","峨眉派-走廊":"jh fam 4 start;go west;go south;go west","峨眉派-休息室":"jh fam 4 start;go west;go south;go east;go south","峨眉派-厨房":"jh fam 4 start;go west;go south;go east;go east","峨眉派-练功房":"jh fam 4 start;go west;go south;go west;go west","峨眉派-小屋":"jh fam 4 start;go west;go south;go west;go north;go north","峨眉派-清修洞":"jh fam 4 start;go west;go south;go west;go south;go south","峨眉派-大殿":"jh fam 4 start;go west;go south;go south","峨眉派-睹光台":"jh fam 4 start;go northup","峨眉派-华藏庵":"jh fam 4 start;go northup;go east","逍遥派-青草坪":"jh fam 5 start","逍遥派-林间小道":"jh fam 5 start;go east","逍遥派-练功房":"jh fam 5 start;go east;go north","逍遥派-木板路":"jh fam 5 start;go east;go south","逍遥派-工匠屋":"jh fam 5 start;go east;go south;go south","逍遥派-休息室":"jh fam 5 start;go west;go south","逍遥派-木屋":"jh fam 5 start;go north;go north","逍遥派-地下石室":"jh fam 5 start;go down;go down","丐帮-树洞内部":"jh fam 6 start","丐帮-树洞下":"jh fam 6 start;go down","丐帮-暗道":"jh fam 6 start;go down;go east","丐帮-破庙密室":"jh fam 6 start;go down;go east;go east;go east","丐帮-土地庙":"jh fam 6 start;go down;go east;go east;go east;go up","丐帮-林间小屋":"jh fam 6 start;go down;go east;go east;go east;go east;go east;go up","杀手楼-大门":"jh fam 7 start","杀手楼-大厅":"jh fam 7 start;go north","杀手楼-暗阁":"jh fam 7 start;go north;go up","杀手楼-铜楼":"jh fam 7 start;go north;go up;go up","杀手楼-休息室":"jh fam 7 start;go north;go up;go up;go east","杀手楼-银楼":"jh fam 7 start;go north;go up;go up;go up;go up","杀手楼-练功房":"jh fam 7 start;go north;go up;go up;go up;go up;go east","杀手楼-金楼":"jh fam 7 start;go north;go up;go up;go up;go up;go up;go up","杀手楼-书房":"jh fam 7 start;go north;go up;go up;go up;go up;go up;go up;go west","杀手楼-平台":"jh fam 7 start;go north;go up;go up;go up;go up;go up;go up;go up","襄阳城-广场":"jh fam 8 start","襄阳城-南城门":"jh fam 8 start;go south;go south;go south;go south","襄阳城-北城门":"jh fam 8 start;go north;go north;go north;go north;","襄阳城-西城门":"jh fam 8 start;go west;go west;go west;go west","襄阳城-东城门":"jh fam 8 start;go east;go eastgo east;go east","武道塔":"jh fam 9 start"},mpz_path={"武当派":"jh fam 1 start;go west;go northup;go north;go west;go northup;go northup;go northup;go north;go north;go north;go north;go north","华山派":"jh fam 3 start;go westup;go north","少林派":"jh fam 2 start;go north;go north;go northwest;go northeast;go north","峨眉派":"jh fam 4 start;go west;go south;go west;go south","逍遥派":"jh fam 5 start;go west;go east;go down","丐帮":"jh fam 6 start;go down;go east;go east;go east;go east;go east"},diff_colors={normal:"",access:"https://cdn.jsdelivr.net/gh/mapleobserver/wsmud-script/plugins/wsmud_color_accessibility.css",flat:"https://cdn.jsdelivr.net/gh/mapleobserver/wsmud-script/plugins/wsmud_color_flat.css"},fb_path=[],drop_list=[],fenjie_list=[],blacklist="",blackpfm=[],role,roleid,family=null,sm_loser="开",sm_price=null,sm_getstore=null,sm_any="开",wudao_pfm="",ks_pfm="2000",ks_wait="120",automarry=null,autoKsBoss=null,stopauto=!1,getitemShow=null,zmlshowsetting=0,bagFull=0,pushSwitch="关",pushType="0",pushToken="",auto_command=null,eqlist={},skilllist={},unauto_pfm="",auto_pfmswitch="开",auto_pfm_mode="开",auto_rewardgoto="关",busy_info="关",saveAddr="关",auto_updateStore="关",auto_relogin="关",autoeq="",zml=[],zdy_item_store="",zdy_item_store2="",zdy_item_lock="",zdy_item_drop="",zdy_item_fenjie="",ztjk_item=[],zdyskills="关",zdyskilllist="",welcome="",shieldswitch="开",shield="",shieldkey="",statehml="",backimageurl="",loginhml="",timequestion=[],silence="开",pfmnum=0,pfmdps=0,dpssakada="开",critical=0,criticalnum=0,dpslock=0,battletime=0,lastcri=0,lastpfm=0,funnycalc="关",inzdy_btn=!1,zdy_btnlist=[],auto_buylist="",auto_skillPaperSelllist="",color_select="normal",die_str="菜",exit1=void 0,exit2=void 0,exit3=void 0,KEY={keys:[],roomItemSelectIndex:-1,init:function(){$("span[command=stopstate] span:eq(0)").html("S"),$("span[command=showcombat] span:eq(0)").html("A"),$("span[command=showtool] span:eq(0)").html("C"),$("span[command=pack] span:eq(0)").html("B"),$("span[command=tasks] span:eq(0)").html("L"),$("span[command=score] span:eq(0)").html("O"),$("span[command=jh] span:eq(0)").html("J"),$("span[command=skills] span:eq(0)").html("K"),$("span[command=message] span:eq(0)").html("U"),$("span[command=shop] span:eq(0)").html("P"),$("span[command=stats] span:eq(0)").html("I"),$("span[command=setting] span:eq(0)").html(","),$(document).on("keydown",this.e),this.add(27,function(){KEY.dialog_close()}),this.add(192,function(){$(".map-icon").click()}),this.add(32,function(){KEY.dialog_confirm()}),this.add(83,function(){KEY.do_command("stopstate")}),this.add(13,function(){KEY.do_command("showchat")}),this.add(65,function(){KEY.do_command("showcombat")}),this.add(67,function(){KEY.do_command("showtool")}),this.add(66,function(){KEY.do_command("pack")}),this.add(76,function(){KEY.do_command("tasks")}),this.add(79,function(){KEY.do_command("score")}),this.add(74,function(){KEY.do_command("jh")}),this.add(75,function(){KEY.do_command("skills")}),this.add(73,function(){KEY.do_command("stats")}),this.add(85,function(){KEY.do_command("message")}),this.add(80,function(){KEY.do_command("shop")}),this.add(188,function(){KEY.do_command("setting")}),this.add(81,function(){inzdy_btn?WG.zdybtnfunc(0):WG.sm_button()}),this.add(87,function(){inzdy_btn?WG.zdybtnfunc(1):WG.go_yamen_task()}),this.add(69,function(){inzdy_btn?WG.zdybtnfunc(2):WG.kill_all()}),this.add(82,function(){inzdy_btn?WG.zdybtnfunc(3):WG.get_all()}),this.add(84,function(){inzdy_btn?WG.zdybtnfunc(4):WG.sell_all()}),this.add(89,function(){inzdy_btn?WG.zdybtnfunc(5):WG.zdwk()}),this.add(9,function(){return KEY.onRoomItemSelect(),!1}),this.add(102,function(){exit1=G.exits.get("east"),exit2=G.exits.get("eastup"),exit3=G.exits.get("eastdown"),exit1?WG.Send("go east"):exit2?WG.Send("go eastup"):exit3&&WG.Send("go eastdown"),KEY.onChangeRoom()}),this.add(39,function(){exit1=G.exits.get("east"),exit2=G.exits.get("eastup"),exit3=G.exits.get("eastdown"),exit1?WG.Send("go east"):exit2?WG.Send("go eastup"):exit3&&WG.Send("go eastdown"),KEY.onChangeRoom()}),this.add(100,function(){exit1=G.exits.get("west"),exit2=G.exits.get("westup"),exit3=G.exits.get("westdown"),exit1?WG.Send("go west"):exit2?WG.Send("go westup"):exit3&&WG.Send("go westdown"),KEY.onChangeRoom()}),this.add(37,function(){exit1=G.exits.get("west"),exit2=G.exits.get("westup"),exit3=G.exits.get("westdown"),exit1?WG.Send("go west"):exit2?WG.Send("go westup"):exit3&&WG.Send("go westdown"),KEY.onChangeRoom()}),this.add(98,function(){exit1=G.exits.get("south"),exit2=G.exits.get("southup"),exit3=G.exits.get("southdown"),exit1?WG.Send("go south"):exit2?WG.Send("go southup"):exit3&&WG.Send("go southdown"),KEY.onChangeRoom()}),this.add(40,function(){exit1=G.exits.get("south"),exit2=G.exits.get("southup"),exit3=G.exits.get("southdown"),exit1?WG.Send("go south"):exit2?WG.Send("go southup"):exit3&&WG.Send("go southdown"),KEY.onChangeRoom()}),this.add(101,function(){WG.Send("go down")}),this.add(613,function(){WG.Send("go up")}),this.add(104,function(){exit1=G.exits.get("north"),exit2=G.exits.get("northup"),exit3=G.exits.get("northdown"),exit1?WG.Send("go north"):exit2?WG.Send("go northup"):exit3&&WG.Send("go northdown"),KEY.onChangeRoom()}),this.add(38,function(){exit1=G.exits.get("north"),exit2=G.exits.get("northup"),exit3=G.exits.get("northdown"),exit1?WG.Send("go north"):exit2?WG.Send("go northup"):exit3&&WG.Send("go northdown"),KEY.onChangeRoom()}),this.add(99,function(){WG.Send("go southeast"),KEY.onChangeRoom()}),this.add(97,function(){WG.Send("go southwest"),KEY.onChangeRoom()}),this.add(105,function(){WG.Send("go northeast"),KEY.onChangeRoom()}),this.add(103,function(){WG.Send("go northwest"),KEY.onChangeRoom()}),this.add(49,function(){KEY.combat_commands(0)}),this.add(50,function(){KEY.combat_commands(1)}),this.add(51,function(){KEY.combat_commands(2)}),this.add(52,function(){KEY.combat_commands(3)}),this.add(53,function(){KEY.combat_commands(4)}),this.add(54,function(){KEY.combat_commands(5)}),this.add(55,function(){KEY.combat_commands(6)}),this.add(56,function(){KEY.combat_commands(7)}),this.add(57,function(){KEY.combat_commands(8)}),this.add(48,function(){KEY.combat_commands(9)}),this.add(45,function(){KEY.combat_commands(10)}),this.add(61,function(){KEY.combat_commands(11)}),this.add(561,function(){KEY.onRoomItemAction(0)}),this.add(562,function(){KEY.onRoomItemAction(1)}),this.add(563,function(){KEY.onRoomItemAction(2)}),this.add(564,function(){KEY.onRoomItemAction(3)}),this.add(565,function(){KEY.onRoomItemAction(4)}),this.add(566,function(){KEY.onRoomItemAction(5)}),this.add(1073,function(){KEY.room_commands(0)}),this.add(1074,function(){KEY.room_commands(1)}),this.add(1075,function(){KEY.room_commands(2)}),this.add(1076,function(){KEY.room_commands(3)}),this.add(1077,function(){KEY.room_commands(4)}),this.add(1078,function(){KEY.room_commands(5)})},add:function(e,t){this.keys.push({key:e,callback:t})},e:function(e){if($(".channel-box").is(":visible"))KEY.chatModeKeyEvent(e);else if(!($(".dialog-confirm").is(":visible")&&(48<=e.keyCode&&e.keyCode<=57||96<=e.keyCode&&e.keyCode<=105)||$("input").is(":focus")||$("textarea").is(":focus"))){var t,o=(e.ctrlKey||e.metaKey?1024:0)+(e.altKey?512:0)+e.keyCode;for(t of KEY.keys)if(t.key==o)return t.callback()}},isallow:!0,dialog_close:function(){$(".dialog-close").click()},dialog_confirm:function(){0<=$(".dialog-confirm").attr("style").indexOf("block")&&this.isallow&&(this.isallow=!1,$(".dialog-btn.btn-ok").click(),setTimeout(()=>{this.isallow=!0},500))},do_command:function(e){$("span[command="+e+"]").click()},room_commands:function(e){$("div.combat-panel div.room-commands span:eq("+e+")").click()},combat_commands:function(e){$("div.combat-panel div.combat-commands span.pfm-item:eq("+e+")").click()},chatModeKeyEvent:function(e){27==e.keyCode?KEY.dialog_close():13==e.keyCode&&($(".sender-box").val().length?$(".sender-btn").click():KEY.dialog_close())},onChangeRoom:function(){KEY.roomItemSelectIndex=-1},onRoomItemSelect:function(){-1!=KEY.roomItemSelectIndex&&$(".room_items div.room-item:eq("+KEY.roomItemSelectIndex+")").css("background","#000"),KEY.roomItemSelectIndex=(KEY.roomItemSelectIndex+1)%$(".room_items div.room-item").length;var e=$(".room_items div.room-item:eq("+KEY.roomItemSelectIndex+")");e.css("background","#444"),e.click()},onRoomItemAction:function(e){$(".room_items .item-commands span:eq("+e+")").click()}};function textBecomeImg(e,t,o){var n=document.createElement("canvas"),s=0,s=(t<=32?s=1:32<t&&t<=60?s=2:60<t&&t<=80?s=4:80<t&&t<=100?s=6:100<t&&(s=10),n.height=t+s,n.getContext("2d"));return s.clearRect(0,0,n.width,n.height),s.fillStyle=o,s.font=t+"px KaiTi",s.textBaseline="middle",s.fillText(e,0,t/2),n.width=s.measureText(e).width,s.fillStyle=o,s.font=t+"px KaiTi",s.textBaseline="middle",s.fillText(e,0,t/2),n.toDataURL("image/png")}function messageClear(){$(".WG_log pre").html("")}var log_line=0;function textShow(e){imgShow(textBecomeImg(e,90,"red"))}function imgShow(e,t=2e3){$(".container > .content-message").css("background","url("+e+") no-repeat center center"),setTimeout(()=>{$(".container > .content-message").css("background","")},t)}function messageAppend(e,t=0,o=0){var n;o?(n=e+"\n",1==t?n="<hiy>"+n+"</hiy>":2==t?n="<hig>"+n+"</hig>":3==t?n="<hiw>"+n+"</hiw>":4==t&&(n="<hir>"+n+"</hir>"),$(".content-message pre").append(n)):(100<log_line&&(log_line=0,$(".WG_log pre").empty()),n=e+"\n",1==t?n="<hiy>"+n+"</hiy>":2==t?n="<hig>"+n+"</hig>":3==t?n="<hiw>"+n+"</hiw>":4==t&&(n="<hir>"+n+"</hir>"),$(".WG_log pre").append(n),log_line++,$(".WG_log")[0].scrollTop=99999)}var sm_array={"武当":{place:"武当派-三清殿",npc:"武当派第二代弟子 武当首侠 宋远桥",sxplace:"武当派-太子岩",sx:"首席弟子"},"华山":{place:"华山派-镇岳宫",npc:"市井豪杰 高根明",sxplace:"华山派-练武场",sx:"首席弟子"},"少林":{place:"少林派-天王殿",npc:"少林寺第三十九代弟子 道觉禅师",sxplace:"少林派-练武场",sx:"大师兄"},"逍遥":{place:"逍遥派-青草坪",npc:"聪辩老人 苏星河",sxplace:"-jh fam 5 start;go west",sx:"首席弟子"},"丐帮":{place:"丐帮-树洞下",npc:"丐帮七袋弟子 左全",sxplace:"丐帮-破庙密室",sx:"首席弟子"},"峨眉":{place:"峨眉派-庙门",npc:"峨眉派第五代弟子 苏梦清",sxplace:"峨眉派-广场",sx:"大师姐"},"武馆":{place:"扬州城-扬州武馆",npc:"武馆教习",sxplace:"扬州城-扬州武馆"},"杀手楼":{place:"杀手楼-大厅",npc:"杀手教习 何小二",sxplace:"杀手楼-练功房",sx:"金牌杀手"}},WG={online:!1,sm_state:-1,sm_item:null,sm_store:null,init:function(){$("li[command=SelectRole]").on("click",function(){WG.login()})},inArray:function(t,o){for(let e=0;e<o.length;e++){var n=o[e];if("<"==n[0]){if(n==t)return!0}else if(""!=n&&0<=t.indexOf(n))return!0}return!1},hasStr:function(t,o){if(null==o.length){for(var e in o)for(var n of o[e])if(n==t)return!0}else for(let e=0;e<o.length;e++)if(o[e]==t)return!0;return!1},set_value(e,t){return GM_setValue(e,t)},get_value(e){return GM_getValue(e)},login:function(){role=$(".role-list .select").text().split(/[\s\n]/).pop(),roleid=$(".role-list .select").attr("roleid"),GM_listValues().map(function(e){var t;0==e.indexOf(role+"_")&&(t=e.split(role+"_")[1],console.log(t),GM_setValue(roleid+"_"+t,GM_getValue(e,null)),GM_deleteValue(e))}),$(".bottom-bar").append("<span class='item-commands' style='display:none'><span WG='WG' cmd=''></span></span>");var e=UI.wgui(),e=($(".content-message").after(e),$(".content-bottom").after("<div class='zdy-commands'></div>"),GM_addStyle(`.zdy-item{
                display: inline-block;border: solid 1px gray;color: gray;background-color: black;
                text-align: center;cursor: pointer;border-radius: 0.25em;min-width: 2.5em;margin-right: 0em;
                margin-left: 0.4em;position: relative;padding-left: 0.4em;padding-right: 0.4em;line-height: 24px;}
                .WG_log{flex: 1;overflow-y: auto;border: 1px solid #404000;max-height: 15em;width: calc(100% - 40px);}
                .WG_log > pre{margin: 0px; white-space: pre-line;}
                .WG_button { width: calc(100% - 40px); overflow-x: auto;display: block;line-height:2em;}
                .WG_button > .zdy-item:active {background-color: gray;color:black;}
                .item-plushp{display: inline-block;float: right;width: 100px;}
                .item-dps{display: inline-block;float: right;width: 100px;}
                .settingbox {margin-left: 0.625 em;border: 1px solid gray;background-color: transparent;color: unset;resize: none;width: 80% ;height: 3rem;}
                .runtest textarea{display:block;width:300px;height:160px;border:10px solid #F8F8F8;border-top-width:0;padding:10px;line-height:20px;overflow:auto;background-color:#3F3F3F;color:#eee;font-size:12px;font-family:Courier New}
                .layui-btn,.layui-input,.layui-select,.layui-textarea,.layui-upload-button{outline:0;-webkit-appearance:none;transition:all .3s;-webkit-transition:all .3s;box-sizing:border-box}
                .layui-btn{display:inline-block;height:38px;line-height:38px;padding:0 18px;background-color:#009688;color:#fff;white-space:nowrap;text-align:center;font-size:14px;border:none;border-radius:2px;cursor:pointer}
                .layui-btn-normal{background-color:#1E9FFF}
                .layui-layer-moves{background-color:transparent}
                .switch2 {display: inline-block;position: relative;height: 1.25em;width: 3.125em;line-height: 1.25em;
                border-radius: 0.875em;background: #dedede;cursor: pointer;-ms-user-select: none;-moz-user-select: none;
                -webkit-user-select: none;user-select: none;vertical-align: middle;text-align: center;}
                .switch2 > .switch-button {position: absolute;left: 0px;height: 1.25em;width: 1.25em;
                border-radius: 0.875em;background: #fff;box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
                transition: 0.3s;-webkit-transition: 0.3s;left: 0px;}
                .switch2 > .switch-text {color:#898989;margin-left: 0.625em;}
                .on>.switch-button {right:0px;left:auto;}
                .on>.switch-text {color:#ffffff;margin-right: 0.625em;    margin-left: 0px;}
                .on {background-color:#008000;}
                .crit{
                    height:24px;
                    position:relative;
                    animation:myfirst 1s;
                    -webkit-animation:myfirst 0.4s; /* Safari and Chrome */
                }
                    @keyframes myfirst
                {
                    0%   {background:red; left:0px; top:0px;}
                    33% {background:red; left:0px; top:-14px;}
                    66% {background:red; left:0px; top:14px;}
                    100% {background:red; left:0px; top:0px;}
                }

                @-webkit-keyframes myfirst /* Safari and Chrome */
                {
                    0%   {background:red; left:0px; top:0px;}
                    33% {background:red; left:0px; top:-30px;}
                    100% {background:red; left:0px; top:0px;}
                }
                .rainbow-text{
                    color:red;
                    background-image: repeating-linear-gradient(45deg, violet, indigo, blue, green, yellow, orange, red, violet);
                    background-size:800% 800%;
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                    animation: rainbow 8s ease infinite;
                    -webkit-animation: rainbow 8s ease infinite;
                }
                @keyframes rainbow
                {
                    0%{background-position:0% 50%}
                    50%{background-position:100% 25%}
                    100%{background-position:0% 50%}
                }`),npcs=GM_getValue("npcs",npcs),pgoods=GM_getValue("goods",goods),equip=GM_getValue(roleid+"_equip",equip),GI.configInit(),""!=backimageurl&&GM_addStyle(`body{background-color:rgb(0,0,0,.25)}
                div{ opacity:1;}
                html{background:rgba(255,255,255,0.25);
                background-image:url('${backimageurl}');
                background-repeat:no-repeat;
                background-size:100% 100%;
                -moz-background-size:100% 100%;} `),color_select=GM_getValue("color_select",color_select),document.createElement("link"));e.rel="stylesheet",e.type="text/css",e.href=diff_colors[color_select],document.getElementsByTagName("head")[0].appendChild(e),setTimeout(()=>{try{GM_registerMenuCommand&&(GM_registerMenuCommand("初始化",WG.update_id_all),GM_registerMenuCommand("设  置",WG.setting),GM_registerMenuCommand("调  试",WG.cmd_echo_button))}catch(e){}var e="";document.title=role+"-MUD游戏-武神传说",L.msg(`欢迎使用 ${welcome} 版本号`+GM_info.script.version),KEY.do_command("showtool"),KEY.do_command("pack"),KEY.do_command("score"),WG.SendCmd("score2"),WG.SendCmd("party load"),setTimeout(()=>{KEY.do_command("score");var t=role;G.level&&(t=G.level+role,G.isGod())&&$(".zdy-item.zdwk").html("修炼(Y)"),t=welcome+""+t,CanUse?("开"!=shieldswitch&&"开"!=silence||messageAppend("已注入屏蔽系统",0,1),0==npcs["店小二"]?e=`
                                <hiy>欢迎${t},插件已加载！第一次使用,请在设置中,初始化ID,并且设置一下是否自动婚宴,自动传送boss
                                插件版本: ${GM_info.script.version}
                                </hiy>`:$.get("https://wsmud.ii74.com/hello/"+role,e=>{messageAppend(`
                                <hiy>欢迎${t},插件已加载！
                                插件版本: ${GM_info.script.version}
                                更新日志: ${e}
                                </hiy>`)}),WG.ztjk_func(),WG.zml_showp(),WG.dsj_func(),setTimeout(()=>{WG.wsdelaytest()},1e3),G.level&&G.isGod()&&WG.ytjk_func()):e=`
                            <hiy>欢迎${role},插件未正常加载！
                            当前浏览器不支持自动喜宴自动boss,请使用centbrowser浏览器
                            谷歌系浏览器,请在network中勾选disable cache,多刷新几次,直至提示已加载!
                            多次刷新无法仍然出现本提示，请打开tampermonkey 插件设置
                            开启高级设置，在最下方实验 设置 “注入模式：即时”“严格模式：禁用”
                            实在不会用加群交流
                            插件版本: ${GM_info.script.version}
                            </hiy>`,messageAppend(e)},500),KEY.do_command("showcombat");"true"===localStorage.getItem("closeBorad")&&WG.showhideborad(),WG.runLoginhml(),setInterval(()=>{var e=new Date,e={data:JSON.stringify({type:"time",h:e.getHours(),m:e.getMinutes(),s:e.getSeconds(),time:e.toTimeString()})};WG.receive_message(e)},1e3)},1e3)},update_goods_id:function(){var e,t,o=$(".dialog-list > .obj-list:first");if(o.length){messageAppend("检测到商品清单");for(var n of o.children())e=(n=$(n)).attr("obj"),t=$(n.children()[0]).html(),n=n.children()[0].localName,"金创药"==t||"引气丹"==t?pgoods[n+t]?pgoods[n+t].id=e:pgoods[n+t]={id:e,type:n,sales:"药铺老板 平一指",place:"扬州城-药铺"}:pgoods[t].id=e,messageAppend(`<${n}>${t}</${n}>:`+e);return GM_setValue("goods",pgoods),!0}return messageAppend("未检测到商品清单"),!1},update_npc_id:function(){var e;for(e of $(".room_items .room-item"))0<=e.lastElementChild.innerText.indexOf("[")?null==e.lastElementChild.lastElementChild.lastElementChild.lastElementChild&&3==e.lastElementChild.firstChild.nodeType&&"SPAN"==e.lastElementChild.firstChild.nextSibling.tagName&&(npcs[e.lastElementChild.innerText.split("[")[0]]=$(e).attr("itemid"),messageAppend(e.lastElementChild.innerText.split("[")[0]+" 的ID:"+$(e).attr("itemid"))):null==e.lastElementChild.lastElementChild&&(npcs[e.lastElementChild.innerText]=$(e).attr("itemid"),messageAppend(e.lastElementChild.innerText+" 的ID:"+$(e).attr("itemid")));GM_setValue("npcs",npcs)},update_id_all:function(){GM_setValue("goods",goods),WG.SendCmd("stopstate");var t,o,n=[],s=(Object.keys(pgoods).forEach(function(e){null==n[pgoods[e].place]&&(n[pgoods[e].place]=pgoods[e].sales)}),Object.keys(n)),i=0,a=0,l=setInterval(()=>{switch(a){case 0:i>=s.length?(messageAppend("初始化完成"),WG.go("武当派-广场"),clearInterval(l)):(t=s[i],o=n[t],WG.go(t),a=1);break;case 1:WG.update_npc_id();var e=npcs[o];WG.Send("list "+e),a=2;break;case 2:WG.update_goods_id()?(a=0,i++):a=1}},1e3)},clean_id_all:function(e=!0){GM_setValue("goods",goods),pgoods=goods,e&&alert("清空完毕,请刷新一下页面")},update_store_hook:void 0,wsdelaytest:async function(){G.wsdelaySetTime=(new Date).getTime(),G.wsdelaySetCount=1,G.wsdelay=void 0,WG.SendCmd("test")},update_store:async function(){WG.update_store_hook=WG.add_hook(["dialog","text"],e=>{if("list"==e.dialog&&e.max_store_count){messageAppend("<hio>仓库信息获取</hio>开始");var t,o=e.stores;store_list=[];for(t of o)store_list.push(t.name.toLowerCase());zdy_item_store=store_list.join(","),$("#store_info").val(zdy_item_store),GM_setValue(roleid+"_zdy_item_store",zdy_item_store)}else"text"==e.type&&"没有这个玩家。"==e.msg&&(messageAppend("<hio>仓库信息获取</hio>完成"),$(".dialog-close").click(),WG.remove_hook(WG.update_store_hook),WG.update_store_hook=void 0)}),WG.SendCmd("$to 扬州城-广场;$to 扬州城-钱庄;look3 1")},clean_dps:function(){if(dpslock&&0!=battletime){let e=pfmnum+criticalnum,t=pfmdps+critical,o=((new Date).getTime()-battletime.getTime())/1e3,n=t/o,s=e/o;o<1&&(n=t,s=e),setTimeout(()=>{messageAppend(`⚔️战斗过程分析:
                    ⏱️战斗时长:${o}秒
                    ⚔️普通攻击:${pfmnum}次
                    ⚔️普通伤害:${addChineseUnit(pfmdps)}
                    🌟暴击攻击:${criticalnum}次
                    🌟暴击伤害:${addChineseUnit(critical)}
                    ⚔️总计攻击:${e}次
                    ⚔️总计伤害:${addChineseUnit(t)}
                    ⏱️每秒伤害:${addChineseUnit(n)}
                    ⏱️每秒攻击:${Math.round(s)}次`,4),dpslock=criticalnum=critical=pfmnum=pfmdps=0},100)}},Send:async function(e){if(CanUse)send_cmd(e,!0);else if(e)for(var t of e=e instanceof Array?e:e.split(";"))$("span[WG='WG']").attr("cmd",t).click()},SendStep:async function(e){if(e)for(var t of e=e instanceof Array?e:e.split(";"))WG.SendCmd(t),await WG.sleep(12e3)},SendCmd:async function(cmd){if(cmd){0<=cmd.indexOf(",")?cmd instanceof Array||(cmd=0<=cmd.indexOf(";")?cmd.split(";"):cmd.split(",")):cmd=cmd instanceof Array?cmd:cmd.split(";");let idx=0,cmds="";for(var c of cmd){if(0<=c.indexOf("$")){if("$"==c[0]){c=c.replace("$","");let p0=c.split(" ")[0],p1=c.split(" ")[1];return cmds=cmd.join(";"),void eval("T."+p0+"("+idx+",'"+p1+"','"+cmds+"')")}var p_c=c.split(" "),p_c=p_c[p_c.length-1];if(!p_c)return;if("$"==p_c[0]){p_c=p_c.replace("$","");let patt=new RegExp(/\".*?\"/),result=patt.exec(p_c)[0];return cmds=cmd.join(";"),void eval("T."+p_c.split("(")[0]+"("+idx+","+result+",'"+cmds+"')")}if(p_c=c.split(" "),0<=p_c[1].indexOf("$")){p_c=p_c[1].replace("$","");let patt=new RegExp(/\".*?\"/),result=patt.exec(p_c)[0];return cmds=cmd.join(";"),void eval("T."+p_c.split("(")[0]+"("+idx+","+result+",'"+cmds+"')")}}if(0<=c.indexOf("%")){var rep=c.match("%([^%]+)%");if(null!=npcs[rep[1]])var subStr=new RegExp("%([^%]+)%"),c=c.replace(subStr,npcs[rep[1]]);else for(var item of roomData)if(0!=item&&0<=item.name.indexOf(rep[1])){var subStr=new RegExp("%([^%]+)%");c=c.replace(subStr,item.id);break}}var rep,subStr;0<=c.indexOf("*")&&(rep=c.match("\\*([^%]+)\\*"),null!=pgoods[rep[1]])&&(subStr=new RegExp("\\*([^%]+)\\*"),c=c.replace(subStr,pgoods[rep[1]].id)),WG.Send(c),idx+=1}}},sleep:function(t){return new Promise(e=>setTimeout(e,t))},stopAllAuto:function(){stopauto=!0},reSetAllAuto:function(){stopauto=!1},go:async function(e){null==needfind[e="开"==saveAddr&&"扬州城-钱庄"==e?"住房-卧室":e]&&WG.at(e)||null!=place[e]&&(G.ingo=!0,await WG.SendCmd(place[e]),G.ingo=!1)},at:function(e){return"开"==saveAddr&&"扬州城-钱庄"==e&&(e="住房-卧室"),-1!=$(".room-name").html().indexOf(e)},getIdByName:function(t){for(let e=0;e<roomData.length;e++)if(roomData[e].name&&0<=roomData[e].name.indexOf(t))return roomData[e].id;return null},smhook:void 0,ythook:void 0,ungetStore:!1,kala_count:0,doSmTask:async function(c){return new Promise(async t=>{try{switch(c){case 0:WG.go(sm_array[family].place),WG.sm_state=1,2<WG.kala_count&&(WG.clean_id_all(!1),5<WG.kala_count)&&(WG.kala_count=0,WG.sm_state=0,$(".sm_button").text("师门(Q)"),messageAppend("错误:师门任务错误,脚本将重试")),t();break;case 1:var e,o=$(".room_items .room-item"),n=null;for(e of o)0<=e.lastElementChild.innerText.indexOf("[")?null==e.lastElementChild.lastElementChild.lastElementChild.lastElementChild&&3==e.lastElementChild.firstChild.nodeType&&"SPAN"==e.lastElementChild.firstChild.nextSibling.tagName&&e.lastElementChild.innerText.split("[")[0]==sm_array[family].npc&&(n=$(e).attr("itemid")):null==e.lastElementChild.lastElementChild&&e.lastElementChild.innerText==sm_array[family].npc&&(n=$(e).attr("itemid"));null!=n?(WG.Send("task sm "+n),WG.Send("task sm "+n),WG.sm_state=2):(WG.update_npc_id(),WG.clean_id_all(!1),WG.sm_state=0,WG.kala_count=WG.kala_count+1),t();break;case 2:var s=GM_getValue(roleid+"_sm_loser",sm_loser),i=(0==(l=$("span[cmd$='giveup']:last").parent().prev()).length&&(WG.sm_state=0,WG.kala_count=WG.kala_count+1),l.html()),a=l[0].localName,l=l[0].outerHTML;if(WG.ungetStore){if("开"==s){$("span[cmd$='giveup']:last").click(),messageAppend("放弃任务"),WG.ungetStore=!1,WG.sm_state=0,WG.kala_count=0,t();break}if("关"==s){WG.sm_state=-1,WG.kala_count=0,$(".sm_button").text("师门(Q)"),t();break}}var r=$("span[cmd$='giveup']:last").prev();for(let e=0;e<6;e++)if(r.children().html()){if(0<=r.html().indexOf(l))return r.click(),messageAppend("自动上交"+l),WG.sm_state=0,WG.kala_count=0,void t();r=r.prev()}if(WG.sm_item="金创药"==i||"引气丹"==i?pgoods[a+i]:pgoods[i],null!=l&&(WG.sm_itemx=l,WG.inArray(l,store_list))&&"开"==sm_getstore){if(!(0<=l.indexOf("hiz")||0<=l.indexOf("hio")))return messageAppend("自动仓库取"+l),WG.sm_store=l,WG.sm_state=4,void t();if("开"==(sm_any=GM_getValue(roleid+"_sm_any",sm_any)))return messageAppend("自动仓库取"+l),WG.sm_store=l,WG.sm_state=4,void t();if(window.confirm("您确定要交稀有物品吗"))return messageAppend("自动仓库取"+l),WG.sm_store=l,WG.sm_state=4,void t()}null!=WG.sm_item&&0<=l.indexOf(WG.sm_item.type)?(null==WG.smbuyNum?(WG.smbuyNum=0,WG.kala_count=WG.kala_count+1):3<WG.smbuyNum&&(WG.sm_state=5),WG.go(WG.sm_item.place),messageAppend("自动购买"+l),WG.sm_state=3):WG.sm_state=5,t();break;case 3:WG.go(WG.sm_item.place),WG.buy(WG.sm_item)&&((WG.sm_state=0)==WG.smbuyNum&&(WG.lastBuy=WG.sm_item),WG.lastBuy==WG.sm_item)&&(WG.smbuyNum=WG.smbuyNum+1),t();break;case 4:s=GM_getValue(roleid+"_sm_loser",sm_loser);WG.go("扬州城-钱庄"),WG.qu(WG.sm_store,e=>{e?WG.sm_state=0:(messageAppend("无法取"+WG.sm_store),null!=WG.sm_item&&0<=WG.sm_store.indexOf(WG.sm_item.type)?(WG.go(WG.sm_item.place),messageAppend("自动购买"+WG.sm_store),WG.sm_state=3):"开"==s?(WG.ungetStore=!0,WG.sm_state=0):WG.sm_state=5),t()});break;case 5:s=GM_getValue(roleid+"_sm_loser",sm_loser);if("开"==sm_price){var d,u=[{},{},{},{},{}],r=$("span[cmd$='giveup']:last").prev();for(let e=0;e<6;e++)r.children().html()&&-1==r.html().indexOf("放弃")&&0<=r.html().indexOf("令牌")&&(0<=r.html().indexOf("hig")&&(u[0]=r),0<=r.html().indexOf("hic")&&(u[1]=r),0<=r.html().indexOf("hiy")&&(u[2]=r),0<=r.html().indexOf("hiz")&&(u[3]=r),0<=r.html().indexOf("hio"))&&(u[4]=r),r=r.prev();let e=!1;for(d of u)if(null!=d.html)return d.click(),messageAppend("自动上交牌子"),WG.sm_state=0,WG.kala_count=0,e=!0,void t();if(!e)return messageAppend("没有牌子并且无法购买"),WG.smbuyNum=null,"开"==s?($("span[cmd$='giveup']:last").click(),messageAppend("放弃任务"),WG.sm_state=0,WG.kala_count=0):(WG.sm_state=-1,$(".sm_button").text("师门(Q)")),void t()}else messageAppend("无法提交"+WG.sm_itemx),WG.smbuyNum=null,"关"==s?(WG.sm_state=-1,$(".sm_button").text("师门(Q)")):"开"==s&&($("span[cmd$='giveup']:last").click(),messageAppend("放弃任务"),WG.sm_state=0,WG.kala_count=0);t()}}catch(e){console.error(e),t()}})},smTask:async function(){for(WG.smhook||(WG.smhook=WG.add_hook("text",function(e){(0<=e.msg.indexOf("辛苦了， 你先去休息")||0<=e.msg.indexOf("和本门毫无瓜葛")||0<=e.msg.indexOf("你没有"))&&(WG.Send("taskover signin"),WG.sm_state=-1,$(".sm_button").text("师门(Q)"),WG.remove_hook(WG.smhook),WG.smhook=void 0)}));-1!=WG.sm_state;)try{await WG.doSmTask(WG.sm_state),await WG.sleep(1e3)}catch(e){console.error(e);break}},sm_button:async function(){0<=WG.sm_state?(WG.sm_state=-1,$(".sm_button").text("师门(Q)")):(WG.sm_state=0,$(".sm_button").text("停止(Q)"),await WG.smTask())},buy:function(e){var t=npcs[e.sales];return null==t?(WG.update_npc_id(),!1):(WG.Send("list "+t),WG.Send("buy 1 "+e.id+" from "+t),!0)},qu_hook:void 0,qu:function(o,n){let s=!1;WG.qu_hook=WG.add_hook("dialog",async function(e){if(null!=e.dialog&null!=e.stores){for(var t of e.stores)if(-1!=t.name.toLocaleLowerCase().indexOf(o)){s=!0;t=t.id;WG.Send("qu 1 "+t);break}setTimeout(()=>{n(s)},300),WG.remove_hook(WG.qu_hook),WG.qu_hook=void 0}}),WG.SendCmd("store")},Give:function(e){var t=npcs["店小二"];return null==t?(WG.update_npc_id(),!1):(WG.Send("give "+t+" "+e),!0)},eq:function(e){WG.Send("eq "+equip[e])},ask:function(e,t){null!=(e=npcs[e])?WG.Send("ask"+t+" "+e):WG.update_npc_id()},yamen_lister:void 0,yamen_err_no:0,go_yamen_task:async function(){WG.yamen_lister||(WG.yamen_lister=WG.add_hook("text",function(e){0<=e.msg.indexOf("最近没有在逃的逃犯了，你先休息下吧。")?(clearInterval(WG.check_yamen_task),WG.check_yamen_task="over",WG.remove_hook(WG.yamen_lister),WG.yamen_lister=void 0,WG.yamen_err_no=0):0<=e.msg.indexOf("没有这个人")&&WG.update_npc_id()})),WG.go("扬州城-衙门正厅"),await WG.sleep(200),WG.update_npc_id(),WG.ask("扬州知府 程药发",1),"over"!=WG.check_yamen_task&&window.setTimeout(WG.check_yamen_task,1e3)},check_yamen_task:function(){if("over"!=WG.check_yamen_task){messageAppend("查找任务中");var t=$(".task-desc:eq(-2)").text();for(let e=3;e<10&&-1==t.indexOf("扬州知府");e++)t=$(".task-desc:eq(-"+e+")").text();if(0==t.length)KEY.do_command("tasks"),window.setTimeout(WG.check_yamen_task,1e3);else try{zb_npc=t.match("犯：([^%]+)，据")[1],zb_place=t.match("在([^%]+)出")[1],messageAppend("追捕任务："+zb_npc+"   地点："+zb_place),KEY.do_command("score"),WG.go(zb_place),window.setTimeout(WG.check_zb_npc,1e3)}catch(e){messageAppend("查找衙门追捕失败"),WG.yamen_err_no<4?(KEY.do_command("tasks"),window.setTimeout(WG.check_yamen_task,1e3),WG.yamen_err_no=WG.yamen_err_no+1):(clearInterval(WG.check_yamen_task),WG.remove_hook(WG.yamen_lister),WG.yamen_lister=void 0,WG.yamen_err_no=0)}}},zb_next:0,check_zb_npc:function(){var e,t=!1;for(e of $(".room_items .room-item"))if(-1!=e.innerText.indexOf(zb_npc))return t=!0,WG.Send("kill "+$(e).attr("itemid")),messageAppend("找到"+zb_npc+"，自动击杀！！！"),void(WG.zb_next=0);var o=needfind[zb_place];!t&&null!=needfind[zb_place]&&WG.zb_next<o.length&&(messageAppend("寻找附近"),WG.Send(o[WG.zb_next]),WG.zb_next++),t||window.setTimeout(WG.check_zb_npc,1e3)},kill_all:function(){var e;for(e of $(".room_items .room-item"))-1==$(e).html().indexOf("尸体")&&WG.Send("kill "+$(e).attr("itemid"))},get_all:function(){var e;for(e of $(".room_items .room-item"))WG.Send("get all from "+$(e).attr("itemid"))},clean_all:function(){WG.go("扬州城-打铁铺"),WG.Send("sell all")},sort_hook:void 0,sort_all:function(){var i,a=[];WG.sort_hook?(messageAppend("<hio>仓库排序</hio>运行中"),messageAppend("<hio>仓库排序</hio>手动结束"),WG.remove_hook(WG.sort_hook),WG.sort_hook=void 0):(i="",WG.sort_hook=WG.add_hook(["dialog","text"],e=>{if("dialog"==e.type&&"list"==e.dialog){if(null!=e.stores){var t,o,n=["wht","hig","hic","hiy","hiz","hio","red","hir","ord"];for(t of e.stores){let e=0;for(var s of n)0<=t.name.toLocaleLowerCase().indexOf(s)&&(a[e]?a[e].push(t):a[e]=[t]),e++}for(o of a)o&&(i+=function(e){var t,o,n=[];for(t of e)n.push("qu "+t.count+" "+t.id+";$wait 350;");for(o of e=e.sort(function(e,t){return e.name.length-t.name.length}))n.push("store "+o.count+" "+o.id+";$wait 350;");return n.join("")}(o));i+="look3 1",WG.SendCmd(i)}}else"text"==e.type&&"没有这个玩家。"==e.msg&&(messageAppend("<hio>仓库排序</hio>完成"),WG.remove_hook(WG.sort_hook),WG.sort_hook=void 0)}),messageAppend("<hio>仓库排序</hio>开始"),WG.at("扬州城-钱庄")?WG.Send("store"):WG.go("扬州城-钱庄"))},sort_all_bag:function(){var i,a=[];WG.sort_hook?(messageAppend("<hio>背包排序</hio>运行中"),messageAppend("<hio>背包排序</hio>手动结束"),WG.remove_hook(WG.sort_hook),WG.sort_hook=void 0):(i="",WG.sort_hook=WG.add_hook(["dialog","text"],e=>{if("dialog"==e.type&&"pack"==e.dialog){if(null!=e.items){var t,o,n=["wht","hig","hic","hiy","hiz","hio","red","hir","ord"];for(t of e.items){let e=0;for(var s of n)0<=t.name.toLocaleLowerCase().indexOf(s)&&(a[e]?a[e].push(t):a[e]=[t]),e++}for(o of a)o&&(i+=function(e){var t,o,n=[];for(t of e)n.push("store "+t.count+" "+t.id+";$wait 350;");for(o of e=e.sort(function(e,t){return e.name.length-t.name.length}))n.push("qu "+o.count+" "+o.id+";$wait 350;");return n.join("")}(o));i+="look3 1",WG.SendCmd(i)}}else"text"==e.type&&"没有这个玩家。"==e.msg&&(messageAppend("<hio>背包排序</hio>完成,执行后请刷新并重新登录"),WG.remove_hook(WG.sort_hook),WG.sort_hook=void 0)}),messageAppend("<hio>背包排序</hio>开始"),WG.at("扬州城-钱庄")?(WG.Send("pack"),KEY.dialog_close()):WG.go("扬州城-钱庄"))},packup_listener:null,packup_ready:!1,sell_all:function(i=1,a=1,l=1){if(WG.packup_listener)messageAppend("<hio>包裹整理</hio>运行中"),messageAppend("<hio>包裹整理</hio>手动结束"),WG.packup_ready=!1,WG.remove_hook(WG.packup_listener),WG.packup_listener=void 0;else{let s=[];WG.packup_listener=WG.add_hook(["dialog","text"],n=>{if("dialog"==n.type&&"list"==n.dialog){if(null!=n.stores&&!WG.packup_ready){s=[];for(let o=0;o<n.stores.length;o++){let t=null;for(let e=0;e<s.length;e++)if(s[e].name==n.stores[o].name.toLowerCase()){t=s[e];break}null!=t?t.count+=n.stores[o].count:s.push(n.stores[o])}}}else if("dialog"==n.type&&"pack"==n.dialog){let e=[];var t=[];if(null!=n.items&&!WG.packup_ready){for(var o=0;o<n.items.length;o++){if(0!=store_list.length&&WG.inArray(n.items[o].name.toLowerCase(),store_list)&&i)if(n.items[o].can_eq){let t=null;for(let e=0;e<s.length;e++)if(s[e].name==n.items[o].name.toLowerCase()){t=s[e];break}null!=t?t.count<4?(t.count+=n.items[o].count,e.push("store "+n.items[o].count+" "+n.items[o].id),e.push("$wait 350"),messageAppend("<hio>包裹整理</hio>"+n.items[o].name+"储存到仓库")):messageAppend("<hio>包裹整理</hio>"+n.items[o].name+"超过设置的储存上限"):(s.push(n.items[o]),e.push("store "+n.items[o].count+" "+n.items[o].id),e.push("$wait 350"),messageAppend("<hio>包裹整理</hio>"+n.items[o].name+"储存到仓库"))}else e.push("store "+n.items[o].count+" "+n.items[o].id),e.push("$wait 350"),messageAppend("<hio>包裹整理</hio>"+n.items[o].name+"储存到仓库");if(WG.inArray(n.items[o].name.toLowerCase(),drop_list)&&l&&(-1==n.items[o].name.indexOf("★")||-1==n.items[o].name.indexOf("☆"))){if(0<=lock_list.indexOf(n.items[o].name.toLowerCase()))continue;1==n.items[o].count?t.push("drop "+n.items[o].id):t.push("drop "+n.items[o].count+" "+n.items[o].id),t.push("$wait 350"),messageAppend("<hio>包裹整理</hio>"+n.items[o].name+"丢弃")}fenjie_list.length&&WG.inArray(n.items[o].name.toLowerCase(),fenjie_list)&&-1==n.items[o].name.indexOf("★")&&a&&(e.push("fenjie "+n.items[o].id),e.push("$wait 350"),messageAppend("<hio>包裹整理</hio>"+n.items[o].name+"分解"))}e.push("$wait 1000"),e.push("$to 扬州城-杂货铺"),e.push("sell all"),e.push("$wait 1000"),(e=e.concat(t)).push("look3 1"),(0<e.length||WG.packup_ready)&&(WG.SendCmd(e),WG.packup_ready=!0)}}else"text"==n.type&&"没有这个玩家。"==n.msg&&(messageAppend("<hio>包裹整理</hio>完成"),WG.packup_ready=!1,WG.remove_hook(WG.packup_listener),WG.packup_listener=void 0)}),messageAppend("<hio>包裹整理</hio>开始"),WG.go("扬州城-钱庄"),WG.Send("store;pack")}},cmd_echo_button:function(){G.cmd_echo?(G.cmd_echo=!1,messageAppend("<hio>命令代码关闭</hio>")):(G.cmd_echo=!0,ProConsole.init(),messageAppend("<hio>命令代码显示</hio>"))},getItemNameByid:(t,o)=>{packData.forEach(function(e){0!=e&&e.id==t&&o(e.name)})},addstore:e=>{GM_setValue(roleid+"_zdy_item_store2",zdy_item_store2=""==zdy_item_store2?e:zdy_item_store2+","+e),$("#store_info2").val(zdy_item_store2),zdy_item_store2&&(store_list=zdy_item_store2.split(",")),messageAppend("添加存仓成功"+e)},addlock:e=>{GM_setValue(roleid+"_zdy_item_lock",zdy_item_lock=""==zdy_item_lock?e:zdy_item_lock+","+e),$("#lock_info").val(zdy_item_lock),zdy_item_lock&&(lock_list=zdy_item_lock.split(",")),messageAppend("添加物品锁成功"+e)},dellock:e=>{lock_list.remove(e),zdy_item_lock=lock_list.join(","),GM_setValue(roleid+"_zdy_item_lock",zdy_item_lock),$("#lock_info").val(zdy_item_lock),messageAppend("解锁物品锁成功"+e)},addfenjieid:e=>{GM_setValue(roleid+"_zdy_item_fenjie",zdy_item_fenjie=""==zdy_item_fenjie?e:zdy_item_fenjie+","+e),zdy_item_fenjie&&(fenjie_list=zdy_item_fenjie.split(",")),messageAppend("添加分解成功"+e),$("#store_fenjie_info").val(zdy_item_fenjie)},adddrop:e=>{0<=e.indexOf("hio")||0<=e.indexOf("hir")||0<=e.indexOf("ord")?messageAppend("高级物品,不添加整理时丢弃"+e):(GM_setValue(roleid+"_zdy_item_drop",zdy_item_drop=""==zdy_item_drop?e:zdy_item_drop+","+e),zdy_item_drop&&(drop_list=zdy_item_drop.split(",")),messageAppend("添加丢弃成功"+e),$("#store_drop_info").val(zdy_item_drop))},addzxbuy:e=>{0<=e.indexOf("hio")||0<=e.indexOf("hir")||0<=e.indexOf("ord")?messageAppend("高级物品,不添加"+e):(GM_setValue(roleid+"_auto_skillPaperSelllist",auto_skillPaperSelllist=""==auto_skillPaperSelllist?e:auto_skillPaperSelllist+","+e),messageAppend("添加成功"+e),$("#autoSkillPaperSell").val(auto_skillPaperSelllist))},zdwk:async function(e,t=!0){if(t&&G.level&&G.isGod())WG.go("住房-练功房"),WG.Send("xiulian");else if(CanUse){if("remove"==e)G.wk_listener&&(WG.remove_hook(G.wk_listener),G.wk_listener=void 0);else if(!G.wk_listener){let i,t=!1;G.wk_listener=WG.add_hook(["dialog","text"],async function(o){if("dialog"==o.type&&"pack"==o.dialog){let t;if(o.name){if("<wht>铁镐</wht>"==o.name)return WG.Send("eq "+o.id),await WG.sleep(2e3),WG.go("扬州城-矿山"),WG.Send("wa"),void WG.zdwk("remove",!1)}else if(o.items){if(o.eqs[0]&&-1<o.eqs[0].name.indexOf("铁镐"))return await WG.sleep(1e3),WG.go("扬州城-矿山"),await WG.sleep(1e3),WG.Send("wa"),void WG.zdwk("remove",!1);for(let e=0;e<o.items.length;e++){var n=o.items[e];if(-1<n.name.indexOf("铁镐")){t=n.id;break}}if(t)return WG.Send("eq "+t),await WG.sleep(2e3),WG.go("扬州城-矿山"),WG.Send("wa"),void WG.zdwk("remove",!1);WG.go("扬州城-打铁铺"),WG.Send("look 1")}}var e;if("text"==o.type&&"你要看什么？"==o.msg?(e=WG.getIdByName("铁匠"))?(i=e,WG.Send("list "+e)):(messageAppend("<hio>自动挖矿</hio>未发现铁匠"),WG.zdwk("remove",!1)):"text"==o.type&&("你挥着铁镐开始认真挖矿。"==o.msg?WG.zdwk("remove"):("你现在正忙。"==o.msg||"你正在战斗，待会再说。"==o.msg||0<=o.msg.indexOf("不要急")||0<=o.msg.indexOf("这个方向没有出路"))&&0==t&&(t=!0,messageAppend("卡顿,五秒后再次尝试操作",0,1),setTimeout(()=>{t=!1,WG.zdwk("remove",!1),WG.zdwk()},5e3))),"dialog"==o.type&&"list"==o.dialog&&o.seller==i){let t;for(let e=0;e<o.selllist.length;e++){var s=o.selllist[e];if("<wht>铁镐</wht>"==s.name){t=s.id;break}}t?(WG.Send("buy 1 "+t+" from "+i),await WG.sleep(2e3)):(messageAppend("<hio>自动挖矿</hio>无法购买<wht>铁镐</wht>"),WG.zdwk("remove",!1))}}),WG.Send("stopstate;pack")}}else{t=$(".room_items .room-item:first .item-name").text();if(-1==(t=t.indexOf("<挖矿"))?(messageAppend("当前不在挖矿状态"),0==timer&&(console.log(timer),WG.go("扬州城-矿山"),WG.eq("铁镐"),WG.Send("wa"),timer=setInterval(WG.zdwk,5e3))):WG.timer_close(),WG.at("扬州城-矿山")&&-1==t)WG.go("扬州城-打铁铺"),WG.buy(pgoods["铁镐"]),messageAppend("自动买铁镐");else if(WG.at("扬州城-打铁铺")){var o,e=$(".dialog-list > .obj-list:eq(1)");if(e.length){messageAppend("查找铁镐ID");for(var n of e.children())if(o=(n=$(n)).attr("obj"),"铁镐"==$(n.children()[0]).html()){equip["铁镐"]=o,WG.eq("铁镐");break}GM_setValue(roleid+"_equip",equip),WG.go("扬州城-矿山"),WG.Send("wa")}}}},timer_close:function(){timer&&(clearInterval(timer),timer=0)},wudao_hook:void 0,wudao_auto:function(){var e;0==timer&&(timer=setInterval(WG.wudao_auto,1e3)),WG.at("武道塔")?-1!=(e=$(".room_items .room-item:last")).text().indexOf("守护者")?(WG.Send("kill "+e.attr("itemid")),WG.wudao_autopfm()):WG.Send("go up"):CanUse?(WG.wudao_hook||(WG.wudao_hook=WG.add_hook("dialog",e=>{var t;for(t of e.items)if("signin"==t.id){WG.go("武道塔");var o,n=new RegExp("进度([^%]+)，<"),n=t.desc.match(n)[1];null!=n?(messageAppend("爬塔 : "+n),o=n.indexOf("<"),n=n.substring(0,o).split("/"),o=-1!=t.desc.indexOf("武道塔可以重置"),n[0]==n[1]?(messageAppend("爬塔完成! "),o?(WG.ask("守门人",1),messageAppend("爬塔重置完成! "),WG.Send("go enter")):(messageAppend("爬塔已经重置过了!"),WG.timer_close())):(messageAppend("爬塔未完成!"),WG.Send("go enter"))):messageAppend("获取爬塔信息失败 : "+t.desc);break}WG.remove_hook(WG.wudao_hook),WG.wudao_hook=void 0})),WG.Send("tasks")):(WG.go("武道塔"),WG.ask("守门人",1),WG.Send("go enter"))},wudao_autopfm:function(){var e;for(e of wudao_pfm.split(","))"0px"==$("div.combat-panel div.combat-commands span.pfm-item:eq("+e+") span").css("left")&&$("div.combat-panel div.combat-commands span.pfm-item:eq("+e+") ").click()},xue_auto:function(){var e=-1!=(e=$(".room_items .room-item:first .item-name").text()).indexOf("<打坐")||-1!=e.indexOf("<学习")||-1!=e.indexOf("<练习");if(0==timer){if(0==e)return void messageAppend("当前不在打坐或学技能");timer=setInterval(WG.xue_auto,1e3)}0==e?(WG.timer_close(),WG.zdwk()):messageAppend("自动打坐学技能")},fbnum:0,needGrove:0,oncegrove:function(){this.fbnum+=1,messageAppend("第"+this.fbnum+"次"),WG.Send("cr yz/lw/shangu;cr over"),this.needGrove<=this.fbnum&&(WG.Send("taskover signin"),messageAppend("<hiy>"+this.fbnum+"次副本小树林秒进秒退已完成</hiy>"),WG.remove_hook(WG.daily_hook),WG.daily_hook=void 0,this.timer_close(),this.needGrove=0,this.fbnum=0)},grove_ask_info:function(){return prompt("请输入需要秒进秒退的副本次数","")},grove_auto:function(e=null){0==timer&&(this.needGrove=null==e?this.grove_ask_info():e,this.needGrove)&&("NaN"==parseFloat(this.needGrove).toString()?messageAppend("请输入数字"):(messageAppend("开始秒进秒退小树林"+this.needGrove+"次"),timer=setInterval(()=>{this.oncegrove()},1e3)))},showhideborad:function(){"none"==$(".WG_log").css("display")?(window.localStorage.setItem("closeBorad","false"),$(".WG_log").show()):(window.localStorage.setItem("closeBorad","true"),$(".WG_log").hide())},showhidebtn:function(){"none"==$(".WG_button").css("display")?(window.localStorage.setItem("closeBtn","false"),$(".WG_button").show()):(window.localStorage.setItem("closeBtn","true"),$(".WG_button").hide())},calc:function(){messageClear();messageAppend(UI.jsquivue),new Vue({el:".JsqVueUI",data:{status:1},methods:{qnjs_btn:function(){WG.qnjs()},lxjs_btn:function(){WG.lxjs()},khjs_btn:function(){WG.khjs()},zcjs_btn:function(){WG.zcjs()},getskilljson:function(){WG.getPlayerSkill()},autoAddLianxi:function(){var e=prompt("请输入修炼到多少级","1");null!=e&&("NaN"==parseFloat(e).toString()?messageAppend("请输入数字"):WG.selectLowKongfu(e))},onekeydaily:function(){WG.SendCmd("$daily")},onekeypk:function(){WG.auto_fight()},onekeysansan:function(){unsafeWindow&&unsafeWindow.ToRaid?ToRaid.perform(`//~silent
                        // 导入三三懒人包流程，方便后续导入操作
                        // 自命令类型选 Raidjs流程
                        // 四区白三三
                        ($f_ss)={"name":"三三懒人包","source":"https://cdn.jsdelivr.net/gh/mapleobserver/wsmud-script/三三懒人包.flow.txt","finder":"根文件夹"}
                        @js var time=Date.parse(new Date());var f=(f_ss);var n=f["name"];var s=f["source"];var fd=f["finder"];WorkflowConfig.removeWorkflow({"name":n,"type":"flow","finder":fd});$.get(s,{stamp:time},function(data,status){WorkflowConfig.createWorkflow(n,data,fd);});
                        @await 2000
                        tm 【三三懒人包】流程已导入，如果曾用早期版本的懒人包导入过流程，请先删除这些流程后再使用。`):messageAppend("请先安装Raid.js")},onelddh:function(){unsafeWindow&&unsafeWindow.ToRaid?ToRaid.perform(`//
                        ($f_ss)={"name":"来点动画","source":"http://ii74.oss-cn-qingdao.aliyuncs.com/gif.txt","finder":"根文件夹"}
                        @js var time=Date.parse(new Date());var f=(f_ss);var n=f["name"];var s=f["source"];var fd=f["finder"];WorkflowConfig.removeWorkflow({"name":n,"type":"flow","finder":fd});$.get(s,{stamp:time},function(data,status){WorkflowConfig.createWorkflow(n,data,fd);});
                        @awiat 2000
                        tm 来点动画已导入`):messageAppend("请先安装Raid.js")},onekeystore:function(){WG.SendCmd("$store")},onekeysell:function(){WG.SendCmd("$drop")},onekeyfenjie:function(){WG.SendCmd("$fenjie")},updatestore:function(){WG.update_store()},cleandps:function(){WG.clean_dps()},sortstore:function(){WG.sort_all()},sortbag:function(){WG.sort_all_bag()},dsrw:function(){WG.dsj()},zdybtnset:function(){WG.zdy_btnset()},cleankksboss:function(){GM_setValue(roleid+"_autoKsBoss",null),GM_setValue(roleid+"_automarry",null),L.msg("操作成功")},onekeydelaytest:function(){WG.wsdelaytest()},yuanshen:function(){window.location.href="https://ys.mihoyo.com/cloud/?utm_source=default#/"},onekeyyaota:function(){T.goyt()}}})},dsj_hook:void 0,dsj_func:function(){WG.dsj_hook&&WG.remove_hook(WG.dsj_hook),messageAppend("已注入定时任务",0,1),timequestion=GM_getValue(roleid+"_timequestion",timequestion),WG.dsj_hook=WG.add_hook("time",t=>{if("time"==t.type){let e=0;for(var o of timequestion)(o.h==t.h&&o.m==t.m&&o.s==t.s||""==o.h&&o.m==t.m&&o.s==t.s||""==o.h&&""==o.m&&o.s==t.s)&&(messageAppend("已触发计划"+o.name,1,0),WG.SendCmd(o.send),1==o.type)&&(messageAppend("一次性任务,已移除"+o.name,1,0),timequestion.baoremove(e),GM_setValue(roleid+"_timequestion",timequestion)),e+=1}})},dsj:function(){WG.dsj_func(),messageClear(),messageAppend(UI.timeoutui),$(".startQuest").off("click"),$(".removeQuest").off("click");for(let n of timequestion=GM_getValue(roleid+"_timequestion",timequestion)){var e=`<span class='addrun${n.name}'>编辑${n.name}</span>
                <span class='stoprun${n.name}'>删除${n.name}</span>
             <br/>
                `;$(".questlist").append(e),$(".addrun"+n.name).on("click",()=>{$("#questname").val(n.name),$("#rtype").val(n.type),$("#ht").val(n.h),$("#mt").val(n.m),$("#st").val(n.s),$("#zml_info").val(n.send)}),$(".stoprun"+n.name).on("click",()=>{var e,t=n.name;let o=0;for(e of timequestion)e.name==t&&timequestion.baoremove(o),o+=1;GM_setValue(roleid+"_timequestion",timequestion),WG.dsj()})}$(".startQuest").on("click",()=>{let e=$("#questname").val();var t,o=$("#rtype").val(),n=$("#ht").val(),s=$("#mt").val(),i=$("#st").val(),a=$("#zml_info").val(),l={name:e=e.replaceAll(" ","_"),type:o,send:a,h:n,m:s,s:i};let r=0;for(t of timequestion){if(e==t.name)return timequestion[r]=l,GM_setValue(roleid+"_timequestion",timequestion),void WG.dsj();r+=1}timequestion.push(l),GM_setValue(roleid+"_timequestion",timequestion),WG.dsj()}),$(".removeQuest").on("click",()=>{var e,t=$("#questname").val();let o=0;for(e of timequestion){if(e.name==t)return void timequestion.baoremove(o);o+=1}GM_setValue(roleid+"_timequestion",timequestion),WG.dsj()})},qnjs:function(){messageClear();messageAppend(UI.qnjsui),new Vue({el:".QianNengCalc",data:{qnsx:{m:0,c:0,color:0}},methods:{qnjscalc:function(){$.each(this.qnsx,(e,t)=>{this.qnsx[e]=Number(t)}),messageAppend("需要潜能:"+WG.dian(this.qnsx.c,this.qnsx.m,this.qnsx.color))}}})},lxjs:function(){messageClear();messageAppend(UI.lxjsui),new Vue({el:".StudyTimeCalc",data:{jsqsx:{xtwx:0,htwx:0,lxxl:0,clevel:0,mlevel:0,color:0}},created(){this.jsqsx.xtwx=G.score.int,this.jsqsx.htwx=G.score.int_add,this.jsqsx.lxxl=parseInt(G.score2.lianxi_per.replaceAll("%",""))},methods:{lxjscalc:function(){$.each(this.jsqsx,(e,t)=>{this.jsqsx[e]=Number(t)});var e=WG.lx(this.jsqsx.xtwx,this.jsqsx.htwx,this.jsqsx.lxxl,this.jsqsx.clevel,this.jsqsx.mlevel,this.jsqsx.color);messageAppend("需要潜能:"+e.qianneng+"     所需时间:"+e.time)}}})},khjs:function(){messageClear();messageAppend(UI.khjsui),new Vue({el:".KaihuaCalc",data:{khsx:{nl:0,xg:0,hg:0}},created(){this.khsx.nl=G.score.max_mp,this.khsx.xg=G.score.con,this.khsx.hg=G.score.con_add},methods:{khjscalc:function(){$.each(this.khsx,(e,t)=>{this.khsx[e]=Number(t)}),messageAppend("你的分值:"+WG.gen(this.khsx.nl,this.khsx.xg,this.khsx.hg))}}})},zcjs:function(){messageClear();messageAppend(UI.zcjsui),new Vue({el:".ZiChuangCalc",data:{zcsx:{level:0,percentage:0}},methods:{zcjscalc:function(){messageAppend("自创"+this.zcsx.level+"级,词条百分比:"+this.zcsx.percentage+" 需要词条等级:"+Math.ceil((this.zcsx.percentage-4-.0025*this.zcsx.level)/this.zcsx.level/25e-6))}}})},switchReversal:function(e){return e.hasClass("on")?"关":"开"},auto_preform_switch:function(){G.auto_preform?(G.auto_preform=!1,messageAppend("<hio>自动施法</hio>关闭"),WG.auto_preform("stop")):(G.auto_preform=!0,messageAppend("<hio>自动施法</hio>开启"),WG.auto_preform())},forcebufskil:"",bufskill:{},xubuf:null,pfmskill:null,is_free:function(){return!(WG.hasStr("faint",G.selfStatus)||WG.hasStr("busy",G.selfStatus)||WG.hasStr("rash",G.selfStatus)||WG.hasStr("bss",G.selfStatus))},is_zero_releasetime:function(){return 0<=G.score2.releasetime.indexOf("0秒")},auto_preform:function(e){if("stop"==e)G.selfStatus=[],WG.xubuf=null,WG.pfmskil=null,G.preform_timer&&(clearInterval(G.preform_timer),G.preform_timer=void 0,$(".auto_perform").css("background",""),WG.forcebufskil="",WG.bufskill={});else if(!G.preform_timer&&0!=G.auto_preform){var t;$(".auto_perform").css("background","#3E0000");for(t of(unauto_pfm=GM_getValue(roleid+"_unauto_pfm",unauto_pfm)).split(","))WG.hasStr(t,blackpfm)||blackpfm.push(t);if(WG.hasStr("force.tuoli",blackpfm)||blackpfm.push("force.tuoli"),G.auto_pfm_mode){let s=["force.cui","force.power","force.xi","force.xin","force.chu","force.ztd","force.zhen","force.busi","force.wang"],i={weapon:["sword.wu","blade.shi","sword.yu"],ztd:["force.ztd"],mingyu:["force.wang"],force:["*"],dodge:["dodge.power","dodge.fo","dodge.gui","dodge.lingbo","dodge.zhui"]};WG.xubuf=null,WG.pfmskill=null,G.preform_timer=setInterval(()=>{var n;0==G.in_fight?WG.auto_preform("stop"):(n=[],null==WG.xubuf&&(WG.xubuf=setTimeout(async()=>{for(var e of G.skills)if(!WG.hasStr(e.id,blackpfm)){for(var t in i)for(var o of i[t])if(o==e.id){if(!G.gcd&&!G.cds.get(e.id)&&!WG.hasStr(t,G.selfStatus)){for(WG.Send("perform "+e.id),await WG.sleep(200);!G.cds.get(e.id);){if(0==G.in_fight)return void WG.auto_preform("stop");if(!WG.is_free())break;WG.Send("perform "+e.id),await WG.sleep(200)}WG.hasStr(t,G.selfStatus)&&(console.log("buf技能"+e.id),WG.bufskill[t]=e.id)}break}if(WG.hasStr(e.id,s)&&!G.gcd&&!G.cds.get(e.id)&&!WG.hasStr("force",G.selfStatus)){for(WG.Send("perform "+e.id),await WG.sleep(200);!G.cds.get(e.id)&&!WG.hasStr("force",G.selfStatus);){if(0==G.in_fight)return void WG.auto_preform("stop");if(!WG.is_free())break;WG.Send("perform "+e.id),await WG.sleep(200)}WG.hasStr("force",G.selfStatus)&&(console.log("内功buf技能"+e.id),WG.forcebufskil=e.id),n.push(e.id)}}WG.xubuf=null},10)),null==WG.pfmskill&&(WG.pfmskill=setTimeout(async()=>{for(var e of G.skills)if(!WG.hasStr(e.id,blackpfm)){if(G.gcd)break;if(!(G.gcd||G.cds.get(e.id)||WG.hasStr(e.id,s)||WG.hasStr(e.id,i))){if(WG.Send("perform "+e.id),WG.is_zero_releasetime())break;if(await WG.sleep(20),!WG.is_free())break}if(""!=WG.forcebufskil&&!G.gcd&&!G.cds.get(e.id)&&WG.hasStr(e.id,s)&&e.id!=WG.forcebufskil&&!WG.hasStr(e.id,i.mingyu)&&!WG.hasStr(e.id,i.ztd)&&(console.log("使用无buf的内功技能"+e.id),WG.Send("perform "+e.id),!WG.is_free()))break}WG.pfmskill=null},10)))},300)}else G.preform_timer=setInterval(()=>{0==G.in_fight&&WG.auto_preform("stop");for(var e of G.skills)if(!WG.inArray(e.id,blackpfm)&&!G.gcd&&!G.cds.get(e.id)){WG.Send("perform "+e.id);break}},350)}},formatCurrencyTenThou:function(e){e=e.toString().replace(/\$|\,/g,"");var t=(e=isNaN(e)?"0":e)==(e=Math.abs(e));e=Math.floor(10*e+.50000000001),e=Math.floor(e/10).toString();for(var o=0;o<Math.floor((e.length-(1+o))/3);o++)e=e.substring(0,e.length-(4*o+3))+","+e.substring(e.length-(4*o+3));return(t?"":"-")+e},gen:function(e,t,o){return this.formatCurrencyTenThou(e/100+t*o/10)},dian:function(e,t,o){return this.formatCurrencyTenThou((e+t)*((t-e)/2)*o*5)},lx:function(e,t,o,n,s,i){s=2.5*(s*s-n*n)*i,n=s/(e+t)/(1+o/100-e/100)/12;return{qianneng:s,time:n<60?parseInt(n)+"分钟":`${parseInt(n/60)}小时${parseInt(n%60)}分钟`}},findboss:function(t,o,n){for(let e=0;e<t.items.length;e++)0!=t.items[e]&&0<=t.items[e].name.indexOf(o)&&n(t.items[e].id);n(-1)},ksboss:void 0,kksBoss:function(e){var t=e.content.match("出现在([^%]+)一带。")[1],o=e.content.match("听说([^%]+)出现在")[1];null!=o&&null!=t&&(blacklist=(blacklist=GM_getValue(roleid+"_blacklist",blacklist))instanceof Array?blacklist:blacklist.split(","),WG.inArray(o.replace("/<(.*?)>/g",""),blacklist)?messageAppend("黑名单boss,忽略!"):(autoKsBoss=GM_getValue(roleid+"_autoKsBoss",autoKsBoss),ks_pfm=GM_getValue(roleid+"_ks_pfm",ks_pfm),ks_wait=GM_getValue(roleid+"_ks_wait",ks_wait),autoeq=GM_getValue(roleid+"_auto_eq",autoeq),console.log("boss"),console.log(t),messageAppend("自动前往BOSS地点 <div class=\"item-commands\"><span id = 'closeauto'>关闭自动执行后命令</span></div>"),$("#closeauto").off("click"),$("#closeauto").on("click",()=>{0!=timer?(WG.timer_close(),messageAppend("已停止后命令")):messageAppend("已经停止")}),WG.Send("stopstate"),WG.go(t),WG.ksboss=WG.add_hook(["items","itemadd","die","room"],function(e){if("items"==e.type){if(!WG.at(t))return;WG.findboss(e,o,function(e){if(-1!=e)next=999,""!=autoeq&&WG.eqhelper(autoeq),setTimeout(()=>{WG.Send("kill "+e),next=0},Number(ks_pfm));else if(999==next)console.log("found");else{let e=needfind[t];null!=needfind[t]&&next<e.length?setTimeout(()=>{console.log(e[next]),WG.Send(e[next]),next++},1e3):console.log("not found")}})}"itemadd"==e.type&&0<=e.name.indexOf(o)&&(next=0,WG.Send("get all from "+e.id),WG.remove_hook(this.index)),"die"==e.type&&(next=0,WG.Send("relive"),WG.remove_hook(this.index)),"room"==e.type&&999==next&&(next=0)}),timer=setTimeout(()=>{console.log("复活挖矿"),WG.Send("relive"),WG.remove_hook(this.ksboss),(auto_command=GM_getValue(roleid+"_auto_command",auto_command))&&null!=auto_command&&""!=auto_command&&"null"!=auto_command?WG.SendCmd(auto_command):WG.zdwk(),next=0,WG.timer_close()},1e3*ks_wait)))},marryhy:void 0,xiyan:async function(){messageAppend("自动喜宴 <div class=\"item-commands\"><span id = 'closeauto'>关闭自动执行后命令</span></div>"),$("#closeauto").off("click"),$("#closeauto").on("click",()=>{0!=timer?(WG.timer_close(),messageAppend("已停止后命令")):messageAppend("已经停止")}),WG.Send("stopstate"),WG.go("扬州城-喜宴"),WG.marryhy=WG.add_hook(["items","cmds","text","msg"],function(t){if("items"==t.type){for(let e=0;e<t.items.length;e++)if(0!=t.items[e]&&0<=t.items[e].name.indexOf(">婚宴礼桌<")){console.log("拾取"),WG.Send("get all from "+t.items[e].id),console.log("xy"+WG.marryhy),WG.remove_hook(WG.marryhy);break}}else if("text"==t.type)"你要给谁东西？"==t.msg&&console.log("没人"),/^店小二拦住你说道：怎么又是你，每次都跑这么快，等下再进去。$/.test(t.msg)&&(console.log("cd"),messageAppend("<hiy>你太勤快了, 1秒后回去挖矿</hiy>")),/^店小二拦住你说道：这位(.+)，不好意思，婚宴宾客已经太多了。$/.test(t.msg)&&(console.log("客满"),messageAppend("<hiy>你来太晚了, 1秒后回去挖矿</hiy>"));else if("cmds"==t.type)for(let e=0;e<t.items.length;e++)if("1金贺礼"==t.items[e].name){WG.SendCmd(t.items[e].cmd+";go up;$wait 2000;go down;go up"),console.log("交钱");break}}),timer=setTimeout(()=>{console.log("挖矿"),WG.remove_hook(this.marryhy),auto_command&&null!=auto_command&&""!=auto_command&&"null"!=auto_command?WG.SendCmd(auto_command):WG.zdwk(),next=0,WG.timer_close()},3e4)},saveRoomstate(e){roomData=e.items},haspack:function(e,t){WG.Send("pack");for(var o of packData)if(0<=o.name.indexOf(e))return void t(o.id);t("")},eqx:null,eqxp:null,eqhelper(n,s=0,e=!1){function i(e){var t,o={};for(t in e)o[t]="object"==typeof e[t]?i(e[t]):e[t];return o}if(!(null==n||0==n||n>eqlist.length))if(null==eqlist||null==eqlist[n]||""==eqlist[n])1!=s&&(messageAppend("套装未保存,保存当前装备作为套装"+n+"!",1),WG.eqx=WG.add_hook("dialog",e=>{"pack"==e.dialog&&null!=e.eqs&&(eqlist[n]=i(e.eqs),GM_setValue(roleid+"_eqlist",eqlist),messageAppend("套装"+n+"保存成功!",1),WG.remove_hook(WG.eqx),WG.eqx=null)}),WG.eqxp=WG.add_hook("dialog",e=>{if("skills"==e.dialog&&null!=e.items){var t,o={throwing:"",unarmed:"",force:"",dodge:"",sword:"",blade:"",club:"",staff:"",whip:"",parry:""};for(t of e.items)null!=o[t.id]&&(null==t.enable_skill?o[t.id]="none":o[t.id]=t.enable_skill);skilllist[n]=o,GM_setValue(roleid+"_skilllist",skilllist),messageAppend("技能"+n+"保存成功!",1),WG.remove_hook(WG.eqxp),WG.eqxp=null}}),WG.Send("cha"),WG.Send("pack"));else if(null==WG.eqx&&null==WG.eqxp||(WG.remove_hook(WG.eqx),WG.remove_hook(WG.eqxp),WG.eqx=null,WG.eqxp=null),eqlist=GM_getValue(roleid+"_eqlist",eqlist),skilllist=GM_getValue(roleid+"_skilllist",skilllist),e){var t="";if(0==s){for(let e=1;e<11;e++)null!=eqlist[n][e]&&""!=eqlist[n][e]&&(t+="eq "+eqlist[n][e].id+";");t+="eq "+eqlist[n][0].id+";"}else for(var o in skilllist[n])null!=skilllist[n][o]&&""!=skilllist[n][o]&&(t+="enable "+o+" "+skilllist[n][o]+";");copyToClipboard(t),messageAppend(n+"已复制到剪贴板!",1)}else{var a,l="";let t="";for(a of G.eqs)a&&(t+=a.id);let o="套装";if(0===s){for(let e=1;e<11;e++)null!=eqlist[n][e]&&t.indexOf(eqlist[n][e].id)<0&&(l+="$wait 20;eq "+eqlist[n][e].id+";");null!=eqlist[n][0]&&t.indexOf(eqlist[n][0].id)<0&&(l+="$wait 40;eq "+eqlist[n][0].id+";")}if(1===s){for(var r in skilllist[n])for(var d of G.enable_skills)if(d.name!=skilllist[n][r]&&d.type==r){l+=`$wait 40;enable ${r} ${skilllist[n][r]};`;break}o="技能",$("span[command=skills]").click()}l+="$wait 40;cha;look3 1",WG.eqx=WG.add_hook("text",function(e){"text"==e.type&&0<=e.msg.indexOf("没有这个玩家")&&(messageAppend(o+"装备成功"+n+"!",1),1==s&&$("span[command=skills]").click(),WG.remove_hook(WG.eqx))}),WG.SendCmd(l)}},eqhelperdel:function(e){eqlist=GM_getValue(roleid+"_eqlist",eqlist),skilllist=GM_getValue(roleid+"_skilllist",skilllist),delete eqlist[e],delete skilllist[e],GM_setValue(roleid+"_eqlist",eqlist),GM_setValue(roleid+"_skilllist",skilllist),messageAppend("清除套装 技能"+e+"设置成功!",1)},uneqall:function(e="0"){if("0"==e)this.eqx=WG.add_hook("dialog",t=>{if("pack"==t.dialog&&null!=t.eqs){for(let e=0;e<t.eqs.length;e++)null!=t.eqs[e]&&WG.Send("uneq "+t.eqs[e].id);WG.remove_hook(this.eqx)}}),WG.Send("pack"),messageAppend("取消所有装备成功!",1);else{var t="enable unarmed none;enable blade none;enable force none;enable parry none;enable dodge none;enable sword none;enable throwing none;enable whip none;enable club none;enable staff none".split(";");for(let e=0;e<t.length;e++)WG.sleep(10),WG.Send(t[e]);messageAppend("取消所有技能成功!",1)}},eqloader:function(){var t=GM_getValue(roleid+"_eqlist",null),o={};for(let e in t)o[e]={name:"装备"+e,icon:"fa-compress",callback:function(){WG.eqhelper(e,0)}},o[e+"sk"]={name:"技能"+e,icon:"fa-magic",callback:function(){WG.eqhelper(e,1)}},o[e+"del"]={name:"删除组"+e,icon:"fa-remove",callback:function(){WG.eqhelperdel(e)}};o.setting={name:"套装管理",icon:"edit",callback:function(){WG.eqhelperui()}};var e=jQuery.Deferred();return setTimeout(function(){e.resolve(o)},20),e.promise()},eqhelperui:function(){messageClear(),messageAppend(UI.skillsPanel),new Vue({el:"#skillsPanelUI",data:{role:role,roleid:roleid,eqlist:{},cpeqlist:{},eqlistdel:{},covereqlist:{},eqskills_id:"none"},created(){},mounted(){this.eqlist=GM_getValue(this.roleid+"_eqlist",{})},methods:{eq:function(e){WG.eqhelper(e,0)},eqs:function(e){WG.eqhelper(e,1)},copyeq:function(e){WG.eqhelper(e,0,!0)},copyeqs:function(e){WG.eqhelper(e,1,!0)},save:function(e){WG.eqhelper(e),setTimeout(()=>{this.eqlist=GM_getValue(this.roleid+"_eqlist",{}),WG.eqhelperui()},300)},covereq:function(e){this.deleq(e),this.save(e)},deleq:function(e){WG.eqhelperdel(e),setTimeout(()=>{WG.eqhelperui()},200)},show:function(){WG.eqhelperui()},saveUI:function(){var o=this;layer.prompt({title:"请输入套装名...",formType:2},function(e,t){layer.close(t),null!=e&&o.save(e)})},eqskills_opts_change:function(e){switch(e){case"save":this.saveUI();break;case"copyeq":this.covereqlist={},this.eqlist={},this.eqlistdel={},this.cpeqlist=GM_getValue(this.roleid+"_eqlist",{}),this.role="<< 返回";break;case"delete":this.cpeqlist={},this.eqlist={},this.covereqlist={},this.eqlistdel=GM_getValue(this.roleid+"_eqlist",{}),this.role="<< 返回";break;case"covereq":this.cpeqlist={},this.eqlist={},this.eqlistdel={},this.covereqlist=GM_getValue(this.roleid+"_eqlist",{}),this.role="<< 返回";break;case"uneqall":WG.uneqall()}}}})},fight_listener:void 0,auto_fight:function(){if(WG.fight_listener)messageAppend("<hio>自动比试</hio>结束"),WG.remove_hook(WG.fight_listener),WG.fight_listener=void 0;else{var e=prompt('请输入NPC名称,例如:"高根明"');let o=WG.find_item(e);null!=o&&(WG.fight_listener=WG.add_hook(["text","sc","combat"],async function(e){var t;"combat"==e.type&&e.end?((t=G.items.get(G.id)).mp/t.max_mp<.8&&WG.SendCmd("dazuo"),WG.SendCmd("liaoshang")):"sc"==e.type&&e.id==o?(t=G.items.get(o)).hp>=t.max_hp&&WG.Send("stopstate;fight "+o):"sc"==e.type&&e.id==G.id?e.max_hp<=e.hp&&WG.Send("stopstate;fight "+o):"text"==e.type&&(0<=e.msg.indexOf("你先调整好自己的状态再来找别人比试吧")&&WG.SendCmd("liaoshang"),0<=e.msg.indexOf("你想趁人之危吗")&&WG.SendCmd("dazuo"),0<=e.msg.indexOf(">你疗伤完毕，深深吸了口气"))&&WG.Send("stopstate;fight "+o)}),WG.Send("stopstate;fight "+o),messageAppend("<hio>自动比试</hio>开始"))}},find_item:function(e){for(var[t,o]of G.items)if(o.name==e)return t;return null},recover:function(n,s,i,a){0==n?WG.recover_timer&&(clearTimeout(WG.recover_timer),WG.recover_timer=void 0):(WG.Send("dazuo"),WG.recover_timer=setInterval(function(){var e=G.items.get(G.id);if(e.mp/e.max_mp<s)"打坐"!=e.state&&WG.Send("stopstate;dazuo");else if(e.hp/e.max_hp<n)"疗伤"!=e.state&&WG.Send("stopstate;liaoshang");else{if(e.state&&WG.Send("stopstate"),i)for(var[t,o]of G.cds)if("force.tu"!=t&&o)return;clearInterval(WG.recover_timer),a()}},1e3))},useitem_hook:void 0,auto_useitem:async function(){var t=!0,e=(WG.useitem_hook||(WG.useitem_hook=WG.add_hook("text",function(e){(0<=e.msg.indexOf("你身上没有这个东西")||0<=e.msg.indexOf("太多")||0<=e.msg.indexOf("不能使用"))&&(t=!1,WG.remove_hook(WG.useitem_hook),WG.useitem_hook=void 0)})),prompt("请输入物品id,在背包中点击查看物品,即可在提示窗口看到物品id输出"));if(e){var o=prompt('请输入物品使用次数,例如:"10"',"10");if(e){if(11!=e.length)return L.msg("id不合法"),WG.remove_hook(WG.useitem_hook),void(WG.useitem_hook=void 0);for(var n=0;n<o;n++){if(!t)return WG.remove_hook(WG.useitem_hook),void(WG.useitem_hook=void 0);WG.Send("use "+e),await WG.sleep(1e3)}}}WG.remove_hook(WG.useitem_hook),WG.useitem_hook=void 0},auto_Development_medicine:function(){messageClear();messageAppend(UI.lyui),new Vue({el:"#LianYao",data:{level:0,num:1,info:""},created(){this.info=GM_getValue("lastmed",$("#medicint_info").val()),this.level=GM_getValue("lastmedlevel",$("#medicine_level").val())},methods:{startDev:function(){WG.at("住房-炼药房")||WG.at("帮会-炼药房")?WG.auto_start_dev_med(this.info.replace(" ",""),this.level,this.num):L.msg("请先前往炼药房")},stopDev:function(){WG.Send("stopstate")}}})},findMedItems_hook:void 0,auto_start_dev_med:function(e,_,k){if(GM_setValue("lastmed",e),GM_setValue("lastmedlevel",_),e)if(e.split(",").length<2)L.msg("素材不足");else{var t,e=e.split("|"),y=[];for(t of e)t=t.replace(/(^\s*)|(\s*$)/g,""),y.push(t.split(","));WG.findMedItems_hook=WG.add_hook("dialog",function(t){if("pack"==t.dialog&&null!=t.items&&0<=t.items.length){var o,n,s=[],i=[];for(o of y){var a,l=[],r=[];for(a of o)if(0<=JSON.stringify(t.items).indexOf(a))for(var d of t.items)0<=d.name.indexOf(a)&&(l.push(d.id),r.push(a));i.push(r),s.push(l)}let e=0;for(n of s){if(n.length!=y[e].length){for(var u=[],c=[],m=0;m<i[e].length;m++)u[i[e][m]]=typeof i[e][m];for(m=0;m<y[e].length;m++){var p=typeof y[e][m];(!u[y[e][m]]||u[y[e][m]].indexOf(p)<0)&&c.push(y[e][m])}var g,f=[];for(g of new Set(c))f.push(g);return L.msg("素材不足,请检查背包是否存在"+f.join(".")),WG.remove_hook(WG.findMedItems_hook),void(WG.findMedItems_hook=null)}e+=1}var h=WG.make_med_cmd(s,_,k);console.log(h),WG.SendStep(h),WG.remove_hook(WG.findMedItems_hook)}}),WG.Send("pack")}else L.msg("素材不足")},make_med_cmd:function(e,t,o){let n="";for(var s of e)for(let e=0;e<parseInt(o);e++){var i,a="lianyao2 start "+t+";";for(i of s)n+=a+"lianyao2 add "+i+";";n+="lianyao2 stop;"}return n+"$syso 炼制完成;"},zmlfire:async function(zml){zml&&(messageAppend("运行"+zml.name,2),0==zml.zmlType||""==zml.zmlType||null==zml.zmlType?await WG.SendCmd(zml.zmlRun):1==zml.zmlType?unsafeWindow&&unsafeWindow.ToRaid&&ToRaid.perform(zml.zmlRun):2==zml.zmlType&&eval(zml.zmlRun))},zmlztjk:function(){zml=GM_getValue(roleid+"_zml",zml),!1 instanceof Array&&(zml=[]),messageClear();messageAppend(UI.zmlandztjkui),new Vue({el:"#zmlandztjk",data:{},created(){this.zmldata=zml},methods:{run:function(e){WG.zmlfire(e)},zml:function(){WG.zml_edit()},ztjk:function(){WG.ztjk_edit()},startjk:function(){WG.ztjk_func()},stopjk:function(){WG.ztjk_hook?(WG.remove_hook(WG.ztjk_hook),WG.ztjk_hook=void 0,messageAppend("已取消注入",2)):messageAppend("未注入",2)}}})},zml_edit:function(){zml=GM_getValue(roleid+"_zml",zml),!1 instanceof Array&&(zml=[]),messageClear();messageAppend(UI.zmlsetting),new Vue({el:"#zmldialog",data:{singnalzml:{name:"",zmlType:"0",zmlRun:""},zmldata:zml},created(){this.zmldata=zml},methods:{add:function(){var e,t={name:this.singnalzml.name,zmlRun:this.singnalzml.zmlRun,zmlShow:0,zmlType:this.singnalzml.zmlType};let o=!0;for(e of this.zmldata)e.name==t.name&&(t.zmlShow=e.zmlShow,e=t,o=!1);o&&this.zmldata.push(t),GM_setValue(roleid+"_zml",this.zmldata),L.msg("保存成功")},del:function(){this.zmldata.forEach((e,t)=>{e.name==this.singnalzml.name&&(this.zmldata.baoremove(t),GM_setValue(roleid+"_zml",this.zmldata),L.msg("删除成功"))})},getShare:function(){var e=prompt("请输入分享码");S.getShareJson(e,e=>{e=JSON.parse(e.json);null!=e.zmlRun?this.singnalzml=e:L.msg("不合法")})},edit:function(e){this.singnalzml=e},showp:function(e){zmlshowsetting=GM_getValue(roleid+"_zmlshowsetting",zmlshowsetting);let t=$(".room-commands");for(var o of(t=1==zmlshowsetting?$(".zdy-commands"):t).children())if(o.textContent==e.name)return o.remove(),e.zmlShow=0,GM_setValue(roleid+"_zml",zml),void messageAppend("删除快速使用"+e.name,1);t.append('<span class="zdy-item act-item-zdy act-item">'+e.name+"</span>"),e.zmlShow=1,GM_setValue(roleid+"_zml",zml),messageAppend("设置快速使用"+e.name,0,1),$(".act-item-zdy").off("click"),$(".act-item-zdy").on("click",function(){T.usezml(0,this.textContent,"")})},share:function(e){S.shareJson(G.id,e)}}})},isseted:!1,zml_showp:function(){$(".zdy-commands").empty(),$(".act-item-zdy").remove(),zmlshowsetting=GM_getValue(roleid+"_zmlshowsetting",zmlshowsetting);for(var t of zml){let e=$(".room-commands");if(1==zmlshowsetting){for(var o of e.children())o.textContent==t.name&&o.remove();if(e=$(".zdy-commands"),!WG.isseted){let e=$(".tool-bar.right-bar").css("bottom");e.replace("px",""),e=parseInt(e),e+=24,$(".tool-bar.right-bar").css("bottom",e+"px"),WG.isseted=!0}}else for(var n of $(".zdy-commands").children())n.textContent==t.name&&n.remove();1==t.zmlShow&&(e.append('<span class="zdy-item act-item-zdy act-item">'+t.name+"</span>"),messageAppend("设置快速使用"+t.name,0,1),$(".act-item-zdy").off("click"),$(".act-item-zdy").on("click",function(){T.usezml(0,this.textContent,"")}))}},ztjk_edit:function(){ztjk_item=GM_getValue(roleid+"_ztjk",ztjk_item),messageClear(),messageAppend(UI.ztjksetting),$(".ztjk_sharedfind").on("click",()=>{var e=prompt("请输入分享码");S.getShareJson(e,e=>{e=JSON.parse(e.json);null!=e.type?($("#ztjk_name").val(e.name),$("#ztjk_type").val(e.type),$("#ztjk_action").val(e.action),$("#ztjk_keyword").val(e.keyword),$("#ztjk_ishave").val(e.ishave),$("#ztjk_send").val(e.send),$("#ztjk_senduser").val(e.senduser),$("#ztjk_maxcount").val(e.maxcount),$("#ztjk_istip").val(e.istip)):L.msg("不合法")})}),$(".ztjk_editadd").on("click",function(){var o={name:$("#ztjk_name").val(),type:$("#ztjk_type").val(),action:$("#ztjk_action").val(),keyword:$("#ztjk_keyword").val(),ishave:$("#ztjk_ishave").val(),send:$("#ztjk_send").val(),senduser:$("#ztjk_senduser").val(),isactive:1,maxcount:$("#ztjk_maxcount").val(),istip:$("#ztjk_istip").val()};let n=!0;ztjk_item.forEach(function(e,t){e.name==$("#ztjk_name").val()&&(ztjk_item[t]=o,n=!1)}),n&&ztjk_item.push(o),GM_setValue(roleid+"_ztjk",ztjk_item),WG.ztjk_edit(),messageAppend("保存成功",2),WG.ztjk_func()}),$(".ztjk_editdel").on("click",function(){let o=$("#ztjk_name").val();ztjk_item.forEach(function(e,t){e.name==o&&(ztjk_item.baoremove(t),GM_setValue(roleid+"_ztjk",ztjk_item),WG.ztjk_edit(),messageAppend("删除成功",2),WG.ztjk_func())})}),ztjk_item.forEach(function(e,t){var o="<span class='addrun"+t+"'>编辑"+e.name+"</span>",o=($("#ztjk_show").append(o),"注入"),o="<span class='setaction"+t+"'>"+(o=e.isactive&&1==e.isactive?"暂停":o)+e.name+"</span>",o=($("#ztjk_set").append(o),"<span class='shareztjk"+t+"'>分享"+e.name+"</span>");$("#ztjk_show").append(o)}),ztjk_item.forEach(function(e,t){$(".addrun"+t).on("click",function(){$("#ztjk_name").val(e.name),$("#ztjk_type").val(e.type),$("#ztjk_action").val(e.action),$("#ztjk_keyword").val(e.keyword),$("#ztjk_ishave").val(e.ishave),$("#ztjk_send").val(e.send),$("#ztjk_senduser").val(e.senduser),$("#ztjk_maxcount").val(e.maxcount),null==e.istip&&$("#ztjk_istip").val(1),$("#ztjk_istip").val(e.istip)}),$(".setaction"+t).on("click",function(){0<=this.textContent.indexOf("暂停")?ztjk_item[t].isactive=0:ztjk_item[t].isactive=1,GM_setValue(roleid+"_ztjk",ztjk_item),WG.ztjk_func(),WG.ztjk_edit()}),$(".shareztjk"+t).on("click",function(){S.shareJson(G.id,e)})})},ytjk_func:function(){WG.add_hook("room",async function(e){G.yaotaFlag&&"zc/mu/shishenta"!=e.path&&($(".channel pre").append("<hig>【插件】第 "+G.yaotaCount+" 次妖塔共获得 "+G.yaoyuan+" 点妖元，结束时间: "+dateFormat("YYYY-mm-dd HH:MM",new Date)+"。<br><hig>"),$(".tm").append("<hig>【插件】第 "+G.yaotaCount+" 次妖塔共获得 "+G.yaoyuan+" 点妖元，结束时间: "+dateFormat("YYYY-mm-dd HH:MM",new Date)+"。<br><hig>"),setTimeout(async function(){for(;!WG.is_free();)await WG.sleep(1e3);261==G.yaoyuan?WG.SendCmd("tm 第 "+G.yaotaCount+" 次妖塔圆满完成，撒花~~~~~"):WG.SendCmd("tm 第 "+G.yaotaCount+" 次妖塔遗憾收场，撒花~~~~~"),$("#yt_prog").remove(),G.yaotaFlag=!1,G.yaoyuan=0},0)),"zc/mu/shishenta"==e.path&&($(".state-bar").before("<div id=yt_prog>开始攻略妖塔</div>"),G.yaotaCount=G.yaotaCount+1,$(".channel pre").append("<hig>【插件】开始第 "+G.yaotaCount+" 次攻略妖塔，现在时间是:"+dateFormat("YYYY-mm-dd HH:MM",new Date)+"。<br><hig>"),$(".tm").append("<hig>【插件】开始第 "+G.yaotaCount+" 次攻略妖塔，现在时间是:"+dateFormat("YYYY-mm-dd HH:MM",new Date)+"。<br><hig>"),G.yaoyuan=0,G.yaotaFlag=!0)})},ztjk_hook:void 0,ztjk_func:function(){WG.ztjk_hook&&WG.remove_hook(WG.ztjk_hook),WG.ztjk_hook=void 0,ztjk_item=GM_getValue(roleid+"_ztjk",ztjk_item),WG.ztjk_hook=WG.add_hook(["dispfm","enapfm","dialog","room","itemadd","itemremove","status","text","msg","die","combat","sc"],function(v){ztjk_item.forEach(function(t,e){if(1==t.isactive&&v.type==t.type){var o,n,s,i,a,l,r,d,u,c,m,p,g,f,h,_=t.keyword.split("|");switch(t.type){case"status":if(v.name){if(t.action==v.action)for(var k of _)(0<=v.sid.indexOf(k)||0<=v.name.indexOf(k))&&("0"==t.ishave&&v.id!=G.id?("0"!=t.istip&&messageAppend("已触发"+t.name,1),v.id?(o=t.send.replace("{id}",v.id),WG.SendCmd(o)):WG.SendCmd(t.send)):"1"==t.ishave&&v.id==G.id&&(null!=v.count&&t.maxcount?parseInt(v.count)<parseInt(t.maxcount)&&(messageAppend("当前层数"+v.count+",已触发"+t.name,1),v.id?(o=t.send.replace("{id}",v.id),WG.SendCmd(o)):WG.SendCmd(t.send)):("0"!=t.istip&&messageAppend("已触发"+t.name,1),v.id?(n=t.send.replace("{id}",v.id),WG.SendCmd(n)):WG.SendCmd(t.send))))}else if(t.action==v.action)for(var k of _)0<=v.sid.indexOf(k)&&("0"==t.ishave&&v.id!=G.id?("1"==t.istip&&messageAppend("已触发"+t.name,1),v.id?(s=t.send.replace("{id}",v.id),WG.SendCmd(s)):WG.SendCmd(t.send)):"1"==t.ishave&&v.id==G.id&&(null!=v.count&&t.maxcount?parseInt(v.count)<parseInt(t.maxcount)&&("0"!=t.istip&&messageAppend("已触发"+t.name,1),v.id?(s=t.send.replace("{id}",v.id),WG.SendCmd(s)):WG.SendCmd(t.send)):("0"!=t.istip&&messageAppend("已触发"+t.name,1),v.id?(i=t.send.replace("{id}",v.id),WG.SendCmd(i)):WG.SendCmd(t.send))));break;case"text":for(var k of _)0<=v.msg.indexOf(k)&&("0"!=t.istip&&messageAppend("已触发"+t.name,1),v.msg?(a=t.send.replace("{content}",v.msg.replaceAll("\n","").replaceAll(",","").replaceAll(";","")),WG.SendCmd(a)):WG.SendCmd(t.send));break;case"msg":if(t.senduser&&""!=t.senduser&&null!=t.senduser){for(l of t.senduser.split("|"))if(v.name==l)for(var k of _)0<=v.content.indexOf(k)&&("0"!=t.istip&&messageAppend("已触发"+t.name,1),v.content?(r=t.send.replace("{content}",v.content),WG.SendCmd(r)):WG.SendCmd(t.send));else if("谣言"==l&&"rumor"==v.ch||"系统"==l&&"sys"==v.ch||"门派"==l&&"fam"==v.ch||"帮派"==l&&"pty"==v.ch)for(var k of _)0<=v.content.indexOf(k)&&("0"!=t.istip&&messageAppend("已触发"+t.name,1),v.content?(d=t.send.replace("{content}",v.content),WG.SendCmd(d)):WG.SendCmd(t.send))}else for(var k of _)0<=v.content.indexOf(k)&&("0"!=t.istip&&messageAppend("已触发"+t.name,1),v.content?(u=t.send.replace("{content}",v.content.replaceAll("\n","").replaceAll(",","").replaceAll(";","")),WG.SendCmd(u)):WG.SendCmd(t.send));break;case"die":null!=v.commands&&("0"!=t.istip&&messageAppend("已触发"+t.name,1),WG.SendCmd(t.send));break;case"itemadd":for(var k of _)if(0<=v.name.indexOf(k)){if(2==t.ishave&&null!=v.p)break;"0"!=t.istip&&messageAppend("已触发"+t.name,1),v.id?(c=t.send.replace("{id}",v.id),WG.SendCmd(c)):WG.SendCmd(t.send)}break;case"room":for(var k of _){if(0<=v.name.indexOf(k))return"0"!=t.istip&&messageAppend("已触发"+t.name,1),m=t.send.replace("{name}",v.name),void WG.SendCmd(m);for(p of roomData){if(0==p)return;if(0<=p.name.indexOf(k)&&null==p.p)return"0"!=t.istip&&messageAppend("已触发"+t.name,1),g=t.send.replace("{name}",v.name),void WG.SendCmd(g)}}break;case"dialog":if(v.dialog&&"pack"==v.dialog)for(var k of _)v.name&&0<=v.name.indexOf(k)&&("0"!=t.istip&&messageAppend("已触发"+t.name,1),f=t.send.replace("{id}",v.id),WG.SendCmd(f));break;case"combat":for(var k of _)("start"==k&&1==v.start||"end"==k&&1==v.end)&&("0"!=t.istip&&messageAppend("已触发"+t.name,1),WG.SendCmd(t.send));break;case"sc":let e=G.items.get(G.id);"0"==t.ishave&&(h=WG.find_item(t.senduser),e=G.items.get(h)),e&&e.hp&&e.hp/e.max_hp*100<parseInt(_[0])&&("0"!=t.istip&&messageAppend("已触发"+t.name,1),WG.SendCmd(t.send)),e&&e.mp&&e.mp/e.max_mp*100<parseInt(_[1])&&("0"!=t.istip&&messageAppend("已触发"+t.name,1),WG.SendCmd(t.send));break;case"enapfm":for(var y of _)y==v.id&&("0"!=t.istip&&messageAppend("已触发"+t.name,1),WG.SendCmd(t.send));break;case"dispfm":for(var w of _)w==v.id&&("0"!=t.istip&&messageAppend("已触发"+t.name,1),WG.SendCmd(t.send))}}})}),messageAppend("已重新注入自动监控",0,1)},daily_hook:void 0,oneKeyDaily:async function(){messageAppend("本脚本会自动执行师门及自动进退小树林,请确保精力足够再执行,请不要点击任务菜单",1);var i=0;for(WG.daily_hook=WG.add_hook("dialog",async function(o){if("tasks"==o.dialog&&o.items){let t="",e="";for(var n of o.items)"signin"==n.id&&(t=n.desc,e=n.state);if(3==e)messageAppend("日常已完成",1),setTimeout(()=>{WG.remove_hook(WG.daily_hook),WG.daily_hook=void 0},1);else{let e=t;var o=(e=e.replace(/<(?!\/?p\b)[^>]+>/gi,"")).split("精力消耗"),s=o[0].match("：([^%]+)/20")[1],o=o[1].match("：([^%]+)/200")[1];messageAppend("还需要"+(s=20-parseInt(s))+"次师门任务,"+(i=20-parseInt(o)/10)+"次副本,才可签到"),0!=s?($(".sm_button").text("停止(Q)"),WG.sm_state=0,setTimeout(WG.smTask,200)):WG.sm_state=-1}}}),WG.SendCmd("tasks"),await WG.sleep(2e3);0<=WG.sm_state;)await WG.sleep(2e3);i<=0?(WG.Send("taskover signin"),messageAppend("<hiy>任务完成</hiy>"),WG.remove_hook(WG.daily_hook),WG.daily_hook=void 0,this.timer_close(),this.needGrove=0,this.fbnum=0):WG.grove_auto(i)},oneKeyQA:async function(){WG.Send("stopstate"),WG.sm_state=-1;var e=sm_array[family].sxplace,t=sm_array[family].sx;0==e.indexOf("-")?WG.Send(e.replace("-","")):WG.go(e),await WG.sleep(2e3),WG.SendCmd('select $findPlayerByName("'+t+'");$wait 200;ask2 $findPlayerByName("'+t+'")'),await WG.sleep(1e3)},sd_hook:void 0,oneKeySD:function(){var s=0;messageAppend("本脚本自动执行购买扫荡符,进行追捕扫荡,请确保元宝足够，请不要点击任务菜单\n注意! 超过上限会自动放弃",1),WG.sd_hook=WG.add_hook(["dialog","text"],async function(o){var e=0,t=2;if("text"==o.type&&o.msg){if(e=WG.getIdByName("程药发"),0<=o.msg.indexOf("无法快速完"))for(WG.Send("select "+e),await WG.sleep(200),WG.Send("ask1 "+e),await WG.sleep(200),WG.Send("ask2 "+e),await WG.sleep(200);t;)t--,console.log("ask3 "+e),WG.Send("ask3 "+e),await WG.sleep(1e3);if(0<=o.msg.indexOf("追捕任务完成了")){let e=o.msg;e=e.replace(/<(?!\/?p\b)[^>]+>/gi,""),"20"==(s=e.match("目前完成([^%]+)/20")[1])&&(messageAppend("追捕已完成",1),await WG.sleep(2e3),WG.remove_hook(WG.sd_hook),WG.sd_hook=void 0)}if((0<=o.msg.indexOf("多历练一番")||0<=o.msg.indexOf("没有那么多元宝"))&&(messageAppend("等级太低无法接取追捕,自动取消",1),WG.remove_hook(WG.sd_hook),WG.sd_hook=void 0),0<=o.msg.indexOf("你的追捕任务已经完成了")&&(messageAppend("追捕已完成",1),WG.remove_hook(WG.sd_hook),WG.sd_hook=void 0),0<=o.msg.indexOf("你的扫荡符不够。"))for(e=WG.getIdByName("程药发"),messageAppend("还需要"+s+"次扫荡,自动购入"+s+"张扫荡符"),WG.Send("shop 0 "+s),await WG.sleep(1e3);t;)t--,console.log("ask3 "+e),WG.Send("ask3 "+e),await WG.sleep(1e3)}if("tasks"==o.dialog&&o.items){let e="";for(var n of o.items)"yamen"==n.id&&(e=n.desc);let t=e;if(t=t.replace(/<(?!\/?p\b)[^>]+>/gi,""),s=t.match("完成([^%]+)/20")[1],0==(s=20-parseInt(s)))messageAppend("追捕已完成",1),WG.remove_hook(WG.sd_hook),WG.sd_hook=void 0;else{for(;WG.go("扬州城-衙门正厅"),await WG.sleep(1e3),!WG.getIdByName("程药发"););WG.SendCmd('ask3 $pname("程药发")')}}}),WG.Send("stopstate"),WG.SendCmd("tasks")},gpSkill_hook:void 0,getPlayerSkill:async function(){WG.gpSkill_hook=WG.add_hook("dialog",t=>{t.dialog&&"skills"==t.dialog&&t.items&&null!=t.items&&(messageAppend(`<div class="item-commands ">
                <span class = "copycha" data-clipboard-target = ".target1" >
                        技能详情复制到剪贴板 </span></div> `),$(".copycha").on("click",()=>{var e=G.level.replace(/<\/?.+?>/g,"").replace(/ /g,""),e={player:role,roleid:roleid,level:e,family:G.pfamily,items:t.items};copyToClipboard(JSON.stringify(e)),messageAppend("复制成功")}),WG.remove_hook(WG.gpSkill_hook),WG.gpSkill_hook=void 0)}),KEY.do_command("skills"),KEY.do_command("skills"),WG.Send("cha")},make_config:async function(){let t={};GM_listValues().forEach(e=>{0<=e.indexOf(roleid)&&(t[e]=GM_getValue(e))}),t._shieldswitch=GM_getValue("_shieldswitch",shieldswitch),t._shield=GM_getValue("_shield",shield),t._shieldkey=GM_getValue("_shieldkey",shieldkey),t._pushSwitch=GM_getValue("_pushSwitch",pushSwitch),t._pushType=GM_getValue("_pushType",pushType),t._pushToken=GM_getValue("_pushToken",pushToken),S.uploadUserConfig(G.id,t,e=>{"true"==e&&L.msg("已成功上传")})},load_config:async function(){S.getUserConfig(G.id,e=>{if(""!=e){var t,o=JSON.parse(e);for(t in o)GM_setValue(t,o[t]);GI.configInit(),WG.setting(),WG.ztjk_func(),WG.zml_showp(),WG.dsj_func(),L.msg("已成功加载")}})},setting:function(){var a,keyitem=(KEY.do_command("setting"),$(".footer-item")[$(".footer-item").length-1].click(),0==$(".dialog-custom .zdy_dialog").length&&(a=UI.syssetting(),$(".dialog-custom").prepend(a)),$(".dialog-custom").off("click"),$("#family").off("change"),$("#wudao_pfm").off("focusout"),$(".savebtn").off("click"),$(".clear_skillJson").off("click"),$(".backup_btn").off("click"),$(".clean_dps").off("click"),$(".load_btn").off("click"),$(".update_store").off("click"),$(".update_id_all").off("click"),$(".clean_id_all").off("click"),$("#autobuy").off("change"),$("#autoSkillPaperSell").off("change"),$("#loginhml").off("change"),$("#backimageurl").off("change"),$("#statehml").off("change"),$("#shieldkey").off("focusout"),$("#shield").off("focusout"),$("#funnycalc").off("click"),$("#dpssakada").off("click"),$("#silence").off("click"),$("#zdyskilllist").off("change"),$("#zdyskillsswitch").off("click"),$("#shieldswitch").off("click"),$("#welcome").off("focusout"),$("#die_str").off("focusout"),$("#blacklist").off("change"),$("#auto_command").off("change"),$("#store_fenjie_info").off("change"),$("#store_drop_info").off("change"),$("#lock_info").off("change"),$("#store_info2").off("change"),$("#store_info").off("change"),$("#unauto_pfm").off("change"),$("#getitemShow").off("click"),$("#zmlshowsetting").off("change"),$("#bagFull").off("change"),$("pushSwitch").off("click"),$("pushType").off("change"),$("pushToken").off("change"),$("#autorelogin").off("click"),$("#autoupdateStore").off("click"),$("#saveAddr").off("click"),$("#autorewardgoto").off("click"),$("#autopfmswitch").off("click"),$("#auto_eq").off("change"),$("#ks_Boss").off("click"),$("#marry_kiss").off("click"),$("#ks_wait").off("focusout"),$("#ks_pfm").off("focusout"),$("#sm_getstore").off("click"),$("#sm_price").off("click"),$("#sm_any").off("click"),$("#sm_loser").off("click"),$(".dialog-custom").on("click",".switch2",UI.switchClick),$("#family").change(function(){family=$("#family").val(),GM_setValue(roleid+"_family",family)}),$("#wudao_pfm").focusout(function(){wudao_pfm=$("#wudao_pfm").val(),GM_setValue(roleid+"_wudao_pfm",wudao_pfm)}),$("#sm_loser").click(function(){sm_loser=WG.switchReversal($(this)),GM_setValue(roleid+"_sm_loser",sm_loser)}),$("#sm_any").click(function(){sm_any=WG.switchReversal($(this)),GM_setValue(roleid+"_sm_any",sm_any)}),$("#sm_price").click(function(){sm_price=WG.switchReversal($(this)),GM_setValue(roleid+"_sm_price",sm_price)}),$("#sm_getstore").click(function(){sm_getstore=WG.switchReversal($(this)),GM_setValue(roleid+"_sm_getstore",sm_getstore)}),$("#ks_pfm").focusout(function(){ks_pfm=$("#ks_pfm").val(),GM_setValue(roleid+"_ks_pfm",ks_pfm)}),$("#ks_wait").focusout(function(){ks_wait=$("#ks_wait").val(),GM_setValue(roleid+"_ks_wait",ks_wait)}),$("#marry_kiss").click(function(){automarry=WG.switchReversal($(this)),GM_setValue(roleid+"_automarry",automarry)}),$("#ks_Boss").click(function(){autoKsBoss=WG.switchReversal($(this)),GM_setValue(roleid+"_autoKsBoss",autoKsBoss)}),$("#auto_eq").focusout(function(){autoeq=$("#auto_eq").val(),GM_setValue(roleid+"_auto_eq",autoeq)}),$("#autopfmswitch").click(function(){auto_pfmswitch=WG.switchReversal($(this)),GM_setValue(roleid+"_auto_pfmswitch",auto_pfmswitch),G.auto_preform="开"==auto_pfmswitch}),$("#autopfmmode").click(function(){auto_pfm_mode=WG.switchReversal($(this)),GM_setValue(roleid+"_auto_pfm_mode",auto_pfm_mode),G.auto_pfm_mode="开"==auto_pfm_mode}),$("#autorewardgoto").click(function(){auto_rewardgoto=WG.switchReversal($(this)),GM_setValue(roleid+"_auto_rewardgoto",auto_rewardgoto)}),$("#busyinfo").click(function(){busy_info=WG.switchReversal($(this)),GM_setValue(roleid+"_busy_info",busy_info)}),$("#saveAddr").click(function(){saveAddr=WG.switchReversal($(this)),GM_setValue(roleid+"_saveAddr",saveAddr)}),$("#autoupdateStore").click(function(){auto_updateStore=WG.switchReversal($(this)),GM_setValue(roleid+"_auto_updateStore",auto_updateStore)}),$("#autorelogin").click(function(){auto_relogin=WG.switchReversal($(this)),GM_setValue(roleid+"_auto_relogin",auto_relogin)}),$("#zmlshowsetting").change(function(){zmlshowsetting=$("#zmlshowsetting").val(),GM_setValue(roleid+"_zmlshowsetting",zmlshowsetting),WG.zml_showp()}),$("#bagFull").change(function(){bagFull=$("#bagFull").val(),GM_setValue(roleid+"_bagFull",bagFull)}),$("#pushSwitch").click(function(){GM_setValue("_pushSwitch",pushSwitch=WG.switchReversal($(this)))}),$("#pushType").change(function(){GM_setValue("_pushType",pushType=$("#pushType").val())}),$("#pushToken").focusout(function(){GM_setValue("_pushToken",pushToken=$("#pushToken").val())}),$("#color_select").change(function(){GM_setValue("color_select",color_select=$("#color_select").val())}),$("#getitemShow").click(function(){getitemShow=WG.switchReversal($(this)),GM_setValue(roleid+"_getitemShow",getitemShow),G.getitemShow="开"==getitemShow}),$("#unauto_pfm").change(function(){unauto_pfm=$("#unauto_pfm").val(),GM_setValue(roleid+"_unauto_pfm",unauto_pfm);var e,t=unauto_pfm.split(",");blackpfm=[];for(e of t)e&&blackpfm.push(e)}),$("#store_info").change(function(){zdy_item_store=$("#store_info").val(),GM_setValue(roleid+"_zdy_item_store",zdy_item_store),store_list=(store_list=zdy_item_store.split(",")).concat(zdy_item_store2.split(","))}),$("#store_info2").change(function(){zdy_item_store2=$("#store_info2").val(),GM_setValue(roleid+"_zdy_item_store2",zdy_item_store2),store_list=(store_list=zdy_item_store2.split(",")).concat(zdy_item_store.split(","))}),$("#lock_info").change(function(){zdy_item_lock=$("#lock_info").val(),GM_setValue(roleid+"_zdy_item_lock",zdy_item_lock),lock_list=zdy_item_lock.split(",")}),$("#store_drop_info").change(function(){zdy_item_drop=$("#store_drop_info").val(),GM_setValue(roleid+"_zdy_item_drop",zdy_item_drop),drop_list=zdy_item_drop.split(",")}),$("#store_fenjie_info").change(function(){zdy_item_fenjie=$("#store_fenjie_info").val(),GM_setValue(roleid+"_zdy_item_fenjie",zdy_item_fenjie),fenjie_list=zdy_item_fenjie.split(",")}),$("#auto_command").change(function(){auto_command=$("#auto_command").val(),GM_setValue(roleid+"_auto_command",auto_command)}),$("#blacklist").change(function(){blacklist=$("#blacklist").val(),GM_setValue(roleid+"_blacklist",blacklist)}),$("#welcome").focusout(function(){welcome=$("#welcome").val(),GM_setValue(roleid+"_welcome",welcome)}),$("#die_str").focusout(function(){die_str=$("#die_str").val(),GM_setValue(roleid+"_die_str",die_str)}),$("#shieldswitch").click(function(){GM_setValue("_shieldswitch",shieldswitch=WG.switchReversal($(this))),"开"==shieldswitch&&messageAppend("已注入屏蔽系统",0,1)}),$("#zdyskillsswitch").click(function(){zdyskills=WG.switchReversal($(this)),GM_setValue(roleid+"_zdyskills",zdyskills),"开"==zdyskills&&messageAppend("已开启自定义技能顺序，填写顺序后，请刷新游戏生效",0,1)}),$("#zdyskilllist").change(function(){JSON.parse($("#zdyskilllist").val());if(!1 instanceof Array)return alert("无效的输入"),!1;zdyskilllist=$("#zdyskilllist").val(),GM_setValue(roleid+"_zdyskilllist",zdyskilllist)}),$("#silence").click(function(){silence=WG.switchReversal($(this)),GM_setValue(roleid+"_silence",silence),"开"==silence&&messageAppend("已开启安静模式",0,1)}),$("#dpssakada").click(function(){dpssakada=WG.switchReversal($(this)),GM_setValue(roleid+"_dpssakada",dpssakada),"开"==dpssakada&&messageAppend("已开启战斗统计",0,1)}),$("#funnycalc").click(function(){funnycalc=WG.switchReversal($(this)),GM_setValue(roleid+"_funnycalc",funnycalc),"开"==funnycalc&&messageAppend("已开启FUNNY计算",0,1)}),$("#shield").focusout(function(){GM_setValue("_shield",shield=$("#shield").val())}),$("#shieldkey").focusout(function(){GM_setValue("_shieldkey",shieldkey=$("#shieldkey").val())}),$("#statehml").change(function(){statehml=$("#statehml").val(),GM_setValue(roleid+"_statehml",statehml)}),$("#backimageurl").change(function(){backimageurl=$("#backimageurl").val(),GM_setValue(roleid+"_backimageurl",backimageurl),""!=backimageurl&&(WG.SendCmd("setting backcolor none"),GM_addStyle(`body{
              background-color:rgb(0,0,0,.25)
                }
                div{
                    opacity:1;
                }
                html{
                background:rgba(255,255,255,0.25);
                background-image:url('${backimageurl}');
                background-repeat:no-repeat;
                background-size:100% 100%;
                -moz-background-size:100% 100%;
            }
            `))}),$("#loginhml").change(function(){loginhml=$("#loginhml").val(),GM_setValue(roleid+"_loginhml",loginhml)}),$("#autobuy").change(function(){auto_buylist=$("#autobuy").val(),GM_setValue(roleid+"_auto_buylist",auto_buylist)}),$("#autoSkillPaperSell").change(function(){auto_skillPaperSelllist=$("#autoSkillPaperSell").val(),GM_setValue(roleid+"_auto_skillPaperSelllist",auto_skillPaperSelllist)}),$(".update_id_all").on("click",WG.update_id_all),$(".clean_id_all").on("click",WG.clean_id_all),$(".update_store").on("click",WG.update_store),$(".backup_btn").on("click",WG.make_config),$(".load_btn").on("click",WG.load_config),$(".clean_dps").on("click",WG.clean_dps),$(".clear_skillJson").on("click",()=>{messageAppend("已关闭自定义，请刷新重新获取技能数据!"),zdyskills="关",GM_setValue(roleid+"_zdyskilllist",""),GM_setValue(roleid+"_zdyskills",zdyskills)}),$(".savebtn").on("click",function(){var e,t=[];for(e of keyitem){var o={name:"无",send:""},n=$("#name"+e).val(),s=$("#send"+e).val();""!=n&&(o.name=n,o.send=s),t.push(o)}GM_setValue(roleid+"_zdy_btnlist",zdy_btnlist=t),messageAppend("保存自定义按钮成功"),WG.zdy_btnListInit()}),$("#family").val(family),$("#wudao_pfm").val(wudao_pfm),$("#sm_loser").val(sm_loser),$("#sm_any").val(sm_any),$("#sm_price").val(sm_price),$("#sm_getstore").val(sm_getstore),$("#ks_pfm").val(ks_pfm),$("#ks_wait").val(ks_wait),$("#marry_kiss").val(automarry),$("#ks_Boss").val(autoKsBoss),$("#auto_eq").val(autoeq),$("#autopfmswitch").val(auto_pfmswitch),$("#autopfmmode").val(auto_pfm_mode),$("#autorewardgoto").val(auto_rewardgoto),$("#busyinfo").val(busy_info),$("#saveAddr").val(saveAddr),$("#autoupdateStore").val(auto_updateStore),$("#autorelogin").val(auto_relogin),$("#zmlshowsetting").val(zmlshowsetting),$("#bagFull").val(bagFull),$("#pushSwitch").val(pushSwitch),$("#pushType").val(pushType),$("#pushToken").val(pushToken),$("#color_select").val(color_select),$("#getitemShow").val(getitemShow),$("#unauto_pfm").val(unauto_pfm),$("#store_info").val(zdy_item_store),$("#store_info2").val(zdy_item_store2),$("#lock_info").val(zdy_item_lock),$("#store_drop_info").val(zdy_item_drop),$("#store_fenjie_info").val(zdy_item_fenjie),$("#auto_command").val(auto_command),$("#blacklist").val(blacklist),$("#welcome").val(welcome),$("#die_str").val(die_str),$("#shieldswitch").val(shieldswitch),$("#silence").val(silence),$("#dpssakada").val(dpssakada),$("#funnycalc").val(funnycalc),$("#shield").val(shield),$("#shieldkey").val(shieldkey),$("#statehml").val(statehml),$("#backimageurl").val(backimageurl),$("#loginhml").val(loginhml),$("#autobuy").val(auto_buylist),$("#autoSkillPaperSell").val(auto_skillPaperSelllist),$("#zdyskillsswitch").val(zdyskills),$("#zdyskilllist").val(zdyskilllist),["Q","W","E","R","T","Y"]),item;let zdybtni=0;for(item of keyitem)$("#name"+item).val(zdy_btnlist[zdybtni].name),$("#send"+item).val(zdy_btnlist[zdybtni].send),zdybtni+=1;for(let w=$(".setting>.setting-item2"),t=0;t<w.length;t++){var s=$(w[t]),i=s.attr("for"),n;i&&(n=eval(i),"开"==n)&&(s.find(".switch2").addClass("on"),s.find(".switch-text").html("开"))}},zdybtnfunc:function(e){WG.SendCmd(zdy_btnlist[e].send)},zdy_btnset:function(){zdy_btnlist=GM_getValue(roleid+"_zdy_btnlist",zdy_btnlist),messageClear();messageAppend(UI.zdyBtnsetui());var e,i=["Q","W","E","R","T","Y"];let t=0;for(e of i)$("#name"+e).val(zdy_btnlist[t].name),$("#send"+e).val(zdy_btnlist[t].send),t+=1;$(".savebtn").off("click"),$(".savebtn").on("click",function(){var e,t=[];for(e of i){var o={name:"无",send:""},n=$("#name"+e).val(),s=$("#send"+e).val();""!=n&&(o.name=n,o.send=s),t.push(o)}GM_setValue(roleid+"_zdy_btnlist",zdy_btnlist=t),messageAppend("保存成功"),WG.zdy_btnListInit()})},zdy_btnListInit:function(){if(zdy_btnlist=GM_getValue(roleid+"_zdy_btnlist",zdy_btnlist),inzdy_btn=GM_getValue(roleid+"_inzdy_btn",inzdy_btn),0==zdy_btnlist.length){for(var e=0;e<6;e++)zdy_btnlist.push({name:"无",send:""});GM_setValue(roleid+"_zdy_btnlist",zdy_btnlist)}inzdy_btn?WG.zdy_btnshow():WG.zdy_btnshow("off")},zdy_btnshow:function(e="on"){if("on"==e){inzdy_btn=!0;var t=UI.zdybtnui(),o=($(".WG_button").remove(),$(".WG_log").after(t),["Q","W","E","R","T","Y"]);for(let e=0;e<o.length;e++)$("#keyin"+o[e]).on("click",function(){WG.zdybtnfunc(e)});$(".auto_perform").on("click",WG.auto_preform_switch),$(".cmd_echo").on("click",WG.cmd_echo_button)}else"off"==e&&(inzdy_btn=!1,t=UI.btnui(),$(".WG_button").remove(),$(".WG_log").after(t),$(".sm_button").on("click",WG.sm_button),$(".go_yamen_task").on("click",WG.go_yamen_task),$(".kill_all").on("click",WG.kill_all),$(".get_all").on("click",WG.get_all),$(".sell_all").on("click",WG.sell_all),$(".zdwk").on("click",WG.zdwk),$(".auto_perform").on("click",WG.auto_preform_switch),$(".cmd_echo").on("click",WG.cmd_echo_button),G.isGod())&&$(".zdy-item.zdwk").html("修炼(Y)");GM_setValue(roleid+"_inzdy_btn",inzdy_btn)},runLoginhml:function(){WG.SendCmd(loginhml)},tnBuy_hook:null,tnBuy:function(){WG.tnBuy_hook=WG.add_hook(["dialog","text"],e=>{let n;var t=new Map;let s="";if("dialog"==e.type&&null!=e.title&&0<=e.title.indexOf("唐楠正在贩卖")){n=e.seller;for(var o of e.selllist)WG.inArray(o.name,auto_buylist.split(","))&&t.set(o.id,o.count);t.forEach((e,t,o)=>{s=s+"buy "+e+" "+t+" from "+n+";",s+="$wait 500;"}),s+="look3 1;",WG.SendCmd(s)}"text"==e.type&&0<=e.msg.indexOf("没有这个玩家")&&(messageAppend("执行结束"),$(".dialog-close").click(),WG.remove_hook(WG.tnBuy_hook))}),WG.SendCmd("$to 扬州城-广场;$wait 100;$to 扬州城-当铺;$wait 200;list %唐楠%")},zxBuy_hook:null,zxBuy:function(){WG.zxBuy_hook=WG.add_hook(["dialog","text"],e=>{let n=WG.getIdByName("朱熹");var t=new Map;let s="";if("dialog"==e.type&&"pack"==e.dialog){for(var o of e.items)WG.inArray(o.name.toLowerCase(),auto_skillPaperSelllist.split(","))&&t.set(o.id,o.count);t.forEach((e,t,o)=>{s=s+"sell "+e+" "+t+" to "+n+";",s+="$wait 500;"}),s+="look3 1;",WG.SendCmd(s)}"text"==e.type&&0<=e.msg.indexOf("没有这个玩家")&&($(".dialog-close").click(),WG.remove_hook(WG.zxBuy_hook))}),WG.SendCmd("$to 扬州城-广场;go east;go north;$wait 100;$wait 200;pack")},selectLowKongfu:function(c=0){WG.gpSkill_hook=WG.add_hook("dialog",e=>{if(e.dialog&&"skills"==e.dialog&&e.items&&null!=e.items){var t,o="jh fam 0 start,go west,go west,go north,go enter,go west,",n="",s="",i="wakuang",a=(G.isGod()&&(i="xiulian"),[]),l=[],r=c,d=(0!=c&&!isNaN(c)||(r=e.limit),0),u=[];for(t of e.items){if(5<d)break;t.enable_skill&&u.push(t.enable_skill),(WG.inArray(t.id,u)||0<=t.name.indexOf("基本"))&&parseInt(t.level)<parseInt(r)&&(n+=`lianxi ${t.id} ${r},`,d<4&&(s+=`lianxi ${t.id} ${r},`,l.push(t.name)),a.push(t.name),d++)}("setting auto_work "+o+n+i).length<=200?(WG.Send("setting auto_work "+o+n+i),messageAppend("添加"+a.join(",")+"到"+r)):(WG.Send("setting auto_work "+o+s+i),messageAppend("添加"+l.join(",")+"到"+r)),messageAppend("添加成功,数据刷新后显示"),WG.remove_hook(WG.gpSkill_hook),WG.gpSkill_hook=void 0}}),KEY.do_command("skills"),KEY.do_command("skills"),WG.Send("cha")},hooks:[],hook_index:0,add_hook:function(e,t){e={index:WG.hook_index++,types:e,fn:t};return WG.hooks.push(e),e.index},remove_hook:function(e){for(var t=0;t<this.hooks.length;t++)this.hooks[t].index==e&&this.hooks.baoremove(t)},run_hook:function(e,t){for(var o=0;o<this.hooks.length;o++)try{var n=this.hooks[o];(n.types==t.type||n.types instanceof Array&&0<=$.inArray(t.type,n.types))&&n.fn(t)}catch(e){console.error("hook error",e)}},receive_message:function(t){if(t&&t.data){var v,e,o,n=function(e){var t,o={};for(t in e)o[t]="object"==typeof e[t]?n(e[t]):e[t];return o};if(v="{"==t.data[0]||"["==t.data[0]?new Function("return "+t.data+";")():{type:"text",msg:t.data},G.cmd_echo&&"time"!=v.type&&console.log(v),G.yaotaFlag&&"string"==typeof v.msg&&0<=(s=v.msg).indexOf("一股奇异的能量涌入你的体内，你获得")&&(G.yaoyuan=G.yaoyuan+parseInt(s.replace(/[^0-9]/gi,"")),$("#yt_prog").html("<hiy>目前已获得 "+G.yaoyuan+" 妖元</hiy>"),261==G.yaoyuan)&&$("#yt_prog").html("<hiy>目前已获得 "+G.yaoyuan+" 妖元，boss出现！</hiy>"),"开"==silence){if("state"==v.type)if(null==v.silence)if(v.desc!=[])return v.desc=[],v.silence=1,(s=n(t)).data=JSON.stringify(v),WG.run_hook(v.type,v),void ws_on_message.apply(this,[s]);if("text"==v.type){var s=v.msg.split(/.*造成<wht>|.*造成<hir>|<\/wht>点|<\/hir>点/);if(s[2])return i=s[2].split(/伤害|\(|</),messageAppend(`造成<wht>${s[1]}</wht>点<hir>${i[0]}</hir>伤害！`,0,1),void WG.run_hook(v.type,v)}}if("msg"==v.type&&"开"==shieldswitch){if(null!=shield&&(0<=shield.indexOf(v.name)||0<=shield.indexOf(v.uid)))return;for(e of shieldkey.split(","))if(""!=e&&0<=v.content.indexOf(e))return}if("text"==v.type)if("开"==shieldswitch)for(o of shieldkey.split(","))if(""!=o&&0<=v.msg.indexOf(o))return;if("dialog"==v.type&&"fam"==v.t&&null==v.k)if(null!=UI.toui[v.index])return v.desc+="\n",v.desc+=UI.toui[v.index],v.k="knva",(s=n(t)).data=JSON.stringify(v),WG.run_hook(v.type,v),void ws_on_message.apply(this,[s]);if("text"==v.type&&"什么？"==v.msg&&null!=G.wsdelaySetTime&&(G.wsdelaySetCount<=3?(G.wsdelaySetCount+=1,G.wsdelay=null==G.wsdelay?(new Date).getTime()-G.wsdelaySetTime:((new Date).getTime()-G.wsdelaySetTime+G.wsdelay)/2,G.wsdelaySetTime=(new Date).getTime(),WG.SendCmd("test")):(G.wsdelay=((new Date).getTime()-G.wsdelaySetTime+G.wsdelay)/2,WG.SendCmd("tm 服务器到本地来回延迟约 "+G.wsdelay+" 毫秒"),G.wsdelaySetTime=void 0,G.wsdelaySetCount=void 0,setTimeout(()=>{let e=$(".content-message pre").html();e=e.replaceAll("什么？\n",""),$(".content-message pre").html(e)},10))),"dialog"==v.type&&"fb"==v.t&&null==v.k)v.desc+="\n",v.desc+=UI.fbui(fb_path[v.index],v.is_multi,v.is_diffi),v.k="knva",(i=n(t)).data=JSON.stringify(v),WG.run_hook(v.type,v),ws_on_message.apply(this,[i]);else if("dialog"==v.type&&"pack"==v.dialog&&"item"==v.from&&null==v.k)s=v.desc.split("\n")[0],v.desc+="\n",v.desc+=UI.itemui(s),v.k="knva",(i=n(t)).data=JSON.stringify(v),WG.run_hook(v.type,v),ws_on_message.apply(this,[i]);else{if("perform"==v.type)if("开"==zdyskills)return zdyskilllist=GM_getValue(roleid+"_zdyskilllist",zdyskilllist),v.skills=JSON.parse(zdyskilllist),(s=n(t)).data=JSON.stringify(v),WG.run_hook(v.type,v),void ws_on_message.apply(this,[s]);if("cmds"==v.type&&unsafeWindow&&unsafeWindow.ToRaid&&0<=JSON.stringify(v.items).indexOf("进入副本")){var i=v.items[0].cmd;let e="";e=0<=i.indexOf("1 0")?i.replaceAll("1 0","1"):i+" 0";s={name:"扫荡指定次数"},s=(s.cmd=`@js ($sdnum) =prompt("请输入次数,注意:若副本掉落物品过多,请不要输入超过50次,否则可能号没了","10")
                                    [if] (sdnum)!=null
                                      ${e} (sdnum)`,v.items.push(s),{name:"偷渡指定次数"}),i=(s.cmd=`@js ($sdnum) =prompt("请输入次数","10")
                                    [if] (sdnum)!=null
                                      [while] (sdnum) !=0
                                        ($sdnum) = (sdnum)-1
                                        ${i}
                                        cr over`,v.items.push(s),n(t));i.data=JSON.stringify(v),WG.run_hook(v.type,v),void ws_on_message.apply(this,[i])}else{if("dialog"==v.type&&"tasks"==v.dialog&&v.items){let o,n,s,i,a,l,r,d,u,c,m,p,g,f,h,_,k,y,w,e=(v.items.forEach(e=>{var t;2===e.state&&WG.SendCmd("taskover "+e.id),"signin"===e.id?((t=e.desc.match(/精力消耗：<...>(\d+)\/200<....>/))&&(o=parseInt(t[1])<200?`<hig>${t[1]}</hig>`:t[1]),t=e.desc.match(/武道塔(.+)，进度(\d+)\/(\d+)<....>/),i=t?(a=t[2],l=t[3],a<l&&(a=`<hig>${a}</hig>`),r=/可以重置/.test(t[1])?"<hig>可以重置</hig>":"已经重置",a+"/"+l+" "+r):"只打塔主",t=e.desc.match(/<.+?>(.+)首席请安<.+?>/),s=t?/已经/.test(t[1])?"已经请安":"<hig>尚未请安</hig>":"无需请安",(t=e.desc.match(/今日副本完成次数：(\d+)。/))&&(n=t[1]),t=e.desc.match(/尚未协助襄阳守城/),d=t?"<hig>0</hig>":1,t=e.desc.match(/尚未挑战门派BOSS/),u=t?"<hig>0</hig>":1,(t=e.desc.match(/挑战(\d+)次武神BOSS/))?c=`<hig>${c=5-parseInt(t[1])}</hig>`:G.level&&/武神|剑神|刀皇|兵主|战神/.test(G.level)&&(c=5),t=e.desc.match(/尚未挑战武道塔塔主/),m=t?"<hig>0</hig>/1":"已打或未解锁",(t=e.desc.match(/挑战弑妖塔(\d+)\/50/))&&(p=t[1]),t=e.desc.match(/尚未挑战妖神/),g=t?"<hig>0</hig>/1":"已打或未解锁"):"sm"===e.id?(t=e.desc.match(/目前完成(.*)\/20个，共连续完成(.*)个。/),f=parseInt(t[1])<20?`<hig>${t[1]}</hig>`:t[1],h=t[2]):"yamen"===e.id?(t=e.desc.match(/目前完成(.*)\/20个，共连续完成(.*)个。/),_=parseInt(t[1])<20?`<hig>${t[1]}</hig>`:t[1],k=t[2]):"yunbiao"===e.id&&(t=e.desc.match(/本周完成(.*)\/20个，共连续完成(.*)个。/),y=parseInt(t[1])<20?`<hig>${t[1]}</hig>`:t[1],w=t[2])}),`门派请安 => ${s}
武道之塔 => ${i}
`);e=(e=(e=(e+=`精力消耗 => ${o}/200 副本次数 => ${n}次
师门任务 => ${f}/20 ${h}连
`)+`衙门追捕 => ${_}/20 ${k}连
每周运镖 => ${y}/20 ${w}连
`)+`襄阳守城 => ${d}/1 门派BOSS => ${u}/1
`)+`武道塔主 => ${m}
`,c&&(e+=`武神BOSS => ${c}/5
`),p&&(e+=`挑战弑妖塔 => ${p}/50 挑战妖神 => ${g}
`),$(".remove_taskprog").remove(),$(".content-message pre").append(`<span class="remove_taskprog">${e}</span>`),AutoScroll(".content-message")}if("dialog"==v.type&&"pack"==v.dialog)if(v.name){var a=v;if(/养精丹|朱果|潜灵果|背包扩充石|小箱子|师门补给包|随从礼包|技能重置包/.test(a.name)){let t=["stopstate"];var l=a.count;let o="use";/小箱子|师门补给包|随从礼包|技能重置包/.test(a.name)&&(o="open");for(let e=0;e<l;e++)t.push(`$wait 250;${o} `+a.id);$(".content-message pre").append($(`<div class="item-commands"><span class="autouse">使用 ${a.name} ${l}次</span></div>`).click(()=>WG.SendCmd(t))),AutoScroll(".content-message")}}if("room"!=v.type||/桃花岛|慈航静斋/.test(v.name))WG.run_hook(v.type,v),ws_on_message.apply(this,arguments),unsafeWindow.funny&&null!=unsafeWindow.funny.API&&unsafeWindow.funny.API.onmessage(t);else{let e=v.desc;30<e.length&&(i=(s=e.replace(/<([^<]+)>/g,"")).substr(0,30),s.substr(30),v.desc=`<span id="show">${i} <hic>»»»</hic></span><span id="more" style="display:none">${s}</span><span id="hide" style="display:none"> <hiy>«««</hiy></span>`),e.includes("cmd")&&((i=(e=(e=(e=(e=(e=e.replace("<hig>椅子</hig>","椅子")).replace("<CMD cmd='look men'>门(men)<CMD>","<cmd cmd='look men'>门</cmd>")).replace(/span/g,"cmd")).replace(/"/g,"'")).replace(/\((.*?)\)/g,"")).match(/<cmd cmd='([^']+)'>([^<]+)<\/cmd>/g)).forEach(e=>{e=e.match(/<cmd cmd='(.*)'>(.*)<\/cmd>/);v.commands.unshift({cmd:e[1],name:`<hic>${e[2]}</hic>`})}),i.forEach(e=>v.desc=`<hic>${e}</hic>　`+v.desc));s=n(t);s.data=JSON.stringify(v),WG.run_hook(v.type,v),ws_on_message.apply(this,[s]),$("#show").click(()=>{$("#more").show(),$("#show").hide(),$("#hide").show()}),void $("#hide").click(()=>{$("#more").hide(),$("#show").show(),$("#hide").hide()})}}}}}},T={_recmd:function(e){return e?((e=e instanceof Array?e:e.split(";")).baoremove(0),e.join(";")):""},recmd:function(t,o){for(let e=0;e<t+1;e++)o=T._recmd(o);return o},findhook:void 0,_findItem:async function(o,n){console.log("finditem"+o),T.findhook=WG.add_hook("dialog",async function(e){if(e.items){for(var t of e.items)t.name==o&&(n(t.id),WG.remove_hook(T.findhook));n("")}WG.remove_hook(T.findhook)}),WG.Send("pack")},pname:function(e=0,t,o){T.findPlayerByName(e,t,o)},findPlayerByName:function(e=0,t,o){let n=(o=0<=(o=T.recmd(e-1,o)).indexOf(",")?o.split(","):o.split(";"))[0].split("$")[0];o=T.recmd(0,o)," "==(n=n.replaceAll("-"," "))[n.length-1]&&(n=n.substring(0,n.length-1)),console.log("findPlayerByName"+t);for(let e=0;e<roomData.length;e++)roomData[e].name&&0<=roomData[e].name.indexOf(t)&&WG.Send(n+" "+roomData[e].id);WG.SendCmd(o)},findItem:async function(e=0,t,o){var n,s=(o=0<=(o=T.recmd(e-1,o)).indexOf(",")?o.split(","):o.split(";"))[0].split(" ")[0];o=T.recmd(0,o),console.log("finditem"+t),WG.Send("pack");for(n of packData)n.name==t&&(("fenjie"==s||"drop"==s)&&0<=n.name.indexOf("★")?messageAppend("高级物品 ,不分解"):WG.SendCmd(s+" "+n.id));WG.SendCmd(o)},wait:async function(e=0,t,o){o=T.recmd(e,o),console.log("延时:"+t+"ms,延时触发:"+o),await WG.sleep(parseInt(t)),WG.SendCmd(o)},batwait:async function(e=0,t,o){G.in_fight&&(o=T.recmd(e,o),console.log("延时:"+t+"ms,延时触发:"+o),await WG.sleep(parseInt(t)),WG.SendCmd(o))},goyt:async function(){WG.SendCmd("jh fam 9 start;go enter;go up;"),await WG.sleep(1e3);var t="";for(let e=0;e<roomData.length;e++)roomData[e].name&&0<=roomData[e].name.indexOf("疯癫的老头")&&(t=roomData[e].id);WG.SendCmd("ggdl "+t+";go north;go north;go north;go north;$wait 250;go north;go north;look shi;tiao1 shi;tiao3 shi;$wait 250;tiao1 shi;tiao3 shi;tiao2 shi;go north;")},gogzm:async function(){WG.SendCmd("jh fam 9 start;go enter;go up;"),await WG.sleep(1e3);var t="";for(let e=0;e<roomData.length;e++)roomData[e].name&&0<=roomData[e].name.indexOf("疯癫的老头")&&(t=roomData[e].id);WG.SendCmd("ggdl "+t+";go north;go north;go north;go north;$wait 250;go north;go north;$wait 250;look shi;tiao1 shi;tiao1 shi;tiao2 shi;$wait 250;jumpdown;")},godddb:async function(){WG.SendCmd("jh fam 9 start;go enter;go up;"),await WG.sleep(1e3);var t="";for(let e=0;e<roomData.length;e++)roomData[e].name&&0<=roomData[e].name.indexOf("疯癫的老头")&&(t=roomData[e].id);WG.SendCmd("ggdl "+t+";go north;go north;go north;go north;$wait 250;go north;go down;")},killall:async function(e=0,t,o){o=T.recmd(e,o),console.log("叫杀"),WG.kill_all(),await WG.sleep(100),WG.SendCmd(o)},getall:async function(e=0,t,o){o=T.recmd(e,o),console.log("拾取"),WG.get_all(),await WG.sleep(100),WG.SendCmd(o)},cleanall:async function(e=0,t,o){o=T.recmd(e,o),console.log("清包"),WG.clean_all(),await WG.sleep(100),WG.SendCmd(o)},to:async function(e=0,t,o){o=T.recmd(e,o),WG.go(t),await WG.sleep(100),WG.SendCmd(o)},eq:async function(e=0,t,o){o=T.recmd(e,o),"0"==t?WG.uneqall():WG.eqhelper(t),await WG.sleep(100),WG.SendCmd(o)},eqskill:async function(e=0,t,o){o=T.recmd(e,o),"0"==t?WG.uneqall(1):WG.eqhelper(t,1),await WG.sleep(100),WG.SendCmd(o)},eqdel:async function(e=0,t,o){o=T.recmd(e,o),WG.eqhelperdel(t),await WG.sleep(100),WG.SendCmd(o)},zdwk:async function(e=0,t,o){o=T.recmd(e,o),WG.zdwk(),await WG.sleep(100),WG.SendCmd(o)},rzdwk:async function(e=0,t,o){o=T.recmd(e,o),WG.zdwk("",!1),await WG.sleep(100),WG.SendCmd(o)},killhook:void 0,killw:async function(e=0,t,o){o=T.recmd(e,o);var n="";for(let e=0;e<roomData.length;e++)roomData[e].name&&0<=roomData[e].name.indexOf(t)&&(n=roomData[e].id);T.killhook=WG.add_hook("itemremove",function(e){e.id==n&&(WG.SendCmd(o),WG.remove_hook(T.killhook),T.killhook=void 0)}),WG.SendCmd("kill "+n)},eqhook:void 0,eqw:async function(e=0,n,t){var s=T.recmd(e,t);if(0<=n.indexOf("<"))T._findItem(n,async function(e){let t=e,o=!0;if(""==t)o=!1,WG.SendCmd(s);else for(T.eqhook=WG.add_hook("dialog",function(e){0==e.eq&&e.id==t&&(o=!1,WG.SendCmd(s),WG.remove_hook(T.eqhook),T.eqhook=void 0)});o;)WG.Send("pack"),WG.SendCmd("eq "+t),await WG.sleep(1e3)});else{let t=n,o=!0;if(""==t)o=!1,WG.SendCmd(s);else for(T.eqhook=WG.add_hook(["text","dialog"],function(e){"dialog"==e.type&&0==e.eq&&e.id==t&&(o=!1,WG.SendCmd(s),WG.remove_hook(T.eqhook),T.eqhook=void 0),"text"==e.type&&0<=e.msg.indexOf("你要装备什么")&&(o=!1,WG.SendCmd(s),WG.remove_hook(T.eqhook),T.eqhook=void 0)});o;)WG.Send("pack"),WG.SendCmd("eq "+t),await WG.sleep(1e3)}},usezml:async function(e=0,t,o){o=T.recmd(e,o);for(var n of zml=GM_getValue(roleid+"_zml",zml))n.name==t&&await WG.zmlfire(n);await WG.sleep(100),WG.SendCmd(o)},waitpfm:async function(e=0,t,o){o=T.recmd(e,o);let n=!0,s=0;for(;n;)G.gcd||G.cds.get(t)||(WG.Send("perform "+t),s++,G.cds.get(t)&&n&&(n=!1,WG.SendCmd(o)),!G.in_fight&&n&&(n=!1,WG.SendCmd(o)),1<=s&&n&&(n=!1,WG.SendCmd(o))),s++,await WG.sleep(350)},startjk:async function(e=0,t,o){o=T.recmd(e,o);for(var n of ztjk_item=GM_getValue(roleid+"_ztjk",ztjk_item))if(n.name==t){n.isactive=1,GM_setValue(roleid+"_ztjk",ztjk_item),WG.ztjk_func(),messageAppend("已注入"+n.name,0,1);break}await WG.sleep(100),WG.SendCmd(o)},stopjk:async function(e=0,t,o){o=T.recmd(e,o);for(var n of ztjk_item=GM_getValue(roleid+"_ztjk",ztjk_item))if(n.name==t){n.isactive=0,GM_setValue(roleid+"_ztjk",ztjk_item),WG.ztjk_func(),messageAppend("已暂停"+n.name);break}await WG.sleep(100),WG.SendCmd(o)},sm:async function(e=0,t,o=""){for(o=T.recmd(e,o),WG.sm_button();0<=$(".sm_button").text().indexOf("停止");)await WG.sleep(1e3);await WG.sleep(100),WG.SendCmd(o)},daily:async function(e=0,t,o){for(o=T.recmd(e,o),KEY.do_command("tasks"),messageAppend("执行请安.",1),await WG.oneKeyQA(),WG.oneKeyDaily(),await WG.sleep(2e3);null!=WG.daily_hook;)await WG.sleep(1e3);for(WG.Send("tasks"),await WG.sleep(1e3),WG.oneKeySD();WG.sd_hook;)await WG.sleep(1e3);await WG.sleep(100),WG.SendCmd(o)},xiyan:async function(e=0,t,o){for(o=T.recmd(e,o),WG.xiyan(),await WG.sleep(1e3);WG.marryhy;)await WG.sleep(1e3);await WG.sleep(100),WG.SendCmd(o)},yamen:async function(e=0,t,o){for(o=T.recmd(e,o),WG.go_yamen_task(),await WG.sleep(1e3);WG.yamen_lister;)await WG.sleep(1e3);await WG.sleep(100),WG.SendCmd(o)},wudao:async function(e=0,t,o){o=T.recmd(e,o),WG.wudao_auto(),await WG.sleep(100),WG.SendCmd(o)},boss:async function(e=0,t,o){for(o=T.recmd(e,o),WG.kksBoss({content:"听说xxx出现在逍遥派-青草坪一带。"}),await WG.sleep(1e3);WG.ksboss;)await WG.sleep(1e3);await WG.sleep(100),WG.SendCmd(o)},stoppfm:async function(e=0,t,o){o=T.recmd(e,o),G.auto_preform&&(G.auto_preform=!1,messageAppend("<hio>自动施法</hio>关闭"),WG.auto_preform("stop")),await WG.sleep(100),WG.SendCmd(o)},startpfm:async function(e=0,t,o){o=T.recmd(e,o),G.auto_preform||(G.auto_preform=!0,messageAppend("<hio>自动施法</hio>开启"),WG.auto_preform()),await WG.sleep(100),WG.SendCmd(o)},stopautopfm:async function(e=0,t,o){var n;o=T.recmd(e,o);for(n of t.split(","))WG.inArray(n,blackpfm)||blackpfm.push(n);console.log("当前自动施法黑名单为:"+blackpfm),await WG.sleep(100),WG.SendCmd(o)},startautopfm:async function(e=0,t,o){o=T.recmd(e,o);for(var n=t.split(","),s=0;s<blackpfm.length;s++)for(var i of n)i==blackpfm[s]&&blackpfm.baoremove(s);console.log("当前自动施法黑名单为:"+blackpfm),await WG.sleep(100),WG.SendCmd(o)},store:async function(e=0,t,o){for(o=T.recmd(e,o),await WG.sell_all(1,0,0);WG.packup_listener;)await WG.sleep(200);await WG.sleep(100),WG.SendCmd(o)},fenjie:async function(e=0,t,o){for(o=T.recmd(e,o),await WG.sell_all(0,1,0);WG.packup_listener;)await WG.sleep(200);await WG.sleep(100),WG.SendCmd(o)},drop:async function(e=0,t,o){for(o=T.recmd(e,o),await WG.sell_all(0,0,1);WG.packup_listener;)await WG.sleep(200);await WG.sleep(100),WG.SendCmd(o)},sellall:async function(e=0,t,o){for(o=T.recmd(e,o),await WG.sell_all(1,1,1);WG.packup_listener;)await WG.sleep(200);await WG.sleep(100),WG.SendCmd(o)},callcontextMenu:function(e=0,t,o){$(".container").contextMenu({x:1,y:1})},stopallauto:function(e=0,t,o){o=T.recmd(e,o),WG.stopAllAuto(),messageAppend("暂停自动喜宴及自动BOSS",0,1),WG.SendCmd(o)},startallauto:function(e,t,o){o=T.recmd(e,o),WG.reSetAllAuto(),messageAppend("恢复自动喜宴及自动BOSS",0,1),WG.SendCmd(o)},roll:function(e,t,o){o=T.recmd(e,o),1==t?WG.SendCmd("pty "+100*Math.random()):2==t?WG.SendCmd("chat "+100*Math.random()):3==t&&WG.SendCmd("say "+100*Math.random()),WG.SendCmd(o)},addstore:function(e,t,o){o=T.recmd(e,o),WG.addstore(t),WG.SendCmd(o)},addlock:function(e,t,o){o=T.recmd(e,o),WG.addlock(t),WG.SendCmd(o)},dellock:function(e,t,o){o=T.recmd(e,o),WG.dellock(t),WG.SendCmd(o)},tnbuy:function(e,t,o){o=T.recmd(e,o),WG.tnBuy(),WG.SendCmd(o)},zxbuy:function(e,t,o){o=T.recmd(e,o),WG.zxBuy(),WG.SendCmd(o)},atlx:function(e,t,o){o=T.recmd(e,o),WG.selectLowKongfu(parseInt(t)),WG.SendCmd(o)},addfenjieid:function(e,t,o){o=T.recmd(e,o),WG.addfenjieid(t),WG.SendCmd(o)},adddrop:function(e,t,o){o=T.recmd(e,o),WG.adddrop(t),WG.SendCmd(o)},addzxbuy:function(e,t,o){o=T.recmd(e,o),WG.addzxbuy(t),WG.SendCmd(o)},clsSakada:function(e,t,o){o=T.recmd(e,o),WG.clean_dps(),WG.SendCmd(o)},cls:function(e,t,o){o=T.recmd(e,o),messageClear(),WG.SendCmd(o)},syso:function(e,t,o){o=T.recmd(e,o),messageAppend(t),WG.SendCmd(o)},stop:function(e,t,o){o=T.recmd(e,o),WG.timer_close(),WG.SendCmd(o)},tts:function(e,t,o){o=T.recmd(e,o),FakerTTS.playtts(t),WG.SendCmd(o)},beep:async function(e,t,o){o=T.recmd(e,o),Beep(),WG.SendCmd(o)},music:function(e,t,o){o=T.recmd(e,o);new MusicBox({loop:!1,musicText:"6 - - 5 - 3 2 - 1 - - - 3 - - 2 1 - ·6 ·5 - - - ·5 - ·6 - ·5 - ·6 - 1 - - 2 - 3 5 6 - - 3 2 1 - 2",autoplay:6,type:"triangle",duration:2});WG.SendCmd(o)}},ProConsole={init:function(){var lastrun;L.isMobile()?layer.prompt({title:"请输入...",formType:2},function(text,index){var jscode;layer.close(index),null!=text&&(0<=text.split("\n")[0].indexOf("//")?unsafeWindow&&unsafeWindow.ToRaid&&ToRaid.perform(text):0<=text.split("\n")[0].indexOf("#js")?(jscode=text.split("\n"),jscode.baoremove(0),eval(jscode.join(""))):WG.SendCmd(text))}):(layer.open({type:1,title:"运行命令",shade:!1,offset:"rb",zIndex:961024,success:function(e,t){$(".runtesta").show()},content:$(".runtest"),end:function(){$(".runtesta").off("click"),$(".runtesta").hide()}}),lastrun=GM_getValue("_lastrun",""),""!=lastrun&&$("#testmain").val(lastrun),$(".runtesta").off("click"),$(".runtesta").on("click",function(){var jscode;0<=$("#testmain").val().split("\n")[0].indexOf("//")?unsafeWindow&&unsafeWindow.ToRaid&&ToRaid.perform($("#testmain").val()):0<=$("#testmain").val().split("\n")[0].indexOf("#js")?(jscode=$("#testmain").val().split("\n"),jscode.baoremove(0),eval(jscode.join(""))):WG.SendCmd($("#testmain").val())}),$("#testmain").focusout(function(){GM_setValue("_lastrun",$("#testmain").val())}))},close:function(){layer.close()}},UI={codeInput:`<div class="runtest layui-layer-wrap" style="display: none;">
                         <textarea class="site-demo-text" id="testmain" data-enpassusermodified="yes">
                         //<-第一行输入双斜杠即可运行流程命令 ,第一行输入#js 即可运行JS

                        </textarea>
                        <a class="layui-btn layui-btn-normal runtesta" style="position:absolute;right:20px;bottom:20px"  >立即运行</a>
                     </div>`,zdybtnui:function(){let e="<div class='WG_button'>";var t,o=["Q","W","E","R","T","Y"];let n=0;for(t of zdy_btnlist)e+=` <span class='zdy-item' id = 'keyin${o[n]}'>${t.name}(${o[n]})</span>`,n+=1;return e+`<span class="zdy-item auto_perform" style="float:right;"> 自动攻击 </span>
                <span class="zdy-item cmd_echo" style="float:right;">代码</span> </div>`},btnui:function(){return`<div class='WG_button'><span class='zdy-item sm_button'>师门(Q)</span>
            <span class='zdy-item go_yamen_task'>追捕(W)</span>
            <span class='zdy-item kill_all'>击杀(E)</span>
            <span class='zdy-item get_all'>拾取(R)</span>
            <span class='zdy-item sell_all'>清包(T)</span>
            <span class='zdy-item zdwk'>挖矿(Y)</span>
            <span class="zdy-item auto_perform" style="float:right;"> 自动攻击 </span>
                <span class="zdy-item cmd_echo" style="float:right;">代码</span> </div>`},wgui:function(){let e;return` <div class='WG_log'>
                    <pre></pre>
                </div>`+(e=inzdy_btn?UI.zdybtnui():UI.btnui())},zdyBtnsetui:function(){let e="";var t;for(t of["Q","W","E","R","T","Y"])e+=`<div class="setting-item setting-item2 ">
                 <div style='width:10%'>${t}:</div><span>名称:<input style='width:20%' id='name${t}' /></span> <span style='margin-left:5px'>命令:<input id='send${t}'/></span>
                </div>`;return e+=`
                         <div class="setting-item" >
                <div class="item-commands"><span class="savebtn">保存自定义按钮设置</span></div>
                        </div>
            `},html_lninput:function(e,t){return`
              <div class="setting-item" >
                <span><label for="${e}">${t}</label><input id="${e}" name="${e}" type="text" style="width:80px" value>
                </span>        </div> `},html_input:function(e,t){return`
                 <div class="setting-item" >
                <span><label for="${e}"> ${t}</label> </span>
              </div>
              <textarea class="settingbox hide zdy-box" id="${e}" name="${e}" style="display: inline-block;">  </textarea>
            `},html_switch:function(e,t,o){return`<div class="setting-item setting-item2 " for="${o}" style='display: inline-block;'>
                <span class="title"> ${t}</span>
                <span class="switch2" id="${e}" >
                <span class="switch-button"></span>
                <span class="switch-text">关</span>
                </span>
                </div>
                `},switchClick:function(e){var t=$(this);t.parent().attr("for");t.is(".on")?(t.removeClass("on"),t.find(".switch-text").html("关")):(t.addClass("on"),t.find(".switch-text").html("开"))},syssetting:function(){return`<h3>插件</h3>
                    <div class="setting-item zdy_dialog" >
                有空的话请点个star,您的支持是我最大的动力<a href="https://github.com/knva/wsmud_plugins" target="_blank">https://github.com/knva/wsmud_plugins</a>
                </div> `+UI.html_lninput("welcome","欢迎语句： ")+UI.html_lninput("die_str","死亡提示： ")+`
                <div class="setting-item">
                <span> <label for="color_select"> 界面配色： </label><select id="color_select" style="width:80px">
                    <option value="normal"> 原版 </option>
                    <option value="flat"> flat模式 </option>
                    <option value="access"> 色若模式</option>
                </select> *此功能刷新后生效
                </span></div>  
                <div class="setting-item" >
                <span><label for="family">门派选择：</label><select id="family" style="width:80px">
                        <option value="武当">武当</option>
                        <option value="华山">华山</option>
                        <option value="少林">少林</option>
                        <option value="峨眉">峨眉</option>
                        <option value="逍遥">逍遥</option>
                        <option value="丐帮">丐帮</option>
                        <option value="武馆">武馆</option>
                        <option value="杀手楼">杀手楼</option>
                    </select>
                </span>
                </div>`+UI.html_switch("autorelogin","自动重连: ","auto_relogin")+UI.html_switch("shieldswitch","聊天频道屏蔽开关: ","shieldswitch")+UI.html_switch("silence","安静模式:","silence")+UI.html_switch("dpssakada","战斗统计:","dpssakada")+UI.html_switch("funnycalc","funny计算:","funnycalc")+"<h3>屏蔽选项</h3>"+UI.html_lninput("shield","屏蔽人物名(用半角逗号分隔)：")+UI.html_lninput("shieldkey","屏蔽关键字(用半角逗号分隔)：")+"<h3>师门任务配置</h3>"+UI.html_switch("sm_loser","师门自动放弃：","sm_loser")+UI.html_switch("sm_any","师门任务提交稀有：","sm_any")+UI.html_switch("sm_price","师门自动牌子：","sm_price")+UI.html_switch("sm_getstore","师门自动仓库取：","sm_getstore")+`<h3>自命令配置</h3>
                <div class="setting-item" >
                <span> <label for="zmlshowsetting"> 自命令显示位置： </label><select id="zmlshowsetting" style="width:80px">
                    <option value="0"> 物品栏 </option>
                    <option value="1"> 技能栏下方 </option>
                </select>
                </span></div> `+"<h3>武道塔配置</h3>"+UI.html_lninput("wudao_pfm","武道释放技能(用半角逗号分隔)：")+"<h3>杂项配置</h3>"+UI.html_switch("autorewardgoto","开启转发路径：","auto_rewardgoto")+UI.html_switch("busyinfo","显示昏迷信息：","busy_info")+UI.html_switch("saveAddr","使用豪宅仓库：","saveAddr")+UI.html_switch("getitemShow","显示获得物品：","getitemShow")+UI.html_input("statehml","当你各种状态中断后，自动以下操作(部分地点不执行)：")+UI.html_input("backimageurl","背景图片url(建议使用1920*1080分辨率图片)：")+UI.html_input("loginhml","登录后执行命令：")+`
                <div class="setting-item">
                <span> <label for="bagFull"> 背包已满提示： </label><select id="bagFull" style="width:80px">
                    <option value="0"> 文字提醒 </option>
                    <option value="1"> 提示音 </option>
                    <option value="2"> 语音提醒 </option>
                </select>
                </span></div>`+"<h3>推送配置</h3>"+UI.html_switch("pushSwitch","远程通知推送开关(使用@push推送通知，语法参考@print)：","pushSwitch")+`
                <div class="setting-item">
                <span> <label for="pushType"> 通知推送方式(使用方法加群看)： </label><select id="pushType" style="width:80px">
                    <option value="0"> Server酱(限32字符) </option>
                    <option value="1"> Bark iOS </option>
                    <option value="2"> PushPlus.plus(支持html标签) </option>
                    <option value="3"> 飞书机器人 </option>
                    <option value="4"> Qmsg私聊 </option>
                    <option value="5"> Qmsg群聊 </option>
                </select>
                </span></div> `+UI.html_lninput("pushToken","推送方式对应的Token或Key(只要Key不要填整个网址)：")+"<h3>自动BOSS配置</h3>"+UI.html_switch("marry_kiss","自动喜宴：","automarry")+UI.html_switch("ks_Boss","自动传到boss：","autoKsBoss")+UI.html_lninput("auto_eq","BOSS击杀时自动换装：")+UI.html_lninput("ks_pfm","BOSS叫杀延时(ms)： ")+UI.html_lninput("ks_wait","BOSS击杀等待延迟(s)： ")+UI.html_input("auto_command","输入喜宴及boss后命令(留空为自动挖矿或修炼)：")+UI.html_input("blacklist","输入黑名单boss名称(黑名单boss不会去打,中文,用半角逗号分隔)：")+"<h3>自动施法配置</h3>"+UI.html_input("unauto_pfm","自动施法黑名单(填技能代码，使用半角逗号分隔)：")+UI.html_switch("autopfmswitch","自动施法开关：","auto_pfmswitch")+UI.html_switch("autopfmmode","AI施法模式：","auto_pfm_mode")+"<h3>仓库存储配置</h3>"+UI.html_switch("autoupdateStore","自动更新仓库数据：","auto_updateStore")+UI.html_input("store_info","自动存储的物品名称（自动获得的物品信息,随仓库内容更新）：")+UI.html_input("store_info2","手动添加的自动存仓物品信息（不会随仓库内容更新，使用半角逗号分隔）：")+UI.html_input("lock_info","已锁物品名称(锁定物品不会自动丢弃,使用半角逗号分隔)：")+UI.html_input("store_drop_info","输入自动丢弃的物品名称(使用半角逗号分隔)：")+UI.html_input("store_fenjie_info","输入自动分解的物品名称(使用半角逗号分隔)：")+UI.html_input("autobuy","自动当铺购买清单：(用半角逗号分隔)")+UI.html_input("autoSkillPaperSell","自动回收残页清单：(用半角逗号分隔)")+"<h3>技能自定义</h3>"+UI.html_switch("zdyskillsswitch","自定义技能顺序开关：","zdyskills")+UI.html_input("zdyskilllist","自定义技能顺序json数组：")+' <div class="setting-item" ><div class="item-commands"><span class="clear_skillJson">清空技能json数组</span></div></div>'+`

                <div class="setting-item" >
                <div class="item-commands"><span class="update_id_all">初始化ID</span>
                                            <span class="clean_id_all">清空商品ID配置</span></div>
                        </div>
                <div class="setting-item" >
                <div class="item-commands"><span class="update_store">更新存仓数据(覆盖)</span><span class="clean_dps">重置伤害统计</span></div>
                    </div>
                <div class="setting-item" >
                <div class="item-commands"><span class="backup_btn">备份到云</span><span class="load_btn">加载云配置</span></div>
            </div>

            <h3>自定义按钮</h3>`+UI.zdyBtnsetui()+" <h3>系统</h3> "},skillsPanel:`<div class="item-commands" style="text-align:center" id='skillsPanelUI'>
                <div style="margin-top:0.5em">
                    <div style="width:8em;float:left;text-align:left;padding:0px 0px 0px 2em;height:1.23em" id="wsmud_raid_left" @click='show'><wht>{{role}}</wht></div>
                    <div style="width:calc(100% - 16em);float:left;height:1.23em"><hig>套装列表</hig></div>
                    <div style="width:8em;float:left;text-align:right;padding:0px 2em 0px 0px;height:1.23em" id="wsmud_raid_right">
                    <select style="width:80px" id="eqskills-opts" @change="eqskills_opts_change(eqskills_id)" v-model="eqskills_id">
                        <option value="none">选择操作</option>
                        <option value="save">新建套装</option>
                        <option value="covereq">覆盖套装</option>
                        <option value="copyeq">复制命令</option>
                        <option value="delete">删除套装</option>
                        <option value="uneqall">脱光装备</option>
                    </select></div>
                </div>
                <br><br>
				<div class="item-commands">
                <span class="zdy-item"  v-for="(item, index) in eqlistdel" @click='deleq(index)'
                        style="width: 120px;">
                        <div class="eqsname" style="width: 100%;">删除{{index}}</div>
                </span>
				</div>
				<div class="item-commands">
                <span class="zdy-item"  v-for="(item, index) in eqlist" @click='eq(index)'
                        style="width: 120px;">
                        <div class="eqsname" style="width:100%;">装备套装:{{index}}</div>
                </span>

				</div>
                <div class="item-commands">
                <span class="zdy-item"  v-for="(item, index) in covereqlist" @click='covereq(index)'
                        style="width: 120px;">
                        <div class="eqsname" style="width:100%;">覆盖套装:{{index}}</div>
                </span>

				</div>
                <br>
				<div class="item-commands">
                    <span class="zdy-item"  v-for="(item, index) in eqlist" @click='eqs(index)'
                        style="width: 120px;">
                        <div class="eqsname" style="width: 100%;">装备技能:{{index}}</div>
                </span>
				</div>
                <div class="item-commands">
                <span class="zdy-item"  v-for="(item, index) in cpeqlist" @click='copyeq(index)'
                        style="width: 120px;">
                        <div class="eqsname" style="width:100%;">复制装备套装:{{index}}</div>
                </span>

				</div>
                <br>
				<div class="item-commands">
                    <span class="zdy-item"  v-for="(item, index) in cpeqlist" @click='copyeqs(index)'
                        style="width: 120px;">
                        <div class="eqsname" style="width: 100%;">复制装备技能:{{index}}</div>
                </span>
				</div>
                 <br>

                </div>
        `,zmlsetting:`<div class='zdy_dialog' style='text-align:right;width:280px' id="zmldialog">
    <div class="setting-item"><span><label for="zml_name"> 输入自定义命令名称:</label></span><span><input id="zml_name"
                style='width:80px' type="text" name="zml_name" value="" v-model="singnalzml.name"></span></div>
    <div class="setting-item"> <label for="zml_type"> 自命令类型： </label><select id="zml_type" style="width:80px"
            v-model="singnalzml.zmlType">
            <option value="0"> 插件原生 </option>
            <option value="1"> Raidjs流程 </option>
            <option value="2"> JS原生 </option>
        </select> </div>
    <div class="setting-item"> <label for="zml_info"> 输入自定义命令(用半角分号(;)分隔):</label></div>
    <div class="setting-item"><textarea class="settingbox hide zdy-box" style="display: inline-block;" id='zml_info'
            v-model="singnalzml.zmlRun"></textarea></div>
    <div class="item-commands"><span class="getSharezml" @click="getShare"> 查询分享 </span> <span class="editadd"
            @click="add"> 保存 </span> <span class="editdel" @click="del"> 删除 </span> </div>
    <div class="item-commands" id="zml_show">
        <span v-for="(item, index) in zmldata" @click="edit(item)">
            编辑{{item.name}}
        </span>
        <br />
        <span v-for="(item, index) in zmldata" @click="showp(item)">
             <label v-if="item.zmlShow == '1'">取消快速使用</label><label v-else>快速使用</label>{{item.name}}
        </span>
        <br />
        <span v-for="(item, index) in zmldata" @click="share(item)">
            分享{{item.name}}
        </span>
        <br />
    </div>
</div> `,zmlandztjkui:`<div class='zdy_dialog' style='text-align:right;width:280px' id="zmlandztjk">
     <div class="item-commands"> <span class="editzml" @click="zml"> 编辑自命令 </span> </div>
     <div class="item-commands"> <span class="editztjk" @click="ztjk"> 编辑自定义监控 </span>
         <div class="item-commands"> <span class="startzdjk" @click="startjk"> 注入所有监控 </span> <span class="stopzdjk"
                 @click="stopjk"> 暂停所有监控
             </span>
         </div>
     </div>
     <div class="item-commands" id="zml_show">
                 <span v-for="(item, index) in zmldata" @click="run(item)">
                     {{item.name}}
                 </span>
     </div>
 </div>`,ztjksetting:`<div class='zdy_dialog' style='text-align:right;width:280px'>
    <div class="setting-item"> <label> 请打开插件首页,查看文档及例子,本人血量状态监控 请按如下规则输入关键字 90|90 这样监控的是hp 90% mp 90% 以下触发</label></div>
    <div class="setting-item"> <label for="ztjk_name"> 名称:</label><input id="ztjk_name" style='width:80px' type="text"
            name="ztjk_name" value=""></div>
    <div class="setting-item"><label for="ztjk_type"> 类型(type):</label><select style='width:80px' id="ztjk_type">
            <option value="status"> 状态(status) </option>
            <option value="text"> 文本(text) </option>
            <option value="msg"> 聊天(msg) </option>
            <option value="die"> 死亡(die) </option>
            <option value="itemadd"> 人物刷新(itemadd) </option>
            <option value="room"> 地图名与房间人物(room) </option>
            <option value="dialog"> 背包监控(dialog) </option>
            <option value="combat"> 战斗状态(combat) </option>
            <option value="sc"> 血量状态(sc) </option>
            <option value="enapfm"> 技能监控(enapfm) </option>
            <option value="dispfm"> 技能监控(dispfm) </option>
        </select></div>
    <div class="setting-item"><span id='actionp' style='display:block'><label for="ztjk_action">
                动作(action):</label><input id="ztjk_action" style='width:80px' type="text" name="ztjk_action"
                value=""></span></div>
    <div class="setting-item"><span><label for="ztjk_keyword"> 关键字(使用半角 | 分割):</label><input id="ztjk_keyword"
                style='width:80px' type="text" name="ztjk_keyword" value=""></span></div>
    <div class="setting-item"><span><label for="ztjk_ishave"> 触发对象: </label><select style='width:80px' id="ztjk_ishave">
                <option value="0"> 其他人 </option>
                <option value="1"> 本人 </option>
                <option value="2"> 仅NPC </option>
            </select></span></div>
    <div class="setting-item"> <span id='senduserp' style='display:block'><label for="ztjk_senduser"> MSG/其他人名称(使用半角 |
                分割):</label><input id="ztjk_senduser" style="width:80px;" type="text" name="ztjk_senduser"
                value=""></span></div>
    <div class="setting-item"> <span style='display:block'><label> Buff层数:</label><input id="ztjk_maxcount"
                style="width:80px;" type="text" name="ztjk_maxcount" value=""></span></div>
    <div class="setting-item"> <span style='display:block'><label> 状态监控提示:</label><select style='width:80px'
                id="ztjk_istip">
                <option value="1"> 提示 </option>
                <option value="0"> 不提示 </option>
            </select></span></div>
    <div class="setting-item"><span><label for="ztjk_send"> 输入自定义命令(用半角分号(;)分隔):</label></span></div>
    <div class="setting-item"> <textarea class="settingbox hide zdy-box" style="display: inline-block;"
            id='ztjk_send'></textarea></div>
    <div class="item-commands"><span class="ztjk_sharedfind"> 查询分享 </span> <span class="ztjk_editadd"> 保存 </span> <span
            class="ztjk_editdel"> 删除 </span></div>
    <div class="item-commands" id="ztjk_show"></div>
    <div class="item-commands" id="ztjk_set"></div>
</div> `,jsquivue:`
                    <div class="JsqVueUI">
                    <div class="item-commands">
                <span @click='qnjs_btn'>潜能计算</span>
                <span @click='lxjs_btn'>练习时间及潜能计算</span>
                <span @click='khjs_btn'>开花计算</span>
                <span @click='zcjs_btn'>自创等级计算</span>
                <span  @click='getskilljson'>提取技能属性(可用于苏轻模拟器)</span>
                <span  @click='autoAddLianxi'>自动将最低等级技能添加到离线练习</span>
            </div>
            <div class="item-commands">
                <span  @click='onekeydaily'>一键日常</span>
                <span  @click='onekeypk'>自动比试</span>
                <span  @click='onekeysansan'>导入白三三懒人包（依赖raid.js）</span>
                <span  @click='onelddh'>来点动画（依赖raid.js）</span>
            </div>
            <div class="item-commands">
                <span  @click="onekeystore">存仓及贩卖</span>
                <span  @click='onekeysell'>丢弃及贩卖</span>
                <span  @click='onekeyfenjie'>分解及贩卖</span>
            </div>
            <div class="item-commands">
                <span @click='updatestore'>更新仓库数据(覆盖)</span>
                <span @click='sortstore'>排序仓库</span>
                <span @click='sortbag'>排序背包</span>
                <span @click='dsrw'>定时任务</span>
                <span @click='cleandps'>清空伤害</span>
                <span @click='cleankksboss'>不再提示婚宴及boss传送信息</span>
            </div>
            <div class="item-commands">
                <span @click='onekeyyaota'>一键妖塔</span>
                <span @click='onekeydelaytest'>延迟测试</span>
                <span @click='yuanshen'>原神</span>
            </div>
            </div>`,lxjsui:`
                       <div style="width:50%;float:left" class='StudyTimeCalc'>
     <div class="setting-item"> <span>练习时间计算器</span></div>
     <div class="setting-item">先天悟性:<input type="number"  placeholder="先天悟性" style="width:50%"
             class="mui-input-speech" v-model=jsqsx.xtwx></div>
     <div class="setting-item">后天悟性:<input type="number"  placeholder="后天悟性" style="width:50%"
             class="mui-input-speech" v-model=jsqsx.htwx></div>
     <div class="setting-item">练习效率:<input type="number"  placeholder="练习效率" style="width:50%"
             class="mui-input-speech" v-model=jsqsx.lxxl></div>
     <div class="setting-item">初始等级:<input type="number" placeholder="初始等级" style="width:50%"
             class="mui-input-speech" v-model=jsqsx.clevel></div>
     <div class="setting-item"> 目标等级:<input type="number" placeholder="目标等级" style="width:50%"
             v-model=jsqsx.mlevel></div>
     <div class="setting-item">技能颜色: <select style="width:50%" v-model=jsqsx.color>
             <option value='0'>选择技能颜色</option>
             <option value='1' style="color: #c0c0c0;">白色</option>
             <option value='2' style="color:#00ff00;">绿色</option>
             <option value='3' style="color:#00ffff;">蓝色</option>
             <option value='4' style="color:#ffff00;">黄色</option>
             <option value='5' style="color:#912cee;">紫色</option>
             <option value='6' style="color: #ffa600;">橙色</option>
             <option value='7' style="color: #CC0000;">红色</option>
         </select></div>
                <div class="setting-item">
        <div class="item-commands"><span @click="lxjscalc">计算</span></div>
             </div>
    </div>`,qnjsui:` <div style="width:50%;float:left" class="QianNengCalc">
    <div class="setting-item"> <span>潜能计算器</span></div>
    <div class="setting-item">初始等级:<input type="number" placeholder="初始等级" style="width:50%"
            class="mui-input-speech" v-model='qnsx.c'>
    </div>
    <div class="setting-item"> 目标等级:<input type="number" v-model='qnsx.m' placeholder="目标等级" style="width:50%">
    </div>
    <div class="setting-item"> 技能颜色:<select id="se" style="width:50%" v-model='qnsx.color'>
            <option value='0'>选择技能颜色</option>
            <option value='1' style="color: #c0c0c0;">白色</option>
            <option value='2' style="color:#00ff00;">绿色</option>
            <option value='3' style="color:#00ffff;">蓝色</option>
            <option value='4' style="color:#ffff00;">黄色</option>
            <option value='5' style="color:#912cee;">紫色</option>
            <option value='6' style="color: #ffa600;">橙色</option>
        </select>
        </div>
        <div class="setting-item">
        <div class="item-commands"><span @click="qnjscalc">计算</span></div>
             </div>

</div>`,khjsui:`<div style="width:50%;float:left" class="KaihuaCalc">
    <div class="setting-item"><span>开花计算器</span></div>
    <div class="setting-item"> 当前内力:<input type="number" placeholder="当前内力" style="width:50%"
            class="mui-input-speech" v-model="khsx.nl"></div>
    <div class="setting-item"> 先天根骨:<input type="number" placeholder="先天根骨" style="width:50%"
        v-model="khsx.xg"></div>
    <div class="setting-item"> 后天根骨:<input type="number" placeholder="后天根骨" style="width:50%"
        v-model="khsx.hg"></div>
    <div class="setting-item">      <div class="item-commands"><span @click="khjscalc" >计算</span></div></div>
    <div class="setting-item"> <label>人花分值：5000 地花分值：6500 天花分值：8000</label></div>
</div>`,zcjsui:`<div style="width:50%;float:left" class="ZiChuangCalc">
    <div class="setting-item"><span>自创等级计算器</span></div>
    <div class="setting-item"> 自创等级:<input type="number" placeholder="自创等级" style="width:50%"
            class="mui-input-speech" v-model="zcsx.level"></div>
    <div class="setting-item"> 目标属性百分比:<input type="number" placeholder="目标属性百分比" style="width:50%"
        v-model="zcsx.percentage"></div>

    <div class="setting-item">      <div class="item-commands"><span @click="zcjscalc" >计算</span></div></div>

</div>`,lyui:`<div class='zdy_dialog' id="LianYao" style='text-align:right;width:280px'> 有空的话请点个star,您的支持是我最大的动力 <a target="_blank"
        href="https://github.com/knva/wsmud_plugins">https://github.com/knva/wsmud_plugins</a> 药方链接:<a target="_blank"
        href="https://emeisuqing.github.io/wsmud.old/yaofang/">https://emeisuqing.github.io/wsmud.old/yaofang/</a>
    <div class="setting-item"> <span> <label for="medicine_level"> 级别选择： </label><select style='width:80px'
                id="medicine_level" v-model="level">
                <option value="1">绿色</option>
                <option value="2">蓝色</option>
                <option value="3">黄色</option>
                <option value="4">紫色</option>
                <option value="5">橙色</option>
                <option value="6">红色</option>
            </select></span></div>
    <div class="setting-item"> 数量:<span><input id="mednum" v-model="num" style="width:80px;" type="number" name="mednum" value="1">
        </span></div>
    <div class="setting-item"> <span><label for="medicint_info"> 输入使用的顺序(使用半角逗号分隔,多配方使用 | 分割):</label></span></div>
    <div class="setting-item"><textarea v-model="info"  class="settingbox hide zdy-box" style="display: inline-block;"
            id='medicint_info'>石楠叶,金银花,金银花,金银花,当归</textarea></div>
    <div class="item-commands"> <span class="startDev" @click="startDev"> 开始 </span><span class="stopDev" @click="stopDev"> 停止 </span> </div>
</div>`,timeoutui:`<div class='zdy_dialog' style='text-align:right;width:280px'> 注意,可以留空的时或者分,这样就是每分钟/小时 的x秒触发任务,秒为必填项目 <div class="setting-item">    <span>任务名:<input type="text" id="questname" placeholder="任务名" style="width:50%"></span></div> <div class="setting-item">     <label for = "rtype"> 运行次数 </label><select style='width:80px' id="rtype"></div> <option value="1">一次</option> <option value="2">每天</option> </select></span></div> <div class="setting-item">  <span>时:<input type="number" id="ht" placeholder="时" style="width:50%"></span></div> <div class="setting-item">   <span>分:<input type="number" id="mt" placeholder="分" style="width:50%"></span></div> <div class="setting-item">  <span>秒:<input type="number" id="st" placeholder="秒" style="width:50%"></span></div> <div class="setting-item">  <span><label for="zml_info"> 输入自定义命令(用半角分号(;)分隔):</label></span></div> <div class="setting-item">   <textarea class = "settingbox hide zdy-box"style = "display: inline-block;"id = 'zml_info'></textarea></div> <div class = "item-commands"> <span class = "startQuest"> 开始 </span><span class = "removeQuest"> 删除 </span>  </div> <div class='questlist item-commands'></div> </div>`,toui:[`<div class='item-commands'><span cmd = "$to 扬州城-衙门正厅" > 衙门 </span>
            <span cmd = "$to 扬州城-当铺" > 当铺 </span>
            <span cmd = "$to 扬州城-醉仙楼" > 醉仙 </span>
            <span cmd = "$to 扬州城-杂货铺" > 杂货 </span>
            <span cmd = "$to 扬州城-打铁铺" > 打铁 </span>
            <span cmd = "$to 扬州城-钱庄" > 钱庄 </span>
            <span cmd = "$to 扬州城-药铺" > 药铺 </span>
            <span cmd = "$to 扬州城-扬州武馆" > 武馆 </span>
            <span cmd = "$to 扬州城-镖局正厅" > 镖局 </span>
            <span cmd = "$to 住房" > 住房 </span>
            <span cmd = "$to 扬州城-武庙" > 武庙 </span>
            <span cmd = "$to 帮会-大院" > 帮派 </span>
            <span cmd = "$to 扬州城-赌场" > 赌场 </span>
            <span cmd = "$to 扬州城-有间客栈" > 客栈 </span>
            <span cmd = "$to 扬州城-擂台" > 擂台 </span>
            <span cmd = "$to 扬州城-矿山" > 矿山 </span></div>`,`<div class='item-commands'><span cmd = "$to 武当派-后山小院" >掌门</span>
             <span cmd = "$to 武当派-石阶" >后勤</span>
             <span cmd = "$to 武当派-三清殿" >三清殿</span></div>`,`<div class='item-commands'><span cmd = "$to 少林派-方丈楼" >掌门</span>
             <span cmd = "$to 少林派-山门殿" >后勤</span>
             <span cmd = "$to 少林派-天王殿" >天王殿</span></div>`,`<div class='item-commands'><span cmd = "$to 华山派-客厅" >掌门</span>
             <span cmd = "$to 华山派-练武场" >后勤</span>
             <span cmd = "$to 华山派-落雁峰" >落雁峰</span>
             <span cmd = "$to 华山派-林间小屋" >封不平</span></div>`,`<div class='item-commands'><span cmd = "$to 峨眉派-清修洞" >掌门</span>
            <span cmd = "$to 峨眉派-走廊" >后勤</span>
            <span cmd = "$to 峨眉派-小屋" >周芷若</span>
            <span cmd = "$to 峨眉派-大殿" >静心</span></div>`,`<div class='item-commands'><span cmd = "$to 逍遥派-地下石室" >掌门</span>
             <span cmd = "$to 逍遥派-林间小道" >后勤</span>
             <span cmd = "$to 逍遥派-木屋" >薛慕华</span>
             <span cmd = "$to 逍遥派-练功房" >木桩</span></div>`,`<div class='item-commands'><span cmd = "$to 丐帮-林间小屋" >掌门</span>
             <span cmd = "$to 丐帮-暗道;go east;" >后勤</span>
             <span cmd = "$to 丐帮-土地庙" >土地庙</span></div>`,`<div class='item-commands'><span cmd = "$to 杀手楼-书房" >掌门</span>
             <span cmd = "$to 杀手楼-休息室;" >后勤</span></div>`,`<div class='item-commands'><span cmd = "@call 自动襄阳" >自动襄阳</span></div>`,`<div class='item-commands'><span cmd = "@call 自动武道塔" >自动武道塔</span>
            <span cmd = "$goyt">妖塔</span>
            <span cmd = "$gogzm">古宗门</span>
            <span cmd = "$godddb">大殿底部</span></div>`],fbui:function(e,t,o){let n="<div class='item-commands'>";return unsafeWindow&&unsafeWindow.ToRaid?(ToRaid.existAutoDungeon(e+" 0")&&(n+=`<span cmd = "@fb ${e} 0" >自动副本-${e}</span>`),o&&ToRaid.existAutoDungeon(e+" 1")&&(n+=`<span cmd = "@fb ${e} 1" >自动副本-${e}-困难</span>`),t&&ToRaid.existAutoDungeon(e+" 2")&&(n+=`<span cmd = "@fb ${e} 2" >自动副本-${e}-组队</span>`)):n+="未安装Raid.js插件","<div class='item-commands'>"==n?"<div>暂无自动副本脚本,欢迎共享。可以到三三仓库寻找更多脚本。</div>":n+"</div>"},itemui:function(e){let t=`<div class="item-commands ">
            <span class = "addstore" cmd='$addstore ${e=e.toLowerCase()}'> 添加到存仓 </span>`;return 0<=lock_list.indexOf(e)?t+=`<span class = "dellock" cmd='$dellock ${e}'> 移除物品锁 </span>`:t+=`<span class = "addlock" cmd='$addlock ${e}'> 添加物品锁 </span>`,0<=e.indexOf("★")||0<=e.indexOf("☆")||0<=e.indexOf("hio")||0<=e.indexOf("hir")||0<=e.indexOf("ord")||(0<=e.indexOf("残页")&&"武道残页"!=e?t+=`<span class = "addzxbuy"  cmd='$addzxbuy ${e}'> 添加到回收 </span>`:t+=`<span class = "addfenjieid"  cmd='$addfenjieid ${e}'> 添加到分解 </span>`,-1==lock_list.indexOf(e)&&(t+=`<span class = "adddrop" cmd='$adddrop ${e}'> 添加到丢弃 </span>`)),t+="</div>"}},G={id:void 0,state:void 0,room_name:void 0,family:void 0,items:new Map,stat_boss_success:0,stat_boss_find:0,stat_xiyan_success:0,stat_xiyan_find:0,cds:new Map,in_fight:!1,fight_id:"",auto_preform:!1,auto_pfm_mode:!1,can_auto:!1,level:void 0,getitemShow:void 0,wk_listener:void 0,status:new Map,score:void 0,party:"",yaoyuan:0,yaotaFlag:!1,yaotaCount:0,jy:0,qn:0,selfStatus:[],wsdelaySetTime:void 0,wsdelaySetCount:void 0,wsdelay:void 0,enable_skills:[{type:"unarmed",name:"none"},{type:"force",name:"none"},{type:"parry",name:"none"},{type:"dodge",name:"none"},{type:"sword",name:"none"},{type:"throwing",name:"none"},{type:"blade",name:"none"},{type:"whip",name:"none"},{type:"club",name:"none"},{type:"staff",name:"none"}],eqs:[],isGod:function(){return null!=G.level&&(0<=G.level.indexOf("武帝")||0<=G.level.indexOf("武神")||0<=G.level.indexOf("剑神")||0<=G.level.indexOf("刀皇")||0<=G.level.indexOf("兵主")||0<=G.level.indexOf("战神"))},cookie:void 0,connected:!1},GI={gcdThread:null,init:function(){WG.add_hook("items",function(e){WG.saveRoomstate(e)});var n=!1;WG.add_hook(["dialog","text"],function(e){if("dialog"==e.type){null==WG.packup_listener&&null!=e.id&&null!=e.store&&n&&(WG.SendCmd("store"),n=!1);var t=e.stores;if(null!=t){store_list=[];for(var o of t)store_list.push(o.name.toLowerCase());zdy_item_store=store_list.join(","),$("#store_info").val(zdy_item_store),GM_setValue(roleid+"_zdy_item_store",zdy_item_store),store_list=store_list.concat(zdy_item_store2.split(","))}}else auto_updateStore=GM_getValue(roleid+"_auto_updateStore",auto_updateStore),null==WG.sort_hook&&"开"==auto_updateStore&&e.msg.indexOf("书架")<0&&(/^你把(.+)存入仓库。$/.test(e.msg)||/^你从仓库里取出(.+)。$/.test(e.msg))&&(n=!0)}),WG.add_hook("dialog",function(e){if("pack"==e.dialog&&null!=e.items&&(packData=e.items,eqData=e.eqs,G.eqs=e.eqs),"pack"==e.dialog&&null!=e.uneq&&(G.eqs[e.uneq]=null),"pack"==e.dialog&&null!=e.eq&&(G.eqs[e.eq]={id:e.id,name:""}),"skills"==e.dialog){if(null!=e.enable&&"开"==zdyskills&&(messageAppend("检测到更换技能,请刷新重新获取技能数据!"),zdyskills="关",GM_setValue(roleid+"_zdyskilllist",""),GM_setValue(roleid+"_zdyskills",zdyskills)),e.items)for(var t of e.items)if(0<=t.name.indexOf("基本"))if(t.enable_skill){for(var o of G.enable_skills)if(o.type==t.id){o.name=t.enable_skill;break}}else for(var n of G.enable_skills)if(n.type==t.id){n.name="none";break}if(null!=e.enable)for(var s of G.enable_skills)if(s.type==e.id){s.name=e.enable;break}}"party"==e.dialog&&(G.party=e.name)}),WG.add_hook(["status","login","exits","room","items","itemadd","itemremove","sc","text","state","msg","perform","clearDistime","dispfm","combat","die"],function(n){switch(n.type){case"login":G.id=n.id,G.connected=!0,WG.online=!0;break;case"exits":G.exits=new Map,n.items.north&&G.exits.set("north",{exits:n.items.north}),n.items.south&&G.exits.set("south",{exits:n.items.south}),n.items.east&&G.exits.set("east",{exits:n.items.east}),n.items.west&&G.exits.set("west",{exits:n.items.west}),n.items.northup&&G.exits.set("northup",{exits:n.items.northup}),n.items.southup&&G.exits.set("southup",{exits:n.items.southup}),n.items.eastup&&G.exits.set("eastup",{exits:n.items.eastup}),n.items.westup&&G.exits.set("westup",{exits:n.items.westup}),n.items.northdown&&G.exits.set("northdown",{exits:n.items.northdown}),n.items.southdown&&G.exits.set("southdown",{exits:n.items.southdown}),n.items.eastdown&&G.exits.set("eastdown",{exits:n.items.eastdown}),n.items.westdown&&G.exits.set("westdown",{exits:n.items.westdown}),n.items.up&&G.exits.set("up",{exits:n.items.up}),n.items.down&&G.exits.set("down",{exits:n.items.down}),n.items.enter&&G.exits.set("enter",{exits:n.items.enter}),n.items.out&&G.exits.set("out",{exits:n.items.out});break;case"room":var s=n.path.split("/");G.map=s[0],G.room=s[1],"home"==G.map||"kuang"==G.room?G.can_auto=!0:G.can_auto=!1,G.room_name=n.name,G.in_fight&&(G.in_fight=!1,WG.auto_preform("stop"),WG.clean_dps());break;case"items":G.items=new Map;for(var e=0;e<n.items.length;e++){var i=n.items[e];if(i.id){if(i.id==G.id&&null!=i.status){G.selfStatus=[];for(var a=0;a<i.status.length;a++)G.selfStatus.push(i.status[a].sid)}let e=$.trim($("<body>"+i.name+"</body>").text());var l=e.lastIndexOf(" "),r=e.lastIndexOf("<");let t="",o="";0<=r&&(o=e.substr(r+1,2)),0<=l&&(t=e.substr(0,l),e=e.substr(l+1).replace(/<.*>/g,"")),G.items.set(i.id,{name:e,title:t,state:o,max_hp:i.max_hp,max_mp:i.max_mp,hp:i.hp,mp:i.mp,p:i.p,damage:0,status:i.status})}}break;case"itemadd":if(n.id){let e=$.trim($("<body>"+n.name+"</body>").text());var s=e.lastIndexOf(" "),d=e.lastIndexOf("<");let t="",o="";0<=s&&(t=e.substr(0,s),0<=d&&(o=e.substr(d+1,2)),e=e.substr(s+1).replace(/<.*>/g,"")),G.items.set(n.id,{name:e,title:t,state:o,max_hp:n.max_hp,max_mp:n.max_mp,hp:n.hp,mp:n.mp,p:n.p,damage:0,status:n.status})}break;case"itemremove":G.items.delete(n.id);break;case"sc":d=G.items.get(n.id);void 0!==n.hp&&(d.hp=n.hp,n.id!=G.id)&&(G.scid=n.id),void 0!==n.mp&&(d.mp=n.mp),n.id==G.id&&(null!=n.hp&&(G.hp=n.hp),null!=n.max_hp&&(G.maxHp=n.max_hp),null!=n.mp&&(G.mp=n.mp),null!=n.max_mp)&&(G.maxMp=n.max_mp);break;case"perform":G.skills=n.skills,""==zdyskilllist&&(zdyskilllist=JSON.stringify(n.skills),GM_setValue(roleid+"_zdyskilllist",zdyskilllist));break;case"clearDistime":G.cds.forEach(function(e,t){G.cds.set(t,!1)});case"dispfm":n.id&&(G.cds.set(n.id,!0),o=n.id,setTimeout(function(){G.cds.set(o,!1);var e={data:JSON.stringify({type:"enapfm",id:o})};WG.receive_message(e)},n.distime)),n.rtime&&(G.gcd&&clearTimeout(GI.gcdThread),G.gcd=!0,GI.gcdThread=setTimeout(function(){G.gcd=!1},n.rtime));break;case"combat":n.start&&(G.in_fight=!0,battletime=new Date,WG.auto_preform()),n.end&&(G.in_fight=!1,WG.auto_preform("stop"),WG.clean_dps());break;case"status":if(null!=n.count&&G.status.set(n.id,{sid:n.sid,count:n.count}),n.id==G.id)if("add"==n.action)G.selfStatus.push(n.sid),n.duration&&setTimeout(()=>{G.selfStatus.remove(n.sid)},n.duration-(n.overtime||0));else if("remove"==n.action){var t=[];for(let e=0;e<G.selfStatus.length;e++)G.selfStatus[e]!=n.sid&&t.push(G.selfStatus[e]);G.selfStatus=t}else"clear"==n.action&&(G.selfStatus=[]);if("开"===busy_info)if(n.id==G.id){if("add"==n.action&&("busy"==n.sid||"faint"==n.sid)){var o=n.id;if(messageAppend(`你被${n.name}了${n.duration/1e3}秒`,2,0),"绊字诀"==n.name)return}}else"add"!=n.action||"busy"!=n.sid&&"faint"!=n.sid&&"chidun"!=n.sid&&"unarmed"!=n.sid||messageAppend(`${G.items.get(n.id).name}被${n.name}了${n.duration/1e3}秒`,2,0);var u=G.items.get(n.id);if(null!=u)if("add"==n.action)null==u.status&&(u.status=[]),u.status.push({sid:n.sid,name:n.name,duration:n.duration,overtime:0});else if("remove"==n.action){for(let e=0;e<u.status.length;e++)if(u.status[e].sid==n.sid){u.status.splice(e,1);break}}else if("clear"==n.action)for(let e=0;e<u.status.length;e++)u.status.splice(e,1);break;case"text":0<=n.msg.indexOf("还没准备好，你还不能使用。")&&(G.gcd||(G.gcd=!0,setTimeout(()=>{G.gcd=!1},500))),(0<=n.msg.indexOf("不要急")||0<=n.msg.indexOf("你现在手忙脚乱")||0<=n.msg.indexOf("你正在昏迷")||0<=n.msg.indexOf("你上个技能"))&&G.auto_preform&&(G.gcd||(G.gcd=!0,setTimeout(()=>{G.gcd=!1},500)));break;case"die":G.selfStatus=[],""!=die_str&&null==n.relive&&textShow(die_str)}}),WG.add_hook("state",function(e){console.dir(e),"state"!=e.type||null!=e.state||0<=G.room_name.indexOf("副本")||0<=G.room_name.indexOf("襄阳")||0<=G.room_name.indexOf("矿山")||0<=G.room_name.indexOf("练功房")||(statehml=GM_getValue(roleid+"_statehml",statehml),WG.SendCmd(statehml))}),WG.add_hook("dialog",function(i){if("pack"==i.dialog&&null!=i.items&&0<=i.items.length){for(var e=0;e<i.items.length;e++)0<=i.items[e].name.indexOf("铁镐")&&(equip["铁镐"]=i.items[e].id);for(var t=0;t<i.eqs.length;t++)null!=i.eqs[t]&&0<=i.eqs[t].name.indexOf("铁镐")&&(equip["铁镐"]=i.eqs[t].id)}else if("pack"==i.dialog&&null!=i.desc)messageClear(),messageAppend(`<div class="item-commands ">
                <span class = "copyid" data-clipboard-target = ".target1" > `+i.desc.split("\n")[0]+":"+i.id+`复制到剪贴板 </span></div>
                         `),$(".copyid").off("click"),$(".copyid").on("click",()=>{GM_setClipboard(i.id),messageAppend("复制成功")});else if("pack"==i.dialog&&null!=i.name)packData.push({id:i.id,name:i.name,count:i.count});else if("list"==i.dialog&&null!=i.stores)storeData=i.stores;else if("list"==i.dialog&&null!=i.store){let t=!0,o=null,n=null;for(let e=0;e<packData.length;e++){var a=packData[e];if(null!=a&&a.id==i.id){t=!1;a=a.count-i.store;0==a?o=e:packData[e].count=a;break}}if(t)for(let e=0;e<storeData.length;e++){var l=storeData[e];if(null!=l&&l.id==i.storeid){l={id:i.id,name:l.name,count:Math.abs(i.store)};packData.push(l);break}}let s=!0;for(let e=0;e<storeData.length;e++){var r=storeData[e];if(null!=r&&r.id==i.id){s=!1;r=r.count+i.store;0===r?n=e:storeData[e].count=r;break}}if(s)for(let e=0;e<packData.length;e++){var d=packData[e];if(null!=d&&d.id===i.id){d={id:i.stroeid,name:d.name,count:Math.abs(i.store)};storeData.push(d);break}}null!=o&&packData.splice(o,1),null!=n&&storeData.splice(n,1)}else if("pack"==i.dialog&&null!=i.jldesc){var o=i.jldesc.match(/<(.*)>(.*)<\/.*><br\/>精炼<(hig|hic|hiy|hiz|hio|ord)>＋(.*)\s</i);if(o){var n=o[1],n=`<${n}>`+o[2]+`</${n}>`,s=13-parseInt(o[4]);let t=[];for(let e=0;e<s;e++)t.push(`jinglian ${i.id} ok`);$(".content-message pre").append($(`<div class="item-commands"><span class="jinglian">精炼6星 => ${n}</span></div>`).click(()=>WG.SendCmd(t))),AutoScroll(".content-message")}}"score"==i.dialog&&(console.log("score update"),G.level||null==i.level||(G.level=i.level,console.log("欢迎"+G.level)),G.family||null==i.family?null!=i.study_per&&(G.score2=i):(G.pfamily=i.family,G.family=i.family.replaceAll("派",""),console.log(G.family),"无门无"==G.family&&(G.family="武馆"),family=G.family,G.score=i,GM_setValue(roleid+"_family",G.family)),i.hp)&&i.mp&&i.pot&&(G.score=i)}),WG.add_hook(["dialog","items"],e=>{if("dialog"==e.type){if(e.selllist){for(var t of e.selllist){var o=t.name.replace(/<[^>]+>/g,""),n=/<([^<>]*)>/.exec(t.name)[1];null!=pgoods[o]&&(pgoods[o].id=t.id),null!=pgoods[n+o]&&(pgoods[n+o].id=t.id)}GM_setValue("goods",pgoods)}}else if("items"==e.type)if(WG.at("扬州城-醉仙楼")){for(var s of e.items)if("店小二"==s.name)return npcs["店小二"]=s.id,void GM_setValue("npcs",npcs)}else for(var i of e.items){if("店小二"==i.name)return;if(null!=npcs[i.name])return npcs[i.name]=i.id,void GM_setValue("npcs",npcs)}}),WG.add_hook("msg",function(e){var t,o;"sys"==e.ch?(t=GM_getValue(roleid+"_automarry",t),0<=e.content.indexOf("，婚礼将在一分钟后开始。")&&(console.dir(e),"开"==t&&0==G.in_fight?stopauto||WG.at("副本")?(messageClear(),messageAppend("<hiy>点击参加喜宴</hiy>"),messageAppend("<div class=\"item-commands\"><span  id = 'onekeyjh'>参加喜宴</span></div>"),$("#onekeyjh").on("click",function(){WG.xiyan()})):(console.log("xiyan"),WG.xiyan()):"关"!=t&&1!=G.in_fight||(messageClear(),messageAppend("<hiy>点击参加喜宴,由于未开启自动传送,或者在战斗中,需要手动传送</hiy>"),messageAppend("<div class=\"item-commands\"><span  id = 'onekeyjh'>参加喜宴</span></div>"),$("#onekeyjh").on("click",function(){WG.xiyan()})))):"rumor"==e.ch&&0<=e.content.indexOf("听说")&&0<=e.content.indexOf("出现在")&&0<=e.content.indexOf("一带。")&&(console.dir(e),"开"==autoKsBoss&&0==G.in_fight?stopauto||WG.at("副本")?(o="<div class=\"item-commands\"><span id = 'onekeyKsboss'>传送到boss</span></div>",messageClear(),messageAppend("boss已出现"),messageAppend(o),$("#onekeyKsboss").on("click",function(){WG.kksBoss(e)})):WG.kksBoss(e):"关"!=autoKsBoss&&1!=G.in_fight||(o="<div class=\"item-commands\"><span id = 'onekeyKsboss'>传送到boss</span></div>",messageClear(),messageAppend("<hiy>boss已出现,由于未开启自动传送,或者在战斗中,需要手动传送</hiy>"),messageAppend(o),$("#onekeyKsboss").on("click",function(){WG.kksBoss(e)})))}),WG.add_hook("text",function(t){if(G.getitemShow&&(0<=t.msg.indexOf("恭喜你得到")||0<=t.msg.indexOf("获得")&&-1==t.msg.indexOf("经验")&&-1==t.msg.indexOf("潜能")&&-1==t.msg.indexOf("提升")||0==t.msg.indexOf("你找到")||0==t.msg.indexOf("你从")||0<=t.msg.indexOf("得到")&&-1==t.msg.indexOf("郭襄在得到倚天剑")&&-1==t.msg.indexOf("长白山得到剑谱"))&&messageAppend(t.msg),-1==t.msg.indexOf("说：")&&((0<=t.msg.indexOf("只能在战斗中使用。")||-1!=t.msg.indexOf("这里不允许战斗")||-1!=t.msg.indexOf("没时间这么做"))&&G.in_fight&&(G.in_fight=!1,WG.auto_preform("stop"),WG.clean_dps()),0<=t.msg.indexOf("加油，加油！！")&&0==G.in_fight&&(G.in_fight=!0,WG.auto_preform()),0<=t.msg.indexOf("你的内力不够，无法使用"))&&null!=G.preform_timer&&(WG.auto_preform("stop"),messageAppend("内力不足,停止自动出招",1,0)),"text"==t.type){if((0<=t.msg.indexOf(role+"身上东西太多了")||0<=t.msg.indexOf("你身上东西太多了")||0<=t.msg.indexOf("你拿不下那么多东西。"))&&(WG.Send("tm 友情提示：请检查是否背包已满！"),messageAppend("友情提示：请检查是否背包已满！",1),1==bagFull?Beep():2==bagFull&&FakerTTS.playtts(role+"，请检查是否背包已满！"),0<=WG.sm_state)&&(WG.sm_state=-1,$(".sm_button").text("师门(Q)")),0<=t.msg.indexOf("长得")&&0<=t.msg.indexOf("看起来")){var o=t.msg.split("\n")[0].split(" ");let e=o[o.length-1];0<=e.indexOf("<")&&(e=e.split("<")[0]);o=(new Date).getMilliseconds();messageAppend(`<div class="item-commands"><span id="addshield${o}">屏蔽 ${e}</span></div>`,0,0),$("#addshield"+o).on("click",function(){GM_setValue("_shield",shield=""!=(shield=GM_getValue("_shield",shield))?shield+","+e:e),$("#shield").val(shield),messageAppend("已屏蔽",1,1)})}"开"==dpssakada&&(/.*造成<.*>.*<\/.*>点.*/.test(t.msg)&&"你"!=(e=(o=t.msg.split(/.*造成<wht>|.*造成<hir>|<\/wht>点|<\/hir>点/))[2].split(/伤害|\(|</))[2]&&("暴击"==e[0]?lastcri=parseInt(o[1]):lastpfm=parseInt(o[1]),dpslock=1),2<=(e=t.msg.split(/看起来充满活力，一点也不累。|似乎有些疲惫，但是仍然十分有活力。|看起来可能有些累了。|动作似乎开始有点不太灵光，但是仍然有条不紊。|已经一副头重脚轻的模样，正在勉力支撑著不倒下去。|看起来已经力不从心了。|已经陷入半昏迷状态，随时都可能摔倒晕去。|似乎十分疲惫，看来需要好好休息了。|气喘嘘嘘，看起来状况并不太好。|摇头晃脑、歪歪斜斜地站都站不稳，眼看就要倒在地上。/)).length)&&(e[0].indexOf("你")<0&&(0<lastcri&&(critical+=lastcri,criticalnum+=1),0<lastpfm)&&(pfmdps+=lastpfm,pfmnum+=1),lastpfm=lastcri=0)}o=t.msg.match(/看起来(.*)想杀死你！/)||t.msg.match(/你扑向(.*)/);if(Array.isArray(o)&&1<o.length){let t=o[1];var e=roomData.find(e=>e.name&&e.name.includes(t));e&&(G.fight_id=e.id)}}),WG.add_hook("dialog",function(e){"jh"==e.dialog&&e.fbs&&(fb_path=e.fbs)}),WG.add_hook(["text","sc"],function(e){if("关"!=funnycalc)if("text"===e.type&&/你的最大内力增加了/.test(e.msg)){var t=e.msg.replace(/[^0-9]/gi,""),o=G.score,n=o.max_mp,o=o.limit_mp,t=(o-n)/(6*t);messageAppend(`<hic class="remove_nl">你的最大内力从${n}到${o}还需${t<60?parseInt(t)+"分钟":`${parseInt(t/60)}小时${parseInt(t%60)}分钟`}。
</hic>`,0,1)}else if("sc"==e.type&&e.id==G.id)null!=e.max_mp&&null!=e.mp&&(G.score.max_mp=e.max_mp,G.score.mp=e.mp);else if("text"==e.type&&/你获得了(.*)点经验，(.*)点潜能/.test(e.msg)){n=e.msg.match(/获得了(.*)点经验，(.*)点潜能/);G.jy+=parseInt(n[1]),G.qn+=parseInt(n[2]);let t=`<span class="remove_jy">共计获得了${G.jy}点经验和${G.qn}点潜能。
</span>`;setTimeout(()=>{return e=t,$(".remove_jy").remove(),$(".content-message pre").append(e),void AutoScroll(".content-message");var e},200)}}),WG.add_hook("roles",function(t){!function e(){originWindow.source?originWindow.source.postMessage(t.roles,"*"):setTimeout(e,1e3)}(),setTimeout(()=>{var t=getQueryVariable("login");if(t){var o=$("#role_panel > ul > li.content > ul >li");for(let e=0;e<o.length;e++)t==e+1?$(o[e]).addClass("select"):$(o[e]).removeClass("select");$("li[command=SelectRole]").click()}},5e3)})},configInit:function(){var e;family=GM_getValue(roleid+"_family",family),automarry=GM_getValue(roleid+"_automarry",automarry),autoKsBoss=GM_getValue(roleid+"_autoKsBoss",autoKsBoss),ks_pfm=GM_getValue(roleid+"_ks_pfm",ks_pfm),ks_wait=GM_getValue(roleid+"_ks_wait",ks_wait),eqlist=GM_getValue(roleid+"_eqlist",eqlist),skilllist=GM_getValue(roleid+"_skilllist",skilllist),autoeq=GM_getValue(roleid+"_auto_eq",autoeq),null==family&&(family=$(".role-list .select").text().substr(0,2)),wudao_pfm=GM_getValue(roleid+"_wudao_pfm",wudao_pfm),sm_loser=GM_getValue(roleid+"_sm_loser",sm_loser),sm_any=GM_getValue(roleid+"_sm_any",sm_any),sm_price=GM_getValue(roleid+"_sm_price",sm_price),sm_getstore=GM_getValue(roleid+"_sm_getstore",sm_getstore),unauto_pfm=GM_getValue(roleid+"_unauto_pfm",unauto_pfm),auto_pfmswitch=GM_getValue(roleid+"_auto_pfmswitch",auto_pfmswitch),auto_pfm_mode=GM_getValue(roleid+"_auto_pfm_mode",auto_pfm_mode),auto_rewardgoto=GM_getValue(roleid+"_auto_rewardgoto",auto_rewardgoto),busy_info=GM_getValue(roleid+"_busy_info",busy_info),saveAddr=GM_getValue(roleid+"_saveAddr",saveAddr),auto_updateStore=GM_getValue(roleid+"_auto_updateStore",auto_updateStore),auto_relogin=GM_getValue(roleid+"_auto_relogin",auto_relogin),!(blacklist=GM_getValue(roleid+"_blacklist",blacklist))instanceof Array&&(blacklist=blacklist.split(",")),getitemShow=GM_getValue(roleid+"_getitemShow",getitemShow),G.getitemShow="开"==getitemShow,zml=GM_getValue(roleid+"_zml",zml),zdy_item_store=GM_getValue(roleid+"_zdy_item_store",zdy_item_store),zdy_item_store2=GM_getValue(roleid+"_zdy_item_store2",zdy_item_store2),zdy_item_lock=GM_getValue(roleid+"_zdy_item_lock",zdy_item_lock),zdy_item_drop=GM_getValue(roleid+"_zdy_item_drop",zdy_item_drop),zdy_item_fenjie=GM_getValue(roleid+"_zdy_item_fenjie",zdy_item_fenjie),zdy_item_store&&(store_list=store_list.concat(zdy_item_store.split(","))),zdy_item_store2&&(store_list=store_list.concat(zdy_item_store2.split(","))),zdy_item_lock&&(lock_list=lock_list.concat(zdy_item_lock.split(","))),zdy_item_drop&&(drop_list=drop_list.concat(zdy_item_drop.split(","))),zdy_item_fenjie&&(fenjie_list=fenjie_list.concat(zdy_item_fenjie.split(","))),ztjk_item=GM_getValue(roleid+"_ztjk",ztjk_item),"开"==auto_pfmswitch&&(G.auto_preform=!0),"开"==auto_pfm_mode&&(G.auto_pfm_mode=!0),auto_command=GM_getValue(roleid+"_auto_command",auto_command);for(e of unauto_pfm.split(","))e&&blackpfm.push(e);welcome=GM_getValue(roleid+"_welcome",welcome),die_str=GM_getValue(roleid+"_die_str",die_str),shieldswitch=GM_getValue("_shieldswitch",shieldswitch),shield=GM_getValue("_shield",shield),shieldkey=GM_getValue("_shieldkey",shieldkey),statehml=GM_getValue(roleid+"_statehml",statehml),backimageurl=GM_getValue(roleid+"_backimageurl",backimageurl),loginhml=GM_getValue(roleid+"_loginhml",loginhml),timequestion=GM_getValue(roleid+"_timequestion",timequestion),silence=GM_getValue(roleid+"_silence",silence),dpssakada=GM_getValue(roleid+"_dpssakada",dpssakada),funnycalc=GM_getValue(roleid+"_funnycalc",funnycalc),auto_buylist=GM_getValue(roleid+"_auto_buylist",auto_buylist),auto_skillPaperSelllist=GM_getValue(roleid+"_auto_skillPaperSelllist",auto_skillPaperSelllist),zdyskilllist=GM_getValue(roleid+"_zdyskilllist",zdyskilllist),zdyskills=GM_getValue(roleid+"_zdyskills",zdyskills),bagFull=GM_getValue(roleid+"_bagFull",bagFull),pushSwitch=GM_getValue("_pushSwitch",pushSwitch),pushType=GM_getValue("_pushType",pushType),pushToken=GM_getValue("_pushToken",pushToken),color_select=GM_getValue("color_select",color_select),WG.zdy_btnListInit()}},S={serverUrl:"https://wsmud.ii74.com",GetJson:function(e,t){let o="";return $.post(S.serverUrl+e,t,e=>{o=e}),o},shareJson:function(e,t){$.post(S.serverUrl+"/sharejk",{username:e,json:JSON.stringify(t)},e=>{e&&0==e.code?(GM_setClipboard(e.shareid),messageAppend("复制成功"+e.msg+":"+e.shareid)):messageAppend("失败了"+e.msg)})},getShareJson:function(e,t){$.post(S.serverUrl+"/getjk",{shareid:e},e=>{e&&0==e.code?t(e):messageAppend("失败了"+e.msg)})},getUserConfig:function(e,t){$.get(S.serverUrl+"/User/Load?id="+e,e=>{e&&""!=e?t(e):messageAppend("失败了")})},uploadUserConfig:function(e,t,o){$.post(S.serverUrl+"/User/Backup",{id:e,data:JSON.stringify(t)},e=>{e&&"true"==e?o(e):messageAppend("失败了,或配置已存在")})}},FakerTTS={playtts:function(t){try{var e=new SpeechSynthesisUtterance(t);e.lang="zh",e.voice=speechSynthesis.getVoices().filter(function(e){return"Whisper"==e.name})[0],speechSynthesis.speak(e)}catch(e){try{android.speak(t)}catch(e){console.log("这个真没有.")}}}};function Beep(){document.getElementById("beep-alert").play()}function Push(e){if(e)if("开"!=pushSwitch||null==pushType||null==pushToken)messageAppend("通知功能未开启或设置不完整，请在 右键菜单-设置 中设置开启。",1);else switch(String(pushType)){case"0":$.post(`https://sctapi.ftqq.com/${pushToken}.send?title=`+e);break;case"1":$.post(`https://api.day.app/${pushToken}/武神传说/`+encodeURIComponent(e));break;case"2":var t={token:pushToken,title:"武神传说",content:e};$.ajaxSetup({contentType:"application/json; charset=utf-8"}),$.post("http://www.pushplus.plus/send/",JSON.stringify(t));break;case"3":t={msg_type:"text",content:{text:e}};$.ajaxSetup({contentType:"application/json; charset=utf-8"}),$.post("https://open.feishu.cn/open-apis/bot/v2/hook/"+pushToken,JSON.stringify(t));break;case"4":$.post(`https://qmsg.zendee.cn/send/${pushToken}?msg=`+e);break;case"5":$.post(`https://qmsg.zendee.cn/group/${pushToken}?msg=`+e)}}class MusicBox{constructor(e){this.arrFrequency=[262,294,330,349,392,440,494,523,587,659,698,784,880,988,1047,1175,1319,1397,1568,1760,1967],this.arrNotes=["·1","·2","·3","·4","·5","·6","·7","1","2","3","4","5","6","7","1·","2·","3·","4·","5·","6·","7·"],this.opts=Object.assign({loop:!1,musicText:"",autoplay:!1,type:"sine",duration:2},e),this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.opts.autoplay&&this.playMusic(this.opts.musicText,this.opts.autoplay)}createSound(e){var t=this.audioCtx.createOscillator(),o=this.audioCtx.createGain();t.connect(o),o.connect(this.audioCtx.destination),t.type=this.opts.type,t.frequency.value=e,o.gain.setValueAtTime(0,this.audioCtx.currentTime),o.gain.linearRampToValueAtTime(1,this.audioCtx.currentTime+.01),t.start(this.audioCtx.currentTime),o.gain.exponentialRampToValueAtTime(.001,this.audioCtx.currentTime+this.opts.duration),t.stop(this.audioCtx.currentTime+this.opts.duration)}createMusic(e){e=this.arrNotes.indexOf(e);-1!==e&&this.createSound(this.arrFrequency[e])}pressBtn(e){this.createSound(this.arrFrequency[e])}playMusic(e,t=2){let o=0,n=e.split(" "),s=setInterval(()=>{try{var e=this.arrNotes.indexOf(n[o]);"-"!==n[o]&&"0"!==n[o]&&this.pressBtn(e),++o>=n.length&&(this.opts.loop?o=0:clearInterval(s))}catch(e){alert("请输入正确的乐谱！"),clearInterval(s)}},1e3/t);return s}}var originWindow={};$(document).ready(function(){function receiveMessage(event){originWindow=event;var origin=event.origin,data=event.data,jscode;if(0<=String(data).indexOf("denglu")){if(null!=role)return;console.log(data);let userName=data.split(" ")[1],userList=$("#role_panel > ul > li.content > ul >li");for(var user of userList)0<=user.innerText.indexOf(userName)?$(user).addClass("select"):$(user).removeClass("select");void $("li[command=SelectRole]").click()}else{try{if(JSON.parse(data)instanceof Object)return}catch(error){console.log("Run at message")}"string"==typeof data&&("挖矿"===data||"修炼"===data?WG.zdwk():"日常"===data?WG.SendCmd("$daily"):"挂机"===data?WG.SendCmd("stopstate"):0<=data.split("\n")[0].indexOf("//")?unsafeWindow&&unsafeWindow.ToRaid&&ToRaid.perform(data):0<=data.split("\n")[0].indexOf("#js")?(jscode=data.split("\n"),jscode.baoremove(0),eval(jscode.join(""))):WG.SendCmd(data))}}function makeTp(e=0){var t={"豪宅":"住房","衙门":"扬州城-衙门正厅","镖局":"扬州城-镖局正厅","当铺":"扬州城-当铺","擂台":"扬州城-擂台","药铺":"扬州城-药铺","书院":"扬州城-书院"},o=(1==e&&(t={"武当":"武当派-广场","少林":"少林派-广场","华山":"华山派-镇岳宫","峨眉":"峨眉派-金顶","逍遥":"逍遥派-青草坪","丐帮":"丐帮-树洞内部","武馆":"扬州城-扬州武馆","杀手楼":"杀手楼-大门"},17<=(new Date).getHours())&&(t={"武当":"武当派-后山小院","少林":"少林派-方丈楼","华山":"华山派-客厅","峨眉":"峨眉派-清修洞","逍遥":"逍遥派-地下石室","丐帮":"丐帮-林间小屋","武馆":"扬州城-扬州武馆","杀手楼":"杀手楼-大门"}),{});for(let e in t)o[e]={name:e,callback:function(){WG.go(t[e])}};0==e&&(o.wmls={name:"武庙疗伤",callback:function(){WG.go("扬州城-武庙"),WG.Send("liaoshang")}});var n=jQuery.Deferred();return setTimeout(function(){n.resolve(o)},20),n.promise()}function createSomeMenu(){return{items:{"关闭自动":{name:"关闭自动",visible:function(e,t){return 0!=timer},callback:function(e,t){WG.timer_close()}},"自动":{name:"自动",visible:function(e,t){return 0==timer},items:{"自动武道":{name:"自动武道",callback:function(e,t){WG.wudao_auto()}},"自动小树林":{name:"自动小树林",callback:function(e,t){WG.grove_auto()}},"自动整理并清包":{name:"自动整理并清包",callback:function(e,t){WG.sell_all()}},"回收秘籍残页":{name:"回收秘籍残页",callback:function(e,t){WG.zxBuy()}},"自动比试":{name:"自动比试",visible:function(e,t){return null==WG.fight_listener},callback:function(e,t){WG.auto_fight()}},"关闭比试":{name:"关闭比试",visible:function(e,t){return null!=WG.fight_listener},callback:function(e,t){WG.auto_fight()}},"自动使用道具":{name:"自动使用道具",callback:function(e,t){WG.auto_useitem()}},"自动研药":{name:"自动研药",callback:function(e,t){WG.auto_Development_medicine()}},"一键日常":{name:"一键日常",callback:function(e,t){WG.oneKeyDaily()}},"一键请安":{name:"一键请安",callback:function(e,t){WG.oneKeyQA()}},"一键扫荡":{name:"一键扫荡",callback:function(e,t){WG.oneKeySD()}},"一键当铺购买":{name:"一键当铺购买",callback:function(e,t){WG.tnBuy()}}}},"换装设置":{name:"换装设置",callback:function(e,t){WG.eqhelperui()}},"换装":{name:"换装",items:WG.eqloader()},"自命令,自定监控":{name:"自命令,自定监控",callback:function(e,t){WG.zmlztjk()}},"手动喜宴":{name:"手动喜宴",callback:function(e,t){console.log("当前自动状态:"+stopauto),WG.xiyan()}},"快捷传送":{name:"常用地点",items:makeTp(0)},"门派传送":{name:"门派传送",items:makeTp(1)},"打开仓库":{name:"打开仓库",callback:function(e,t){WG.at("扬州城-钱庄")?WG.Send("store"):WG.go("扬州城-钱庄")}},"切换菜单":{name:"切换菜单",callback:function(e,t){let o=inzdy_btn?"off":"on";WG.zdy_btnshow(o)}},"简单工具":{name:"简单工具",callback:function(e,t){WG.calc()}},"调试BOSS":{name:"调试BOSS",visible:!1,callback:function(e,t){WG.kksBoss({content:"听说呼符出现在逍遥派-地下石室一带。"})}},"流程菜单Raid.js":{name:"流程菜单Raid.js",callback:function(e,t){unsafeWindow&&unsafeWindow.ToRaid?unsafeWindow.ToRaid.menu():(messageAppend("插件未安装,请访问 https://greasyfork.org/zh-CN/scripts/375851-wsmud-raid 下载并安装"),window.open("https://greasyfork.org/zh-CN/scripts/375851-wsmud-raid ","_blank").location)}},"设置":{name:"设置",callback:function(e,t){WG.setting()}},"打开面板":{name:"打开面板",visible:function(e,t){return"none"==$(".WG_log").css("display")},callback:function(e,t){WG.showhideborad()}},"关闭面板":{name:"关闭面板",visible:function(e,t){return"none"!=$(".WG_log").css("display")},callback:function(e,t){WG.showhideborad()}},"打开快捷操作栏":{name:"打开快捷操作栏",visible:function(e,t){return"none"==$(".WG_button").css("display")},callback:function(e,t){WG.showhidebtn()}},"关闭快捷操作栏":{name:"关闭快捷操作栏",visible:function(e,t){return"none"!=$(".WG_button").css("display")},callback:function(e,t){WG.showhidebtn()}}}}}$("head").append('<link href="https://cdn.staticfile.org/jquery-contextmenu/3.0.0-beta.2/jquery.contextMenu.min.css" rel="stylesheet">'),$("head").append('<link href="https://cdn.staticfile.org/layer/2.3/skin/layer.css" rel="stylesheet">'),$("head").append('<link href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet">'),$("body").append(UI.codeInput),$("body").append($('<audio id="beep-alert" preload="auto"></audio>').append('<source src="https://cdn.jsdelivr.net/gh/mapleobserver/wsmud-script/plugins/complete.mp3" type="audio/mpeg">')),setInterval(()=>{var e="";parseInt(10*Math.random())<3?e="<hir>【插件】有任何问题欢迎加入 武神传说-仙界 367657589 进行技术交流，脚本讨论。\n<hir>":parseInt(10*Math.random())<10&&(e="<hir>【插件】欢迎访问 https://emeisuqing.github.io/wsmud.old/ 苏轻 助你武神之路上更加轻松愉快。\n<hir>"),parseInt(10*Math.random())<2?$(".channel pre").append(e):console.log(""),$(".channel")[0].scrollTop=99999},32e4),KEY.init(),WG.init(),GI.init(),unsafeWindow.WG=WG,unsafeWindow.T=T,unsafeWindow.L=L,unsafeWindow.G=G,unsafeWindow.messageClear=messageClear,unsafeWindow.messageAppend=messageAppend,unsafeWindow.send_cmd=send_cmd,unsafeWindow.roomData=roomData,unsafeWindow.MusicBox=MusicBox,unsafeWindow.FakerTTS=FakerTTS,unsafeWindow.Beep=Beep,unsafeWindow.Push=Push,unsafeWindow.WSStore=store,unsafeWindow.imgShow=imgShow,window.addEventListener("message",receiveMessage,!1),$(".room-name").on("click",e=>{e.preventDefault(),$(".container").contextMenu({x:1,y:1})}),$.contextMenu({selector:".container",build:function(e,t){return createSomeMenu()}})})}(),!function(){class o{constructor(){this.roles=this.getValue("roles")}set roles(e){e instanceof Array?(e.sort((e,t)=>e.sort-t.sort),e.forEach((e,t)=>{e.server?e.sort=t+1:e.sort=9999}),this._roles=e):this._roles=[],this.setValue("roles",this._roles)}get roles(){return this._roles}addStyle(e){GM_addStyle(e)}cookie(){var e=document.cookie.split(";").reduce((e,t)=>{var o=t.indexOf("="),n=t.substr(0,o).trim(),t=t.substr(o+1);return e[n]=t,e},{});return new Proxy(e,{set:(e,t,o)=>{return document.cookie=t+"="+o,Reflect.set(e,t,o)},deleteProperty:(e,t)=>{return document.cookie=t+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;",Reflect.deleteProperty(e,t)}})}setValue(e,t){localStorage.setItem(e,JSON.stringify(t))}getValue(e){return JSON.parse(localStorage.getItem(e))}deleteValue(e){localStorage.removeItem(e)}}$(document).ready(function(){var e=unsafeWindow.WG,a=Vue.observable(new o);e.add_hook("roles",function(e){e.roles instanceof Array&&(e.roles.forEach(e=>{let{id:t,name:o,title:n}=e;e=a.roles.findIndex(e=>e.id===t);-1===e?a.roles.push({id:t,name:o,title:n,sort:9999}):(a.roles[e].name=o,a.roles[e].title=n)}),a.roles=a.roles.slice(0))}),e.add_hook("login",function(e){let t=e.id;var o;!a.id&&t&&(a.id=t,e=a.roles.findIndex(e=>e.id===t),a.name=a.roles[e].name,o=a.cookie(),a.roles[e].u=o.u,a.roles[e].p=o.p,a.roles[e].s=o.s,a.roles[e].server=["一区","二区","三区","四区","测试"][o.s],a.roles=a.roles.slice(0))});let t=a.getValue("auto-login-id");t?(a.deleteValue("auto-login-id"),e.add_hook(["roles"],function(){setTimeout(()=>$(`.role-item[roleid=${t}]`).click(),1e3),setTimeout(()=>$(".panel_item[command=SelectRole]").click(),2e3)})):($('li.panel_item[command="SelectRole"]').after(`
<li class="panel_item" id="wsmud-login" style="color:orange;" @click.stop="show = true">
  <span class="glyphicon glyphicon-ok"></span> <span style="margin-left:0.5rem">[苏轻]一键登录</span>
  <div v-if="show" class="login-dialog-bg" @click.stop="show = false">
    <div class="login-dialog" @click.stop>
      <div class="login-dialog-title">[苏轻]一键登录</div>
      <transition-group class="login-dialog-rows" tag="div" name="login-animate-list">
        <div class="login-dialog-row" v-for="(role, index) in roles" :key="role.id" v-if="role.server">
          <span class="login-dialog-role" @click="login(role)">[{{ role.server }}] {{ role.name }}</span>
          <span class="glyphicon glyphicon-arrow-up login-dialog-up" @click="up(index)"></span>
          <span class="glyphicon glyphicon-arrow-down login-dialog-down" @click="down(index)"></span>
          <span class="glyphicon glyphicon-trash login-dialog-remove" @click="remove(index)"></span>
        </div>
      </transition-group>
    </div>
  </div>
</li>
`),new Vue({data:{show:!1},computed:{roles(){return a.roles}},mounted(){var e,t,o,n=new URLSearchParams(window.location.search),s=(n.get("type")&&(e=n.get("username"),t=n.get("password"),o=n.get("area"),s=n.get("name"),e)&&t&&o&&s&&$.ajax({type:"POST",url:"/UserAPI/Login",data:"code="+e+"&pwd="+t,success:function(e){console.log(e),a.cookie().s=o;e=window.location.href.split("?")[0];window.location=e+"?name="+s},error:function(e){}}),n.get("name"));if(s)for(var i of a.roles)i.name==s&&this.login(i)},methods:{login(e){var t=a.cookie();t.u=e.u,t.p=e.p,t.s=e.s,a.setValue("auto-login-id",e.id),(window.android?android:window.location).reload()},up(e){a.roles[e].sort=e-1,a.roles=a.roles.slice(0)},down(e){a.roles[e].sort=e+3,a.roles=a.roles.slice(0)},remove(e){delete a.roles[e].server,a.roles=a.roles.slice(0),this.$forceUpdate()}},el:"#wsmud-login"}),a.addStyle(`
.login-dialog-bg {
  display: block;
  position: absolute;
  width: 100%;
  height: 100%;
  left: 0;
  top: 0;
  z-index: 100;
  overflow-y: auto;
  background-color: #000000dd;
  cursor: default;
  user-select: none;
}
.login-dialog {
  display: block;
  position: absolute;
  left: 50%;
  top: 50%;
  z-index: 101;
  min-width: 300px;
  padding: 10px;
  transform: translate(-50%, -50%);
  border-radius: 10px;
  color: #999999;
  background-color: #080808;
  box-shadow: 0 0 5px #333333;
}
.login-dialog-title {
  color: #00f000;
  padding: 10px 0 10px 10px;
  text-shadow: 0 0 15px;
}
.login-dialog-rows {
  max-height: 230px;
  overflow: auto;
}
.login-dialog-row {
  cursor: pointer;
  padding: 10px;
  display: flex;
}
.login-dialog-role {
  flex: 1 0 auto;
}
.login-dialog-role:hover {
  color: #00ffff;
  text-shadow: 0 0 15px;
}
.login-dialog-up, .login-dialog-down, .login-dialog-remove {
  flex: 0 0 22px;
  margin-left: 5px;
}
.login-dialog-up:hover, .login-dialog-down:hover {
  color: #088000;
  text-shadow: 0 0 15px;
}
.login-dialog-remove:hover {
  color: #880000;
  text-shadow: 0 0 15px;
}
/* 图标 */
.glyphicon-arrow-up:before {
  content: "\\e093";
}
.glyphicon-arrow-down:before {
  content: "\\e094";
}
.glyphicon-trash:before {
  content: "\\e020";
}
/* 过渡动画效果 */
.login-animate-list-move {
  transition: transform 0.5s;
}
.login-animate-list-item {
  display: inline-block;
  margin-right: 10px;
}
.login-animate-list-enter-active, .login-animate-list-leave-active {
  transition: all 0.5s;
}
.login-animate-list-enter, .login-animate-list-leave-to {
  opacity: 0;
  transform: translateX(50px);
}
`))})}(),!function(){var Message={append:function(e){console.log(e)},clean:function(){},cmdLog:function(e,t){let o=`&nbsp;&nbsp;<hic>${e}</hic>`;null!=t&&(o+=": "+t),this.append(o)}};function CopyObject(e){return JSON.parse(JSON.stringify(e))}let SortInsert=function(e,t,o){let n=e.length;for(;0<=n;){if(0==n){e.splice(n,0,t);break}if(o(e[n-1],t)){e.splice(n,0,t);break}--n}},SourceCodeHelper={split:function(e){var e=e.split(/\s*\n+/g),t=e[0],t=(null!=t&&0==/\S/.test(t)&&e.splice(0,1),e[e.length-1]);return null!=t&&0==/\S/.test(t)&&e.splice(e.length-1,1),e},appendHeader:function(e,t){let o=`
`+t;return o=(o=(o=o.replace(/(\n)/g,"$1"+e)).replace(/\n\s*\n/g,"\n")).replace(/^\s*\n/,"")}};class PersistentCache{constructor(e,t,o){this._save=e,this._getAll=t,this._remove=o}save(e,t){this._save(e,t)}get(e){return this.getAll()[e]}getAll(){return this._getAll()}remove(e){this._remove(e)}}class PrecompileRule{constructor(e,t){this._handle=e,this.priority=t}handle(e){return this._handle(e)}}class PrecompileRuleCenter extends PrecompileRule{constructor(){super(function(e){var t,o=e;for(t of this._rules)o=t.handle(o);return o},-1),this._rules=[],this.instance=this}static shared(){return this.instance||(this.instance=new PrecompileRuleCenter),this.instance}addRule(e){SortInsert(this._rules,e,(e,t)=>e.priority>=t.priority)}}class Precompiler{precompile(e){e=SourceCodeHelper.split(e);return e.length<=0?e:PrecompileRuleCenter.shared().handle(e)}}let ControlKeys={while:"while",continue:"continue",break:"break",if:"if",elseif:"elseif",else:"else",exit:"exit"};class Compiler{constructor(){this._cc="CC",this._pc="PC",this._breakStacks=[]}compile(e){var t;return null==e?[]:(e=(new Precompiler).precompile(e),t=["[if] true"],e.forEach(e=>{t.push("  "+e)}),(e=this._handleBlock(t,0).cmds).push("%exit"),e)}_handleBlock(e,o,t){var n=t,s=[],i=this._handleCondition(e[0]),a=function(){},l=this;switch(i.type){case ControlKeys.while:this._breakStacks.push([]),s.push(i.cmd),s.push(null),a=function(){s.push(`%${l._pc}=`+o);var t=s.length+o;s[1]=`%${l._pc}=${l._cc}?${o+2}:`+t,l._breakStacks.pop().forEach(e=>{s[e-o]=`%${l._pc}=`+t})},n=o;break;case ControlKeys.if:s.push(i.cmd),s.push(null),a=function(){s.push("%pass");var e=s.length+o;s[1]=`%${l._pc}=${l._cc}?${o+2}:`+e};break;case ControlKeys.elseif:s.push(i.cmd),s.push(null),a=function(){s.push("%pass");var e=s.length+o;s[1]=`%${l._pc}=${l._cc}?${o+2}:`+e};break;case ControlKeys.else:s.push(null),a=function(){var e=s.length+o;s[0]=`%${l._pc}=${l._cc}?${e}:`+(o+1)};break;case ControlKeys.continue:return s.push(`%${l._pc}=`+t),{type:"continue",cmds:s};case ControlKeys.break:return s.push(null),this._breakStacks[this._breakStacks.length-1].push(o),{type:"break",cmds:s};case ControlKeys.exit:return s.push("%exit"),{type:"exit",cmds:s};default:throw"未知的控制关键字: "+i.type}for(var r=e.length,d=1;d<r;){var u=e[d],c=/^\s*/g.exec(u)[0].length;if("["==u[c]){for(var m=[u],p=d+1;p<r;){var g=e[p];if(" "!=g[c])break;m.push(g),p+=1}var f=s.length-1,h=s.length+o,h=this._handleBlock(m,h,n);h.cmds.forEach(e=>{s.push(e)}),"elseif"==h.type?s[f]=`%${this._pc}=`+(s.length+o-1):"else"==h.type&&(s[f]=`%${this._pc}=`+(s.length+o)),d=p}else s.push(u.substring(c)),d+=1}return a(),{type:i.type,cmds:s}}_handleCondition(e){var t,o=null,n=null;for(t of[{type:ControlKeys.while,regexp:/^\s*\[while\]/g},{type:ControlKeys.if,regexp:/^\s*\[if\]/g},{type:ControlKeys.elseif,regexp:/^\s*\[else\s?if\]/g},{type:ControlKeys.else,regexp:/^\s*\[else\]/g},{type:ControlKeys.continue,regexp:/^\s*\[continue\]/g},{type:ControlKeys.break,regexp:/^\s*\[break\]/g},{type:ControlKeys.exit,regexp:/^\s*\[exit\]/g}]){var s=t.regexp.exec(e);if(s){o=t.type,s=e.substring(s[0].length),n=`%${this._cc}=`+s;break}}if(null==o)throw"编译失败: "+e;return{type:o,cmd:n}}}let PrecompileRulePriority={subflow:100,call:90,annatition:80,compatible:70,guard:60,emptyLine:50,high:30,ordinary:20,low:10};!function(){var e=new PrecompileRule(function(e){var t,o=[];for(t of e)/^\s*\/\//.test(t)||o.push(t);return o},PrecompileRulePriority.annatition);PrecompileRuleCenter.shared().addRule(e)}(),!function(){var e=new PrecompileRule(function(e){var t,o=[],n=!1;for(t of e)/^\s*\/\*/.test(t)?n=!0:n&&/\*\/\s*$/.test(t)?n=!1:n||o.push(t);return o},PrecompileRulePriority.annatition);PrecompileRuleCenter.shared().addRule(e)}(),!function(){var e=new PrecompileRule(function(e){var t,o=[];let n=!1,s=null;for(t of e)null!=/^(\s*)<===+\s*$/.exec(t)?(n=!0,s="<==="):n?null!=/^\s*=+==>\s*$/.exec(t)?(n=!1,s+="===>",o.push(s)):s+=`
`+t:o.push(t);return o},PrecompileRulePriority.subflow);PrecompileRuleCenter.shared().addRule(e)}(),!function(){var e=new PrecompileRule(function(e){var t,o=[],n=[],s=!1;for(t of e){var i=/^(\s*)<---+/.exec(t);if(null!=i){var s=!0,i={headerLength:i[1].length,cmds:[]};n.push(i)}else if(s)null==/^\s*-+-->/.exec(t)?(i=n[n.length-1]).cmds.push(t.substring(i.headerLength)):s=!1;else{o.push(t);i=/^(\s*)[^\[\s]/.exec(t);if(null!=i){var a=i[1],l=!1;for(let e=n.length;0<e;e--){var r=n[e-1];a.length<r.headerLength?n.pop():(l||(o.push(a+"%guardStart"),l=!0),r.cmds.forEach(e=>{o.push(""+a+e)}))}l&&o.push(a+"%guardEnd")}}}return o},PrecompileRulePriority.guard);PrecompileRuleCenter.shared().addRule(e)}();var __CallCounter=0,FlowStore=null;function CompatibleOperator(e){return e=(e=(e=e.replace(/([^&])[&]([^&])/g,"$1&&$2")).replace(/([^\|])[\|]([^\|])/g,"$1||$2")).replace(/([^=<>!])[=]([^=])/g,"$1==$2")}!function(){var e=new PrecompileRule(function(e){let d=[];return e.forEach(o=>{var n=/^(\s*)@call\s(\S+)(\s*(\S.*)+\s*|\s*)$/.exec(o);if(null==n)d.push(o);else{o=n[4];let t="";if(null!=o&&0<o.length){var s=o.split(",");for(let e=0;e<s.length;e++){var i=s[e];t+=`($arg${e})=${i}
`}}var o=n[2],a=FlowStore.get(o);null==a&&Message.append(`<ord>未找到调用的流程 ${o}</ord>`);let e=`[if] true
`+SourceCodeHelper.appendHeader("    ",t+`
`+a);var l,o=__CallCounter,a=(__CallCounter+=1,e=(e=e.replace(/\(\$([_a-z][a-zA-Z0-9_]*?)\)/g,`($__x${o}_$1)`)).replace(/\(([_a-z][a-zA-Z0-9_]*?)\)/g,`(__x${o}_$1)`),SourceCodeHelper.split(e)),r=n[1];for(l of a)/^\s*#/.test(l)||d.push(""+r+l)}}),d},PrecompileRulePriority.call);PrecompileRuleCenter.shared().addRule(e)}(),!function(){var e=new PrecompileRule(function(e){var t,o=[];for(t of e)/\S+/.test(t)&&o.push(t);return o},PrecompileRulePriority.emptyLine);PrecompileRuleCenter.shared().addRule(e)}(),!function(){var e=new PrecompileRule(function(e){var o=[];return e.forEach(e=>{var t=/^\s*#(\[.*)$/.exec(e);null==t?o.push(e):(e=t[1],o.push("<---",e,"---\x3e"))}),o},PrecompileRulePriority.compatible);PrecompileRuleCenter.shared().addRule(e)}(),!function(){var e=new PrecompileRule(function(e){var n=[];return e.forEach(e=>{var t,o=/^(\s*)\[=(.+?)\](.*)$/.exec(e);null==o?n.push(e):(e=o[1],t=CompatibleOperator(t=o[2]),o=o[3],n.push(e+"@until "+t),/\S/.test(o)&&n.push(""+e+o))}),n},PrecompileRulePriority.compatible);PrecompileRuleCenter.shared().addRule(e)}(),!function(){var e=new PrecompileRule(function(e){var n=[];return e.forEach(e=>{var t,o=/^(\s*)\[(.*?[=<>].*?|true|false)\](.*)$/i.exec(e);null==o?n.push(e):(e=o[3],/\S/.test(e)&&(t=o[1],o=CompatibleOperator(o=o[2]),n.push(t+"[if] "+o,t+"    "+e)))}),n},PrecompileRulePriority.compatible);PrecompileRuleCenter.shared().addRule(e)}(),!function(){var e=new PrecompileRule(function(e){var o=[];return e.forEach(e=>{var t=/^(\s*)@next(.*)$/i.exec(e);null==t?o.push(e):(e=t[1],o.push(e+"[continue]"))}),o},PrecompileRulePriority.compatible);PrecompileRuleCenter.shared().addRule(e)}(),!function(){var e=new PrecompileRule(function(e){var o=[];return e.forEach(e=>{var t=/^(\s*)@exit(.*)$/i.exec(e);null==t?o.push(e):(e=t[1],o.push(e+"[break]"))}),o},PrecompileRulePriority.compatible);PrecompileRuleCenter.shared().addRule(e)}();var AssertLeftMarkHandlerCenter={addHandler:function(e){this._leftMarkHandlers.push(e)},getValue(t){for(let e=0;e<this._leftMarkHandlers.length;e++){var o=this._leftMarkHandlers[e].handle(t);if(o.handle)return o.value}return t},_leftMarkHandlers:[]};class AssertWrapper{constructor(e){var t=this;this.assert=function(){return e(t.text)}}setText(e){this.text=e}}class AssertHolder{constructor(e,t){this.match=e,this._getAssertWrapper=t}getAssertWrapper(){return this._getAssertWrapper()}}var AssertHolderCenter={addAssertHolder:function(e){this._assertHolders.push(e)},get:function(e){var o,n,s,t=e.replace(/^\s*|\s*$/g,""),i=this,e=t.search(/&&|\|\|/g);if(-1!=e)return o=t.substring(e,e+2),n=t.substring(0,e),s=t.substring(e+2),function(){var e=i.get(n),t=i.get(s);switch(o){case"&&":return e()&&t();case"||":return e()||t()}};if("!"==t[0])return function(){return!i.get(t.substring(1))()};for(let e=0;e<this._assertHolders.length;e++){var a=this._assertHolders[e];if(a.match(t))return(a=a.getAssertWrapper()).setText(t),a.assert}return null},_assertHolders:[]};!function(){function e(e){return!0}var t=new AssertHolder(function(e){return"true"==e},function(){return new AssertWrapper(e)});AssertHolderCenter.addAssertHolder(t)}(),!function(){function e(e){return!1}var t=new AssertHolder(function(e){return"false"==e},function(){return new AssertWrapper(e)});AssertHolderCenter.addAssertHolder(t)}(),!function(){function e(e){let t=e;t=(t=t.replace(/<(\w+)>/g,"「$1」")).replace(/<(\/\w+)>/g,"「¿$1」");var e=l.exec(t)[0],o=(i=t.split(e))[0].replace(/^\s*|\s*$/g,""),n=AssertLeftMarkHandlerCenter.getValue(o),s=i[1].replace(/^\s*|\s*$/g,""),o=parseFloat(n),i=parseFloat(s),a=!1;switch(isNaN(o)||isNaN(i)||(n=o,s=i,a=!0),e){case"=":case"==":return a?Math.abs(n-s)<.001:n==s;case">":return s<n;case"<":return n<s;case">=":return s<=n;case"<=":return n<=s;case"!=":return a?.001<Math.abs(n-s):n!=s;default:return!1}}var l=new RegExp(">=?|<=?|!=|==?"),t=new AssertHolder(function(e){return l.test(e)},function(){return new AssertWrapper(e)});AssertHolderCenter.addAssertHolder(t)}();let CmdPrehandlerPriority={ordinary:50};class CmdPrehandler{constructor(e,t){this._handle=e,this.priority=t||CmdPrehandlerPriority.ordinary}handle(e,t){return this._handle(e,t)}}class CmdPrehandleCenter extends CmdPrehandler{constructor(){super(function(e,t){var o,n=t;for(o of this._handlers)n=o.handle(e,n);return n},-1),this._handlers=[],this.instance=this}static shared(){return this.instance||(this.instance=new CmdPrehandleCenter),this.instance}addHandler(e){SortInsert(this._handlers,e,(e,t)=>e.priority>=t.priority)}}let CmdExecutorPriority={compiler:90,high:30,ordinary:20,low:10};class CmdExecutor{constructor(e,t,o){this._appropriate=e,this._execute=t,this.priority=o||CmdExecutorPriority.ordinary}appropriate(e){return this._appropriate(e)}execute(e,t){return this._execute(e,t)}}var CmdExecuteCenter={addExecutor:function(e){SortInsert(this._executors,e,(e,t)=>e.priority>=t.priority)},execute:function(e,t){var o,n=null;for(o of this._executors)if(o.appropriate(t)){n=o;break}if(null==n)throw"无法处理此命令: "+t;return n.execute(e,t)},_executors:[]};class Performer{constructor(e,t){this._name=e,this._source=t,this._log=!1,this._running=!1,this._pausing=!1}name(){return this._name}runing(){return this._running}pausing(){return this._pausing}log(e){return null==e||1==/\/\/\s*~silent\s*\n/.test(this._source)?this._log:void(this._log=e)}start(e){if(!this._running){try{var t=new Compiler,o=(new Date).getTime(),n=(this._cmds=t.compile(this._source),(new Date).getTime());console.log(`编译总耗时: ${n-o} 毫秒`)}catch(e){return void Message.append("<ord>编译错误</ord>: "+e)}this._log&&Message.append(`<hiy>开始执行，流程: ${this._name}...</hiy>`),this._running=!0,this._pausing=!1,this._callback=e,this._pc=0,this._cc=!0,this._guarding=!1,this._subflows=[],this._perform()}}stop(){if(this._running){this._running=!1;for(var e of this._subflows)e.stop();this._log&&Message.append(`<hiy>执行完毕，流程: ${this._name}。</hiy>`),this._callback&&this._callback()}}pause(){if(this._running){this._log&&Message.append(`<hiy>暂停执行，流程: ${this._name}...</hiy>`),this._pausing=!0;for(var e of this._subflows)e.pause()}}resume(){if(this._running&&this._pausing){this._log&&Message.append(`<hiy>恢复执行，流程: ${this._name}。</hiy>`),this._pausing=!1;for(var e of this._subflows)e.resume();this._perform()}}guarding(){return this._guarding}timeSeries(e){if(null==e)return this._systemCmdTimeSeries;this.guarding()||(this._systemCmdTimeSeries=e)}async _perform(){if(this._running&&!this._pausing&&!this._doing){var e=this._cmds[this._pc];this._pc+=1;try{this._doing=!0,await CmdExecuteCenter.execute(this,e)}catch(e){return Message.append("<ord>执行错误</ord>: "+e),void this.stop()}finally{this._doing=!1}this._perform()}}}function TryCalculate(expression){return/^[0-9\+\-\*\/% ]*$/g.test(expression)?eval(expression):expression}!function(){var e=new CmdExecutor(function(e){return"%exit"==e},function(e,t){e.stop()},CmdExecutorPriority.compiler);CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new CmdExecutor(function(e){return"%pass"==e},function(e,t){},CmdExecutorPriority.compiler);CmdExecuteCenter.addExecutor(e)}(),!function(){let appropriate=function(e){return 0==e.indexOf("%PC=CC")},execute=function(performer,cmd){performer._pc=eval("performer._cc"+cmd.substring(6))},executor=new CmdExecutor(appropriate,execute,CmdExecutorPriority.compiler);CmdExecuteCenter.addExecutor(executor)}(),!function(){let appropriate=function(e){return 0==e.indexOf("%PC=")},execute=function(performer,cmd){performer._pc=eval(cmd.substring(4))},executor=new CmdExecutor(appropriate,execute,CmdExecutorPriority.compiler);CmdExecuteCenter.addExecutor(executor)}(),!function(){var e=new CmdExecutor(function(e){return 0==e.indexOf("%CC=")},function(e,t){t=CmdPrehandleCenter.shared().handle(e,t),t=AssertHolderCenter.get(t.substring(4));e._cc=t()},CmdExecutorPriority.compiler);CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new CmdExecutor(function(e){return"%guardStart"==e},function(e,t){e._guarding=!0},CmdExecutorPriority.compiler);CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new CmdExecutor(function(e){return"%guardEnd"==e},function(e,t){e._guarding=!1},CmdExecutorPriority.compiler);CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new CmdExecutor(function(e){return/^<===[^爫]*===>$/.test(e)},function(e,t){t=t.slice(4,-4),t=new Performer("subflow",t);e._subflows.push(t),t.start()},CmdExecutorPriority.compiler);CmdExecuteCenter.addExecutor(e)}();var PersistentVariables=null;function UpdateVariable(e,t,o){/^_*[A-Z][a-zA-Z0-9_]*$/.test(t)?PersistentVariables.save(t,TryCalculate(o)):/^_*[a-z][a-zA-Z0-9_]*$/.test(t)&&(null==e.tempParams&&(e.tempParams={}),e.tempParams[t]=TryCalculate(o))}!function(){var o=/^\(\$([A-Za-z_][a-zA-Z0-9_]*?)\)\s*=\s*(.+)\s*/,e=new CmdExecutor(function(e){return o.test(e)},function(e,t){t=CmdPrehandleCenter.shared().handle(e,t),t=o.exec(t);UpdateVariable(e,t[1],t[2])});CmdExecuteCenter.addExecutor(e)}();var VariableStore={register:function(e){this._allGetAll.push(e)},getAll:function(){var e,t={};for(e of this._allGetAll){var o,n=e();for(o in n)n.hasOwnProperty(o)&&(t[o]=n[o])}return t},_allGetAll:[]};!function(){let s=function(e,t){for(var o=[],n=/\([:a-zA-Z0-9_]+?\)/g,s=n.exec(e);null!=s;)o.push(s[0]),s=n.exec(e);let i=e;for(let e=0;e<o.length;e++){var a=o[e],l=t[a.substring(1,a.length-1)];null==l&&(l="null"),i=i.replace(a,l)}var r,d=[],u=/\((:[a-zA-Z0-9_]+?)\s+([^\(\)\s][^\(\)]*?)\s*\)/g;let c=u.exec(i);for(;null!=c;)d.push({value:c[0],key:c[1]+" ",params:c[2]}),c=u.exec(i);for(r of d){var m=t[r.key];let e="null";null!=m&&"function"==typeof m&&(e=m(r.params)),i=i.replace(r.value,e)}return i};var e=new CmdPrehandler(function(e,t){var o={},e=(Object.assign(o,VariableStore.getAll(),e.tempParams),function(e,t){let o=e;for(;;){var n=s(o,t);if(n==o)return o;o=n}}(t,o));return e});CmdPrehandleCenter.shared().addHandler(e)}();class AtCmdExecutor extends CmdExecutor{constructor(n,s,e){super(function(e){return 0==e.indexOf("@"+n)},function(e,t){t=CmdPrehandleCenter.shared().handle(e,t);let o=/^\s*(.*)\s*$/.exec(t.substring(n.length+1))[1];return o&&0==o.length&&(o=null),s(e,o)},e)}}!function(){var e=new AtCmdExecutor("wait",function(e,t){return e.log()&&Message.cmdLog(`等待 ${(t/1e3).toFixed(2)} 秒`),new Promise(e=>{setTimeout(()=>e(),t)})});CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new AtCmdExecutor("await",function(e,n){return new Promise(t=>{e="setTimeout(() =>  postMessage('0'), "+n+")",e=new Blob(["(function(){"+e.toString()+"})()"]),e=window.URL.createObjectURL(e);var e,o=new Worker(e);o.onmessage=function(e){o.terminate(),t()}})});CmdExecuteCenter.addExecutor(e)}(),!function(){let executor=new AtCmdExecutor("debug",function(performer,param){let text=param;">"==text[0]&&(text=JSON.stringify(eval(text.substring(1))));var message=`&nbsp;&nbsp;[debug]: <hiz>${text}</hiz>`;Message.append(message)});CmdExecuteCenter.addExecutor(executor)}(),!function(){var e=new AtCmdExecutor("print",function(e,t){Message.append(t)});CmdExecuteCenter.addExecutor(e)}();class UntilAtCmdExecutor extends CmdExecutor{constructor(a,l,e,r,d){super(function(e){return 0==e.indexOf("@"+a)},function(n,s){function i(t){var e=CmdPrehandleCenter.shared().handle(n,s);let o=/^\s*(.*)\s*$/.exec(e.substring(a.length+1))[1];null!=o&&0==o.length&&(o=null),1==l(n,o)?null!=d?setTimeout(e=>{t()},d):t():setTimeout(e=>{i(t)},null!=r?r:500)}return n.log()&&Message.cmdLog("等待，直至符合条件",s),new Promise(e=>{i(e)})},e),this._key=a,this._assert=l}}function PerformerPromise(o,n,s){return new Promise(t=>{var e=new Performer("",o);s&&e.log(s),e.start(e=>{n?n(t):t()})})}!function(){var e=new UntilAtCmdExecutor("until",function(e,t){return AssertHolderCenter.get(t)()});CmdExecuteCenter.addExecutor(e)}(),!function(){let appropriate=function(e){return 0==e.indexOf("@js ")},execute=function(performer,cmd){let validCmd=CmdPrehandleCenter.shared().handle(performer,cmd),exp=validCmd.substring(4),result=(performer.log()&&Message.cmdLog("调用 js",exp),/^\(\$([A-Za-z_][a-zA-Z0-9_]*?)\)\s*=\s*/.exec(exp));if(null==result)eval(exp);else{let name=result[1];exp=exp.substring(result[0].length),UpdateVariable(performer,name,eval(exp))}},executor=new CmdExecutor(appropriate,execute);CmdExecuteCenter.addExecutor(executor)}(),!function(){var e=new CmdExecutor(function(e){return 0==e.indexOf("@stop ")},function(e,t){let o=CmdPrehandleCenter.shared().handle(e,t).substring(6);e.log()&&Message.cmdLog("停止流程",o);var n,t=/^\(\$([A-Za-z_][a-zA-Z0-9_]*?)\)\s*=\s*/.exec(o);null==t?ManagedPerformerCenter.getAll().filter(e=>e.name()==o).forEach(e=>e.stop()):(n=t[1],o=o.substring(t[0].length),UpdateVariable(e,n,ManagedPerformerCenter.getAll().filter(e=>e.name()==o).forEach(e=>e.stop())))});CmdExecuteCenter.addExecutor(e)}(),VariableStore.register(e=>({":date":(new Date).getDate(),":day":(new Date).getDay(),":hour":(new Date).getHours(),":minute":(new Date).getMinutes(),":second":(new Date).getSeconds()})),!function(){var e=new CmdExecutor(function(e){return 0==e.indexOf("$wait ")},function(e,t){return PerformerPromise("@wait "+t.substring(6),null,e.log())});CmdExecuteCenter.addExecutor(e)}();var __ConfigDomIdCounter=0;function GetConfigDomId(){var e=__ConfigDomIdCounter;return __ConfigDomIdCounter+=1,"wsmud_raid_config_dom_id_"+e}var __ConfigPanelHtml="",__ConfigPanelInits=[],__ConfigPanelActions=[];class HashCmdExecutor extends CmdExecutor{constructor(t,n){super(function(e){return 0==e.indexOf("#"+t)},function(e,t){var o=CmdPrehandleCenter.shared().handle(e,t).substring(this._key.length+2),e=n(e,t,o);null!=e&&(e.html&&(__ConfigPanelHtml+=e.html),e.init&&__ConfigPanelInits.push(e.init),e.action)&&__ConfigPanelActions.push(e.action)}),this._key=t}}!function(){var e=new HashCmdExecutor("input",function(e,t,o){o=/^\(\$([a-zA-Z0-9_]+)\)\s?=\s?([^,]+?),(.*)\s*$/.exec(o);if(null==o)throw"错误的格式: "+t;let n=o[1];t=o[2];let s=null==o[3]?"":o[3],i=GetConfigDomId();return{html:`
            <p>
                <label for="${i}">&nbsp;* ${t}:&nbsp;</label><input style='width:80px' id ="${i}" type="text">
            </p>`,init:function(){$("#"+i).val(s)},action:function(){var e={};return e[n]=$("#"+i).val(),e}}});CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new HashCmdExecutor("select",function(e,t,o){o=/^\(\$([a-zA-Z0-9_]+)\)\s?=\s?([^,]+?),([^,]+?),([^,]+?)\s*$/.exec(o);if(null==o)throw"错误的格式: "+t;let n=o[1];var t=o[2],s=o[3].split("|");let i=o[4],a=GetConfigDomId(),l="";s.forEach(e=>{l+=`<option value="${e}">${e}</option>`});return{html:`
            <p>
                <label for="${a}">&nbsp;* ${t}:&nbsp;</label><select style='width:80px' id="${a}">
                    ${l}
                </select>
            </p>`,init:function(){$("#"+a).val(i)},action:function(){var e={};return e[n]=$("#"+a).val(),e}}});CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new CmdExecutor(function(e){return/^#config\s*$/.test(e)},function(n,e){return new Promise(e=>{var t=layer.open({type:1,skin:"layui-layer-rim",area:"350px",title:"配置参数",content:__ConfigPanelHtml,offset:"auto",shift:2,move:!1,closeBtn:0,success:function(e,t){__ConfigPanelInits.forEach(e=>{e()});for(var o of e[0].children)"layui-layer-content"==o.className&&o.setAttribute("style","max-height: 370px;color: rgb(0, 128, 0);")},end:function(){__ConfigPanelHtml="",__ConfigPanelInits=[],__ConfigPanelActions=[]},btn:["运行流程","取消"],yes:function(){__ConfigPanelActions.forEach(e=>{var t,o=e();for(t in o)o.hasOwnProperty(t)&&UpdateVariable(n,t,o[t])}),layer.close(t),e()},btn2:function(){n.stop(),e()}})})});CmdExecuteCenter.addExecutor(e)}();var WG=null,messageAppend=null,messageClear=null,T=null,L=null;Message.append=function(e){messageAppend(e)},Message.clean=function(){messageClear()};let RoleState={none:"发呆",liaoshang:"疗伤",dazuo:"打坐",wakuang:"挖矿",gongzuo:"工作",lianxi:"练习",xuexi:"学习",biguan:"闭关",lianyao:"炼药",lingwu:"领悟",dushu:"读书",juhun:"聚魂",tuiyan:"推演"};function FindItem(e,t,o,n,s){var i,a=o?t:"^"+t+"$",l=(/<[a-zA-Z]{3}>.+<\/[a-zA-Z]{3}>/g.test(t)?a="^"+t+"$":null!=n&&null!=(n={white:"wht",w:"wht",green:"hig",g:"hig",blue:"hic",b:"hic",yellow:"hiy",y:"hiy",purple:"HIZ",p:"HIZ",orange:"hio",o:"hio",red:"ord",r:"ord"}[n])&&(a=o?"<"+n+">.*"+t+".*</"+n+">":"<"+n+">"+t+"</"+n+">"),new RegExp(a));for(i of e)if(l.test(i.name)&&!FilterCenter.filter(s,i))return i;return null}var Role={id:null,name:null,grade:null,family:null,energy:0,money:0,hp:0,maxHp:0,mp:0,maxMp:0,status:{},equipments:[],items:{},stores:{},_weaponType:"",skills:{},profitInfo:null,kongfu:{quan:null,nei:null,zhao:null,qing:null,jian:null,dao:null,gun:null,zhang:null,bian:null,an:null},init:function(){WG.add_hook("login",function(e){Role.id=e.id,Role.status=[],setTimeout(function(){$("span[command=skills]").click(),setTimeout(e=>{$(".glyphicon-remove-circle").click()},500)},2e3),UI.showToolbar(),setTimeout(e=>{Server.getNotice()},3e3)}),$("li[command=SelectRole]").on("click",function(){Role.name=$(".role-list .select").text().split(/\s+/).pop()}),Role._monitorHpMp(),Role._monitorStatus(),Role._monitorState(),Role._monitorDeath(),Role._monitorSkillCD(),Role._monitorSkills(),Role._monitorGains(),Role._monitorItems(),Role._monitorCombat(),Role._monitorInfo(),Role._monitorWeapon()},hasStatus:function(e){e=Role.status[e];return null!=e&&!(e<(new Date).getTime())},isFree:function(){return!Role.hasStatus("busy")&&!Role.hasStatus("faint")&&!Role.hasStatus("rash")},gains(t,o){var n=Role._gains.slice(),s=-1,i=-1;for(let e=0;e<n.length;e++)if(n[e].timestamp>=t){s=e;break}for(let e=n.length-1;0<=e;e--)if(n[e].timestamp<=o){i=e;break}return-1==s||-1==i?[]:n.slice(s,i+1)},state:RoleState.none,wearing:function(e){for(var t of this.equipments)if(null!=t&&t.id==e)return!0;return!1},getEqId:function(e){e=this.equipments[e];return null==e?null:e.id},living:!0,combating:!1,rtime:!1,shimen:function(e){var t=(new Date).getTime();Role._shimen(0,t,e)},atPath:function(e){switch(arguments.length){case 0:return Room.path;case 1:return e==Room.path}},inRoom:function(e){switch(arguments.length){case 0:return Room.name;case 1:return e==Room.name}},findItem:function(e,t,o,n){return FindItem(Object.values(Role.items),e,t,o,n)},renew:function(e){new Performer("",`
            stopstate;$to 扬州城-武庙
            @liaoshang
            [if] (:mpPer)<0.8
                @dazuo
                stopstate
            `).start(e)},cleanBag:function(e){WG.clean_all(),e&&e()},tidyBag:function(e){Role._tidyBag(0,e)},hasCoolingSkill:function(){return 0<Role._coolingSkills.length},coolingSkills:function(){var e,t=[];for(e of Role._coolingSkills)t.push(e.split("_")[0]);return t},coolingSkill:function(e){return-1!=this.coolingSkills().indexOf(e)},hasSkill:function(e){return-1!=$(".combat-commands").html().indexOf(e)},weapon:function(){return Role._weaponType},_renewHookIndex:null,_renewStatus:"resting",_coolingSkills:[],_gains:[],_shimen:function(e,t,o){0==e&&(WG.SendCmd("stopstate"),WG.sm_button()),null!=SystemTips.search("你先去休息|和本门毫无瓜葛|你没有",t)?o():setTimeout(function(){Role._shimen(e+1,t,o)},1e3)},_tidyBag:function(e,t){0==e&&WG.sell_all(),WG.packup_listener?10<e?(WG.packup_listener&&WG.sell_all(),t()):window.setTimeout(function(){Role._tidyBag(e+1,t)},1e3):window.setTimeout(t,1e3)},_monitorHpMp:function(){WG.add_hook(["items","sc","itemadd"],function(e){switch(e.type){case"items":if(null!=e.items)for(var t=e.items.length-1;0<=t;t--){var o=e.items[t];if(o.id==Role.id){Role.hp=o.hp,Role.maxHp=o.max_hp,Role.mp=o.mp,Role.maxMp=o.max_mp;break}}break;case"itemadd":case"sc":e.id==Role.id&&(null!=e.hp&&(Role.hp=e.hp),null!=e.max_hp&&(Role.maxHp=e.max_hp),null!=e.mp&&(Role.mp=e.mp),null!=e.max_mp)&&(Role.maxMp=e.max_mp)}})},_monitorStatus:function(){WG.add_hook(["items","status","itemadd"],function(e){switch(e.type){case"items":if(null!=e.items)for(var t=e.items.length-1;0<=t;t--){var o=e.items[t];if(o.id==Role.id){if(null==o.status)break;Role.status={};for(var n=(new Date).getTime(),s=o.status.length-1;0<=s;s--){var i=o.status[s];Role.status[i.sid]=n+i.duration-i.overtime}break}}break;case"status":var a;e.id==Role.id&&(a=(new Date).getTime(),"add"==e.action?Role.status[e.sid]=a+e.duration:"remove"==e.action&&delete Role.status[e.sid]);break;case"itemadd":if(e.id==Role.id&&null!=e.status){Role.status={};for(var l=(new Date).getTime(),r=e.status.length-1;0<=r;r--){var d=e.status[r];Role.status[d.sid]=l+d.duration-d.overtime}}}})},_monitorState:function(){WG.add_hook("state",function(e){var t=e.state;if(null!=t)for(var o in RoleState)if(RoleState.hasOwnProperty(o)){o=RoleState[o];if(-1!=t.indexOf(o))return void(Role.state=o)}Role.state=RoleState.none})},_monitorDeath:function(){WG.add_hook("die",function(e){1==e.relive?Role.living=!0:Role.living=!1})},_monitorInfo:function(){WG.add_hook("dialog",function(e){var t;"score"==e.dialog&&e.id==Role.id&&(null!=e.level&&(t=e.level.replace(/<\/?.+?>/g,""),Role.grade=t.replace(/ /g,"")),null!=e.family&&(Role.family=e.family),null!=e.jingli)&&(t=e.jingli.split("/"),Role.energy=t[0])})},_monitorItems:function(){WG.add_hook("dialog",function(t){if(null!=t.dialog){if("pack"==t.dialog){if(null!=t.items){Role.items={};for(let e of t.items)e.id&&(Role.items[e.id]=e)}else if(null!=t.id){if(null==t.remove&&null!=t.count)return void(Role.items[t.id]=t);if(null!=t.remove){var e=Role.items[t.id];if(null==e)return;null!=e.count?e.count-=t.remove:e.count=0,0==e.count&&delete Role.items[t.id]}}null!=t.eqs?Role.equipments=CopyObject(t.eqs):null!=t.uneq&&null!=t.id?((o=Role.equipments[t.uneq]).count=1,o.id=t.id,Role.items[o.id]=o,Role.equipments[t.uneq]=null):null!=t.eq&&null!=t.id&&(o=Role.items[t.id],Role.equipments[t.eq]=o,delete Role.items[t.id]),null!=t.money&&(Role.money=t.money)}if("list"==t.dialog)if(null!=t.stores){Role.stores={};for(let e of t.stores)e.id&&(Role.stores[e.id]=e)}else{var o;null!=t.id&&null!=t.storeid&&null!=t.store&&(e=Role.items[t.id],o=Role.stores[t.storeid],null==e&&((e=Object.assign({},o,{count:0})).id=t.id,Role.items[e.id]=e),null==o&&(o=Object.assign({},e,{count:0}),Role.stores[o.id]=o),e.count-=t.store,o.count+=t.store,e.count<=0&&delete Role.items[t.id],o.count<=0)&&delete Role.stores[t.storeid]}}})},_monitorGains:function(){WG.add_hook("dialog",function(e){var t,o,n;"pack"==e.dialog&&null!=e.id&&null!=e.name&&null!=e.unit&&null!=e.count&&null==e.remove&&(t=(new Date).getTime(),o=Role.items[e.id],n=e.count,null!=o&&null!=o.count&&(n-=o.count),Role._gains.push({timestamp:t,name:e.name,count:n,unit:e.unit}))})},_monitorSkillCD:function(){WG.add_hook("dispfm",function(e){var t=Date.parse(new Date),o=e.id+"_"+t;Role._coolingSkills.push(o),window.setTimeout(function(){var e=Role._coolingSkills.indexOf(o);-1!=e&&Role._coolingSkills.splice(e,1)},e.distime),null!=e.rtime&&0!=e.rtime&&(null!=Role._rtimer&&clearTimeout(Role._rtimer),Role.rtime=!0,Role._rtimer=setTimeout(e=>{Role.rtime=!1},e.rtime))})},_monitorSkills:function(){function a(e,t,o){switch(e){case"unarmed":Role.kongfu.quan=t,Role.kongfu.quan_c=o;break;case"force":Role.kongfu.nei=t,Role.kongfu.nei_c=o;break;case"parry":Role.kongfu.zhao=t,Role.kongfu.zhao_c=o;break;case"dodge":Role.kongfu.qing=t,Role.kongfu.qing_c=o;break;case"sword":Role.kongfu.jian=t,Role.kongfu.jian_c=o;break;case"blade":Role.kongfu.dao=t,Role.kongfu.dao_c=o;break;case"club":Role.kongfu.gun=t,Role.kongfu.gun_c=o;break;case"staff":Role.kongfu.zhang=t,Role.kongfu.zhang_c=o;break;case"whip":Role.kongfu.bian=t,Role.kongfu.bian_c=o;break;case"throwing":Role.kongfu.an=t,Role.kongfu.an_c=o}}WG.add_hook("dialog",function(e){if(null!=e.dialog&&"skills"==e.dialog){if(null!=e.items)for(var t of e.items){var o,n=t.enable_skill||null,s="";Role.skills=e.items;for(o of e.items)o.id==n&&(s=/<([^<>]*)>/.exec(o.name)[1]);a(t.id,n,s.toLocaleLowerCase())}if(null!=e.id&&null!=e.enable){0==(n=e.enable)&&(n="none");var i,s="";for(i of Role.skills)i.id==n&&(s=/<([^<>]*)>/.exec(i.name)[1]);a(e.id,n,s)}}})},_monitorCombat:function(){WG.add_hook("combat",function(e){null!=e.start&&1==e.start?Role.combating=!0:null!=e.end&&1==e.end&&(Role.combating=!1)}),WG.add_hook("text",function(e){null!=e.msg&&(-1==e.msg.indexOf("只能在战斗中使用")&&-1==e.msg.indexOf("这里不允许战斗")&&-1==e.msg.indexOf("没时间这么做")||(Role.combating=!1),-1!=e.msg.indexOf("战斗中打坐，你找死吗？")||-1!=e.msg.indexOf("你正在战斗"))&&(Role.combating=!0)})},_monitorWeapon:function(){WG.add_hook("perform",function(e){null!=e.skills&&(-1!=JSON.stringify(e.skills).indexOf("sword")?Role._weaponType="sword":-1!=JSON.stringify(e.skills).indexOf("blade")?Role._weaponType="blade":Role._weaponType="")})}},Room={name:null,path:null,updateTimestamp:null,init:function(){this._monitorLocation(),this._monitorItemsInRoom(),this._monitorDeath()},getItem:function(e){return this._itemsInRoom[e]},getItemId:function(e,t,o,n){for(var s of Object.values(this._itemsInRoom))if(1==t){if(-1!=s.name.indexOf(e)&&(1!=o||-1==s.name.indexOf("的尸体"))&&!FilterCenter.filter(n,s))return s.id}else if(s.name==e&&!FilterCenter.filter(n,s))return s.id;return null},didKillItemsInRoom:function(e){var t,o=this._deadItemsInRoom.slice();for(t of e){var n=!1;for(let e=0;e<o.length;e++){var s=o[e];if(1==t.blurry?-1!=s.name.indexOf(t.name)&&(n=!0):s.name==t.name&&(n=!0),n){o.splice(e,1);break}}if(!n)return!1}return!0},_itemsInRoom:{},_deadItemsInRoom:[],_monitorLocation:function(){WG.add_hook("room",function(e){Room.name=e.name,Room.path=e.path,Room.updateTimestamp=(new Date).getTime(),Room._itemsInRoom={},Room._deadItemsInRoom=[]})},_monitorItemsInRoom:function(){WG.add_hook(["items","itemadd","itemremove","sc","status"],function(t){switch(t.type){case"items":if(null!=t.items)for(var e of t.items)null!=e.name&&null!=e.id&&(Room._itemsInRoom[e.id]=e);break;case"itemadd":null!=t.name&&null!=t.id&&(Room._itemsInRoom[t.id]=t);break;case"itemremove":null!=t.id&&delete Room._itemsInRoom[t.id];break;case"sc":var o;null!=t.id&&(null!=(o=Room._itemsInRoom[t.id])&&(null!=t.hp&&(o.hp=t.hp),null!=t.max_hp&&(o.max_hp=t.max_hp),null!=t.mp&&(o.mp=t.mp),null!=t.max_mp))&&(o.max_mp=t.max_mp);break;case"status":if(null!=t.action&&null!=t.id&&null!=t.sid){var n=Room._itemsInRoom[t.id];if(null!=n)if("add"==t.action)null==n.status&&(n.status=[]),n.status.push({sid:t.sid,name:t.name,duration:t.duration,overtime:0});else if("remove"==t.action)for(let e=0;e<n.status.length;e++)if(n.status[e].sid==t.sid){n.status.splice(e,1);break}}}})},_monitorDeath:function(){WG.add_hook("sc",function(e){if(null!=e.id&&null!=e.hp&&0==e.hp)for(var t of Object.values(Room._itemsInRoom))if(t.id==e.id)return void Room._deadItemsInRoom.push(t)})}};class SystemTip{constructor(e){this.timestamp=(new Date).getTime(),this.text=e}}var SystemTips={init:function(){this._monitorSystemTips()},search:function(e,t){var o=new RegExp(e),n=this._tips.slice();for(let e=n.length-1;0<=e;e--){var s=n[e];if(s.timestamp<t)break;s=o.exec(s.text);if(s)return s}return null},clean:function(e){for(;;){if(this._tips.length<=0)break;if(this._tips[0].timestamp>e)break;this._tips.shift()}},rejectTimestamp:null,_monitorSystemTips:function(){var o=this;WG.add_hook("text",function(e){var t=new SystemTip(e.msg);o._push(t),"不要急，慢慢来。"==e.msg&&(o.rejectTimestamp=(new Date).getTime())}),WG.add_hook("item",function(e){var e=e.desc;null!=e&&(e=new SystemTip(e),o._push(e))})},_push:function(e){this._tips.length>=this._maxCapacity&&this._tips.shift(),this._tips.push(e)},_tips:[],_maxCapacity:100};class MsgTip{constructor(e,t,o,n){this.timestamp=(new Date).getTime(),this.content=e,this.ch=t,this.name=o,this.uid=n}}var MsgTips={init:function(){this._monitorSystemTips()},search:function(e,t){var o=new RegExp(e),n=this._tips.slice();for(let e=n.length-1;0<=e;e--){var s=n[e];if(s.timestamp<t)break;s=o.exec(s.content);if(s)return s}return null},clean:function(e){for(;;){if(this._tips.length<=0)break;if(this._tips[0].timestamp>e)break;this._tips.shift()}},rejectTimestamp:null,_monitorSystemTips:function(){var t=this;WG.add_hook("msg",function(e){e=new MsgTip(e.content,e.ch,e.name,e.uid);t._push(e)})},_push:function(e){this._tips.length>=this._maxCapacity&&this._tips.shift(),this._tips.push(e)},_tips:[],_maxCapacity:100},DialogList={init:function(){this._monitorDialogList()},timestamp:null,findItem:function(e,t,o,n){return FindItem(this._list,e,t,o,n)},_list:[],_monitorDialogList:function(){let o=this;WG.add_hook("dialog",function(e){let t=null;null!=e.selllist?t=e.selllist:null!=e.stores?t=e.stores:"pack2"==e.dialog&&null!=e.items&&(t=e.items),null!=t&&(o.timestamp=(new Date).getTime(),o._list=t)})}},TaskList={init:function(){this._monitorTasksList()},search:function(e,t){if(!(this._timestamp<t)){var o,n=new RegExp(e);for(o of this._list){var s=n.exec(o);if(s)return s}}return null},_timestamp:null,_list:[],_monitorTasksList:function(){let n=this;WG.add_hook("dialog",function(e){if(null!=e.dialog&&"tasks"==e.dialog&&null!=e.items){var t,o=[];for(t of e.items)o.push(t.desc);n._timestamp=(new Date).getTime(),n._list=o}})}},Xiangyang={init:function(){this._monitorXiangyang()},search:function(e,t){return!(this._timestamp<t)&&new RegExp(e).exec(this._desc)||null},_timestamp:null,_desc:"",_monitorXiangyang:function(){let t=this;WG.add_hook("dialog",function(e){null!=e.dialog&&"fam"==e.t&&8==e.index&&null!=e.desc&&(t._timestamp=(new Date).getTime(),t._desc=e.desc)})}};!function(){function n(){return"flow_store@"+Role.id}function s(){let e=GM_getValue(n(),null);return e=null==e?GM_getValue("flow_store@null",{}):e}(FlowStore=new PersistentCache((e,t)=>{var o=s();o[e]=t,GM_setValue(n(),o)},e=>s(),e=>{var t=s();delete t[e],GM_setValue(n(),t)})).corver=function(e){GM_setValue(n(),e)}}(),!function(){function n(){return"global_params@"+Role.id}function s(){let e=GM_getValue(n(),null);return e=null==e?GM_getValue("global_params@null",{}):e}PersistentVariables=new PersistentCache((e,t)=>{var o=s();o[e]=t,GM_setValue(n(),o)},e=>s(),e=>{var t=s();delete t[e],GM_setValue(n(),t)}),VariableStore.register(e=>PersistentVariables.getAll())}(),VariableStore.register(e=>({":online":WG.online,":id":Role.id,":name":Role.name,":grade":Role.grade,":family":Role.family,":energy":Role.energy,":money":Role.money,":hp":Role.hp,":maxHp":Role.maxHp,":hpPer":Role.hp/Role.maxHp,":mp":Role.mp,":maxMp":Role.maxMp,":mpPer":Role.mp/Role.maxMp,":living":Role.living,":state":Role.state,":combating":Role.combating,":free":Role.isFree,":gains":Role.profitInfo,":room":Room.name,":path":Room.path,":eq0":Role.getEqId(0),":eq1":Role.getEqId(1),":eq2":Role.getEqId(2),":eq3":Role.getEqId(3),":eq4":Role.getEqId(4),":eq5":Role.getEqId(5),":eq6":Role.getEqId(6),":eq7":Role.getEqId(7),":eq8":Role.getEqId(8),":eq9":Role.getEqId(9),":eq10":Role.getEqId(10),":kf_quan":Role.kongfu.quan,":kf_nei":Role.kongfu.nei,":kf_zhao":Role.kongfu.zhao,":kf_qing":Role.kongfu.qing,":kf_jian":Role.kongfu.jian,":kf_dao":Role.kongfu.dao,":kf_gun":Role.kongfu.gun,":kf_zhang":Role.kongfu.zhang,":kf_bian":Role.kongfu.bian,":kf_an":Role.kongfu.an,":kf_quan_c":Role.kongfu.quan_c,":kf_nei_c":Role.kongfu.nei_c,":kf_zhao_c":Role.kongfu.zhao_c,":kf_qing_c":Role.kongfu.qing_c,":kf_jian_c":Role.kongfu.jian_c,":kf_dao_c":Role.kongfu.dao_c,":kf_gun_c":Role.kongfu.gun_c,":kf_zhang_c":Role.kongfu.zhang_c,":kf_bian_c":Role.kongfu.bian_c,":kf_an_c":Role.kongfu.an_c})),VariableStore.register(e=>({":room ":function(e){var t;for(t of e.split(","))if(-1!=Room.name.indexOf(t))return!0;return!1},":cd ":function(e){return Role.coolingSkill(e)},":status ":function(e){var t=e.split(",");if(1<t.length){var o=t[0],t=Room.getItem(t[1]);if(null!=t&&null!=t.status)for(var n of t.status)if(n.sid==o)return!0;return!1}return Role.hasStatus(e)},":hp ":function(e){e=Room.getItem(e);return null!=e?e.hp:-1},":weapon ":function(e){return e==Role.weapon()},":maxHp ":function(e){e=Room.getItem(e);return null!=e?e.max_hp:-1},":mp ":function(e){e=Room.getItem(e);return null!=e?e.mp:-1},":maxMp ":function(e){e=Room.getItem(e);return null!=e?e.max_mp:-1},":exist ":function(e){return null!=e&&null!=Room.getItem(e)},":findName ":function(e){return null!=e&&null!=(e=Room.getItem(e))?e.name.replace(/<.+?>|&lt.*/g,"").split(" ").pop():null}}));let FilterCenter={filter:function(filterExp,obj){if(null==filterExp)return!1;let exp=filterExp.substring(1,filterExp.length-2),yes=eval(""+exp);return yes}};function ReplacePlaceholder(e){for(var t=/\{([a-z]?)([^a-z%#]+?|<\w+>[^a-z%#]+?<\/\w+>)([a-z]?)(%?)(#?)\}\??(#[^#{}]*#)?/g,o=[],n=t.exec(e);null!=n;)o.push({text:n[0],location:""==n[1]?null:n[1],name:n[2],blurry:"%"!=n[4],quality:""==n[3]?null:n[3],type:"#"!=n[5]?"id":"amount",filterExp:n[6]}),n=t.exec(e);var s;let i=e;for(s of o){var a=function(t){let e=[];for(var o of e=null==t.location?null==t.quality?["r","b","d"]:["b","d"]:[t.location]){let e=null;switch(o){case"r":e=Room.getItemId(t.name,t.blurry,!1,t.filterExp);break;case"b":var n=Role.findItem(t.name,t.blurry,t.quality,t.filterExp);n&&(e="id"==t.type?n.id:n.count);break;case"d":n=DialogList.findItem(t.name,t.blurry,t.quality,t.filterExp);n&&(e="id"==t.type?n.id:n.count)}if(null!=e)return e}return null}(s);i=i.replace(s.text,a)}return i}!function(){var e=new CmdPrehandler(function(e,t){return ReplacePlaceholder(t)});CmdPrehandleCenter.shared().addHandler(e)}(),!function(){var e=new PrecompileRule(function(e){var t,o,n=[],s="",i=!1;for(t of e)if(0!=t.indexOf("`")&&!i||(0==(o=t).indexOf("`")&&(o=t.substr(1)),s=s+" "+(o="`"==t[t.length-1]?t.substr(0,t.length-1):o),i=!0),"`"==t[t.length-1])n[n.length-1]=n[n.length-1]+s,s="",i=!1;else if(!i){var a=/^\s*/.exec(t)[0],l=/(\{[^\}]+\})([^\?]|$)/g;let e=l.exec(t);for(var r=t.indexOf("@js");null!=e&&-1==r;)n.push(`${a}@until ${e[1]}? != null`),e=l.exec(t);n.push(t)}return n},PrecompileRulePriority.low);PrecompileRuleCenter.shared().addRule(e)}(),!function(){var e=new CmdExecutor(e=>0==e.indexOf("<-stopSSAuto")||0==e.indexOf("@stopSSAuto"),(e,t)=>{e.log()&&Message.cmdLog("暂停自动婚宴和自动Boss","目前手动终止流程不会自动恢复"),WG.stopAllAuto()});CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new CmdExecutor(e=>0==e.indexOf("stopSSAuto->")||0==e.indexOf("@recoverSSAuto"),(e,t)=>{e.log()&&Message.cmdLog("恢复自动婚宴和自动Boss设置"),WG.reSetAllAuto()});CmdExecuteCenter.addExecutor(e)}();var __RecordGainsFrom=null;!function(){var e=new CmdExecutor(e=>0==e.indexOf("<-recordGains"),(e,t)=>{e.log()&&Message.cmdLog("开始记录物品获取"),__RecordGainsFrom=(new Date).getTime()});CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new CmdExecutor(e=>0==e.indexOf("recordGains->"),(e,t)=>{var o,n,s=Role.gains(__RecordGainsFrom,(new Date).getTime()),i={},a=(s.forEach(e=>{var t=0,o=i[e.name];o&&(t=o.count),i[e.name]={count:t+e.count,unit:e.unit}}),"");for(o in-1==t.indexOf("recordGains->silent")&&(Message.clean(),Message.append("&nbsp;&nbsp;> 战利品列表如下：")),i)i.hasOwnProperty(o)&&(n=i[o],-1==t.indexOf("recordGains->silent")&&Message.append("&nbsp;&nbsp;* "+o+" <wht>"+n.count+n.unit+"</wht>"),a+=`&nbsp;&nbsp;* ${o} <wht>${n.count}${n.unit}</wht><br>`);Role.profitInfo=""!=a?a:null,0!=t.indexOf("recordGains->nopopup")&&0!=t.indexOf("recordGains->silent")&&layer.open({type:1,area:["380px","300px"],title:"战利品列表",content:a,offset:"auto",shift:2})});CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new AtCmdExecutor("toolbar",function(e,t){return e.timeSeries((new Date).getTime()),$(`span[command=${t}]`).click(),new Promise(t=>{setTimeout(e=>{$(".glyphicon-remove-circle").click(),t()},500)})});CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new UntilAtCmdExecutor("liaoshang",function(e,t){return 1<=Role.hp/Role.maxHp?(WG.SendCmd("stopstate"),!0):(Role.state!=RoleState.liaoshang&&WG.SendCmd("stopstate;liaoshang"),!1)},null,1e3);CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new UntilAtCmdExecutor("dazuo",function(e,t){return.99<Role.mp/Role.maxMp?(WG.SendCmd("stopstate"),!0):(Role.state!=RoleState.dazuo&&WG.SendCmd("stopstate;dazuo"),!1)},null,1e3);CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new UntilAtCmdExecutor("eq",function(e,t){t=t.split(",");let o=[];return t.forEach(e=>{Role.wearing(e)||o.push("eq "+e)}),!(0<o.length&&(WG.SendCmd("stopstate;"+o.join(";")),1))},null,1e3);CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new UntilAtCmdExecutor("cd",function(e,t){if(null==t)return!Role.hasCoolingSkill();let o=t,n=!1;"^"==o[0]&&(o=o.substring(1),n=!0);var s=o.split(",");if(n){for(var i of Role.coolingSkills())if(-1==s.indexOf(i))return!1}else{var a,l=Role.coolingSkills();for(a of s)if(-1!=l.indexOf(a))return!1}return!0});CmdExecuteCenter.addExecutor(e)}();class UntilSearchedAtCmdExecutor extends UntilAtCmdExecutor{constructor(e,u){super(e,function(t,e){var o=[],n=/\(\$[a-zA-Z0-9_]+?\)/g;let s=n.exec(e);for(;null!=s;)o.push(s[0]),s=n.exec(e);let i=e;for(let e=0;e<o.length;e++){var a=o[e];i=i.replace(a,"(.+?)")}var l=u(i,t.timeSeries());if(null==l)return!1;for(let e=0;e<o.length;e++){var r=o[e],r=r.substring(2,r.length-1),d=l[e+1];null!=d&&UpdateVariable(t,r,d)}return!0})}}function UntilRoleFreePerformerPromise(e,t){return PerformerPromise("@until (:free) == true",e,t)}!function(){var e=new UntilSearchedAtCmdExecutor("tip",(e,t)=>SystemTips.search(e,t));CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new UntilSearchedAtCmdExecutor("msgtip",(e,t)=>MsgTips.search(e,t));CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new UntilSearchedAtCmdExecutor("task",(e,t)=>TaskList.search(e,t));CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new UntilSearchedAtCmdExecutor("xy",(e,t)=>Xiangyang.search(e,t));CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new UntilAtCmdExecutor("kill",function(e,t){var o=t.split(","),n=[];for(let t=0;t<o.length;t++){const s=o[t];let e=!0;"%"==s.substring(s.length-1)&&(s=s.substring(0,s.length-1),e=!1),n.push({name:s,blurry:e})}if(Room.didKillItemsInRoom(n))return!0;{let t="";return n.forEach(e=>{e=Room.getItemId(e.name,e.blurry,!0);null!=e&&(t+="kill "+e+";")}),WG.SendCmd(t),!1}},null,1e3,1e3);CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new UntilAtCmdExecutor("dialog",function(e,t){return DialogList.timestamp>e.timeSeries()});CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new AtCmdExecutor("cleanBag",function(e,t){return e.log()&&Message.cmdLog("清理包裹"),UntilRoleFreePerformerPromise(e=>{WG.SendCmd("$cleanall"),setTimeout(e,1e3)})});CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new AtCmdExecutor("tidyBag",function(e,t){return e.log()&&Message.cmdLog("整理包裹"),UntilRoleFreePerformerPromise(t=>{Role.tidyBag(e=>{setTimeout(t,1e3)})})});CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new AtCmdExecutor("shimen",function(e,t){return e.log()&&Message.cmdLog("自动完成允许放弃的放弃师门"),UntilRoleFreePerformerPromise(t=>{Role.shimen(e=>{setTimeout(t,1e3)})})});CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new AtCmdExecutor("renew",function(e,t){return e.log()&&Message.cmdLog("恢复角色气血和内力"),UntilRoleFreePerformerPromise(t=>{Role.renew(e=>{setTimeout(t,1e3)})})});CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new AtCmdExecutor("beep",function(e,t){Beep()});CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new AtCmdExecutor("push",function(e,t){Push(t)});CmdExecuteCenter.addExecutor(e)}();var SkillStateMachine={perform:function(e,t){var o=(new Date).getTime();this._perform(e,t,o)},_perform:function(n,t,s){if(!(null!=this._skillStack[n]&&this._skillStack[n]>s)){let o=this;if(!Role.isFree()&&!t||Role.coolingSkill(n)||Role.rtime)setTimeout(e=>{o._perform(n,t,s)},200);else{this._skillStack[n]=s,WG.SendCmd("perform "+n);let t=setInterval(e=>{Role.coolingSkill(n)||0==Role.combating?(clearInterval(t),null!=o._skillStack[n]&&o._skillStack[n]==s&&delete o._skillStack[n]):Role.isFree()&&!Role.rtime&&WG.SendCmd("perform "+n)},1e3)}}},reset:function(){this._skillStack={}},_skillStack:{},_performNum:0},__systemCmdDelay=1500;!function(){var e=new AtCmdExecutor("cmdDelay",function(e,t){e._cmdDelay=parseInt(t)});CmdExecuteCenter.addExecutor(e)}();let UnpackSystemCmd=function(e){let t=e;var o=/([^;]+)\[(\d+?)\]/g;let n=o.exec(e);for(;null!=n;){var s=n[1],i=parseInt(n[2]),i=new Array(i).fill(s).join(";");t=t.replace(n[0],i),n=o.exec(e)}return t},GetDungeonFlow=(!function(){var e=new CmdExecutor(e=>!0,(i,e)=>{let a=CmdPrehandleCenter.shared().handle(i,e);return a=UnpackSystemCmd(a),UntilRoleFreePerformerPromise(o=>{let n=(new Date).getTime(),e=0;var t=n-SystemTips.rejectTimestamp,s=(t<1500&&(e=t),t="setTimeout(() =>  postMessage('0'), "+e+")",t=new Blob(["(function(){"+t.toString()+"})()"]),t=window.URL.createObjectURL(t),new Worker(t));s.onmessage=function(e){s.terminate(),i.log()&&Message.cmdLog("执行系统命令",a),i.timeSeries(n),i.systemCmdTimestamp=n,WG.SendCmd(a);var t=null==i._cmdDelay?__systemCmdDelay:i._cmdDelay;setTimeout(o,t)}})},CmdExecutorPriority.low);CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new AtCmdExecutor("force",function(o,n){return new Promise(e=>{o.log()&&Message.cmdLog("强行执行系统命令",n),WG.SendCmd(n);var t=null==o._cmdDelay?__systemCmdDelay:o._cmdDelay;setTimeout(e,t)})});CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new AtCmdExecutor("perform",function(e,t){var o;for(o of t.split(","))SkillStateMachine.perform(o,!1)});CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new AtCmdExecutor("on",function(e,t){unsafeWindow.TriggerCenter.activate(t)});CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new AtCmdExecutor("off",function(e,t){unsafeWindow.TriggerCenter.deactivate(t)});CmdExecuteCenter.addExecutor(e)}(),function(e){for(var t of Dungeons)if(t.name==e)return t.source;return null}),AutoDungeonName=function(e){var e=e.split(" "),t=e[0];let o="";switch(e[1]){case"0":if(GetDungeonFlow(t))return t;if(o=t+"(简单)",GetDungeonFlow(o))return o;break;case"1":if(o=t+"(困难)",null!=GetDungeonFlow(o))return o;break;case"2":if(o=t+"(组队)",null!=GetDungeonFlow(o))return o}return null};function GetDungeonSource(e){e=GetDungeonFlow(e);return null==e?null:`
[if] (_DungeonHpThreshold) == null
    ($_DungeonHpThreshold) = 50
[if] (_DungeonWaitSkillCD) == null
    ($_DungeonWaitSkillCD) = 打开
[if] (_DungeonBagCleanWay) == null
    ($_DungeonBagCleanWay) = 存仓及售卖
[if] (_DungeonRecordGains) == null
    ($_DungeonRecordGains) = 是
#select ($_DungeonHpThreshold) = 副本内疗伤，当气血低于百分比,100|90|80|70|60|50|40|30|20|10,(_DungeonHpThreshold)
#select ($_DungeonWaitSkillCD) = Boss战前等待技能冷却,打开|关闭,(_DungeonWaitSkillCD)
#select ($_DungeonBagCleanWay) = 背包清理方案,不清理|售卖|存仓及售卖,(_DungeonBagCleanWay)
#select ($_DungeonRecordGains) = 结束后显示收益统计,是|否,(_DungeonRecordGains)
#input ($_repeat) = 重复次数,1
#config
[if] (arg0) != null
    ($_DungeonHpThreshold) = (arg0)
[if] (arg1) != null
    ($_DungeonWaitSkillCD) = (arg1)
[if] (arg2) != null
    ($_DungeonBagCleanWay) = (arg2)
[if] (arg3) != null
    ($_repeat) = (arg3)
<-stopSSAuto
stopstate
<---
[if] (_DungeonHpThreshold) == null
    ($_DungeonHpThreshold) = 50
($hpPer) = (_DungeonHpThreshold)/100
[if] (:hpPer) < (hpPer)
    @liaoshang
--->
[if] (_DungeonRecordGains) == 是
    <-recordGains
($_i) = 0
[if] (_repeat) == null
    ($_repeat) = 1
[while] (_i) < (_repeat)
    @renew
    [if] (_DungeonBagCleanWay) == 售卖
        @cleanBag
    [else if] (_DungeonBagCleanWay) == 存仓及售卖
        @tidyBag
${SourceCodeHelper.appendHeader("    ",e)}
    cr;cr over
    ($_i) = (_i) + 1
[if] (_DungeonBagCleanWay) == 售卖
    @cleanBag
[else if] (_DungeonBagCleanWay) == 存仓及售卖
    @tidyBag
$to 住房-练功房;dazuo
[if] (_DungeonRecordGains) == 是
    recordGains->
stopSSAuto->`}!function(){var e=new AtCmdExecutor("fb",function(e,t){let n=AutoDungeonName(t);if(null!=n){let o=GetDungeonSource(n);return new Promise(t=>{var e=new Performer("自动副本-"+n,o);e.log(!0),e.start(e=>{t()})})}Message.append("暂不支持次副本哦，欢迎到论坛分享此副本流程。")});CmdExecuteCenter.addExecutor(e)}();let Dungeons=[{name:"华山论剑",source:`
@print 👑 感谢 koyodakla、freesunny 对此副本代码提供的帮助。
jh fb 30 start1;cr huashan/lunjian/leitaixia
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go up
@tip 恭喜你战胜了五绝
@wait 1000
jump bi
get all from {r五绝宝箱}`},{name:"光明顶(组队)",source:`
@print 👑 感谢 dtooboss 分享此副本代码。
jh fb 26 start3;cr mj/shanmen 2 0
go north;go west;go northwest
@kill 冷谦
go north
@kill 张中
go north
@kill 周颠
go north;go north
@kill 颜垣
go east
@kill 唐洋
go north
@kill 辛然
go west;go west
@kill 庄铮
go south
@kill 闻苍松
go east;go south
@kill 说不得,彭莹玉
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go north[2]
@kill 韦一笑,殷天正
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go north[2]
@kill 张无忌,杨逍,范遥`},{name:"光明顶",source:`
@print 👑 感谢 dtooboss 分享此副本代码。
jh fb 26 start1;cr mj/shanmen
go north;go west;go northwest
@kill 冷谦
go north
@kill 张中
go north
@kill 周颠
go north;go north
@kill 颜垣
go east
@kill 唐洋
go north
@kill 辛然
go west;go west
@kill 庄铮
go south
@kill 闻苍松
go east;go south
@kill 说不得,彭莹玉
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go north[2]
@kill 韦一笑,殷天正
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go north[2]
@kill 张无忌,杨逍,范遥`},{name:"燕子坞(困难)",source:`
jh fb 23 start2;cr murong/anbian 1 0
go east;go east
@kill 包不同
go east;go south;go east;go south;go south
@kill 王夫人
go north;go north;go west;go north
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go east;go east;go east
@kill 慕容复
go west;go north
look pai;bai pai[3]
go north;search
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go south
@kill 慕容博
go east
@kill 阿朱`},{name:"燕子坞(简单)",source:`
jh fb 23 start1;cr murong/anbian
go east;go east
@kill 包不同
go east;go south;go east;go south;go south
@kill 王夫人
go north;go north;go west;go north
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go east;go east;go east
@kill 慕容复
go west;go north
look pai;bai pai[3]
go north;search
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go south
@kill 慕容博
go east
@kill 阿朱`},{name:"燕子坞(偷书)",source:`
@print 👑 感谢 Airson 分享此副本代码。
jh fb 23 start1;cr murong/anbian
go east;go east
@kill 包不同
go east;go east;go east;go north
look pai;bai pai[3]
go north;search`},{name:"移花宫(困难)",source:`
jh fb 22 start2;cr huashan/yihua/shandao 1 0
go south[5]
go south[5]
go south[5]
@kill 花月奴
go south;go south
@kill 移花宫女弟子,移花宫女弟子
go south
@kill 移花宫女弟子,移花宫女弟子
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go southeast
@kill 涟星
[if] {r邀月}? != null
    @kill 邀月
[if] {邀月的尸体}? == null
    [if] (_DungeonWaitSkillCD) == 打开
        @cd
go northwest;go southwest
[if] {r邀月}? != null
    @kill 邀月
[if] {b火折子g}? != null
    look hua
    @tip 你数了下大概有($number)朵花
    go southeast
    look bed;pushstart bed
    pushleft bed[(number)]
    @await 1000
    pushright bed[8]
    @await 1000
    go down;fire;go west
    @kill 花无缺
    look xia;open xia`},{name:"移花宫(简单)",source:`
jh fb 22 start1;cr huashan/yihua/shandao
go south[5]
go south[5]
go south[5]
@kill 花月奴
go south;go south
@kill 移花宫女弟子,移花宫女弟子
go south
@kill 移花宫女弟子,移花宫女弟子
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go southeast
@kill 涟星
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go northwest;go southwest
@kill 邀月
[if] {b火折子g}? != null
    look hua
    @tip 你数了下大概有($number)朵花
    go southeast
    look bed;pushstart bed
    pushleft bed[(number)]
    @await 1000
    pushright bed[8]
    @await 1000
    go down;fire;go west
    @kill 花无缺
    look xia;open xia`},{name:"冰火岛(困难)",source:`
@print 👑 感谢 WanJiaQi 分享此副本代码。
jh fb 21 start2;cr mj/bhd/haibian 1 0
go west
@kill 炎龙
go west
@kill 炎龙
go west
@kill 炎龙王
@liaoshang
go west;search
@tip 你找到了
go east[4];go north
@kill 白熊
go north
@kill 白熊
@liaoshang
go north;go west;zuan dong
[if] (_DungeonWaitSkillCD) == 打开
    @cd
@kill 张翠山
@kill 谢逊`},{name:"冰火岛(简单)",source:`
@print 👑 感谢 WanJiaQi 分享此副本代码。
jh fb 21 start1;cr mj/bhd/haibian 0 0
go west
@kill 炎龙
go west
@kill 炎龙
go west
@kill 炎龙王
@liaoshang
//go west;search
//@tip 你找到了
go east[3];go north
@kill 白熊
go north
@kill 白熊
@liaoshang
go north;go west;zuan dong
[if] (_DungeonWaitSkillCD) == 打开
    @cd
@kill 谢逊`},{name:"星宿海",source:`
jh fb 20 start1;cr xingxiu/xxh6
go northeast
@kill 星宿派
go north
@kill 星宿派
go northwest
@kill 星宿派
go southwest
@kill 星宿派
go south
@kill 星宿派
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go north;go northeast;go north
@kill 丁春秋`},{name:"白驼山",source:`
jh fb 19 start1;cr baituo/damen
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go north[4]
@kill 欧阳锋
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go south
@kill 欧阳克,白衣少女
go south[2];go west[3]
@kill 毒蛇
go north
@kill 毒蛇
go north;go north
@kill 蟒蛇`},{name:"白驼山(组队)",source:`
jh fb 19 start3;cr baituo/damen 2 0
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go north[4]
@kill 欧阳锋
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go south
@kill 欧阳克,白衣少女
go south[2];go west[3]
@kill 毒蛇
go north
@kill 毒蛇
go north;go north
@kill 蟒蛇`},{name:"桃花岛(困难)",source:`
jh fb 18 start2;cr taohua/haitan 1 0
@until (:path) == taohua/haitan
@taohualin
@wait 1000
go south
@kill 陆乘风
go east;go east
@kill 曲灵风
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go east;go east
@kill 黄药师
go west;go north
@kill 黄蓉`},{name:"桃花岛(简单)",source:`
jh fb 18 start1;cr taohua/haitan
@until (:path) == taohua/haitan
@taohualin
@wait 1000
go south
@kill 陆乘风
go east;go east
@kill 曲灵风
go east;go north
ok {黄蓉}
@zhoubotong
@kill 周伯通
look xia;search xia
go east[2]
go northwest;go southeast;go southeast;go northwest
go southwest;go northeast;go northeast;go southwest
@until (:path) == taohua/haitan
@taohualin
@wait 2000
go south;go east
go east;go east;go north
select {黄蓉};give1 {黄蓉}
@kill 黄蓉`},{name:"云梦沼泽(组队)",source:`
@print 👑 感谢 leiyulin 分享此副本代码。
jh fb 17 start3;cr cd/yunmeng/senlin 2 0
$wait 500
go east
@kill 巨鳄
go north
@kill 巨鳄,巨鳄
go east
@kill 巨鳄,巨鳄
go west;go north
@kill 巨鳄,巨鳄
look lu;kan lu;go north
@kill 火龙
go north
@kill 火龙
go north
@kill 火龙
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go north
@kill 火龙王`},{name:"云梦沼泽",source:`
@print 👑 感谢 leiyulin 分享此副本代码。
jh fb 17 start1;cr cd/yunmeng/senlin
$wait 500
go east
@kill 巨鳄
go north
@kill 巨鳄,巨鳄
go east
@kill 巨鳄,巨鳄
go west;go north
@kill 巨鳄,巨鳄
look lu;kan lu;go north
@kill 火龙
go north
@kill 火龙
go north
@kill 火龙
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go north
@kill 火龙王`},{name:"嵩山",source:`
jh fb 16 start1;cr wuyue/songshan/taishi
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go north[2]
@kill 十三太保
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go northup;go northeast;go northup[2]
@kill 十三太保,十三太保
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go northup;go north
@kill 十三太保,十三太保,十三太保
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go north
@kill 十三太保,十三太保,十三太保,十三太保
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go north
@kill 左冷禅`},{name:"泰山",source:`
jh fb 15 start1;cr wuyue/taishan/daizong
go northup[2]
@kill 玉磬子
go northup[2]
@kill 玉音子
go northup[2]
go northup[2]
@kill 玉玑子`},{name:"衡山",source:`
jh fb 14 start1;cr wuyue/henshan/hengyang
go west;go north
@kill 嵩山弟子,嵩山弟子
go north;go north
@kill 费彬
@kill 史登达,丁勉
@kill 刘正风
go south[3];go west[2]
@kill 曲洋,曲非烟
go east[4];go southeast;go south;go east;go south
@kill 莫大`},{name:"青城山",source:`
@print 👑 感谢 矮大瓜 分享此副本代码。
jh fb 13 start1;cr wuyue/qingcheng/shanlu
go westup
@kill 青城派弟子,青城派弟子
go north
go northup
go eastup
@kill 青城派弟子,青城派弟子
go northup
@kill 洪人雄
go north[3]
@kill 于人豪
go north
@kill 侯人英,罗人杰
go south
go east
@kill 余人彦
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go north
@kill 余沧海`},{name:"恒山",source:`
@print 👑 感谢 .min-A 分享此副本代码。
jh fb 12 start1;cr wuyue/hengshan/daziling
go northup;go northwest;go northwest;go northup;go northup
@kill 不戒和尚,仪琳,哑婆婆
go north;go north
@kill 定静师太,定闲师太,定仪师太

($path)=(:path)
[while] true
    <---
    @until (path)!=(:path)
    ($path)=(:path)
    ($guy) = {r采花大盗 田伯光}?
    [if] (guy) != null
        @kill 采花大盗 田伯光
    [if] {田伯光的尸体}? != null
        [break]
    --->
    go south
    go west
    go north
    go south
    go east
    go east
    go north
    go south
    go west
    go south
    go southdown
    go east
    go southeast
    go northup
    go southdown
    go southeast
    go southdown

    go northup
    go northwest
    go northup
    go southdown
    go northwest
    go northup
    go northup
    go north
    go north`},{name:"五毒教(组队)",source:`
@print 👑 感谢 矮大瓜 分享此副本代码。
jh fb 11 start3;cr cd/wudu/damen 2 0
@kill 五毒教徒,五毒教徒,五毒教徒,五毒教徒
go east
@kill 沙千里
go south
@kill 藏獒
go west
@kill 白髯老者
go east
go south
@kill 毒郎中
go north
go north
[if](_DungeonWaitSkillCD) == 打开
    @cd
go east
@kill 潘秀达,岑其斯,齐云敖
[if](_DungeonWaitSkillCD) == 打开
    @cd
go east
@kill 何红药
[if](_DungeonWaitSkillCD) == 打开
    @cd
go east
@kill 何铁手`},{name:"五毒教",source:`
@print 👑 感谢 矮大瓜 分享此副本代码。
jh fb 11 start1;cr cd/wudu/damen
@kill 五毒教徒,五毒教徒,五毒教徒,五毒教徒
go east
@kill 沙千里
go south
@kill 藏獒
go west
@kill 白髯老者
go east
go south
@kill 毒郎中
go north
go north
[if](_DungeonWaitSkillCD) == 打开
    @cd
go east
@kill 潘秀达,岑其斯,齐云敖
[if](_DungeonWaitSkillCD) == 打开
    @cd
go east
@kill 何红药
[if](_DungeonWaitSkillCD) == 打开
    @cd
go east
@kill 何铁手`},{name:"温府",desc:"温府(2k+闪避)",source:`
@print 👑 感谢 JiaQi Wan 分享此副本代码。
jh fb 10 start1;cr cd/wen/damen
look tree;climb tree;go north;go northeast
[while] true
    [if] (:path) != cd/wen/zoulang4
        go northeast
    [else]
        [break]
go north[2];go northwest;go north
look zhuang;tiao zhuang
@kill 温方义,温方山,温方施,温方南
[if] {r温家老大 温方达%}? != null
    @kill 温方达
@wait 2000
[if] (_DungeonWaitSkillCD) == 打开
    @cd
look zhuang;tiao zhuang
@until (:path) == cd/wen/xiaoyuan
@wait 500
[if] {r夏雪宜}? != null
    @kill 夏雪宜
go north
@kill 温仪`},{name:"关外",source:`
@print 👑 感谢 老实人 分享此副本代码。
jh fb 9 start1;cr bj/guanwai/damen
go northeast
@kill 金雕
go east
@kill 金雕
go southeast
@kill 金雕
go east
@kill 平四
go north
select {r胡斐}
ask {r胡斐} about 阎基
@tip 胡斐说道：阎基是我的杀父仇人($chat)
[if] (chat) == ，
        give {r胡斐} {b阎基的头颅}
        ask {r胡斐} about 胡家刀谱
[if] (_DungeonWaitSkillCD) == 打开
    @cd
@kill 胡斐
go south;go east
@kill 东北虎
go eastup
@kill 东北虎
go southup
@kill 东北虎
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go eastup
@kill 黑熊
go westdown;go northdown;go west[2];go northwest
go west;go southwest;go west
give {r船夫} 10000 money
@until (:room)==关外-船厂(副本区域)
@wait 500
@kill 船夫
go south;go west[5];go north
@kill 江湖医生 阎基`},{name:"神龙教(组队)",source:`
jh fb 8 start3;cr bj/shenlong/haitan 2 0;go north
@kill 毒蛇,竹叶青
look bush;kan bush;go north
@kill 毒蛇,竹叶青
go north
@kill 神龙教弟子,神龙教弟子
go north
@kill 神龙教军师 陆高轩
go south;go east
@kill 神龙教青龙使 许雪亭
go east
@kill 神龙教女弟子,神龙教女弟子
go north[2]
@kill 神龙教弟子,神龙教弟子
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go north
@kill 洪安通,张淡月,无根道长`},{name:"神龙教",source:`
jh fb 8 start1;cr bj/shenlong/haitan;go north
@kill 毒蛇,竹叶青
look bush;kan bush;go north
@kill 毒蛇,竹叶青
go north
@kill 神龙教弟子,神龙教弟子
go north
@kill 神龙教军师 陆高轩
go south;go east
@kill 神龙教青龙使 许雪亭
go east
@kill 神龙教女弟子,神龙教女弟子
go north[2]
@kill 神龙教弟子,神龙教弟子
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go north
@kill 洪安通,张淡月,无根道长`},{name:"天地会",source:`
@print 👑 感谢 jicki 分享此副本代码，感谢 andyfos、mma1996 协助完成。
jh fb 7 start1;cr bj/tdh/hct
@kill 药铺伙计
@kill 天地会青木堂护法 徐天川
go west
@kill 关夫子 关安基
knock;knock;knock
go down
@until {r尸体}? != null
go west[5]
@until {r尸体}? != null
go north
@liaoshang
[if] (_DungeonWaitSkillCD) == 打开
    @cd
@kill 陈近南
go east
get {r一}?
@wait 500
get {r一}?
go west
go north
go east
@tip 拔刀相助，贫尼感激不尽。
@wait 1000
select {r神尼};cha {r神尼}
@wait 1000
@kill 独臂神尼`},{name:"鳌拜府",source:`
@print 👑 感谢 Jeaepan 分享此副本代码。
jh fb 6 start1;cr bj/ao/damen
@kill 官兵,官兵
go west
@kill 吴之荣
go north
@kill 厨师
go south;go west
@kill 家将,家将,女管家
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go west
@kill 满洲第一勇士 鳌拜
go east;go north
look shu;open shu
@tip 发现扉页的($pos)下角被鳌拜写了一个大大的杀字
look hua
$wait 500
[if] (pos) == 左
    tleft hua
[if] (pos) == 右
    $wait 500
    tright hua
go north
select {r四十二章经g}?
get {r四十二章经g}?
go south;go south
($open) = 没开
look men;unlock men
@tip 你用一把钥匙($open)了牢房门|你不会撬锁
[if] (open) == 打开
    go south
    select {r庄允城}?
    ask {r庄允城}? about 吴之荣
    @kill 庄允城`},{name:"庄府",source:`
@print 👑 感谢 qwer68588 分享此副本代码。
jh fb 5 start1;cr bj/zhuang/xiaolu
go north
@kill 土匪
go north
look men;break men
go north
@kill 神龙教弟子,神龙教弟子
go north
@kill 神龙教弟子
@kill 神龙教小头目 章老三
go west
@kill 神龙教弟子
go east;go east
@kill 神龙教弟子`},{name:"兵营",source:`
@print 👑 感谢 qwer68588 分享此副本代码。
jh fb 4 start1;cr yz/by/damen
@kill 官兵,官兵
$wait 1000
@liaoshang
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go south
@kill 官兵,官兵,官兵,武将,武将,史青山
$wait 1000
look men;open men
go south;search`},{name:"流氓巷(组队)",source:`
jh fb 2 start3;cr yz/lmw/xiangzi1 2 0
@kill 小流氓,小流氓
go east
@kill 流氓,流氓
go north
@kill 流氓头,流氓,流氓
go south;go east
@kill 流氓,流氓
go east
@kill 流氓头领`},{name:"流氓巷",source:`
jh fb 2 start1;cr yz/lmw/xiangzi1
@kill 小流氓,小流氓
go east
@kill 流氓,流氓
go north
@kill 流氓头,流氓,流氓
go south;go east
@kill 流氓,流氓
go east
@kill 流氓头领`},{name:"丽春院",source:`
jh fb 3 start1;cr yz/lcy/dating
@kill 韦春芳
go up
@kill 龟公
go west
@kill 史松
look tai;tui tai;go enter
@kill 茅十八`},{name:"财主家(困难)",source:`
jh fb 1 start2;cr yz/cuifu/caizhu 1 0
@kill 大狼狗,大狼狗
go north
@kill 管家,家丁,家丁
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go north
@kill 财主 崔员外
($open) = 没开
look men;open men
@tip 你不会撬锁|钥匙($open)了秘门
[if] (open) == 打开
    go east
    ok {丫鬟}
    go west;go south;go south
    ok {丫鬟}?
    go north;go north;go west
    select {财主女儿 崔莺莺};ask {财主女儿 崔莺莺} about 东厢
[else]
    go west
@kill 财主女儿 崔莺莺
[if] (open) == 打开
    go east;go east;look gui;search gui`},{name:"财主家(简单)",source:`
jh fb 1 start1;cr yz/cuifu/caizhu
@kill 大狼狗,大狼狗
go north
@kill 管家,家丁,家丁
[if] (_DungeonWaitSkillCD) == 打开
    @cd
go north
@kill 财主 崔员外
($open) = 没开
look men;open men
@tip 你不会撬锁|钥匙($open)了秘门
[if] (open) == 打开
    go east
    ok {丫鬟}
    go west;go south;go south
    ok {丫鬟}?
    go north;go north;go west
    select {财主女儿 崔莺莺};ask {财主女儿 崔莺莺} about 东厢
[else]
    go west
@kill 财主女儿 崔莺莺
[if] (open) == 打开
    go east;go east;look gui;search gui`}],Server={uploadConfig:function(){let t={};GM_listValues().forEach(e=>{"roles"!=e&&(t[e]=GM_getValue(e))}),null!=unsafeWindow.TriggerConfig&&(e=unsafeWindow.TriggerConfig.get(),t["@@@trigger"]=e);var e=JSON.stringify(t);Server._sync("uploadConfig",{id:Role.id,value:e},e=>{GM_setClipboard(e),alert(`wsmud_Raid 配置上传成功，该浏览器所有角色配置会在服务器保存 24 小时。
配置获取码：${e}，已复制到系统剪切板。`),Message.append(`<hiy>角色配置获取码：${e}</hiy>`),Message.append(`<div class="item-commands"><span cmd = "@js prompt('请手动复制下面的数据','${e}');" >
                                 我无法复制 </span></div>`)},e=>{alert("wsmud_Raid 配置上传失败！")})},downloadConfig:function(e){Server._sync("downloadConfig",{pass:e},e=>{var t,o=JSON.parse(e);for(t in o)"@@@trigger"==t?null!=unsafeWindow.TriggerConfig&&unsafeWindow.TriggerConfig.set(o[t]):"roles"!=t&&GM_setValue(t,o[t]);alert("wsmud_Raid 配置下载成功！")},e=>{alert("wsmud_Raid 配置下载失败！")})},uploadFlows:function(){var e=FlowStore.getAll(),t=WorkflowConfig._rootList(),t=JSON.stringify({map:t,flows:e});Server._sync("uploadFlows",{id:Role.id,value:t},e=>{GM_setClipboard(e),alert(`角色流程上传成功，该角色流程会在服务器保存 24 小时。
角色流程获取码：${e}，已复制到系统剪切板。`),Message.append(`<hiy>角色流程获取码：${e}</hiy>`),Message.append(`<div class="item-commands"><span cmd = "@js prompt('请手动复制下面的数据','${e}');" >
                                 我无法复制 </span></div>`)},e=>{alert("角色流程上传失败！")})},downloadFlows:function(e){Server._sync("downloadFlows",{pass:e},e=>{e=JSON.parse(e);FlowStore.corver(e.flows),WorkflowConfig._rootList(e.map),alert("拷贝角色流程成功！")},e=>{alert("错误的角色流程获取码！")})},uploadTriggers:function(){var e=unsafeWindow.TriggerCenter.getAllData(),e=JSON.stringify(e);Server._sync("uploadTriggers",{id:Role.id,value:e},e=>{GM_setClipboard(e),alert(`角色触发器上传成功，该角色触发会在服务器保存 24 小时。
角色触发器获取码：${e}，已复制到系统剪切板。`),Message.append(`<hiy>角色触发获取码：${e}</hiy>`),Message.append(`<div class="item-commands"><span cmd = "@js prompt('请手动复制下面的数据','${e}');" >
                                    我无法复制 </span></div>`)},e=>{alert("角色触发器上传失败！")})},downloadTriggers:function(e){Server._sync("downloadTriggers",{pass:e},e=>{e=JSON.parse(e);unsafeWindow.TriggerCenter.corver(e),alert("拷贝角色触发器成功！")},e=>{alert("错误的角色触发器获取码！")})},getNotice:function(){let o="NoticeDataKey",n=GM_getValue(o,{version:"0.0.0",type:"0",value:"欢迎使用 wsmud_Raid"});Server._async("notice",{version:n.version,id:Role.id},e=>{let t=n;if(e.version>n.version&&(GM_setValue(o,e),t=e),"0"==t.type)L.msg(`
                    <div>
                    <p><hig>Raid：</hig>${t.value}</p>
                    <p style="text-align:center">(v-${GM_info.script.version})</p>
                    </div>`);else{let e="HideVersionNoticeKey";GM_getValue(e,null)!=t.version&&layer.open({type:1,skin:"layui-layer-rim",area:["380px"],title:"wsmud_Raid 提示",content:t.value,offset:"auto",shift:2,move:!1,closeBtn:0,btn:["确认","不再显示"],yes:function(e){layer.close(e)},btn2:function(){GM_setValue(e,t.version)}})}})},shareFlowTrigger:function(o,n,s,i){Server._getPhone(e=>{var t;""==e?alert("请先绑定手机号！"):(e={username:(t=i).author=o,password:n,name:i.name,phone:e,type:s,value:JSON.stringify(t)},Server._sync("uploadSingle",e,e=>{GM_setClipboard(e),alert(s+`分享成功，该${s}会在服务器保存 30 天
每次下载会延长保存 始于下载时刻的 30 天
分享码：${e}
已复制到系统剪切板。`),Message.append(`<hiy>${s}分享码：${e}</hiy>`),Message.append(`<div class="item-commands"><span cmd = "@js prompt('请手动复制下面的数据','${e}');" >
                                         我无法复制 </span></div>`)},e=>{alert(e)}))},()=>{alert("请先绑定手机号！")})},importFlow:function(e,o){-1==e.indexOf("·流程")?alert("错误的流程分享码！"):(e={token:e},Server._sync("downloadSingle",e,e=>{var e=JSON.parse(e),t=WorkflowConfig.createWorkflow(e.name,e.source,o);1==t?Message.append(`<hiy>导入流程 ${e.name} 成功！</hiy>`):alert(t)},e=>{alert("错误的流程分享码！")}))},importTrigger:function(e){-1==e.indexOf("·触发")?alert("错误的触发器分享码！"):(e={token:e},Server._sync("downloadSingle",e,e=>{var e=JSON.parse(e),t=unsafeWindow.TriggerCenter.create(e.name,e.event,e.conditions,e.source,e.active);1==t?Message.append(`<hiy>导入触发器 ${e.name} 成功！</hiy>`):alert(t)},e=>{alert("错误的触发器分享码！")}))},_address:"wsmud.ii74.com/S",_async(e,t,o,n){this._get(!0,e,t,o,n)},_sync(e,t,o,n){this._get(!1,e,t,o,n)},_get(e,t,o,n,s){$.ajax({type:"post",url:`https://${Server._address}/`+t,data:o,async:e,success:function(t){if(200==t.code)null!=n&&n(t.data);else{let e=null!=t.data?t.data:t.code;null!=s&&s(e)}},dataType:"json"})},_getPhone(t,o){$.ajax({type:"post",url:"/UserAPI/GetPhone",async:!0,xhrFields:{withCredentials:!0},success:function(e){e?(e=e.replace(/\"/g,""),null!=t&&t(e)):o(e)}})}};var CmdGroupManager={getAll:function(){var o=[];return GM_listValues().map(function(e){var t;0==e.indexOf(CmdGroupManager._prefix)&&(e=CmdGroupManager._id(e),t=CmdGroupManager.getName(e),o.push({id:e,name:t}))}),o},getName:function(e){e=GM_getValue(this._key(e));return null==e?null:JSON.parse(e).name},getCmdsText:function(e){e=GM_getValue(this._key(e));return null==e?"":JSON.parse(e).cmdsStr},getCmds:function(e){var e=this.getCmdsText(e).split(/^\s*|\s*\n+\s*/g),t=e[0],t=(null!=t&&0==t.length&&e.splice(0,1),e[e.length-1]);return null!=t&&0==t.length&&e.splice(e.length-1,1),e},createCmdGroup:function(e,t){var o=(new Date).getTime();return this.updateCmdGroup(o,e,t)},updateCmdGroup:function(e,t,o){return null!=t&&/\S+/g.test(t)?null!=o&&/\S+/g.test(o)?(t={name:t,cmdsStr:o},GM_setValue(this._key(e),JSON.stringify(t)),!0):(alert("命令组不想没有任何内容..."),!1):(alert("命令组想要一个名字..."),!1)},removeCmdGroup:function(e){GM_deleteValue(this._key(e))},_prefix:"@cmdgroup",_key:function(e){return this._prefix+e},_id:function(e){return parseInt(e.substring(this._prefix.length))}},WorkflowConfigManager={getAll:function(){var o=[];return GM_listValues().map(function(e){var t;WorkflowConfigManager._isMyKey(e)&&(e=WorkflowConfigManager._id(e),t=WorkflowConfigManager.getName(e),o.push({id:e,name:t}))}),o},getName:function(e){e=GM_getValue(this._key(e));return null==e?null:JSON.parse(e).name},getCmdGroupInfos:function(e){e=GM_getValue(this._key(e));return null==e?null:JSON.parse(e).infos},getWorkflow:function(e){var t,o=[];for(t of this.getCmdGroupInfos(e)){var n=CmdGroupManager.getName(t.id),s=CmdGroupManager.getCmds(t.id),n=new CommandWorkflow(n,s,t.repeat);o.push(n)}return new Workflow(this.getName(e),o,1)},createWorkflowConfig:function(e,t){var o=(new Date).getTime();return this.updateWorkflowConfig(o,e,t)},updateWorkflowConfig:function(e,t,o){return null!=t&&/\S+/g.test(t)?null==o||o.length<=0?(alert("工作流不想没有任何内容..."),!1):(t={name:t,infos:o},GM_setValue(this._key(e),JSON.stringify(t)),!0):(alert("工作流想要一个名字..."),!1)},removeWorkflowConfig:function(e){GM_deleteValue(this._key(e))},_prefix:"workflow@",_isMyKey:function(e){return 0==e.indexOf(this._prefix+Role.id)},_key:function(e){return this._prefix+Role.id+e},_id:function(e){return parseInt(e.substring((this._prefix+Role.id).length))}};let CodeTranslator={run:function(){var e=this._getFinder("原命令组"),e=(e&&WorkflowConfig.removeFinder(e),WorkflowConfig.createFinder("原命令组"),this._getFinder("原工作流程"));e&&WorkflowConfig.removeFinder(e),WorkflowConfig.createFinder("原工作流程");let s=CmdGroupManager.getAll();var e=WorkflowConfigManager.getAll(),t=this._newSingleName(s,e);s=t.group,e=t.flow,s.forEach(e=>{var t=CmdGroupManager.getCmdsText(e.id),t=this._appendHeader("    ",t);WorkflowConfig.createWorkflow(e.name,`($_i) = 0
[while] (_i) < (arg0)
${t}
    ($_i) = (_i) + 1`,"原命令组")}),e.forEach(e=>{var t=WorkflowConfigManager.getCmdGroupInfos(e.id);let n="";t.forEach(e=>{let t=null;for(var o of s)if(o.id==e.id){t=o.name;break}n+=`@call ${t} ${e.repeat}
`}),WorkflowConfig.createWorkflow(e.name,n,"原工作流程")})},_newSingleName:function(e,t){e=this._singleName(e);let n=this._singleName(t);return e.forEach(e=>{var t,o=e.name;for(t of n)if(t.name==o){e.name="芫"+o;break}}),{group:e,flow:n}},_singleName:function(n){for(var e of n)e.name=e.name.replace(/[^_a-zA-Z0-9\u4e00-\u9fa5]/g,"");for(let o=0;o<n.length;o++){var s=n[o].name;let t=1;for(let e=o+1;e<n.length;e++){var i=n[e];i.name==s&&(i.name=s+"_"+t,t+=1)}}return n},_getFinder:function(e){var t=WorkflowConfig._rootList(),e=WorkflowConfig._findFinder(e,t);return null==e?null:t[e]},_appendHeader:function(e,t){let o=`
`+t;return o=(o=(o=o.replace(/(\n)/g,"$1"+e)).replace(/\n\s*\n/g,"\n")).replace(/^\s*\n/,"")}};var WorkflowConfig={rootFinderName:"根文件夹",rootFinderSortWay:function(e){var t="__WorkflowRootFinderSortWay";if(null==e)return GM_getValue(t,"nameAsc");GM_setValue(t,e)},finderList:function(t){let e=[];var o,n;switch(t==this.rootFinderName?e=this._rootList():(n=this._rootList(),null!=(o=this._findFinder(t,n))&&(n=n[o],e=n.flows)),e.forEach(e=>{"flow"==e.type&&(e.finder=t)}),this.rootFinderSortWay()){case"updateDesc":e.reverse();break;case"nameAsc":e.sort(function(e,t){return e.name.localeCompare(t.name)});break;case"nameDesc":e.sort(function(e,t){return t.name.localeCompare(e.name)})}return e},createFinder:function(e,t){var o=this._checkName(null,e,!0);return 1!=o?o:((o=this._rootList()).push({name:e,type:"finder",flows:t||[]}),this._rootList(o),!0)},modifyFinder:function(e,t){var o=this._checkName(e.name,t,!0);return 1!=o?o:e.name==t||(this.removeFinder(e),this.createFinder(t,e.flows))},removeFinder:function(e){var t=this._rootList(),o=this._findFinder(e.name,t);if(null!=o){t.splice(o,1),this._rootList(t);for(var n of e.flows)FlowStore.remove(n.name)}},createWorkflow:function(e,t,o){var n=this._checkName(null,e,!1);if(1!=n)return n;var s,n={name:e,type:"flow"},i=this._rootList();let a=!1;return o==this.rootFinderName?(i.push(n),a=!0):null!=(s=this._findFinder(o,i))&&(i[s].flows.push(n),a=!0),a?(FlowStore.save(e,t),this._rootList(i),!0):`未找到名为"${o}"的文件夹。`},modifyWorkflow:function(e,t,o,n){var s=this._checkName(e.name,t,!1);return 1!=s?s:e.name!=t||e.finder!=n?(this.removeWorkflow(e),this.createWorkflow(t,o,n)):(FlowStore.get(e.name)!=o&&FlowStore.save(e.name,o),!0)},removeWorkflow:function(t){var o=this._rootList();if(t.finder==this.rootFinderName)for(let e=0;e<o.length;e++){var n=o[e];if("flow"==n.type&&n.name==t.name){o.splice(e,1);break}}else{var e=this._findFinder(t.finder,o);if(null!=e){var s=o[e].flows;for(let e=0;e<s.length;e++)if(s[e].name==t.name){s.splice(e,1);break}}}this._rootList(o),FlowStore.remove(t.name)},getFinderNames:function(){let t=[this.rootFinderName];return this._rootList().forEach(e=>{"finder"==e.type&&t.push(e.name)}),t},_rootList:function(e){var t="WorkflowConfig_"+Role.id;return null!=e&&GM_setValue(t,e),GM_getValue(t,[])},_checkName:function(e,t,o){if(t!=e){var n=o?"文件夹":"工作流程";if(!/\S+/.test(t))return n+"的名称不能为空。";if(-1!=t.indexOf(this.rootFinderName))return n+`的名称中不能包含"${this.rootFinderName}"。`;if(!/^[_a-zA-Z0-9\u4e00-\u9fa5]+$/.test(t))return n+"的名称只能使用中文、英文和数字字符。";var s,i=o?"finder":"flow";for(s of this._rootList()){if(s.type==i&&s.name==t)return`已经存在此名称的${n}。`;if("finder"==s.type&&!o)for(var a of s.flows)if(a.name==t)return`已经存在此名称的${n}。`}}return!0},_findFinder:function(t,o){for(let e=0;e<o.length;e++){var n=o[e];if("finder"==n.type&&n.name==t)return e}return null}},ManagedPerformerCenter={start:function(e,t,o,n){e=new Performer(e,t);e.log(null==o||o);let s="key"+this._counter;this._counter+=1,(this._performers[s]=e).start(e=>{delete ManagedPerformerCenter._performers[s],0==ManagedPerformerCenter.getAll().length&&$("#workflows-button").css("border-color","inherit"),n&&n()}),$("#workflows-button").css("border-color","#00FF00")},getAll:function(){return Object.values(this._performers)},_counter:0,_performers:{}};let UI={showToolbar:function(){UI._toolbarHidden&&(UI._toolbarHidden=!1,$(".WG_log").before(`
            <style>
                .raid-item{
                    display: inline-block;
                    border: solid 1px gray;
                    color: gray;
                    background-color: black;
                    text-align: center;
                    cursor: pointer;
                    border-radius: 0.25em;
                    //min-width: 2.5em;
                    margin-right: 0em;
                    //margin-left: 0.4em;
                    position: relative;
                    padding-left: 0.3em;
                    padding-right: 0.3em;
                    line-height: 28px;
                }
            </style>
            <div id="raidToolbar">
                <div class="raidToolbar" style="width:calc(100% - 40px);margin:5px 0 5px 0">
                    <span class="raid-item hideRaidToolbar" style="width:10px"><</span>
                    <span class="raid-item forum">🐟 <hiy>咸鱼</hiy></span>
                    <span class="raid-item shortcut">🍯 <hiz>捷径</hiz></span>
                    <span class="raid-item trigger">🍟 <hio>触发</hio></span>
                    <span class="raid-item customFlow" id="workflows-button">🥗 <hig>流程</hig></span>
                    <span class="raid-item moreRaid">🍺 <hic>副本</hic></span>
                    <!--<span class="raid-item hideRaidToolbar" style="float:right;"><wht>测试</wht></span>-->
                </div>
            </div>`),$(".customFlow").on("click",UI.workflows),$(".trigger").on("click",UI.trigger),$(".forum").on("click",UI.forum),$(".shortcut").on("click",UI.shortcut),$(".moreRaid").on("click",UI.dungeons),$(".hideRaidToolbar").on("click",UI.hideToolbar))},hideToolbar:function(){var e=document.getElementById("raidToolbar");null!=e&&(e.parentNode.removeChild(e),L.msg("单击右键，选择流程菜单可恢复显示。")),UI._toolbarHidden=!0},trigger:function(){null==unsafeWindow.TriggerUI?(UI._appendHtml("🍟 <hio>触发器</hio>",`
                <span class = "zdy-item install-trigger" style="width:120px"> 前往安装 </span>
                `),$(".install-trigger").on("click",function(){window.open("https://greasyfork.org/zh-CN/scripts/378984","_blank").location})):unsafeWindow.TriggerUI.triggerHome()},forum:function(){UI._appendHtml("🐟 <hiy>一键咸鱼</hiy>",`
            <span class = "zdy-item xianyu-xyjq" style="width:120px"> 🤌 襄阳捐钱 </span>
            <span class = "zdy-item xianyu-ksyb" style="width:120px"> 🦆 快速运镖 </span>
            <span class="zdy-item xianyu-sdyt" style="width:120px"> 🐉 扫荡妖塔</span>
            <span class="zdy-item xianyu-mghyj" style="width:120px"> 🍟 门贡换元晶</span>
            <br><br>
            <span class="zdy-item xianyu-xybm" style="width:120px"> 🐘 襄阳报名</span>
            <span class="zdy-item xianyu-ltbm" style="width:120px"> 🏆 擂台报名</span>
            <span class="zdy-item xianyu-cbt" style="width:120px"> 💎 藏宝图</span>
            <span class = "zdy-item xianyu-setting" style="width:120px"> 🔧 参数设置 </span>
            <br><br>
            <hr style="background-color: gray; height: 1px; width: calc(100% - 4em); border: none;"><br>
            <span class = "zdy-item about-script" style="width:120px"> 🦶 <wht>脚本教程</wht> </span>
            <!--<span class = "zdy-item about-flow" style="width:120px"> <wht>流程讨论</wht> </span>-->
            <!--<span class = "zdy-item about-trigger" style="width:120px"> <wht>触发器讨论</wht> </span>-->
            <span class = "zdy-item about-bug" style="width:120px"> 🐞 <wht>Bug 提交</wht> </span>
            <!--<br><br>-->
            <!--<hr style="background-color: gray; height: 1px; width: calc(100% - 4em); border: none;"><br>-->
            <span class = "zdy-item about-yaofang" style="width:120px"> 💊 药方清单 </span>
            <span class = "zdy-item suqingHome" style="width:120px"> 🍿 <hig>苏</hig><hio>轻</hio><hiy>工</hiy><wht>具</wht><hic>包</hic> </span>`),$(".xianyu-xyjq").on("click",function(){DungeonsShortcuts.xianyu_xyjq()}),$(".xianyu-ksyb").on("click",function(){DungeonsShortcuts.xianyu_ksyb()}),$(".xianyu-sdyt").on("click",function(){DungeonsShortcuts.xianyu_sdyt()}),$(".xianyu-mghyj").on("click",function(){DungeonsShortcuts.xianyu_mghyj()}),$(".xianyu-cbt").on("click",function(){DungeonsShortcuts.cangbaotu()}),$(".xianyu-xybm").on("click",function(){DungeonsShortcuts.xianyu_xybm()}),$(".xianyu-ltbm").on("click",function(){DungeonsShortcuts.xianyu_ltbm()}),$(".xianyu-setting").on("click",function(){DungeonsShortcuts.xianyu_setting()}),$(".about-script").on("click",function(){window.open("https://www.yuque.com/wsmud/doc","_blank").location}),$(".about-bug").on("click",function(){window.open("https://www.yuque.com/wsmud/doc/gr9gyy","_blank").location}),$(".about-yaofang").on("click",function(){window.open("https://emeisuqing.github.io/wsmud.old/","_blank").location}),$(".suqingHome").on("click",function(){window.open("https://emeisuqing.github.io/wsmud/","_blank").location})},shortcut:function(){var e=`
            <span class = "zdy-item outMaze" style="width:120px"> 走出桃花林 </span>
            <span class = "zdy-item zhoubotong" style="width:120px"> 找到周伯通 </span>
            <span class = "zdy-item cihang" style="width:120px"> 慈航七重门 </span>
            <span class = "zdy-item zhanshendian" style="width:120px"> 战神殿解谜 </span>
            <span class = "zdy-item guzongmen" style="width:120px"> 古宗门寻路 </span>
            <span class = "zdy-item cangbaotu" style="width:120px"> 藏宝图寻宝 </span>
            <span class = "zdy-item uploadConfig" style="width:120px"> 上传本地配置 </span>
            <span class = "zdy-item downloadConfig" style="width:120px"> 下载云端配置 </span>
            <span class = "zdy-item uploadFlows" style="width:120px"> 分享角色流程 </span>
            <span class = "zdy-item downloadFlows" style="width:120px"> 拷贝角色流程 </span>
            <span class = "zdy-item uploadTriggers" style="width:120px"> 分享角色触发 </span>
            <span class = "zdy-item downloadTriggers" style="width:120px"> 拷贝角色触发 </span>
            <span class = "zdy-item importFlow" style="width:120px"> 导入流程 </span>
            <span class = "zdy-item importTrigger" style="width:120px"> 导入触发器 </span>
            <!--<span class = "zdy-item translateCode" style="width:120px"> 流程转换修复 </span>-->
            <span class = "zdy-item raidVersion" style="width:120px"> 🏹 ${GM_info.script.version} </span>`;UI._appendHtml("🍯 <hiz>捷径</hiz>",e),$(".outMaze").on("click",function(){WG.SendCmd("stopstate"),THIsland.outMaze()}),$(".zhoubotong").on("click",function(){WG.SendCmd("stopstate"),THIsland.zhoubotong()}),$(".cihang").on("click",function(){WG.SendCmd("stopstate"),DungeonsShortcuts.cihang()}),$(".zhanshendian").on("click",function(){WG.SendCmd("stopstate"),DungeonsShortcuts.zhanshendian()}),$(".guzongmen").on("click",function(){WG.SendCmd("stopstate"),DungeonsShortcuts.guzongmen()}),$(".cangbaotu").on("click",function(){WG.SendCmd("stopstate"),DungeonsShortcuts.cangbaotu()}),$(".uploadConfig").on("click",e=>{Server.uploadConfig()}),$(".downloadConfig").on("click",e=>{layer.confirm("下载成功将会完全覆盖该浏览器所有角色配置！",{title:"<red>! 警告</red>",btn:["那还是算了","好的继续"],shift:2},function(e){layer.close(e)},function(){layer.prompt({title:"输入配置获取码",formType:0,shift:2},function(e,t){layer.close(t),Server.downloadConfig(e)})})}),$(".uploadFlows").on("click",e=>{Server.uploadFlows()}),$(".downloadFlows").on("click",e=>{layer.confirm("拷贝成功将会完全覆盖原有角色流程！",{title:"<red>! 警告</red>",btn:["那还是算了","好的继续"],shift:2},function(e){layer.close(e)},function(){layer.prompt({title:"输入角色流程获取码",formType:0,shift:2},function(e,t){layer.close(t),Server.downloadFlows(e)})})}),$(".uploadTriggers").on("click",e=>{Server.uploadTriggers()}),$(".downloadTriggers").on("click",e=>{layer.confirm("拷贝成功将会完全覆盖原有角色触发器！",{title:"<red>! 警告</red>",btn:["那还是算了","好的继续"],shift:2},function(e){layer.close(e)},function(){layer.prompt({title:"输入角色触发获取码",formType:0,shift:2},function(e,t){layer.close(t),Server.downloadTriggers(e)})})}),$(".importFlow").on("click",e=>{var t=`
                #input ($token)=分享码,
                #select ($target)=目标文件夹,${WorkflowConfig.getFinderNames().join("|")},${WorkflowConfig.rootFinderName}
                #config
                @js Server.importFlow("(token)", "(target)");
                `,t=new Performer("导入流程",t);t.log(!1),t.start()}),$(".importTrigger").on("click",e=>{var t=new Performer("导入触发器",`
                #input ($token)=分享码,
                #config
                @js Server.importTrigger("(token)");
                `);t.log(!1),t.start()}),$(".translateCode").on("click",e=>{layer.prompt({title:"客栈->流程讨论，阅读使用说明后操作",formType:0,shift:2},function(e,t){"我确认开始转换"==e&&(layer.close(t),CodeTranslator.run())})}),$(".raidVersion").on("click",e=>{Server.getNotice()})},dungeons:function(){UI._appendHtml("🍺 <hic>自动副本</hic>","");var e=UI._dungeonsContentModel();UI._mountableDiv().appendChild(e.$el)},workflows:function(){0==ManagedPerformerCenter.getAll().length?UI.workflowsHome():UI.runningFlows()},workflowsHome:function(){UI._appendHtml("🥗 <hig>工作流程</hig>","",`
            <select style='width:80px' id="workflows-opts">
                <option value="none">选择操作</option>
                <option value="createFinder">新建文件夹</option>
                <option value="createFlow">新建流程</option>
            </select>`,null,"<wht>运行中</wht>",UI.runningFlows),$("#workflows-opts").val("none"),$("#workflows-opts").change(function(){switch($("#workflows-opts").val()){case"createFinder":UI.createFinder();break;case"createFlow":UI.createWorkflow(WorkflowConfig.rootFinderName)}});var e=UI._workflowContentModel(WorkflowConfig.finderList(WorkflowConfig.rootFinderName));UI._mountableDiv().appendChild(e.$el)},runningFlows:function(){UI._appendHtml("🥗 <hig>运行中流程</hig>","",null,null,UI._backTitle,UI.workflowsHome);var e=UI._runningFlowsContentModel();UI._mountableDiv().appendChild(e.$el)},createFinder:function(){UI._appendHtml("🥗 <hig>新建文件夹</hig>",`
            <div style="margin: 0 2em 5px 2em;text-align:center;width:calc(100% - 4em)">
                <label for="create-finder-name"> 名称:</label><input id ="create-finder-name" style='width:120px' type="text"  name="create-finder-name" value="">
            </div>`,"<wht>保存</wht>",function(){var e=$("#create-finder-name").val(),e=WorkflowConfig.createFinder(e);1==e?UI.workflowsHome():alert(e)},UI._backTitle,UI.workflowsHome)},modifyFinder:function(t){UI._appendHtml("🥗 <hig>修改文件夹</hig>",`
            <div style="margin: 0 2em 5px 2em;text-align:center;width:calc(100% - 4em)">
                <label for="modify-finder-name"> 名称:</label><input id ="modify-finder-name" style='width:120px' type="text"  name="modify-finder-name" value="">
            </div>`,"删除",function(){confirm("删除文件夹将删除其中的所有流程，确认删除吗？")&&(WorkflowConfig.removeFinder(t),UI.workflowsHome())},UI._backSaveTitle,function(){var e=$("#modify-finder-name").val(),e=WorkflowConfig.modifyFinder(t,e);1!=e?alert(e):UI.workflowsHome()}),$("#modify-finder-name").val(t.name)},openFinder:function(e){var t;e==WorkflowConfig.rootFinderName?UI.workflowsHome():(t=WorkflowConfig.finderList(e),UI._appendHtml(`<wht>📂 ${e}</wht>`,"",null,null,UI._backTitle,UI.workflowsHome),e=UI._workflowContentModel(t),UI._mountableDiv().appendChild(e.$el))},createWorkflow:function(o){UI._appendHtml("🥗 <hig>新建流程</hig>",`
            <div style="margin: 0 2em 5px 2em;text-align:left;width:calc(100% - 4em)">
                <label for="create-flow-name"> 名称:</label><input id ="create-flow-name" style='width:120px' type="text"  name="create-flow-name" value="">
            </div>
            <textarea class = "settingbox hide" style = "height:5rem;display:inline-block;font-size:0.8em;width:calc(100% - 4em)" id = "create-flow-source"></textarea>`,"<wht>保存</wht>",function(){var e=$("#create-flow-name").val(),t=$("#create-flow-source").val(),e=WorkflowConfig.createWorkflow(e,t,o);1==e?UI.workflowsHome():alert(e)},UI._backTitle,UI.workflowsHome)},modifyWorkflow:function(n){let t="";WorkflowConfig.getFinderNames().forEach(e=>{t+=`<option value="${e}">${e}</option>`});var e=`
            <div style="margin: 0 2em 5px 2em;text-align:left;width:calc(100% - 4em)">
                <label for="modify-flow-name"> 名称:</label><input id ="modify-flow-name" style='width:120px' type="text"  name="modify-flow-name" value="">
                <label for="modify-flow-finder">移动至</label><select id="modify-flow-finder">
                    ${t}
                </select>
            </div>
            <textarea class = "settingbox hide" style = "height:5rem;display:inline-block;font-size:0.8em;width:calc(100% - 4em)" id = "modify-flow-source"></textarea>
            <span class="raid-item shareFlow">分享此流程</span>`;UI._appendHtml("🥗 <hig>修改流程</hig>",e,"删除",function(){confirm("确认删除此工作流程吗？")&&(WorkflowConfig.removeWorkflow(n),UI.workflowsHome())},UI._backSaveTitle,function(){var e=$("#modify-flow-name").val(),t=$("#modify-flow-source").val(),o=$("#modify-flow-finder").val(),e=WorkflowConfig.modifyWorkflow(n,e,t,o);1!=e?alert(e):UI.openFinder(o)}),$("#modify-flow-name").val(n.name),$("#modify-flow-source").val(FlowStore.get(n.name)),$("#modify-flow-finder").val(n.finder),$(".shareFlow").on("click",function(){var e={name:$("#modify-flow-name").val(),source:$("#modify-flow-source").val()};UI._share("流程",e)})},_toolbarHidden:!0,_backTitle:"<wht>< 返回</wht>",_backSaveTitle:"<wht>< 保存&返回</wht>",_appendHtml(e,t,o,n,s,i){s=`
            <div class = "item-commands" style="text-align:center">
                <div style="margin-top:0.5em">
                    <div style="width:8em;float:left;text-align:left;padding:0px 0px 0px 2em;height:1.23em" id="wsmud_raid_left">${null==s?"":s}</div>
                    <div style="width:calc(100% - 16em);float:left;height:1.23em">${e}</div>
                    <div style="width:8em;float:left;text-align:right;padding:0px 2em 0px 0px;height:1.23em" id="wsmud_raid_right">${null==o?"":o}</div>
                </div>
                <br><br>
                ${t}
            </div>`;Message.clean(),Message.append(s),$("#wsmud_raid_left").on("click",function(){i&&i()}),$("#wsmud_raid_right").on("click",function(){n&&n()})},_mountableDiv:function(){return document.getElementsByClassName("WG_log")[0].getElementsByTagName("pre")[0].getElementsByTagName("div")[0]},_workflowContentModel:function(a){return new Vue({el:"#WorkflowsContentModel",methods:{createSpan:function(e,t){let o={width:"120px","background-color":"#12e4a0",border:"solid 1px rgb(107, 255, 70)",color:"#000dd4"};var n={attrs:{class:"zdy-item"},style:o="finder"==t.type?{width:"120px","background-color":"#0359c3",border:"solid 1px rgb(107, 203, 255)",color:"white"}:o},s=e("div",{style:{width:"30px",float:"left","background-color":"#ffffff4f","border-radius":"4px"},on:{click:function(){"finder"==t.type?UI.modifyFinder(t):UI.modifyWorkflow(t)}}},"⚙"),i=e("div",{attrs:{class:"breakText"},style:{width:"85px",float:"right"},on:{click:function(){"finder"==t.type?UI.openFinder(t.name):ManagedPerformerCenter.start(t.name,FlowStore.get(t.name))}}},"finder"==t.type?t.name:"▶️"+t.name);return e("span",n,[s,i])}},render:function(t){var o=this;let n=[],s=[];a.forEach(e=>{"finder"==e.type&&s.push(o.createSpan(t,e)),"flow"==e.type&&n.push(o.createSpan(t,e))});var e=[],i=(0<n.length&&e.push(n),0<s.length&&(e.push(t("hr",{style:{"background-color":"gray",height:"1px",width:"calc(100% - 4em)",border:"none"}})),e.push(s)),t("style",".breakText {word-break:keep-all;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}"));return e.push(i),t("div",{attrs:{class:"item-commands"}},e)}})},_dungeonsContentModel:function(){return new Vue({el:"#DungeonsContentModel",methods:{getItems:function(){return Dungeons},createSpan:function(e,t){return e("span",{attrs:{class:"zdy-item"},style:{width:"120px"},on:{click:function(){ManagedPerformerCenter.start("自动副本-"+t.name,GetDungeonSource(t.name))}}},null!=t.desc?t.desc:t.name)}},render:function(t){var e=this.getItems(),o=this,e=e.map(function(e){return o.createSpan(t,e)});return t("div",{attrs:{class:"item-commands"}},e)}})},_runningFlowsContentModel:function(){return new Vue({el:"#WorkflowsContentModel",methods:{createSpan:function(e,t){var o={attrs:{class:"zdy-item"},style:{width:"120px","background-color":"#05b77d",border:"solid 1px rgb(107, 255, 70)",color:"white"}},n=e("div",{style:{width:"30px",float:"left","background-color":"#ffffff4f","border-radius":"4px"},on:{click:function(){t.pausing()?t.resume():t.pause(),UI.runningFlows(),t.pausing()?Message.append(`<hiy>暂停执行，流程: ${t.name()}...</hiy>`):Message.append(`<hiy>恢复执行，流程: ${t.name()}。</hiy>`)}}},t.pausing()?"▶️":"⏸"),s=e("div",{attrs:{class:"breakText"},style:{width:"85px",float:"right"},on:{click:function(){t.stop()}}},"⏹"+t.name());return e("span",o,[n,s])}},render:function(t){var e=ManagedPerformerCenter.getAll(),o=this,e=e.map(function(e){return o.createSpan(t,e)}),n=t("style",".breakText {word-break:keep-all;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}");return e.push(n),t("div",{attrs:{class:"item-commands"}},e)}})},_shareData:null,_share:function(e,t){UI._shareData=t;t=`
            [if] (__FormUserName) == null
                (__FormUserName) = (:name)
            #input ($__FormUserName)=当前角色名,(:name)
            #config
            ($__FormUserName)=(:name)
            ($password)=233
            @js Server.shareFlowTrigger("(__FormUserName)", "(password)", "${e}", UI._shareData);
            `,e=new Performer("分享"+e,t);e.log(!1),e.start()}};class AncientCmdExecuter{constructor(e,t,o,n,s,i){this.cmds=e,this.willStartExecute=t,this.didFinishExecute=o,this.willPerformCmd=n,this.didPerformCmd=s,this.interval=i||1e3}execute(){this.isWorking||(this.isWorking=!0,this.willStartExecute&&this.willStartExecute(),this._performCmd(0))}_performCmd(e){if(e>=this.cmds.length)this._finishExecute();else if(Role.isFree()){var t=this.cmds[e];if(this.willPerformCmd){var o=null,o=(0<e&&(o=this.cmds[e-1]),this.willPerformCmd(o,t));if(!o)return void this._delayPerformCmd(e);t=o}-1==t.indexOf("@")&&-1==t.indexOf("kill?")&&WG.SendCmd(t),this.didPerformCmd&&this.didPerformCmd(t),-1!=t.indexOf("[exit]")?this._finishExecute():this._delayPerformCmd(e+1)}else this._delayPerformCmd(e)}_delayPerformCmd(e){var t=this;window.setTimeout(function(){t._performCmd(e)},t.interval)}_finishExecute(){this.isWorking=!1,WG.remove_hook(AncientCmdExecuter._hookIndex),this.didFinishExecute&&this.didFinishExecute()}}let THIsland={outMaze:function(e){Role.atPath("taohua/haitan")?new AncientCmdExecuter(["go south","@look 1","@look 5"],function(){THIsland._monitorMaze()},function(){THIsland._cancelMonitorMaze(),e&&e()},function(e,t){return"@look 1"==t?THIsland._goCenterCmd||null:"@look 5"==t?THIsland._decodedMaze?THIsland._outMazeCmd():null:t},void 0,1e3).execute():Message.append("只有在 桃花岛的海滩 才能使用此虫洞。")},zhoubotong:function(e){Role.atPath("taohua/wofang")?new AncientCmdExecuter(["go south;go west;go west;go west;go north;go north;go north","go west;go east;go west;go east;go west","go south","@look 1","@look 5","@go 2","@go 3","@go 4","@go 6","@go 7","@go 8","@end"],function(){THIsland._monitorMaze(),THIsland._exitsHookIndex=WG.add_hook("exits",function(e){if(null!=THIsland._lastCoord&&THIsland._lastCoord!=[0,0]&&4==Object.keys(e.items).length){for(var t in e.items)if("桃花林"!=e.items[t])return;var o,n=THIsland._lastCoord[0]+1,s=THIsland._lastCoord[1]+1,i=[[["north","northeast","east"],["east","north","south"],["east","south","southeast"]],[["east","north","west"],[],["west","east","south"]],[["west","northwest","north"],["west","south","north"],["west","southwest","south"]]][n][s];for(o in e.items)if(-1==i.indexOf(o))return void(THIsland._goCave="go "+o)}})},function(){THIsland._lastCoord=void 0,THIsland._lastGo=void 0,THIsland._goCave=void 0,THIsland._cancelMonitorMaze(),WG.remove_hook(THIsland._exitsHookIndex),e&&e()},function(e,t){if(THIsland._goCave)return THIsland._goCave+";go west;[exit]";var o,n=0;switch(t){case"@look 1":return THIsland._goCenterCmd||null;case"@look 5":if(THIsland._decodedMaze)break;return null;case"@go 2":return THIsland._lastCoord=THIsland._mazeCoords[2],THIsland._lastGo=THIsland._mazePath(THIsland._lastCoord),THIsland._lastGo;case"@go 3":n=3;break;case"@go 4":n=4;break;case"@go 6":n=6;break;case"@go 7":n=7;break;case"@go 8":n=8}return 0!=n?(o=THIsland._mazeBackPath(THIsland._lastGo),THIsland._lastCoord=THIsland._mazeCoords[n],THIsland._lastGo=THIsland._mazePath(THIsland._lastCoord),o+";"+THIsland._lastGo):t},void 0,1e3).execute():Message.append("只有在 蓉儿的卧室 才能使用此虫洞。")},_outMazeCmd:function(){for(var e="",t=2;t<=9;t++){var o=THIsland._mazeCoords[t],o=THIsland._mazePath(o);e+=9==t?o+";"+o:o+";"+THIsland._mazeBackPath(o)+";"}return e+=";go south"},_mazePath:function(e){return[["go southwest","go west","go northwest"],["go south","","go north"],["go southeast","go east","go northeast"]][e[0]+1][e[1]+1]},_mazeBackPath:function(e){return{"":"","go southwest":"go northeast","go west":"go east","go northwest":"go southeast","go south":"go north","go north":"go south","go southeast":"go northwest","go east":"go west","go northeast":"go southwest"}[e]},_monitorMaze:function(){THIsland._mazeCoords=[[2,2],[2,2],[2,2],[2,2],[2,2],[0,0],[2,2],[2,2],[2,2],[2,2]],THIsland._atFirst=!1,THIsland._goCenterCmd=void 0,THIsland._decodedMaze=!1;var e=WG.add_hook(["room","exits"],function(e){null==THIsland._goCenterCmd&&("room"==e.type?null!=e.desc&&new RegExp("四周栽了大概有一棵桃树").exec(e.desc)&&(THIsland._atFirst=!0):"exits"==e.type&&null!=e.items&&THIsland._atFirst&&(e.items.north&&e.items.south?e.items.west?(THIsland._mazeCoords[1]=[1,0],THIsland._goCenterCmd="go west"):(THIsland._mazeCoords[1]=[-1,0],THIsland._goCenterCmd="go east"):e.items.west&&e.items.east&&(e.items.north?(THIsland._mazeCoords[1]=[0,-1],THIsland._goCenterCmd="go north"):(THIsland._mazeCoords[1]=[0,1],THIsland._goCenterCmd="go south"))))}),t=WG.add_hook("room",function(e){if(!THIsland._decodedMaze&&null!=e.desc){e=new RegExp("能看到东南方向大概有.(?=棵桃树)").exec(e.desc);if(e){e=e.toString();switch(e.substring(e.length-1)){case"二":THIsland._mazeCoords[2]=[1,-1];break;case"四":THIsland._mazeCoords[4]=[1,-1];break;case"六":THIsland._mazeCoords[6]=[1,-1];break;case"八":THIsland._mazeCoords[8]=[1,-1]}for(THIsland._mazeCoords[9]=[-THIsland._mazeCoords[1][0],-THIsland._mazeCoords[1][1]];;)if(2!=THIsland._mazeCoords[2][0]&&(THIsland._mazeCoords[8]=[-THIsland._mazeCoords[2][0],-THIsland._mazeCoords[2][1]]),2!=THIsland._mazeCoords[8][0]&&(THIsland._mazeCoords[8][0]==THIsland._mazeCoords[1][0]?THIsland._mazeCoords[6]=[THIsland._mazeCoords[8][0],-THIsland._mazeCoords[8][1]]:THIsland._mazeCoords[6]=[-THIsland._mazeCoords[8][0],THIsland._mazeCoords[8][1]]),2!=THIsland._mazeCoords[6][0]&&(THIsland._mazeCoords[4]=[-THIsland._mazeCoords[6][0],-THIsland._mazeCoords[6][1]]),2!=THIsland._mazeCoords[4][0]&&(THIsland._mazeCoords[4][0]==THIsland._mazeCoords[9][0]?THIsland._mazeCoords[2]=[THIsland._mazeCoords[4][0],-THIsland._mazeCoords[4][1]]:THIsland._mazeCoords[2]=[-THIsland._mazeCoords[4][0],THIsland._mazeCoords[4][1]]),2!=THIsland._mazeCoords[2][0]&&2!=THIsland._mazeCoords[4][0]&&2!=THIsland._mazeCoords[6][0]&&2!=THIsland._mazeCoords[8][0])break;THIsland._mazeCoords[8][0]==THIsland._mazeCoords[4][0]?THIsland._mazeCoords[3]=[THIsland._mazeCoords[8][0],0]:THIsland._mazeCoords[3]=[0,THIsland._mazeCoords[8][1]],THIsland._mazeCoords[7]=[-THIsland._mazeCoords[3][0],-THIsland._mazeCoords[3][1]],THIsland._decodedMaze=!0}}});THIsland._mazeHookIndexes=[e,t]},_cancelMonitorMaze:function(){for(var e=THIsland._mazeHookIndexes.length-1;0<=e;e--){var t=THIsland._mazeHookIndexes[e];WG.remove_hook(t)}}},DungeonsShortcuts=(!function(){var e=new AtCmdExecutor("taohualin",function(e,t){return new Promise(e=>{THIsland.outMaze(e)})});CmdExecuteCenter.addExecutor(e)}(),!function(){var e=new AtCmdExecutor("zhoubotong",function(e,t){return new Promise(e=>{THIsland.zhoubotong(e)})});CmdExecuteCenter.addExecutor(e)}(),{xianyu_xyjq:function(){var e=new Performer("襄阳捐钱",`
[if] (:room 副本区域,忧愁谷)==true || (:state)==推演 || (:state)==领悟
  @print <ord>当前状态无法进行一键咸鱼，自动停止！</ord>
  [exit]
@print 🐟 一键咸鱼 => <hic>襄阳捐钱</hic>
@cmdDelay 500
stopstate;jh fam 8 start
@await 500
[if] (:room)==襄阳城-广场
  juanxian {r郭靖}?;juanxian2 {r郭靖}?
@print 已完成：襄阳捐钱
$zdwk
            `);e.log(!1),e.start()},xianyu_xybm:function(){var e=new Performer("襄阳报名",`
[if] (:room 副本区域,忧愁谷)==true || (:state)==推演 || (:state)==领悟
  @print <ord>当前状态无法进行一键咸鱼，自动停止！</ord>
  [exit]
@print 🐟 一键咸鱼 => <hic>襄阳报名</hic>
@cmdDelay 500
stopstate;jh fam 8 start
@await 500
[if] (:room)==襄阳城-广场
  baoming {r郭靖}?
  @tip 你可以去($xyBM)附近查看敌情|这位($xyBM)已经报名了。|才可以再次($xyOver)襄阳守城|最近没($xyNone)战事
  [if] (xyBM) != null
    @print 襄阳已报名，请选择守门位置：
    @js Message.append('<div class="item-commands"><span cmd="$wait 350;jh fam 8 start;go north;go north;go north;go north;go north;">⬆️ 守北门</span><span cmd="$wait 350;jh fam 8 start;go south;go south;go south;go south;go south;">⬇️ 守南门</span><span cmd="$wait 350;jh fam 8 start;go east;go east;go east;go east;go east;">➡️ 守东门</span><span cmd="$wait 350;jh fam 8 start;go west;go west;go west;go west;go west;">⬅️ 守西门</span></div>')
  [else if] (xyNone) != null
    @print 襄阳尚未开启。
    $zdwk
  [else if] (xyOver) != null
    @print 襄阳已经完成。
    $zdwk
  [else]
    $zdwk
            `);e.log(!1),e.start()},xianyu_ksyb:function(){var e=new Performer("快速运镖",`
[if] (:room 副本区域,忧愁谷)==true || (:state)==推演 || (:state)==领悟
  @print <ord>当前状态无法进行一键咸鱼，自动停止！</ord>
  [exit]
@print 🐟 一键咸鱼 => <hic>快速运镖</hic>
@cmdDelay 500
stopstate
$to 扬州城-镖局正厅
ksyb {r林震南}
@tip 最近暂时($done)委托，你先休息下吧|你需要支付($charges)黄金的雇佣费用|只有总镖头才($can)雇佣镖师|如果你不能把镖银($escort)送到|你不是($escort)运镖吗
[if] (charges)!=null
  <-recordGains
  task yunbiao {r林震南} qkstart
  @await 11000
  @tidyBag
  recordGains->nopopup
[else if] (can)!=null
  tm 运镖环数不到200环，无法快速运镖。
[else if] (escort)!=null
  tm 当前有未完成的运镖任务，无法快速运镖。
$zdwk 
            `);e.log(!1),e.start()},xianyu_sdyt:function(){var e=new Performer("扫荡妖塔",`
[if] (:room 副本区域,忧愁谷)==true || (:state)==推演 || (:state)==领悟
  @print <ord>当前状态无法进行一键咸鱼，自动停止！</ord>
  [exit]
@print 🐟 一键咸鱼 => <hic>扫荡妖塔</hic>
@print <hic>如果想自己静默式调用扫荡妖塔功能，请先设定变量扫荡次数 <hiy>SDYTnum</hiy> 和 单次消耗精力上限 <hiy>SDYTjlsx</hiy> 的值。</hic>
[if] (SDYTjlsx) == 0 || (SDYTjlsx) == null || (SDYTjlsx) == undefined
  @js ($SDYTjlsx) = prompt("请输入单次消耗精力上限，超过后将自动停止：", "85");
[if] (SDYTnum) == 0 || (SDYTnum) == null || (SDYTnum) == undefined
  @js ($SDYTnum) = prompt("请输入本轮扫荡次数，注意：单次消耗精力达到上限后将自动停止。","5")
($sdyt_num) = (SDYTnum)
//($SDYTnum) = null
[if] (sdyt_num) == 0 || (sdyt_num) == null || (sdyt_num) == undefined
  @print <ord>扫荡次数为0，取消扫荡。</ord>
  [exit]
@print <hiy>计划扫荡(sdyt_num)次妖塔。</hiy>
stopstate
[if] (:room) != 古大陆-墓园
  $goyt
  @await 1500
[if] (:room) != 古大陆-墓园
  @print <ord>无法前往古大陆，请重试或确定当前角色是否已解锁古大陆。</ord>
  $zdwk
  [exit]
[if] {b扫荡符#}? < (sdyt_num) || {b扫荡符}? == null
  shop 0 (sdyt_num)
($num) = 0
@cmdDelay 500
($ytWeek) = null
[while] (num) < (sdyt_num)
  ss muyuan
  @tip 你即将消耗一个扫荡符，($jl_yt)精力快速完成一次弑妖塔|你即将消耗($jl_yt)精力快速完成一次弑妖塔|你尚未($ytJS)弑妖塔|你已达到($ytWeek)上限
  [if] (ytJS) != null
    @print <hiy>妖塔未解锁，无法扫荡。</hiy>
    [break]
  [if] (ytWeek) != null
    @print <hiy>妖塔扫荡已达到本周上限。</hiy>
    [break]
  [if] (jl_yt) > (SDYTjlsx) && (jl_yt) != null
    @print <ord>单次扫荡精力超过(SDYTjlsx)，自动停止。</ord>
    [break]
  [else]
    saodang muyuan
    @tip 你消耗一个扫荡符|精力快速完成弑妖塔|你的($lack)不够|你已达到($ytWeek)上限
    [if] (ytWeek) != null
      @print <hiy>妖塔扫荡已达到本周上限。</hiy>
      [break]
    [if] (lack) != null
      @print <ord>(lack)不足，自动停止扫荡妖塔。</ord>
      [break]
  ($num) = (num) + 1
@await 1000
$zdwk
            `);e.log(!1),e.start()},xianyu_mghyj:function(){var e=new Performer("门贡换元晶",`
[if] (:room 副本区域,忧愁谷)==true || (:state)==推演 || (:state)==领悟
  @print <ord>当前状态无法进行一键咸鱼，自动停止！</ord>
  [exit]
@print 🐟 一键咸鱼 => <hic>门贡换元晶</hic>
@cmdDelay 500
stopstate
($hqName) = 门派后勤管理员
[if] (:family) == 武当派
  ($hqMap) = 武当派-石阶
[else if] (:family) == 少林派
  ($hqMap) = 少林派-山门殿
[else if] (:family) == 华山派
  ($hqMap) = 华山派-练武场
[else if] (:family) == 峨眉派
  ($hqMap) = 峨眉派-走廊
[else if] (:family) == 逍遥派
  ($hqMap) = 逍遥派-林间小道
[else if] (:family) == 丐帮
  ($hqMap) = 丐帮-暗道
[else if] (:family) == 杀手楼
  ($hqMap) = 杀手楼-休息室
[else]
  ($hqMap) = 扬州城-扬州武馆
  ($hqName) = 武馆后勤
[while] (:room) != (hqMap)
  $to (hqMap)
  [if] (:family) == 丐帮
    @await 300
    go east
  @await 500
[if] {r(hqName)}? == null
  @print 后勤失踪，请稍后再试。
[else]
  ask1 {r(hqName)}?
  @dialog
  buy 1 {d元晶o}? from {r(hqName)}?
  @tip 你从门派后勤管理员购买了|这里没有($mgYJ)多的|你没有那么多的($mgGJ)功绩
  [if] (mgGJ) != null
    @print 门贡不足，无法购买。
  [else if] (mgYJ) != null
    @print 元晶已售空，无法购买。
  [else]
    @print 已购买一个<hio>元晶</hio>。
$zdwk
            `);e.log(!1),e.start()},xianyu_ltbm:function(){var e=new Performer("擂台报名",`
[if] (:room 副本区域,忧愁谷)==true || (:state)==推演 || (:state)==领悟
  @print <ord>当前状态无法进行一键咸鱼，自动停止！</ord>
  [exit]
@print 🐟 一键咸鱼 => <hic>擂台报名</hic>
@cmdDelay 500
stopstate;$to 扬州城-擂台
@await 500
select {r擂台比武报名}?
askbiwu {r擂台比武报名}?
@tip 你使用当前装备和技能($ltBM)参加比武|你已经报名参加比武，($ltGX)更新你的技能和装备|你已报名或更新状态，请勿连续报名。
[if] (ltGX) != null
  biwu record ok
$zdwk
            `);e.log(!1),e.start()},xianyu_setting:function(){var e=new Performer("参数设置",`
[(SDYTjlsx)==null]($SDYTjlsx)=85
[(SDYTnum)==null]($SDYTnum)=5
@print 🐟 一键咸鱼 => <hic>参数设置</hic>
#input ($SDYTjlsx)=<hiz>一键设置各种常用流程（陆续更新添加）参数</hiz><br/>&nbsp*&nbsp<ord>🐉 扫荡妖塔</ord> 参数<br/>&nbsp*&nbsp妖塔单次消耗精力上限,(SDYTjlsx)
#input ($SDYTnum)=每轮妖塔扫荡次数,(SDYTnum)
#config
@print 已完成参数设置
            `);e.log(!1),e.start()},cangbaotu:function(){var e=new Performer("藏宝图寻宝",`
[if] (:room 副本区域,忧愁谷)==true || (:state)==推演 || (:state)==领悟
    @print <ord>当前状态无法进行一键咸鱼，自动停止！</ord>
    [exit]
@print 🐟 一键咸鱼 => <hic>藏宝图</hic>
[if] {b藏宝图}? == null
    tm 背包中无藏宝图，取消本次寻宝。
    [exit]
@cmdDelay 500
stopstate
@toolbar jh
@toolbar pack
($money1) = (:money)
($ebony1) = {b玄晶#}?
($number)=1
($cbt_n) = 0
@stopSSAuto
<-recordGains
[while] {b藏宝图}? != null
    <---
    ($pos)=null
    use {b藏宝图}?
    @tip 发现上面的图案所绘的方位似乎($pos)。|你找到了
    [if] (pos) == 就在你这里
        use {b藏宝图}?
        ($cbt_n) = (cbt_n) + 1
        [continue]
    [else if] (pos) == null
        [continue]
    --->
    jh fam (number) start
    [if] (pos) != 离你所在的位置挺远的
        // 武当
        [if] (number)=1
            [if] (pos) == 在你的北方
                go north
                go south;go west;go northup;go north;go east
            [else if] (pos) == 在你的西方
                go west
                go west
            [else]
                go west;go northup
                go north
                go west
                go northup
                go northup
                go northup
                [while] (pos) == 在你的北方
                    go north
        // 少林
        [else if] (number)=2
            [if] (pos) == 在你的北方
                go north
                go north
                go northup
                go southdown;go northwest;go northeast
                [while] (pos) == 在你的北方
                    go north
            [else if] (pos) == 在你的西北方向
                go north;go west
                go east;go north;go northwest
                go northeast;go north;go west
                go east;go north;go west
                go east;go north;go west
            [else]
                go north;go east
                go west;go north;go northeast
                go northwest;go north;go east
                go west;go north;go east
        // 华山
        [else if] (number)=3
            [if] (pos) == 在你的北方
                go westup;go north;go east
                go west;go north;go east
            [else if] (pos) == 在你的西北方向
                go westup;go north
                go north
                go north
            [else if] (pos) == 在你的西方
                go westup
                go west
            [else if] (pos) == 在你东方
                go eastup
            [else if] (pos) == 在你的东南方向
                go eastup;go southup
                jumpdown
                go southup
                go south
                go east
            [else]
                go westup
                go south
                go southup
                go southup
                break bi;go enter
                go westup
                go westup
                jumpup
        // 峨眉
        [else if] (number)=4
            go west;go south;go west
            [if] (pos) == 在你东方
                go east
                go east
                go east
            [else if] (pos) == 在你的西方
                go west
            [else if] (pos) == 在你的南方
                go south
                go south
            [else if] (pos) == 在你的北方
                go north
                go north
            [else if] (pos) == 在你的东北方向
                go east;go north
                go east
                go northup
                go east
            [else]
                go east;go south
                go north;go east;go south
        // 逍遥
        [else if] (number)=5
            [if] (pos) == 在你东方
                go east
            [else if] (pos) == 在你的西方
                go west
            [else if] (pos) == 在你的南方
                go south
                go south
            [else if] (pos) == 在你的北方
                go north
                go north
            [else if] (pos) == 在你的东北方向
                go east;go north
            [else if] (pos) == 在你的东南方向
                go east;go south
                go south
            [else if] (pos) == 在你的西南方向
                go west;go south
            [else]
                go down
                go down
        // 丐帮
        [else]
            [if] (pos) == 在你东方
                go down;go east;go east;go east;go up
                go down;go east;go east;go up
            [else if] (pos) == 在你的南方
                go down
            [else]
                go down;go east
                go east
                go east
                go east
                go east
    [else if] (number)<6
        ($number) = (number) + 1
    [else]
        ($number)=1
//结束后自动挖矿或者闭关
@await 1000
@tidyBag
@wait 2000
$zdwk
recordGains->nopopup
@recoverSSAuto
@toolbar pack
($money2) = (:money)
@js ($income_m) = parseInt(((money2) - (money1))/10000)
($ebony2) = {b玄晶#}?
[if] (ebony1) != null
    ($income_e) = (ebony2) - (ebony1)
[else]
    ($income_e) = (ebony2)
tm 挖宝 (cbt_n) 次，收益 (income_e)个玄晶，(income_m) 两黄金
@print 挖宝 (cbt_n) 次，收益 <hiy>(income_e)</hiy> 个玄晶，<hiy>(income_m)</hiy> 两黄金
            `);e.log(!1),e.start()},cihang:function(){var e=new Performer("慈航七重门",`
[if] (:room 慈航静斋) == false
    @print <hiy>请先进入慈航副本再运行。</hiy>
    [exit]
[else]
    [if] (:room) != 慈航静斋-山门(副本区域) && (:room) != 慈航静斋-帝踏峰(副本区域)
        @print <hiy>请在山门或帝踏峰运行。</hiy>
        [exit]
($go) = 'east','west','south','north'
($qiku) = '老','病','死','爱别离','怨憎会','求不得'
($num1) = 0
[if] (:room) == 慈航静斋-山门(副本区域)
    go south
[else if] (:room) == 慈航静斋-帝踏峰(副本区域)
    go south[2]
@print <hiy>开始自动寻路，寻路期间请勿点击地图……</hiy>
@cmdDelay 500
[while] (num1) < 6
    @js ($ku) = [(qiku)][(num1)]
    ($num2) = 0
    [while] true
        [if] (map) != null && (retry) == true
            (map)
            @await 500
        @js ($fx) = [(go)][(num2)]
        [if] (fx) == null
            @print <hiy>自动寻路失败，请回到山门重新运行！</hiy>
            [exit]
        go (fx)
        [if] (:room) == 慈航静斋-七重门(副本区域)
            @js ($ku_now) = $(".room_desc").text().match("，是名([^%]+)苦。")[1]
            [if] (ku) != (ku_now)
                [while] true
                    go west
                    [if] (:room) == 慈航静斋-七重门(副本区域)
                        @js ($dir_gc) = $("text:contains('广场')").attr("dir")
                    [if] (dir_gc) == south
                        go south
                    @await 200
                    [if] (:room) == 慈航静斋-山门(副本区域)
                        [break]
                    [else if] (:room) == 慈航静斋-广场(副本区域)
                        @print <hiy>已走出七重门！</hiy>
                        [exit]
                go south
                ($num2) = (num2) + 1
                ($retry) = true
            [else]
                [if] (map) == null
                    ($map) = go (fx)
                [else]
                    ($map) = (map);go (fx)
                ($retry) = false
                [break]
        [else if] (:room) == 慈航静斋-广场(副本区域)
            @print <hiy>已走出七重门！</hiy>
            [exit]
    ($num1) = (num1) + 1
go south
[if] (:room) == 慈航静斋-广场(副本区域)
    @print <hiy>已走出七重门！</hiy>
            `);e.log(!1),e.start()},zhanshendian:function(){var e=new Performer("战神殿解谜",`
[if] (:room 战神殿) == false
    @print <hiy>请先进入战神殿副本再运行。</hiy>
    [exit]
[if] (:room) != 战神殿-左雁翼(副本区域)
    @print <hiy>请先手动向左走到左雁翼。</hiy>
@until (:room) == 战神殿-左雁翼(副本区域)
look shi
@tip 和外面星空星宿位置一一对应，($star_0)，($star_1)，($star_2)，($star_3)，($star_4)，($star_5)，($star_6)，($star_7)这些星宿依次闪烁
($stars) = "(star_0)","(star_1)","(star_2)","(star_3)","(star_4)","(star_5)","(star_6)","(star_7)"
($dirs) = {"star":"角亢室","dir":1,"eswn":"东北↗︎","go":"northeast"},{"star":"氏房心","dir":0,"eswn":"东→","go":"east"},{"star":"尾箕轸","dir":2,"eswn":"东南↘︎","go":"southeast"},{"star":"井鬼参","dir":4,"eswn":"西南↙︎","go":"southwest"},{"star":"柳星张翼","dir":3,"eswn":"南↓","go":"south"},{"star":"奎娄斗牛","dir":6,"eswn":"西北↖︎","go":"northwest"},{"star":"胃昴毕觜","dir":5,"eswn":"西←","go":"west"},{"star":"女虚危壁","dir":7,"eswn":"北↑","go":"north"}
@cmdDelay 100
($num_1) = 0
[while] (num_1) < 8
    @js ($star) = [(stars)][(num_1)]
    ($num_2) = 0
    [while] (num_2) < 28
        ($dir) = null
        @js ($dir) = var d=[(dirs)];var s=d[(num_2)]["star"].indexOf("(star)");if(s>=0){d[(num_2)]["dir"]}
        [if] (dir) != null
            [break]
        ($num_2) = (num_2) + 1
    push (dir)
    ($num_1) = (num_1) + 1
look shi
@tip 殿顶的星图依旧，却仅剩一颗($last)宿星孤零零的闪烁着
($num_3) = 0
[while] (num_3) < 28
    ($dir_l) = null
    ($go_l) = null
    @js ($dir_l) = var d=[(dirs)];var s=d[(num_3)]["star"].indexOf("(last)");if(s>=0){d[(num_3)]["eswn"]}
    @js ($go_l) = var d=[(dirs)];var s=d[(num_3)]["star"].indexOf("(last)");if(s>=0){d[(num_3)]["go"]}
    [if] (dir_l) != null && (go_l) != null
        [break]
    ($num_3) = (num_3) + 1
@print <hiy>(last)宿，最后一个方位是【(dir_l)】</hiy>
tm (last)宿，最后一个方位是【(dir_l)】60秒倒计时已开始，请抓紧开打。
@print <ord>打完右雁翼最后一波守卫后会自动进秘道【(go_l)】</ord>
@until (:room) == 战神殿-右雁翼(副本区域) || (:room 副本区域) == false
@until (:combating) == true || (:room 副本区域) == false
@until (:combating) == false || (:room 副本区域) == false
[if] (:room 副本区域) == false
    [exit]
[while] (:room) == 战神殿-右雁翼(副本区域) && (:living) == true
    go (go_l);$wait 100
            `);e.log(!1),e.start()},guzongmen:function(){var e=new Performer("古宗门寻路",`
@print <hiy>如果寻路一直失败，请检查设置中<ord>【切换房间时不清空上房间信息】</ord>是否开启。</hiy>
[if] (:room 副本区域,忧愁谷) == true
    @print <ord>当前处于副本中，无法寻路！</ord>
    [exit]
@cmdDelay 500
stopstate
jh fam 9 start
go enter
go up
@tip 打败我，你就($pass)上去|聚魂成功|踏过长生门|你已堪破生死|古老的大陆寻找真相|你连($pass)都没聚合|你想($pass)为神吗
[if] (pass) != null
    @print <ord>不符合前往古大陆要求，流程终止。</ord>
    [exit]
ggdl {r疯癫的老头}
go north[3]
go north[3]
look shi
tiao1 shi;tiao1 shi;tiao2 shi
@until (:room) == 古大陆-断山
@js ($ylfx) = $(".room_desc").text().match(/[东南西北]，/g)
@js ($ylfx) = var f="(ylfx)";f.replace(/，/g,"")
@js ($ylfx) = var f="(ylfx)";f.replace(/东/g,"west")
@js ($ylfx) = var f="(ylfx)";f.replace(/西/g,"east")
@js ($ylfx) = var f="(ylfx)";f.replace(/南/g,"north")
@js ($ylfx) = var f="(ylfx)";f.replace(/北/g,"south")
@js ($ylfx) = var f="(ylfx)";f.replace(/,/g,"','")
@js ($ylfx) = var f=['(ylfx)'];f.reverse()
@js ($ylfx) = var f="(ylfx)";f.replace(/,/g,"','")
@js ($ylfx) = "'"+"(ylfx)"+"'"
@js ($fl) = [(ylfx)].length
go down
go south[3]
go south[2]
go west
($go) = 'east','west','south','north'
($num) = 0
[while] (num) < 4
    @await 500
    @js $(".content-message pre").html("");
    @await 500
    @js ($fx1) = [(go)][(num)]
    go (fx1)
    @js ($lost) = $(".content-message").text().match("你似乎迷路了")
    [if] (lost) != null
        go south[3]
        go south[3]
        go west
        ($num) = (num) + 1
    [else]
        [break]
[if] (fl) == 5
    ($num) = 0
    [while] (num) < 5
        @js ($fx) = [(ylfx)][(num)]
        go (fx)
        ($num) = (num) + 1
[else if] (fl) == 4
    @js ($fx2) = [(ylfx)][0]
    @js ($fx3) = [(ylfx)][1]
    @js ($fx4) = [(ylfx)][2]
    @js ($fx5) = [(ylfx)][3]
    ($lxjh) = {"lx":"go (fx2);go (fx3);go (fx4);go (fx5);go (fx5)"},{"lx":"go (fx2);go (fx3);go (fx4);go (fx4);go (fx5)"},{"lx":"go (fx2);go (fx3);go (fx3);go (fx4);go (fx5)"},{"lx":"go (fx2);go (fx2);go (fx3);go (fx4);go (fx5)"}
[else if] (fl) == 3
    @js ($fx2) = [(ylfx)][0]
    @js ($fx3) = [(ylfx)][1]
    @js ($fx4) = [(ylfx)][2]
    ($lxjh) = {"lx":"go (fx2);go (fx3);go (fx4);go (fx4);go (fx4)"},{"lx":"go (fx2);go (fx3);go (fx3);go (fx3);go (fx4)"},{"lx":"go (fx2);go (fx2);go (fx2);go (fx3);go (fx4)"},{"lx":"go (fx2);go (fx3);go (fx3);go (fx4);go (fx4)"},{"lx":"go (fx2);go (fx2);go (fx3);go (fx4);go (fx4)"},{"lx":"go (fx2);go (fx2);go (fx3);go (fx3);go (fx4)"}
[else if] (fl) == 2
    @js ($fx2) = [(ylfx)][0]
    @js ($fx3) = [(ylfx)][1]
    ($lxjh) = {"lx":"go (fx2);go (fx3);go (fx3);go (fx3);go (fx3)"},{"lx":"go (fx2);go (fx2);go (fx3);go (fx3);go (fx3)"},{"lx":"go (fx2);go (fx2);go (fx2);go (fx3);go (fx3)"},{"lx":"go (fx2);go (fx2);go (fx2);go (fx2);go (fx3)"}
[else if] (fl) == 1
    @js ($fx2) = [(ylfx)][0]
    ($lxjh) = {"lx":"go (fx2);go (fx2);go (fx2);go (fx2);go (fx2)"}
[if] (fl) < 5
    @js ($fxlen) = [(lxjh)].length
    ($num) = 0
    [while] (num) < (fxlen)
        @js ($map) = var f=[(lxjh)];f[(num)]["lx"]
        (map)
        [if] (:room) != 古大陆-药林
            [while] (:room) != 古大陆-平原
                go south
                @await 350
            go north;go west
            go (fx1)
            ($num) = (num) + 1
        [else]
            [break]
tiao bush
[if] (:room) == 古大陆-山脚
    @print <ord>古宗门自动寻路已完成！</ord>
[else]
    @print <ord>寻路失败，请重新运行或换个时间。</ord>
            `);e.log(!1),e.start()}}),ToRaid={menu:UI.showToolbar,perform:function(e,t,o){ManagedPerformerCenter.start(t||"第三方调用",e,o)},existAutoDungeon:function(e){return null!=AutoDungeonName(e)},shareTrigger:function(e){UI._share("触发",e)}};function __init__(){null==(WG=unsafeWindow.WG)?setTimeout(()=>{__init__()},300):(messageAppend=unsafeWindow.messageAppend,messageClear=unsafeWindow.messageClear,T=unsafeWindow.T,L=unsafeWindow.L,unsafeWindow.ToRaid=ToRaid,(unsafeWindow.Role=Role).init(),Room.init(),SystemTips.init(),MsgTips.init(),DialogList.init(),TaskList.init(),Xiangyang.init())}$(document).ready(function(){__init__(),null==WG&&setTimeout(__init__,300)})}(),!function(){function m(e){return JSON.parse(JSON.stringify(e))}function n(e,t){return 0==e.length&&0==t.length||"*"==e[0]&&1==e.length||0!=e.length&&0!=t.length&&("?"==e[0]?n(e.substring(1),t.substring(1)):"*"==e[0]?n(e.substring(1),t)||n(e.substring(1),t.substring(1))||n(e,t.substring(1)):e[0]==t[0]&&n(e.substring(1),t.substring(1)))}class r{constructor(e,t){this.name=e,this.params=t}}class s{constructor(e,t){this.targetName=e,this.action=t}}let d={observe:function(e,t){var o=this._getOberverIndex(),e=new s(e,t);return this._observers[o]=e,o},removeOberver:function(e){delete this._observers[e]},post:function(e){for(var t in this._observers)this._observers.hasOwnProperty(t)&&(t=this._observers[t]).targetName==e.name&&t.action(e.params)},_observerCounter:0,_observers:{},_getOberverIndex:function(){var e=this._observerCounter;return this._observerCounter+=1,e}};class e{constructor(e){this.run=e}}function i(e,t){return e==t}function t(e,t){return!!/^\s*\*?\s*$/.test(e)||-1!=e.split("|").indexOf(t)}function o(e,t){return console.log(e,t),!!/^\s*\*?\s*$/.test(e)||-1==e.split("|").indexOf(t)}function a(e,t){if(/^\s*\*?\s*$/.test(e))return!0;var o;for(o of e.split("|"))if(-1!=t.indexOf(o))return!0;return!1}let l={addMonitor:function(e){this._monitors.push(e)},run:function(){for(var e of this._monitors)e.run()},_monitors:[]};class u{constructor(e,t,o,n){this.name=e,this.type=t,this.defaultValue=o,this.assert=null==n?i:n}description(e){if(null==e)return null==this._desc?this.name:this._desc;this._desc=e}}class c extends u{constructor(e,t,o,n){super(e,"select",t[o],n),this.options=t}}let p={number:"数字",text:"文本"};class g extends u{constructor(e,t,o,n){super(e,"input",o,n),this.format=t}}class f{constructor(e,t,o){this.event=e,this.filters=t,this.introdution=o+`
// 如需更多信息，可以到论坛触发器版块发帖。`}getFilter(e){for(var t of this.filters)if(t.name==e)return t;return null}}let h={add:function(e){this._templates[e.event]=e},getAll:function(){return Object.values(this._templates)},get:function(e){return this._templates[e]},_templates:{}};class _{constructor(r,d,u,c){this.name=r,this.template=d,this.conditions=u,this.source=c,this._action=function(e){var t,o,n=m(e);for(t in u)if(u.hasOwnProperty(t)){var s=d.getFilter(t),i=u[t],a=e[t];if(!s.assert(i,a))return;delete n[t]}let l=c;for(o in n)l=`($${o}) = ${n[o]}
`+l;0==/\/\/\s*~silent\s*\n/.test(c)&&(l=`@print 💡<hio>触发=>${r}</hio>
`+l),b.perform(l,r,!1)},this._observerIndex=null}event(){return this.template.event}active(){return null!=this._observerIndex}_activate(){null==this._observerIndex&&null!=this.template&&(this._observerIndex=d.observe(this.template.event,this._action))}_deactivate(){null!=this._observerIndex&&(d.removeOberver(this._observerIndex),this._observerIndex=null)}}class k{constructor(e,t,o,n,s){this.name=e,this.event=t,this.conditions=o,this.source=n,this.active=s}}let y={run:function(){for(var e in GM_getValue(this._saveKey(),{}))this._loadTrigger(e)},reload:function(){for(var e in this._triggers)this._triggers.hasOwnProperty(e)&&(this._triggers[e]._deactivate(),delete this._triggers[e]);this.run()},getAllData:function(){return GM_getValue(this._saveKey(),{})},corver:function(e){for(var t of this.getAll())this.remove(t.name);for(var o in e){o=e[o];this.create(o.name,o.event,o.conditions,o.source,o.active)}},getAll:function(){return Object.values(this._triggers)},create:function(e,t,o,n,s){var i=this._checkName(e);return 1!=i?i:(i=null!=s&&s,s=new k(e,t,o,n,i),this._updateData(s),this._loadTrigger(e),!0)},modify:function(e,t,o,n){var s,i=this._triggers[e];return null==i?"修改不存在的触发器？":(s=i.event(),e==t?(i=new k(t,s,o,n,i.active()),this._updateData(i),this._reloadTrigger(t),!0):(1==(i=this.create(t,s,o,n))&&(this.remove(e),this._loadTrigger(t)),i))},remove:function(e){var t=this._triggers[e];null!=t&&(t._deactivate(),delete this._triggers[e],delete(t=GM_getValue(this._saveKey(),{}))[e],GM_setValue(this._saveKey(),t))},activate:function(e){for(var t in this._triggers){var o;!n(e,t)||null==(o=this._triggers[t])||o.active()||(o._activate(),(o=this._getData(t)).active=!0,this._updateData(o))}},deactivate:function(e){for(var t in this._triggers){var o;n(e,t)&&null!=(o=this._triggers[t])&&o.active()&&(o._deactivate(),(o=this._getData(t)).active=!1,this._updateData(o))}},_triggers:{},_saveKey:function(){return W.id+"@triggers"},_reloadTrigger:function(e){var t=this._triggers[e];null!=t&&t._deactivate(),this._loadTrigger(e)},_loadTrigger:function(e){var t,o=this._getData(e);null!=o&&("新聊天信息"===o.event&&void 0===o.conditions["忽略发言人"]&&(o.conditions["忽略发言人"]=""),t=this._toTrigger(o),this._triggers[e]=t,o.active)&&t._activate()},_getData:function(e){return GM_getValue(this._saveKey(),{})[e]},_updateData:function(e){var t=GM_getValue(this._saveKey(),{});t[e.name]=e,GM_setValue(this._saveKey(),t)},_toTrigger:function(e){var t=h.get(e.event);return new _(e.name,t,e.conditions,e.source)},_checkName:function(e){return null!=this._triggers[e]?"无法修改名称，已经存在同名触发器！":/\S+/.test(e)?!!/^[_a-zA-Z0-9\u4e00-\u9fa5]+$/.test(e)||"触发器的名称只能使用中文、英文和数字字符。":"触发器的名称不能为空。"}};var w,v=null,G=null,x=null,b=null,W=null,C=(w=[new c("改变类型",["新增","移除","层数刷新"],0),new g("BuffId",p.text,"weapon",t),new c("触发对象",["自己","他人"],0)],w=new f("Buff状态改变",w,`// Buff状态改变触发器
// 触发对象id：(id)
// buff的sid：(sid)
// buff层数：(count)
// duration持续时间：(duration)`),h.add(w),w=new e(function(){function n(e,t,o){(o={"改变类型":o,BuffId:t,"触发对象":e.id==W.id?"自己":"他人"}).id=e.id,o.sid=t,o.count=0,o.duration=0,null!=e.count&&(o.count=e.count),null!=e.duration&&(o.duration=e.duration),t=new r("Buff状态改变",o),d.post(t)}v.add_hook("status",e=>{if(null!=e.action&&null!=e.id&&null!=e.sid){var t={add:"新增",remove:"移除",refresh:"层数刷新"}[e.action];if(null!=t)if(e.sid instanceof Array)for(var o of e.sid)n(e,o,t);else n(e,e.sid,t)}})}),l.addMonitor(w),w=[new c("频道",["全部","世界","队伍","门派","全区","帮派","谣言","系统"],0,function(e,t){return"全部"==e||e==t}),new g("发言人",p.text,"",t),new g("忽略发言人",p.text,"",o),new g("关键字",p.text,"",a)],w=new f("新聊天信息",w,`// 新聊天信息触发器
// 聊天信息内容：(content)
// 发言人：(name)
// 发言人id：(id)
// 频道：(channel)`),h.add(w),w=new e(function(){v.add_hook("msg",e=>{var t,o,n,s;null!=e.ch&&null!=e.content&&null!=(t={chat:"世界",tm:"队伍",fam:"门派",es:"全区",pty:"帮派",rumor:"谣言",sys:"系统"}[e.ch])&&(o=null==e.name?"无":e.name,n=null==e.uid?null:e.uid,s=e.content.replace(/\n/g,""),(e={"频道":t,"发言人":o,"关键字":e.content,"忽略发言人":o}).content=s,e.name=o,e.id=n,e.channel=t,s=new r("新聊天信息",e),d.post(s))})}),l.addMonitor(w),(w=new g("人物名称",p.text,"",a)).description("人名关键字"),w=new f("人物刷新",w=[w],`// 人物刷新触发器
// 刷新人物id：(id)
// 刷新人物名称：(name)`),h.add(w),w=new e(function(){v.add_hook("itemadd",e=>{var t;null!=e.name&&null!=e.id&&((t={"人物名称":e.name}).id=e.id,t.name=e.name,e=new r("人物刷新",t),d.post(e))})}),l.addMonitor(w),w=[new g("名称关键字",p.text,"",a)],w=new f("物品拾取",w,`// 物品拾取触发器
// 拾取物品id：(id)
// 拾取物品名称：(name)
// 拾取物品数量：(count)
// 物品品质：(quality)  值：白、绿、蓝、黄、紫、橙、红、未知`),h.add(w),w=new e(function(){v.add_hook("dialog",function(e){var t;"pack"==e.dialog&&null!=e.id&&null!=e.name&&null!=e.count&&null==e.remove&&((t={"名称关键字":e.name}).id=e.id,t.name=e.name,t.count=e.count,e=/<\w{3}>/.exec(e.name)[0],t.quality={"<wht>":"白","<hig>":"绿","<hic>":"蓝","<hiy>":"黄","<HIZ>":"紫","<hio>":"橙","<ord>":"红"}[e],e=new r("物品拾取",t),d.post(e))})}),l.addMonitor(w),w=[new g("关键字",p.text,"",a)],w=new f("新提示信息",w,`// 新提示信息触发器
// 提示信息：(text)`),h.add(w),w=new e(function(){v.add_hook("text",e=>{var t;null!=e.msg&&((t={"关键字":e.msg}).text=e.msg,e=new r("新提示信息",t),d.post(e))})}),l.addMonitor(w),w=[new c("类型",["进入战斗","脱离战斗"],0)],w=new f("战斗状态切换",w,"// 战斗状态切换触发器"),h.add(w),w=new e(function(){v.add_hook("combat",e=>{let t=null;null!=e.start&&1==e.start?t={"类型":"进入战斗"}:null!=e.end&&1==e.end&&(t={"类型":"脱离战斗"});e=new r("战斗状态切换",t);d.post(e)}),v.add_hook("text",function(e){null==e.msg||-1==e.msg.indexOf("只能在战斗中使用")&&-1==e.msg.indexOf("这里不允许战斗")&&-1==e.msg.indexOf("没时间这么做")||(e={"类型":"脱离战斗"},e=new r("战斗状态切换",e),d.post(e))})}),l.addMonitor(w),w=[new c("类型",["已经死亡","已经复活"],0)],w=new f("死亡状态改变",w,"// 死亡状态改变触发器"),h.add(w),w=new e(function(){v.add_hook("die",e=>{e={"类型":null==e.relive?"已经死亡":"已经复活"},e=new r("死亡状态改变",e);d.post(e)})}),l.addMonitor(w),w=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59],w=[new c("时",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],0,i),new c("分",w,0,i),new c("秒",w,0,i)],w=new f("时辰已到",w,"// 时辰已到触发器"),h.add(w),w=new e(function(){!function e(){var t=new Date,t={"时":t.getHours(),"分":t.getMinutes(),"秒":t.getSeconds()},t=new r("时辰已到",t),t=(d.post(t),Date.now()),o=1e3*parseInt((t+1e3)/1e3)+1;setTimeout(()=>{e()},o-t)}()}),l.addMonitor(w),w=[new g("技能id",p.text,"",t)],w=new f("技能释放",w,`// 技能释放触发器
// 技能id：(id)
// 出招时间：(rtime)
// 冷却时间：(distime)`),h.add(w),w=new g("技能id",p.text,"",t),w=new f("技能冷却结束",w=[w],`// 技能冷却结束触发器
// 技能id：(id)`),h.add(w),w=new e(function(){v.add_hook("dispfm",o=>{var e;null!=o.id&&null!=o.distime&&null!=o.rtime&&((e={"技能id":o.id}).id=o.id,e.rtime=o.rtime,e.distime=o.distime,e=new r("技能释放",e),d.post(e),setTimeout(e=>{var t={"技能id":o.id},t=(t.id=o.id,new r("技能冷却结束",t));d.post(t)},o.distime))})}),l.addMonitor(w),{});w=[new g("人名关键字",p.text,"",a),new c("类型",["气血","内力"],0,i),new c("当",["低于","高于"],0,i),new c("值类型",["百分比","数值"],0,i),new g("值",p.number,0,function(e,t){var t=t.split(";"),o=parseFloat(t[0]),t=parseFloat(t[1]);return e<=o&&t<e||o<=e&&e<t})],w=new f("气血内力改变",w,`// 气血内力改变触发器
// 人物id：(id)
// 人物当前气血：(hp)
// 人物最大气血：(maxHp)
// 人物当前内力：(mp)
// 人物最大内力：(maxMp)`),h.add(w),w=new e(function(){v.add_hook("items",e=>{if(null!=e.items){C={};for(var t of e.items)C[t.id]=m(t)}}),v.add_hook("itemadd",e=>{C[e.id]=m(e)});function l(e,t){e.id=t.id,e.hp=t.hp,e.maxHp=t.max_hp,e.mp=t.mp,e.maxMp=t.max_mp}v.add_hook("sc",t=>{if(null!=t.id){var o=C[t.id];if(null!=o){if(null!=t.hp){let e="低于";t.hp>o.hp&&(e="高于");var n=o.hp,s=(o.hp/o.max_hp*100).toFixed(2),i=(o.hp=t.hp,o.max_hp<o.hp&&(o.max_hp=o.hp),null!=t.max_hp&&(o.max_hp=t.max_hp),o.hp),a=(o.hp/o.max_hp*100).toFixed(2),s={"人名关键字":o.name,"类型":"气血","当":e,"值类型":"百分比","值":s+";"+a},a=(l(s,o),new r("气血内力改变",s)),s=(d.post(a),{"人名关键字":o.name,"类型":"气血","当":e,"值类型":"数值","值":n+";"+i}),a=(l(s,o),new r("气血内力改变",s));d.post(a)}if(null!=t.mp){let e="低于";t.mp>o.mp&&(e="高于");n=o.mp,i=(o.mp/o.max_mp*100).toFixed(2),s=(o.mp=t.mp,o.max_mp<o.mp&&(o.max_mp=o.mp),null!=t.max_mp&&(o.max_mp=t.max_mp),o.mp),a=(o.mp/o.max_mp*100).toFixed(2),t={"人名关键字":o.name,"类型":"内力","当":e,"值类型":"百分比","值":i+";"+a},i=(l(t,o),new r("气血内力改变",t)),a=(d.post(i),{"人名关键字":o.name,"类型":"内力","当":e,"值类型":"数值","值":n+";"+s}),t=(l(a,o),new r("气血内力改变",a));d.post(t)}}}})}),l.addMonitor(w),w=[new g("人名关键字",p.text,"",a),new c("值类型",["百分比","数值"],0,i),new g("值",p.number,0,(e,t)=>{var t=t.split(";"),o=parseFloat(t[0]),t=parseFloat(t[1]);return o<=e&&e<t})],w=new f("伤害已满",w,`// 伤害已满触发器
// 备注：限制条件-值 不支持多条件
// 人物id：(id)
// 人物名称：(name)
// 伤害数值：(value)
// 伤害百分比：(percent)`),h.add(w),w=new e(function(){function i(e,t,o,n){e.id=t.id,e.name=t.name,e.value=o,e.percent=n}v.add_hook("sc",e=>{var t,o,n,s;null!=e.id&&null!=e.damage&&null!=(t=C[e.id])&&null!=t.id&&null!=t.name&&null!=t.max_hp&&(s=null==t._damage?0:t._damage,n=null==t._damagePer?0:t._damagePer,o=((e=e.damage)/t.max_hp*100).toFixed(2),t._damage=e,t._damagePer=o,n={"人名关键字":t.name,"值类型":"百分比","值":n+";"+o},i(n,t,e,o),n=new r("伤害已满",n),d.post(n),n={"人名关键字":t.name,"值类型":"数值","值":s+";"+e},i(n,t,e,o),s=new r("伤害已满",n),d.post(s))})}),l.addMonitor(w);let S={append:function(e){G(e)},clean:function(){x()}},z={triggerHome:function(){z._appendHtml("🍟 <hio>触发器</hio>",`
            <style>.breakText {word-break:keep-all;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}</style>
            <span class="zdy-item" style="width:120px" v-for="t in triggers" :style="activeStyle(t)">
                <div style="width: 30px; float: left; background-color: rgba(255, 255, 255, 0.31); border-radius: 4px;" v-on:click="editTrigger(t)">⚙</div>
                <div class="breakText" style="width: 85px; float: right;" v-on:click="switchStatus(t)">{{ t.name }}</div>
            </span>
            `,"<span v-on:click='createTrigger()'><wht>新建</wht></span>"),new Vue({el:"#app",data:{triggers:y.getAll()},methods:{switchStatus:function(e){e.active()?y.deactivate(e.name):y.activate(e.name),z.triggerHome()},editTrigger:z.editTrigger,activeStyle:function(e){return e.active()?{"background-color":"#a0e6e0",border:"1px solid #7284ff",color:"#001bff"}:{}},createTrigger:z.selectTriggerTemplate}})},selectTriggerTemplate:function(){z._appendHtml("<wht>选择触发事件</wht>",`
            <span class="zdy-item" style="width:120px" v-for="t in templates" v-on:click="select(t)">{{ t.event }}</span>
            `,null,"<span v-on:click='back()'>< 返回</span>"),new Vue({el:"#app",data:{templates:h.getAll()},methods:{select:z.createTrigger,back:z.triggerHome}})},createTrigger:function(e){z._updateTrigger(e)},editTrigger:function(e){z._updateTrigger(e.template,e)},_updateTrigger:function(t,o){let e="<span v-on:click='save'><wht>保存</wht></span>",n=(o&&(e="<span v-on:click='remove'>删除</span>"),"<span v-on:click='back'>< 返回</span>"),s=(o&&(n="<span v-on:click='saveback'>< 保存&返回</span>"),z._appendHtml(`<input style='width:110px' type="text" placeholder="输入触发器名称" v-model="name">`,`
            <div style="margin:0 2em 0 2em">
                <div style="float:left;width:120px">
                    <span class="zdy-item" style="width:90px" v-for="f in filters">
                    <p style="margin:0"><wht>{{ f.description() }}</wht></p>
                    <input v-if="f.type=='input'" style="width:80%" v-model="conditions[f.name]">
                    <select v-if="f.type=='select'" v-model="conditions[f.name]">
                        <option v-for="opt in f.options" :value="opt">{{ opt }}</option>
                    </select>
                    </span>
                </div>
                <div style="float:right;width:calc(100% - 125px)">
                    <textarea class = "settingbox hide" style = "height:10rem;display:inline-block;font-size:0.8em;width:100%" v-model="source"></textarea>
                    <span class="raid-item shareTrigger" v-if="canShared" v-on:click="share()">分享此触发器</span>
                </div>
            </div>
            `,e,n),{});if(null!=o)s=o.conditions;else for(var i of t.filters)s[i.name]=i.defaultValue;let a=t.introdution;null!=o&&(a=o.source),new Vue({el:"#app",data:{filters:t.filters,name:o?o.name:"",conditions:s,source:a,canShared:null!=o},methods:{save:function(){var e=y.create(this.name,t.event,this.conditions,this.source);1==e?z.triggerHome():alert(e)},remove:function(){confirm("确认删除此触发器吗？")&&(y.remove(o.name),z.triggerHome())},back:function(){z.selectTriggerTemplate()},saveback:function(){var e=y.modify(o.name,this.name,this.conditions,this.source);1==e?z.triggerHome():alert(e)},share:function(){b.shareTrigger(y._getData(o.name))}}})},_appendHtml:function(e,t,o,n){n=`
            <div class = "item-commands" style="text-align:center" id="app">
                <div style="margin-top:0.5em">
                    <div style="width:8em;float:left;text-align:left;padding:0px 0px 0px 2em;height:1.23em" id="wsmud_raid_left">${null==n?"":n}</div>
                    <div style="width:calc(100% - 16em);float:left;height:1.23em">${e}</div>
                    <div style="width:8em;float:left;text-align:right;padding:0px 2em 0px 0px;height:1.23em" id="wsmud_raid_right">${null==o?"":o}</div>
                </div>
                <br><br>
                ${t}
            </div>`;S.clean(),S.append(n)}},j={get:function(){let t={};return GM_listValues().forEach(e=>{"roles"!=e&&(t[e]=GM_getValue(e))}),t},set:function(e){for(var t in e)GM_setValue(t,e[t]);y.reload()}},T=!1;function M(){v=unsafeWindow.WG,G=unsafeWindow.messageAppend,x=unsafeWindow.messageClear,b=unsafeWindow.ToRaid,null==v||null==b?setTimeout(()=>{M()},300):(W=unsafeWindow.Role,unsafeWindow.TriggerUI=z,unsafeWindow.TriggerConfig=j,unsafeWindow.TriggerCenter=y,v.add_hook("login",function(e){T||(T=!0,y.run(),l.run())}))}$(document).ready(function(){M(),null!=v&&null!=b||setTimeout(M,300)})}();